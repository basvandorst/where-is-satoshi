@_author: dgpv
@_date: 2018-09-30 06:41:23
The QR codes with encrypted privkeys can even be transferred via open channels, provided that the value on the address corresponding to the privkey is not too large.
Like, top manager have some qr codes in his wallet, and if the need arise, just snap a picture of one, and send to an employee via message app. Employee shows qr code on his phone to the camera, and it entered into the system.
Only signer node can decrypt the privkey, so there's little risk in sending it via open channel.
If someone steals encryption key used by the signer node, he can steal the amount of the top-up, but will reveal himself that way.
Or someone might steal a wallet from top manager to get his hands on more qr codes, but it is much more complex to perform - you need to both to get encryption key used by signer node, and target the top manager. And the top manager probably only need a ten or so qr codes in his wallet, so it also won't be a huge sum.
@_date: 2018-09-30 20:52:45
the privkeys on paper wallets are encrypted in the proposed scheme, and employees do not have access to decryption keys (unless they can hack into signer node)
even if they somehow know the decryption keys (someone takes over the signer node _and_ bribe the employee), they still have to circumvent the administrative restrictions, to have access to more qr codes than strictly necessary. and protecting papers with qr codes is the same as protecting paper money, or confidential paper documents - all the procedures for that are developed and tested decades or centuries ago.
And if an employee decides to steal from just one paper wallet, this will be immediately visible. One paper wallet holds only small sum (like, 1btc), and because the addresses on these paper wallets are not reused, knowing private key only gives access to this sum, and nothing more.
@_date: 2018-09-29 21:03:33
you can use this with multisig - you'll just need several employees to scan several keys of one address, to increase spendable balance.
@_date: 2018-09-29 13:16:48
You use an offline pc to sign transaction from cold storage, yes. This is about hot-wallet top-up. What is not safe with this ? Encrypted keys in the envelopes in the safe are effectively 'cold'. (edit: and you do NOT reuse these addresses! one address = one UTXO)
You can use pre-signed txs to top-up the hot wallet without involving high management, but it will be a transaction that will be broadcast at the time of hot wallet top-up, will be visible in blockchain, and you have to pay the fees that are in effect when you do your top-up, ~~therefore~~ while with our scheme, you can choose the lower-fee time to distribute the funds to these addresses.
Also doing top-up with a realtime transaction means that it will be more slow - you have to wait for confirmation, or send 0-conf coins, which is not always desirable.
@_date: 2018-09-17 06:02:25
I wonder why wallet developers do not implement the obvious solution here - just allow to send a payment in several transactions ? We implemented this in our payment engine, it wasn't too diffictult.
Is it deemed too confusing to the general user ? Some services expect to get a payment in one transaction, but user may have an option to just choose, in the event that there's too many UTXO - send as several transactions or consolidate.
Probably just not a lot of average users have large UTXO sets, and big players know how to consolidate UTXO periodically, so the problem is not very visible. But I think bitcoin's UX will improve if there is such an option in user wallets.
@_date: 2019-03-12 09:50:45
Cross-chain atomic swaps have a free option problem [1]: one side can opt out of the deal by allowing it to time out, and thus have an advantage - watch the price of asset and decide if it is profitable to execute the swap or let it timeout.
Atomic swaps that is done on the same chain within a single transaction do not have this problem, because there is no timeout involved
Edit: no *long* timeout involved with same-chain atomic swap.
In same-chain atomic swap, sides can opt out of the swap at the last minute: by double-spending own inputs, or by not broadcasting the transaction. Side that has final tx still have tiny advantage: can watch asset prices while testing other side's patience to not double-spend.
But for this to be relevant, I guess asset prices have to be extremely volatile.
Asset swap software have to include the functionality for the participant that does not possess the final signed tx to double-spend their inputs after short timeout.
[1] 
@_date: 2019-03-13 11:30:06
Correct. Cross-chain different-asset swaps
@_date: 2019-03-12 11:12:46


I guess this is a question for blockstream, since they are the developers and maintainers of Liquid. I only have interest in this tech and recently implemented support for Elements sidechain in python-bitcointx library [1] - since can answer some questions regarding it.
MAX_BLOCK_WEIGHT is indeed 4M in Liquid:  but confidential transactions is quite a lot bigger in size than non-confidential ones.
Since the system is not decentralized, but federated, coordinating changes to the protocol should be faster - you probably can call some meeting for the participants and decide on the solution.
Since there is no proof of work involved, there no serious pressure for the fees to go significantly up - the functionaries only have the costs of maintaining their nodes and related things (there's hardware security modules involved somehow, but I do not remember the details)
[1] 
@_date: 2019-03-12 08:16:43
- confidential transactions (values and assets are blinded to those who do not posses the blinding key)
- assets are native to the protocol, no need to write custom contracts in turing-complete script and spend a lot of resources to audit these contracts
- not only bitcoin's stable network as a peg, but bitcoin's stable tech in general. Simple non-turing-complete scripts which is possible to exhaustively analyze. Will be even simpler to build and analyze with [miniscript](
- Since assets are native, atomic swaps of assets within the network are simple cooperatively signed transactions, which can also swap multiple assets in one transaction (similar to EIP875, I suppose, but do not require any contract code - can be done with simple single-sig addresses)
@_date: 2019-03-12 20:56:01
yes. you could create a service that would match those willing to swap and build swap transactions for them to collectively sign. broadcasting such transactions would atomically redistribute assets to new owners
It may be possible to actually make atomic swap of btc with tether on bitcoin blockchain. As far as I remember, omni protocol rules allow extra inputs/outputs in addition to omni-protocol-required ones. This could be used to build collectively-signed tx that sends tether to one address, and btc to another. Problem here that if you make a coding mistake and mess up the format of the omni protocol part of the tx, tx will be accepted and confirmed, btc will move, but tether will not.
@_date: 2019-03-12 09:56:27


Consider the case with two stablecoins: if they exist as assets on the same network (say japanese yen and mexican peso), you can swap them without exchanging them to any intermediary currency like USD (I believe this is how it is done today in the fiat world). This is where companies that need to have operational assets in different currencies across the world lose money.
You still need to find someone willing to swap though, so there need to be some platform to match the participants. But you can do multiple swaps in one transaction, if there are more than two participants - still atomic.
@_date: 2018-10-03 04:10:55
Creating our own thing is an option, but that would mean fragmentation of efforts, and global bitcoin efficiency will not be as good as if the efforts were consolidated.
@_date: 2018-10-22 18:11:08
That's cool. It is good that they show the addresses, too, because the fingerprint by itself is not enough.
There might be collisions - the fingerprint algorithm might not be suitable to represent all 160bits of bitcoin address.  A hash function will be used, with the output of smaller size, to match the possible number of variations for the fingerprint.
Both visual fingerprint and the address should be checked.
The good thing is that similar-looking addresses will have very distinct fingerprints, and if two addresses have the same fingerprint, the addresses themselves will differ significantly.
@_date: 2018-10-03 07:10:25
Yes, let's chat, I'll send you a DM.
I must note, however, that our crypto-payment engine is source-available for customers, but not open-source. Anyway, I am open to any cooperation that may benefit the crypto ecosystem.
@_date: 2018-10-11 07:38:17
You can put seed phrase for xprivkey on [cryptosteel ]( You cannot put 32 megabytes on cryptosteel.
@_date: 2018-10-03 15:03:12
It can also save an exchange from the need to send a transaction from cold storage directly to top-up a hot wallet: 
Or from instant drain of hot wallet by hackers or malicious employees, with Money flow limits (described at  and 
@_date: 2018-10-03 11:07:26
We work with 'payment orders' that we bundle into transactions (like this: 
When a bunch of orders are processed, those that have the same source (source might be a wallet in the system, or a single address, a group of tagged UTXOs, HD-derived chain of addresses, or a tree of HD-derived chains) - can be bundled together in one transaction - that will have one output per payment order, and probably a change output.
We won't bundle, by default, two orders with the same destination address - because some systems get confused when they receive transaction with two outputs to the same address)
The whole point of the organic UTXO consolidation is not to send the cheapest possible transaction - that would result in quick accumulation of large quantities of small UTXO - but to create transactions that are within an acceptable range for 'fee per full coin' - to reduce overall fee paid over long periods of operation.
RBF is currently being implemented, but I don't think we will conflate RBF and initial coin selection - it will complicate things too much.
@_date: 2018-10-10 19:52:27


It does not matter if the keys are derived from xpriv or generated from random and placed into database - the point Bryan Bishop makes in his talk is that if you are using a key (or a bunch of keys) for too long, you better stop using them - it is like changing your password periodically.  
@_date: 2018-10-10 19:38:51


OK, as you say.
Should they reuse their addresses, too, then ?
@_date: 2018-10-24 04:14:22


Base58-encoded address already has a [checksum of 4 bytes]( and it is at the end. So it is harder (but not impossible) to find a collision for both first and last digits. 4 bytes is 6 characters in base58, so to be sure, you need to check 6 characters at the end. I think most people's minds will be too lazy to always check all 6 chars :-)
@_date: 2018-10-24 03:32:48


maybe the visual representation can even be fused with the textual. At the simplest, we could apply bold and italic in a pattern that is based on the hash of the address. It will look like this:
a slightly different address will have completely different hash, and the pattern of bold and italics, based on this hash, will also be very different.
We could add some separating characters as another factor to visually distinguish the addresses, like
or, if we use two separating characters,
bit I'm not sure if it makes it more difficult to read and compare with 'non-styled' address
It could be more factors than bold and italics, but these are the most universally supported text styles.
@_date: 2018-10-11 07:30:09


It makes the same sense as changing your passwords, periodically - you may not know if the keys are stolen, but thief just waits till you have a bigger sum on your addresses
@_date: 2018-10-11 07:27:42
backup of one xprivkey can be done much easier and secure, than a backup of 1 million keys (say you have 100k users and each have generated 10 deposit addresses, on average) 
@_date: 2018-10-24 03:47:34
It wouldn't help against the address being replaced in-transit, but it could help against the address being replaced in clipboard.
The malware will have to edit the application window, too, to replace not only the address in the clipboard, but the address as it shown on the page/conversation window.
The bold/italics/separators mask could be sent as a second factor for checking.
@_date: 2018-10-10 19:29:23
Ordinary people can simply send their funds to new keys in one sweep with ordinary wallet software. This is for big wallets (exchanges, custodians, etc.), where moving to new key setup rapidly may be too costly or inconvenient -- both for the service and their users  -- no need to tell users "please do not not send to these old addresses" (edit: well, there's still a need to tell, but it does not become a big problem if a user still occasionally sends to old address)
Edit: to cliarify: big wallets in that they may have a lot of UTXO, and a lot of addresses (many addresses per user)
@_date: 2018-10-03 03:57:20
The problem is they seem to be a closed club - I asked John Newbery by email about joining their workshops, and he said that it is only for member companies and opensourse contributors. Then I asked how we can become a member company (or if supplying patches to popular bitcoin library count as opensource contribution), and haven't received *any* answer since (its been two weeks). It leads me to believe they are not interested in open discussion, and only interested in sharing the technology inside a closed club of incumbents.
Edit: finally, I got the response. The requirements for member companies are reasonable.
@_date: 2018-10-23 12:56:45


The danger here is that human mind is inherently lazy (an evolutionary adaptation, that gives the ability to conserve the energy used by the brain)
If the visual representation is emphasized as the main one, and not just as a tool for checking, people may adopt a habit of only looking at the avatar, and skip the address itself.
This may create a situation that is worse than without avatars.
I think the address should still be the main thing that is checked, and the visual fingerprint should be a way to assist the check, not replace it. The UX should not create conditions for people to forgo that check, habitually
@_date: 2019-10-05 11:04:06
If I remember correctly, to spend your portion of the bag, you create an output that pays you, and another output that is the new 'bag' where the set of the possible spenders is the same as in the UTXO you are spending, but without you.
A freeloader can broadcast a spend transaction with a low fee, and then while that transaction is in the mempool, those who need their portion of the bag now, would need to use the 'bag' output of the freeloader transaction, and thus will need to pay for it, too.
There can be even a chain of such freeloaders.
Do you think this can be a problem ?
@_date: 2019-10-05 17:37:25
Ah, I see. My incorrect understanding from the prior readings about this (I didnt read this exact article at first) was a degenerate case of the 'tree' scheme described in the article, where one branch would contain a single destination, and other would contain all the other destinations.
I see now that in the simple case (no chain/tree), the one who needs the money the most, pays for all, and all others can be 'freeloaders', by design.
In the chained scheme, though, the described problem seem to still exist. The receivers from each 'half' can transmit the transaction to claim their half first, and then the receivers from other 'half' will need to use the output of that transaction. If this first transaction is broadcasted with small fee, the receivers from the second half (who need money immediately) will need to pay for both their transaction, and for the transaction sending money to the other half.
@_date: 2019-02-19 12:32:16
Not if the supply chain attack is targeted - only the target person will receive the 'evil' hw wallet. 
@_date: 2019-02-19 08:43:28


Then user have to take this message and hash it independently to recreate xpriv and cross-check it with the addresses/xpubkey presented by hardware wallet ?
If there's another device involved to cross-check, the user can just re-create xprivkey from mnemonic on this device, and then cross-check with what hw wallet gives out
@_date: 2019-02-19 08:53:00
And btw, the compromized hw wallet may give out first few addresses derived from correct xpriv, but then switch to different xpriv. The host software should check with xpub (but can only do so for non-hardened derivation)
@_date: 2019-02-20 06:10:34
I'm not sure about 'never leaves the device' approach - you have to be able to do back up your key - or you can lose it if the device malfunctions.
Or the evil firmware might hold your master key hostage and demand ransom to release your own bitcoin
@_date: 2019-06-04 22:00:26


The malicious entity can just 'filter' though its own keys as much UTXO as possible, trading them or coinjoin-ing them inside this system or somehow otherwise be a transient owner of as much UTXO it can lay its 'hands' on.
Since the UTXO is secured by &lt;entity key&gt; + &lt;any of the preivious owners key&gt;, that malicious entity then can steal all the coins it 'filtered through' its 'stealing' keys.
It is somewhat mitigated by the multisig federation.
But if the UTXOs is mostly circulating within this system and rarely go on-chain, then this scenario becomes plausible.
@_date: 2019-02-19 16:49:19
sign-to-contract commitments: 
@_date: 2019-12-27 07:44:07
noticed a bug in PSBT outputs decoding, pushed v1.0.2.post0 release
@_date: 2019-04-15 16:00:47
Still not clear to me, can you please check if I understood correctly:
This is like, 'always aggregate' mode, where you always try spend every UTXO you have, to get a single big one in change. A chain/package of unconfirmed txs still can happen, but this allows for simplified handling of these unconfirmed tx packages.
@_date: 2019-04-02 11:26:41
Agreed. This is not for end users, but for custodial services, or other institutions that need to have both cold storage and active hot wallets
@_date: 2019-04-15 13:23:35


You mean maintain a single unconfirmed transaction by adding new inputs/outputs and RBF-ing the 'old' one ?
There's subtleties with adding new inputs, because there's no guarantee that the 'new', and not the 'old' transaction will actually confirm. Transaction being replaced in mempool of your node does not mean it was replaced in the mempool of the miner's node. Even if the 'new' transaction gets confirmed, it may still be un-confirmed and replaced with 'old' one, in a reorg. After 'old' tx was confirmed instead of 'new', you will need to hold this now-unused UTXO (present in 'new', not present in 'old) in a 'locked' state - you cannot spend them until the potential reorg is 100% resolved, or the complexity to handle possible states will be even larger.
@_date: 2019-04-15 05:24:47
You wait, or spend your unconfirmed change.
Before third-party transaction malleability was fixed on Bitcoin, spending your own unconfirmed UTXO could lead to inconvenient complications if txid of the parent unconfirmed tx suddenly changed by someone other than you. Now this is impossible, so the problems with spending unconfirmed UTXO is now in:
- If you create a chain of unconfirmed txs, and this chain is too long, new transactions for that chain won't be accepted to mempool
- If you need to bump the fee for such a chain of unconfirmed transactions (actually, a it might be a tree, not a chain), you have to consider the whole 'package' of unconfirmed transactions, not just them individually.
If you are to spend just one unconfirmed UTXO, and not pile up other UTXO on top of it, managing that would be simple.
To manage packages of unconfirmed transactions and the complexity of bumping fee on the packages, the software to handle that should be sophisticated enough.
Or you could just prepare a bunch of confirmed UTXO ready to instantly add to your hot wallet in this situation (like in granular cold storage scheme:  and use them if the situation is going out of hand.
"a *majority* of their funds are stuck in change" would mean they do not separate hot and cold wallet, and this is generally a serious mistake for this type of services (unless they operate completely out of offline wallet, but then their payouts will be rare and will not be subject to unconfirmed change problem)
@_date: 2018-11-07 10:06:33
Thank you for clarification.


I missed that bit, and could not find the description of the process for peg-out in the documentation on their website. Did not have the time yet to dig into the source. (Edit: found it:   page 8, "Peg-out authorization")


So, the peg-out is possible only to the member's addresses. That's good for preventing stolen funds outflow. It also means that the peg-out is not automatic, from the point of view of non-federation-member participant, and all peg-outs will need to go through an exchange. The peg-outs will also require offline signing on the part of an exchange (as per the strong-federations paper linked above). This probably will be done in a batched and scheduled way.
Looks like the '[2 minutes to peg-out]( is only technically (the best kind of) correct :-) 
@_date: 2019-01-07 04:11:28
Internet is pretty mutable.
And as verifiable as a wikipedia article
@_date: 2018-11-07 09:00:22
I have a question about peg-out easiness from liquid to bitcoin, and potential hot wallet hacks.
As I understand, current peg-out process requires [only 2]( liquid network confirmations (so, 2 minutes), and is automated.
People can use CHECKSIGFROMSTACK to create covenants, but it would be mostly useful only for cold-storage.
Probably some L-BTC hot wallets will still be large enough to be the target of attacks, either out of necessity because of large volume, or because of carelessness.
Considering that the watchmen are a part of the federation, in an event of large-scale and publicized hack, they could have the power to prevent the peg-out of the stolen L-BTC, if the time required between requesting the peg-out and actual release of bitcoin would be longer. Peg-in requires 102 bitcoin blocks, equally long peg-out probably would not be too bad.
Were this concerns considered when choosing to make peg-out fast ?
Is there other measures that can be utilized with Liquid to mitigate L-BTC hot wallet hacks, other than the measures that are already used to protect bitcoin hot wallets ?
Creating a covenant that only allows to send to known exchange addresses ? But that may hit 520 bytes script limit with big enough list of addresses, and requires address reuse. If the target exchanges are quick to process deposits and withdrawals, that might still not prevent the sending of stolen funds to peg-out to bitcoin.
@_date: 2019-01-06 19:46:30
That's too absolute. Fairly good robustness, practical immutability after certain threshold, good censorship resistance, highly verifiable. This is still a unique combination that no other global system that I can think of has achieved yet.
@_date: 2018-11-07 14:29:13
Thanks for the answer. Now I see the picture more clearly.
Ordinary Liquid users will probably not be using the peg-in, and definitely will not use peg-out functionality. They will just exchange BTC to L-BTC an back via, well, an exchange.
2-minute peg-out will indeed be useful for exchanges that are Liquid members, as they can quickly peg-out L-BTC to their cold BTC wallet, and then process big BTC withdrawal, for example.
@_date: 2018-11-07 14:42:45
The one risk that I see in this, is that the compromise of the peg-out keys of one member exchange (via physical attack, blackmail, etc.) will create a one-time gateway to quickly send stolen L-BTC to bitcoin blockchain.
That is probably not very large risk.
But some Liquid users may get careless, and start to hold extra large balances in L-BTC hot wallets "it is convenient, and hackers cannot peg-out of L-BTC anyway"
It may create an incentive for physical attack on the member exchanges to get hold of peg-out keys. The attacked exchange itself may not be large, and might not be the interesting target of attack (in terms of money held) itself. But such exchange will probably not have the same level of physical security as the large exchange.
This is a factor that I think should play significant role in what exchanges can become the members. This is most likely already considered and strict requirements are enforced. Smaller exchanges will need to work as 'second tier' players, and make L-BTC -&gt; BTC withdrawals  through large ones.
@_date: 2019-05-08 11:22:20
It was a single transaction. With unusually large amount. It should have drawn scrutiny, before it was signed.
Account limits may protect the individual accounts, but if attacker controls many accounts, or have direct access to the wallet API, it will be bypassed, as it apparently was.
The attempt to sign the transaction that spends unusually large amount (or unusually many transactions with smaller amounts in a short period of time) should raise an alarm. This is velocity limits. Many companies have implemented this, this is quite manageable engineering task, especially if your potential losses are in tens of millions.
There is also no need to hold that large amount in the hot wallet - if granular cold storage scheme is implemented, hot wallet balance can be increased instantly by manual action of the employee (scan the key for UTXO). Binance seem to already sending UTXOs of 100 btc to that address after consolidation. To top-up the hot wallet for 7k btc in granular cold storage scheme, they would need to manually add 70 keys - and that should raise a suspicion.
They could also have used different wallets for different sums of withdrawals. Smaller withdrawals (still with velocity control) go from single-sig wallet, larger withdrawals go from the multisig wallet that requires manual signing and review by more than one person. For clients who do frequent large withdrawals, destination address whitelisting can be done (via xpubs).
@_date: 2019-05-08 05:18:39
7k btc withdrawal tx should have drawn scrutiny before being signed.
Sensible warm wallet setup with velocity limits, granular cold storage, or tiered wallets would have prevented such big loss.
Unless 7k btc at once is normal everyday withdrawal tx for them, it should not pass velocity limits.
@_date: 2018-12-10 03:38:19


@_date: 2019-05-08 09:14:59
Biggest recent withdrawal tx from that address is ~439 BTC.
Usually it is much smaller, less than 100.
7k does not seem normal.
@_date: 2018-12-02 11:26:56


Note that you cannot *send* a time-locked transaction just after you created it.
You have to store it yourself, or give it to others to store, and wait until time lock expires.
After the time lock expires, it can be broadcast and will be accepted by the network.
@_date: 2019-05-08 05:00:41
Their database could have been stolen.  If their API keys were not hashed, getting db with keys to generate 2fa codes and API keys would enable access to all accounts in that db. If 2fa via google auth, AFAIR the code that is generated on the device is just compared with the code generated from the same key at the server (with some time leeway).
@_date: 2019-05-08 04:52:25


Attacks could have also targeted the employees, who may have access to internal databases.
@_date: 2018-12-30 14:55:47


There's more to test, besides BIP32 standard test vectors.
Max allowed derivation depth is 255 - you might want to [test for it](
Supplied child number may exceed 32-bit integer - you might also want to [test for this condition](
The underlying privkey or pubkey of xpub/xpriv may happen to be invalid ([test-vector-xprv](
The tests can only detect the presence of bugs, but not their absence. They are not a substitute for code review. 
Good thing is that opensource libs get a chance to have more reviewers.
People, please review more code of the projects yor use! Good chance you'll learn something new, and even in cases when you happen to be wrong in thinking that some code is incorrect, reporting it may nevertheless help to [improve]( project code correctness.
@_date: 2019-05-09 15:23:29
Users of the exchange most likely want to use the funds that they withdraw immediately, and not wait for one week.
There exist a number of methods to make the wallet less 'hot' - often referred as 'warm' wallets. Implementing them 
is quite manageable engineering task, especially if your potential losses are in tens of millions. Apparently this is not always seen as priority, as this is not generating revenue. In traditional industries, such decisions are often offset by insurance, but as getting insurance against theft is difficult, if not impossible, for crypto exchanges, paying for more engineering effort towards securing their hot (and cold) wallets should make economic sense.
Usually, 'warm' wallet setup involves a highly secure computing device of some sort - [hardware security module]( or secure server that connects to the main system only through TOR, and only few people know its location, etc. 
The signing of the transactions would happen on these secure devices, and limits would be enforced by the code that examines the transaction before signing.
The complexity of limit policy may vary, but the most obvious one is simple velocity control - track current 'speed' of money outflow, refuse to sign and raise alarm if signing the transaction would make the 'speed' exceed the limit of X satoshi/second.
This will not prevent the case where funds are slowly siphoned from the hot wallet, but will prevent sudden large-scale theft.
More complex policy would use historical data on typical funds outflow and would adjust current limits accordingly, so that, for example, the limits will be less on weekends when there are no activity, etc. This would make siphoning the funds more difficult, as there will be less 'windows' when real withdraw bandwith is much less than the limit.
Overriding the policies would require manual intervention, and lower-level employees can be given pre-signed commands that would allow to raise the limits temporarily, but not too much.
Holding large amounts in the hot wallet is not necessary in the first place, as there are method to increase balance instantly, if legitimate need arise. I call it '[granular cold storage]( scheme. It works by holding pre-distributed amounts of bitcoin in UTXOs of convenient size, each UTXO at its own address. When the need arise, keys for that addresses are entered into the system. These keys can only be decrypted inside the secure signer box (the same that enforces velocity limits). For example, Binance seems to be already sending outputs of 100 btc each to their hot wallet address, after consolidation. To top-up the hot wallet for 7k btc in granular cold storage scheme, they would need to manually add 70 keys - and that should raise a suspicion.
Also, different wallets (or different wallet 'compartments') could be used for different sizes of withdrawals. Smaller withdrawals (still with velocity control) go from single-sig wallet, larger withdrawals go from the multisig wallet that requires manual signing and review by more than one person.
For clients who do frequent large withdrawals, destination address whitelisting can be done (via xpubs), and withdrawals to these whitelisted addresses would have bigger limits.
So, the tech is here, the only question is that it costs money to implement, and that money can be spent elsewhere, probably generating more short-term profit.