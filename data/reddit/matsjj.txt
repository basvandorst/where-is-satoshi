@_author: matsjj
@_date: 2016-06-01 09:01:49
Oh good as in 'I want to keep the network balanced because thats good for everyone..'
Right, but it's not a gradual process without dynamic fees. You either can squeeze your payment through it (and when its the shortest path you probably would try doing so), or its depleted. Only once its completely depleted is when people don't use it anymore. But there is still no incentive to rebalance it from the other direction..
@_date: 2016-06-01 12:22:27
Oh yea [it was](
@_date: 2016-06-01 07:42:33
Or he could have checked the thunder.network repository and found out I implemented Bellman-Ford [in February]( ;)
BF actually offers [negative-cycle detection]( (even though not used yet). I found out in a simulation that negative cycles would be very rare in a natural environment, so if they occur it's often maliciously. Removing these edges from the graph and repeating until you find the graph then leads to the desired route. 
@_date: 2016-06-01 09:25:02
Yes, think about a linear function f(p) for now, with p=available/total funds. It will go from -.01-.09 over the range of p[0-1] (just an example). As you can see, its the function is mostly in the positive range and only for the very extreme cases slightly negative. 
@_date: 2016-06-01 07:50:41
Negative costs allows that the network rebalances itself. Yes, it might be possible to find a closed loop to yourself, rebalancing this way, but its less efficient than letting the market do it for you. Eventually you will reach an equilibrium just by using the network. 
You want to avoid the situation where your channel is maxed out, because it can skew incentives, it is much more of a gradual process of how the payment channel stay in balance. You will find negative fees very rarely.. 
@_date: 2016-06-01 08:25:47
Without dynamic fees there is no incentive to use the maxed-out channel over any other channel (other than being the good guy - lets not count on that). So by setting a low fee on this hop, we make people route through it.
Negative fees are just the very extreme form of dynamic fees, and if they occur a lot it means that something is wrong from a network perspective (like a lot of senders on one 'side' of the network).
@_date: 2015-08-12 10:20:37
As this is my first deployed open source project, I might not be familiar with the processes involved. Can you elaborate a bit more? In my thinking anyone can be a reviewer or contributor, without my specific 'permission', all documentation and code I have is currently online, and I'm always ready to discuss on IRC freenode ( mjerr ).
I am very thankful for everyone helping this good cause! For some later stage it would be perfect to get some web developers into the boat aswell, as any commerce solution would most definitely need some sort of PHP integration or similar. Small hosting solutions would not allow for a backend service to be running, although it would always be possible (and maybe even preferred) to just produce an address only and claim the payment on a separate machine. (similar to the way it works with blockchain payments today, this would also solve the hot wallet problem)
@_date: 2015-08-11 19:29:41
I don't think TOR will be the main problem in this instance. It's just that running a MAJOR payment hub in the anonymity is very difficult logistic wise. You need staff, you can't talk to anybody about it, you can't really trust anyone. It's the subtle way all the major darknet projects go down. That's why I said that it has little to do with technology.
@_date: 2015-08-12 08:30:43
I started with the channel design as proposed in the 0.5 draft available on lightning.network. It was proposed that each payment would pay to a multi-sig that would in return pay to another multi-sig again. The second output was to a relative timelock, that is not yet ready (OP_CSV or OP_RCLTV).
This was very problematic, due to the malleability risks, so I cut out the middle multi-sig and made the first transaction multi-sig and timelocked where suitable (refund and revoke payments).
By itself, this would have been adequate already, but there are some nasty things the client could do, just to mess with the server (pure 'vandalism'), so I changed the payment output of a payment towards a client, such that it can be claimed by a server in case the client breach the contract. 
@_date: 2015-08-11 15:13:58
I thought about that aswell, but we had one of the worst summers I can imagine here in Germany, and most of the time we heard the rumbling of the thunder approaching, until  finally, we saw the first lightning. 
@_date: 2015-08-12 10:23:46
Most of the low-level stuff is based on bitcoinj, especially transaction creation and validation. Also I use the wallet and blockchain functionality from bitcoinj.
The actual communication (currently JSON over HTTP) and channel design is not based on bitcoinj.
@_date: 2015-08-12 07:07:33
Thank you sir, rather full time. ;) But a lot of time was spent on studying the channel architecture aswell..
Yes I saw your project back then and really liked the demonstration video! And I thought about an integration of it aswell.
There is a lot of review and security hardening to be done, before I would consider this safe for main net. I think it would be best way to integrate would be some kind of interface between any existing wallet (that integrates TN) and your application. 
It would safe developers time that they would spend on integrating these systems, especially since software like wallets are really difficult to design properly, and making a TN payment would be as easy as calling
    thunder://receiver=4AA4vSTmguQReMVMhnNmVnzRbcuvi63zuGuzT0A\=12hS
There would be some kind of authorization part in the wallet, where you can specify how much other apps can spend on their own, with a threshold at which point the user would be asked for further authorization (or something similar more restrictive).
There has been some (now cleared) misunderstandings, it is however not possible for both parties to arbitrarily lock up all funds indefinitely (that would - after all - not be low-trust).  
@_date: 2015-08-11 17:37:41
That's exactly what I would do, and it is possible of course. As transactions are pretty much instant, it would be similar to a download, seeing the progress of the money flow, canceling as soon as one $1 payment is not making it through.
It is not implemented right now, as I have only so much time to work on things, and I wanted to check out some of the opinions here. ;)
@_date: 2015-08-12 07:26:58
Yes there is, it is completely for testnet only actually. There is a prototype of a wallet on thunder.network aswell. (does require jre1.8+)
@_date: 2015-08-11 18:46:51
I replied aswell (and should really educate myself on how to properly reply to mailing lists....).
Do you mind elaborating, why you think that the client is unable to broadcast (and enforce) his channel? In the very worst case, it would come down to a tx race, with the client having a substantial head start and the choice, how he should broadcast the channel.
@_date: 2015-08-14 09:09:27
Oh, yea, I thought so. 
But that doesn't really answer my question. ;) 
@_date: 2015-08-11 18:06:22
We are talking about a $4 VPS after all (most of the time spent is due to the bad connectivity), and in the end it does not really matter, most important is that the price of the server is adequate to the service it can provide. 
$4 / ( 30 * 60 * 24 * 30 ) = 0.0003ct
We can always scale up the servers, if there is the demand.
@_date: 2015-08-13 19:18:18
I have no idea honestly, do you think I should? I always feel like advertising. And doing a search on google, I wasn't able to find a dedicated mailing list, just the google group..
@_date: 2015-08-11 19:10:13
Yes, as soon as we have no-trust solutions, these will become possible (and I think they will be widely used aswell), but as soon as a payment hub reaches a certain amount of transactions, running over tor will no longer be an option. This has nothing to do with pure technology, but rather because of many different reasons. It is difficult to run a complete datacenter and still be anonymous. 
@_date: 2015-08-12 07:25:44
If only I could give you an answer to that... ;)
So far this has been done beside my actual job, and beside me studying. I had some time off due to some bad placed courses in university, so I just gave it a shot, but having a full time job and maybe even a family that I would need to take care of, this wouldn't  have been possible I guess. 
At the end there is always the incentive that the work will eventually pay off. Not (just) monetary, but also reference-wise. By developing in this very difficult terrain you show everyone else your knowledge, and I think devs with deep bitcoin knowledge might be in demand very soon. 
@_date: 2015-08-11 17:40:12
Yea, I struggled with git and maven prior this release, to have it all bundled together. 
This is my first publication on this. The list of things I wanted in it grew and grew.. ;)
@_date: 2015-08-11 19:13:46
Yes, hub is the correct term I think.
It does indeed take a lot of money. I tried to make some educated guesses how much precisely, but it's very difficult to determine and largely depends on the way the users use the payment channel and how often money circulates. In some other comment I explained the fee structure and how it will help building up those crucial funds. Depending on the funds the payment hub starts with, these fees can be very high or very low.
@_date: 2015-08-11 18:09:25
I think you need to do mvn install on the parent first, such that the dependencies for the wallet are built first.
I guess this could be done with a single pom in the parent aswell, but this is pretty much my first project that I'm trying to deploy with maven + github.
@_date: 2015-08-11 17:35:50
I worked the past 8 months on this, don't think quickly describes this process adequately. ;)
I think there is **a lot** to be done, before LN (or similar) is even remotely useful. There are so many services and so much software that needs to be rewritten. The user experience changes (one-time addresses just as an example), and implementing all these changes will take a very long time. I don't think this will be in time to make any difference in the block size debate. My main goal is to start the process of implementing these changes, such that we may experience LN anywhere soon.
I started thinking about LN and an implementation just because of the reasons you mentioned. I imagined how seamless it could be implemented into a browser extension, there are similar projects already. Microtransactions are very difficult to realize with any other solution, while they are very easy with LN. 
Anonymity is difficult. I think, as payment hubs will get larger that secret service will start peeking into the these. And there isn't really anything we can do about it. I am therefore thinking about releasing a complete history of payments, similar to the blockchain, within the server. If the government does have knowledge about everyones transactions, so should anyone else.
@_date: 2015-08-11 17:47:42
Thank you sir!
Yes, you may be right, I have not thought about that. With OP_CLTV enabled, it is possible to have it p2p aswell. However, advantages and trade offs of a large network over a few single hubs has yet to be determined. When payment hubs don't hold the users funds anymore, complete decentralization might not have too many benefits.
I have listed the risks below (I guess I'll add them in the OP aswell), and they are quite manageable I think. But of course, no-trust is always superior to low-trust.
@_date: 2015-08-11 18:18:41
10 satoshis:
These are necessary to pay for the server and associated costs.
These will be collected to accumulate enough funds for the payment hub. As all channel payments do require funds of the payment hub locked up, it is important to have enough funds ready. As soon as enough funds have been collected, the payment hub can run for ever on the 10 satoshis fee only. 
1% is a pretty steep curve, it will probably be lowered. If - for instance - the payment hub receives a large funding up front for example, 0.1% will probably be enough to pay back the credit.
@_date: 2015-08-11 17:25:53
Currently, due to the design of the channel, there are two unresolved issues:
1. The server can mutate the opening transaction, locking in funds of both parties, as the refund tx are no longer valid. 
2. The server can refuse to acknoledge a payment, after the receiver published the secret. This pushes the receiver to broadcast the channel, at which point the server can **try** to claim some of the outputs
I described these risks in some more detail in the *paper* (I should really paste it in some LaTeX), and all of these *attacks* can be proved, such that the reputation of the payment hub is at risk as well.
Both of these problems can be solved, as soon as we have OP_CLTV.
I see that there is a lot of emotion around with the block size discussion. I definitely see that the block size must rise. Having said that, it is also important to have the time to make an educated decision on this matter. I don't think releasing pressure can ever be a bad thing in this discussion. After all, raising the blocksize without further measure is just that - releasing pressure.
@_date: 2017-05-15 15:24:19
Not in this case though. You give the other party a signature whenever you update the channel (which they use when they want to close the channel unilaterally). But how do you find out about that when you don't have access to the UTXO set?
@_date: 2016-05-16 15:44:24
Payment channels are funded by so called 'anchors' on the blockchain. The current design is to have a 2-of-2 multisig account as an anchor, so you need both parties collaborating when changing the channel transaction (for example for making a payment). This is it what makes payments final, because the anchor cannot be spent by one party only.
@_date: 2016-05-16 15:08:30
Hey there, author of thunder here!
It does indeed use a 2-of-2 multisig address for the payment channel. For example this is the anchor for the payment channel used in the 'Tx 0': 
@_date: 2016-05-16 16:31:04
Yes, it has been reworked from the initial design ~8 months ago to a purely P2P network. Anyone can be a node (in fact thunder-node.jar is one of the binaries in the GitHub release) and you are free to connect to any node you wish. It is internally using CSV already, SegWit will be implemented once the branch on bitcoinJ has been merged into master. The overall aim is to achieve compatibility between the different implementations. 
@_date: 2017-05-20 11:46:56
Thanks for the explanation! I just saw your comment. Is there a write down on this specific mechanism somewhere? 
I think it's not quite possible to outsource the claiming of *all* funds. It's only possible to claim the _spare balance_ outputs. Currently open payments have a P2SH-like output, where you would need to know a lot of parameters just to construct the paying script, let alone redeem it for someone else. 
Thats only possible by giving others this new information whenever you make a payment. (or is that actually what they do? In this case there are privacy implications too, since these parties now know when you make payments and how many..)
@_date: 2017-05-12 07:09:22
Neat! How do they deal with not having access to the UTXO set? Currently it's not possible to *prove* someone an unspent hasn't been spent yet. Or do they just download and go through all blocks, without actually validating them, searching for transactions that spend an anchor?
@_date: 2016-05-16 19:27:49
Great tutorial!
You can easily test it by starting the wallet and trying to open a payment channel with it. 
Because of some routing issues and people that just want to try out running a node for five minutes, all nodes will prune their database for data older than ten minutes. Nodes and wallets do broadcast their existence every 7.5 minutes to stay in memory. This is an easy to change constant later when we mitigated some of these issues. For now this means that after a short delay you will only see actual channels and actual nodes online *right now* in the wallet! ;)