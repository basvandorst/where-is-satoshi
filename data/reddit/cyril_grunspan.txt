@_author: cyril_grunspan
@_date: 2018-08-06 06:50:10
Sorry. We can resume discussions now. In case you are interested, here is a new paper on the same topic : 
@_date: 2018-05-29 13:24:37
One of the main point of the article is that selfish mining is an attack on difficulty adjustment formula. It was may be known before but here you can find a clear mathematical proof that selfish mining is unsound before an adjustment difficulty.
Then, a new formula for the difficulty adjustment has been proposed. If the formula was adopted, selfish mining would not be profitable to an attacker even after a difficulty adjustment. The problem would be solved. 
Moreover, the proposal respects Satoshi's philosophy for the following reasons :
* difficulty parameter reflects the true quantity of proof of work on the network  
* peers should always select and broadcast the block with the most "proof of work"  
The article introduces **new tools** to understand the problem and to compare mining strategies.
* introduction of the **notion of revenue ratio** which is the good quantity of interest to compare mining strategies  
* computation of this revenue ratio using stopping times and Doob's theorem for the selfish mining strategy  
The article is short and understandable by anybody who is familiar with the mathematics of Bitcoin's whitepaper. There are **only basic probability theory such as Poisson processes and martingales**. There is no Markov Chain and there' s a good reason for that: a state machine approach does not help for calculating the duration time of the attack which is an essentiel part of the revenue ratio. However a study with a "state machine approach" can be interesting to capture the asymptotic behavior of a mining strategy if one is able to calculate the stationary probability.  
**Abstract**. We review the so called selfish mining strategy in the Bitcoin network and properly  evaluate the cost of the attack and its profitability. The expected duration of the attack has been ignored in the literature but is critical. We prove that such strategy can only be profitable after a difficulty  adjustment. Therefore, it is an attack on the difficulty adjustment algorithm. We propose an improvement of Bitcoin protocol making it immune to a selfish mining attack. 
If you can read french, more explanations are available on my blog: [cyrilgrunspan.fr](
@_date: 2018-05-30 10:16:54
The attacker is unlikely to mine all blocks... You can be more precise. 
The probability that the attacker wins a cycle attack is 1\-\(p\+p\^2\*q\)=q\^2\*\(1\+p\). 
The mean number of official blocks at the end of an attack cycle is 1\+\(p\^2\*q\)/\(p\-q\) 
The number of attack cycles before n\_0=2016 blocks are validated is n\_0 / \(1\+\(p\^2\*q\)/\(p\-q\)\)
You can also compute the mean number of blocks validated by the network at the end of an attack cycle knowing that the attacker wins. It is ��\[N'\(ξ\)|N'\(ξ\)⩾2\] where ξ denotes the stopping time indicating the end of an attack cycle. We have ��\[N'\(ξ\)\] = ��\[N'\(ξ\)|N'\(ξ\)=1\]⋅ℙ\[N'\(ξ\)=1\]\+��\[N'\(ξ\)|N'\(ξ\)⩾2\]⋅ℙ\[N'\(ξ\)⩾2\]
with ℙ\[N'\(ξ\)=1\]=p\^2q, ℙ\[N'\(ξ\)⩾2\]=1\-\(p\+p\^2\*q\) and ��\[N'\(ξ\)\] is given in the paper… Hence, you get the result.
Thank you for your interest in our work. 
@_date: 2018-05-31 18:52:35
Yes. Thank you cypherblock. We are finishing a new paper. The one on "Selfish Mining" was just the starter... I'll answer you later.
@_date: 2018-05-30 13:49:33
GHOST protocol is interesting but as far as I know, the number of orphan blocks is not present in the difficulty adjustment formula.
Here the protocol remains Bitcoin. The rule of the blockchain with the most proof of work still applies. A miner of an orphan block does not get any reward. A miner of a block which includes a proof of existence of uncles does not get an additional reward for including this proof of existence. Incentive to include proof of existence of uncles comes from the fact that in case of competition between two blocks with the same height, peers broadcast the block with the most proof\-of\-work.
The only thing important is to detect the number of orphan blocks \(or a good approximation\) after 2016 blocks have been mined. The number of orphan blocks is only important for the difficulty adjustment formula.
I agree that there are open questions:
Where in a block should a miner include proof of existence of uncles? And what is a "legal" uncle?
I don't have definite answers to these important questions but I have my ideas.
The number of uncles is similar to the parameter Timestamp. Indeed, the parameter Timestamp is mainly used to adjust the difficulty after 2016 blocks. So, ideally, the number of uncles should be indicated in the header. The length of an attack cycle is generally short \(see above\). So, I suggest to try simulations in a setup with k=2 \(with your notations\).