@_author: rudolpho3
@_date: 2013-10-03 07:10:00
It is confusing. Here's another really legit source that recommends the above solutions, including cgi.fix_pathinfo: 
In your example, you actually listed the 3rd way to address the issue: using `try_files $uri =404;` within the PHP block. But the [Nginx wiki suggests not to rely on try_files]( (see footnotes), saying "Some guides recommend to use try_files instead of if, if you do that, beware of nginx bug  linking to the issue  (which is even more confusing because that ticket doesn't really explain why not...). The wiki recommends to instead use an if statement within the PHP block, even though if's are evil in Nginx :). And it notes that my first way of setting cgi.fix_pathinfo=0 has the downside of altering nginx's PHP_SELF variable, which for most people isn't a problem, so I'm okay with it to ensure security. So, the wiki's suggested Nginx config, which uses an if statement within the PHP block, is a 4th way. Anyway, I think your nginx config is good using try_files within the PHP block. That's one of the ways.
So there are 4 possible solutions.
Personally, I think a good nginx config is a given. I like `try_files $uri =404;` within the PHP block or the wiki's suggested config. But I'd also set php.ini's to `cgi.fix_pathinfo=0` to be 100% certain because I know for sure that works. Clearly, if this was the exploit, the hacker is aware of it, and I wouldn't mess around. I'd get it done with something I know works.
@_date: 2013-10-03 05:56:26
 The vuln I described is legit. My description of PHP fix_pathinfo may be off, I just wrote that from memory. But my recommended fix is accurate. Thanks for catching my typo on cgi. I updated that.
 More info:
The vulnerability is caused by a combination of Nginx + PHP. Here's more info when it was first reported:   
and  
The are two recommended fixes:
1.) Set `cgi.fix_pathinfo=0` within php.ini  
or  
2.) Add the following within your site's nginx vhost configuration:  
    if ( $fastcgi_script_name ~ \..*\/.*php ) {    
        return 403;  
    }
(Igor, Nginx's creator, does not recommend this syntax if you choose  If you decided to use that one, Igor has a different version in the thread above. But that's irrelevant, I'd use  anyway because then you won't have to worry about accidentally reintroducing this vulnerability in the future when tweaking your nginx configuration.)
The first solution is what I use to secure my PHP web servers and have tested. That is what I would recommend.
@_date: 2013-10-05 19:38:31
Your app probably relies on the PHP_SELF variable in that case. See 
There are 3 other ways to secure it from this attack. You've got options.
@_date: 2013-10-03 05:35:46
Thanks! I fixed the typo.
@_date: 2013-10-03 03:44:06
I think I know how it was done and how to prevent it...
You say the attacker uploaded a PHP script to the avatars directory. Immediately I know the answer.
PHP has a setting that MUST be disabled to prevent this. If it is left enabled, then it is possible for an attacker to upload a PHP script disguised as an image. The forum software's validation probably looked at the file extension and said "okay it's an image". But when the file is served by your web server, PHP recognizes that it is actually a script (despite the extension) and will 'fix the path' (i.e. it will ignore the incorrect, fake .jpg/.jpeg/.png/.gif file extension) and will treat it as a PHP file and run it through the PHP interpreter, thereby executing the attacker's script. 
In short, the attacker uploaded a malicious script disguised as an image; he then requested a page that contained this avatar image; the web server went to retrieve the image, realized it was actually a PHP script and executed his malicious script. This type of attack is possible when PHP's cgi.fix_pathinfo is enabled (i.e. set to 1). It must be disabled (set it to 0) to prevent this type of attack.
The fix:
1.) Check your php.ini and disable PHP's fix path by setting it to zero: E.g. cgi.fix_pathinfo=0
For instance, on Ubuntu or Debian, if you use php-fpm, you'd open the php.ini using:
    sudo nano /etc/php5/fpm/php.ini
Then find "cgi.fix_pathinfo=1" and set it to 0.
This will prevent that type of attack because PHP will then only execute a script if it has the proper .php extension. This is something I check when setting up and securing web servers.
2.) The above is all you need to protect against this. But it'd probably be a good idea to also submit a bug request to the forum software creators requesting that they validate MIME types of uploaded images, instead of only validating the file extension. I don't know for sure how they do validation without looking at their code, but clearly if it allowed a script to be uploaded, then their validation of user uploaded content (avatars in this case) is insufficient.
Setting php.ini to have  cgi.fix_pathinfo=0  is the real solution.
If this helps, let me know. I'd be very pleased to have helped get bitcointalk get back up again! And of course the BTC bounty would be very nice bonus too.
@_date: 2013-10-03 04:53:46
Yeah it's in there:
    `Then find "cgi.fix_pathinfo=1" and set it to 0.`
    `Check your php.ini and disable PHP's fix path by setting it to zero: E.g. cgi.fix_pathinfo=0`
Did I typo somewhere? I hope this is it so we can get it back up again asap.
Edit: Fixed my typo...cgi.