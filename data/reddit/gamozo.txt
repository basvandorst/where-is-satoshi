@_author: gamozo
@_date: 2013-04-14 23:44:10
My exchange (separate from Buttercoin's implementation, however we share ideas) is all written in C.
@_date: 2013-04-12 06:48:31
On the left is every trade that has occurred. Each 'dot' is a trade.
@_date: 2013-04-15 02:57:02
If something goes down, I have to manually restart it. The program that is feeding out the website is really crude. Hopefully the live demo isn't a miserable flop. I'm going to make a youtube video about what you would see, for historical reference when the site is pulled down for further development.
@_date: 2013-04-15 17:26:46
Everything is resident in RAM. It's in a 'binned' hierarchy, similar to a tree where each node is a bin that holds say, all the data in the [0,10) price range, and a few levels of that down to the [0,0.001) range.
Frequent backups and transactional logging will be made to restore anything to the state it was at.
@_date: 2013-04-12 18:14:12
I consider it to be productive in the matter of we're improving networks, improving servers, creating higher performance code, thinking in high-performance ways. Sure, the main use may be parasitic, but the other uses for the same technology (not the algos themselves, but the infrastructure and ideas) are incredible!
The main thing I'm interested in is having large amounts of data to process efficiently. Sure, I'd probably have just as much fun working on processing nuclear radiation levels from solar flares, but I don't have that data feed... if I had it, I'd be using that. The reason I work with trading is because it's probably the largest source of cheap data. I process about 15,000-20,000 quotes per second from home, for only about $150/mo. If I could have a satellite up in space for that price, I'd process that data instead.
If it makes you feel better I only process the data, I do not actually do HFT. I'm not really interested in the trading itself, I'm interested in the data from the trading.
I hope you see where I'm coming from.
@_date: 2013-04-12 17:37:38
Let me further expand. I believe HFT is bad for investors. However, as someone who greatly enjoys optimizing and creating high-performance servers and algorithms, trading is the one world where speed actually matters. In the interest of money, sure, HFT is bad. In the interest of technological advance, I absolutely love HFT. These two sides of me get mixed sometimes and I get confused. I apologize.
@_date: 2013-04-18 15:07:31
It's a bit dated, but I think it still holds water.
@_date: 2013-04-16 00:00:40
Because that's not fun. I'm interested in implementing it to understand how to do it and how to improve on things. Not to sound ignorant, but I'm doing it from scratch for the learning reasons (as well as the performance ones).
@_date: 2013-04-11 15:07:53
Exactly! :P
@_date: 2013-04-18 07:51:23
Also, don't compete with exchanges. Partner with them. In the real world there are multiple exchanges for redundancy. The only issue is that this requires a clearinghouse to manage transfers. But there are a few ways to make things work somewhat well. There's also plenty money to go around, so there's no need to have 70-80+% of exchange traffic.
@_date: 2013-04-18 18:57:26
I have it do a loop of 10,000,000 quotes (completely random, hence low number of partial fills) and I simply time it.
All the timing and benchmarking can be seen in revfive.c.
@_date: 2013-04-12 06:59:52
I go through bitcoincharts right now. But I'm about to try to make a dual-connection for redundancy.
@_date: 2013-04-13 02:11:25
Be sure to join  on freenode to ask questions and interact!
@_date: 2013-04-12 16:59:17
I don't want to make just a pointless rant without backing it up with some suggestions.
First of all, the software needs to be written in some compiled somewhat optimized language. It doesn't even have to be C, even C# would probably do for this traffic.
Second, the barrier to entry for a direct feed to the exchange needs to be much higher. Such as $500/month to get a connection. People would buy these connections and relay them to distribute the load and to allow for alternate streams of data if one of the relays is dropped. With something like IPv6 you should be able to give each trusted relay a unique IP to the exchange. The second you get ddosed on it, you just drop that IP and never use it again. Meanwhile, other relays are still fully functional with no lag.
Third, create a custom database specifically designed for high-performance order book tracking and trading. I'm not sure if there are any COTS pieces of software out there for this.
Just my $0.02
@_date: 2013-04-15 17:25:02
Yeah. Now if I'm filling a block, and when I'm reporting that every trade in that block is filled, I will ignore blocks with a size of 0, and not bother recursing into them at all. This saves loads of CPU time :P
@_date: 2013-04-15 08:19:53
Sorry for the reply spam. Just released Revision 5. Now processing about 975k quotes per second on a single core at 3.2GHz.
@_date: 2013-04-15 17:23:49
Orders are inserted into the books so the books are always sorted. Basically the different 'levels' are different bins, which allow me to quickly narrow down to where I'm interested in. Everything is sorted when inserted.
If performance becomes and issue sorting everything (but right now, 1.8M quotes per second is everything I'd possibly need), I'll probably add other order books for further away from market prices that are run at a lower priority.
Currently I do not keep track of the best bid and best offer. This makes me have to search for them every time there is an order. This is something that will change in the future, given updating BBBO is cheaper than the searching for them. I made a crude implementation of BBBO tracking to optimize searches, and it gave me about a 1% performance increase. Perhaps I implemented something wrong. I'm going to look into that more down the road.
@_date: 2013-04-12 05:13:07
I do this all day long. It's just gambling. Especially with the lag.
@_date: 2013-04-15 17:11:29
I've already got L2 data, thanks for the offer though!
@_date: 2013-04-18 08:30:46
As for a UI, that'll be many hops away. The exchange will speak to a data feed provider, that data feed provider will send data to a couple thousand places, and those thousand nodes are where users could actually touch. Directly allowing connections to an exchange is silly. There will be very few, extremely trusted, extremely low latency links that get to connect directly to the exchange.
Balance sheet snapshots aren't terribly difficult to implement. They also don't have to lossless. I'm going to aim to make them 100% lossless, but it's perfectly acceptable for the last 5ms of orders placed to be lost.
@_date: 2013-04-15 04:34:54
The only historical data from Gox is the trades that occured. I need full order book AND overlap. To my knowledge that data isn't published at all, let alone historically available.
I'm going to make an easy-to-use interface in the next few buys and try to get some people involved with making realistic simulated trades.
@_date: 2013-04-12 17:28:26
Considering I believe that HFT is bad for the normal investor... sure.
@_date: 2013-04-12 17:01:25
HFTs have added loads of liquidity to the markets and haven't very dramatically changed the movements. Sure, there have been flash crashes and instances of quote stuffing, but they're usually extremely short lived (we're talking a few seconds here).
I'm curious as to what your arguments are against HFT, not just that you heard that HFTs are exploiting you and now you just preach that.
@_date: 2013-04-12 06:51:29
A bit inactive right now, as I'm coding up a better feed that will be more active.
@_date: 2013-04-18 16:54:46
It's under the simplified BSD license. You can see the license at the top of each source file.
@_date: 2013-04-14 04:11:05
It's pretty hard to scam people when you're doing a demo and not providing a service. Nice try though :)
@_date: 2013-05-04 01:15:19
This is called MACD. 
@_date: 2013-04-15 17:20:12
:) Glad I can work closely with the Buttercoin guys. Two different projects allows for two perspectives. I'm going to make sure I have 'meetings' with the Buttercoin guys to share ideas!
@_date: 2013-04-12 17:21:23
You seem too unstable to have a conversation with. Sorry, not even gonna bother here.
@_date: 2013-04-17 00:44:08
@_date: 2013-04-12 17:04:42
Hahahahaha. Bitcoin should go up 1000% to $1k/coin and that would make it really stable! *coughs*
@_date: 2013-04-12 22:16:42
 on freenode. I'm probably going to try to do a Google Hangout on Air. If there are issues with it, there might be a last minute switch.
@_date: 2013-04-15 17:19:04
Hehe! Glad you like it! Nothin' like some good ol' C. I'm going to try to get this on Github sometime, but I'm not the biggest fan of git.
@_date: 2013-04-12 22:05:42
Depending on how long this goes on. I'd actually like to spend 1-2 hours writing an order matching system live on the air (after the main discussion obviously).
@_date: 2013-04-18 15:05:29
That's actually the next plan! I'm also going to play with different amounts of block levels to see if that can get me some more performance. I'm just going to use 16 per block so I can &amp; with 0xFFFF and shift. But that's not really where the core slowdown is, but it's an optimization at least!
@_date: 2013-04-12 22:13:43
I'll try to summarize it and other people hopefully will as well.
@_date: 2013-04-15 08:03:35
Yep, I'm aware. I'm evaluating better solutions. Currently nothing is really optimized, it's only implemented. I'm going to see what I can milk out of this data structure layout.
@_date: 2013-04-15 04:36:10
I'm not familiar with it. I'll have to look into it. Thanks!
@_date: 2013-04-18 15:10:13
That would require USD to be decentralized. Or for your bank account info and identity to be floating around on the block chain. I'm not terribly interested in giving everyone access to my bank accounts.
@_date: 2013-04-12 07:44:09
Feed is now properly realtime!
@_date: 2013-04-13 01:59:48
Hangout is up!
@_date: 2013-04-14 05:14:32
Live stream is over, video up here:
A webapi will be available soon for testing!
@_date: 2013-04-18 23:45:33
Yeah. It's not a huge difference. However kqueue() also requires less system calls. And, mainly, I just like FreeBSD for many other reasons.
If you're really interested:
See section 'Comparison of epoll and kqueue'
@_date: 2013-04-15 17:18:24
Right now it's not scalable sadly, however at 1.8M quotes per second, I'm not *too* worried. But, I'm going to try to make it scalable in the future. Note: The exchange will have multiple brokers who connect to it, and thats where bandwidth distribution (to prevent against DDoS) will be done.
@_date: 2013-04-18 07:27:46
I can't seem to reply there, probably due to post requirements or something...
Security is key. 1000tx per second is fairly weak, and I'd hope to expect a lot better. Trading fees should NOT be percentage based. Well, for accounts with &lt;$1000 they should be percentage based. Above that they should be on a per-share basis. Cancellation fees also should be charged, about 1/10th of a cent per bitcoin cancelled (yes, this exists in the real world).
Also, handle your legal shit before you launch so you don't get frozen like every other legally unprepared exchange. It's pathetic.
@_date: 2013-04-15 04:46:05
Awesome! I'm actually a resident FreeBSDer. Currently the networking/server code is not public as it's crudely made without any extensive research. I'm going to want to optimize the trading engine before it's audited as I'd hate to get it audited then change it a lot.
I'll probably make a 'call for auditing' sometime in the nearish future, then would be the best time.
@_date: 2013-04-15 08:30:29
And now 1.7M, as I forgot to merge the same types of changes to other functions. 1.7M is a peak number by the way, when you go to  that number will be smaller due to the database growing SO fast now. The database is growing unrealistically fast, thus operations become more expensive.
@_date: 2013-04-15 17:27:41
Right now I don't have any extreme need for people. If you want to join  on freenode, I'm always open for discussion there. Soon I'm going to need some frontend stuff worked on, and I'm terrible with that stuff so I might ask for some help.
@_date: 2013-04-12 17:33:13
I'm excited to see what happens! But no, I haven't read the full AMA yet, just parts of it.
@_date: 2013-04-18 15:09:25
I have a few ideas, but I'm not spending too much time on that until I understand the legal requirements for transactions. Sadly, due to heavy regulation, it's not simply a matter of 'what would work best'. It's a matter of 'what will the government not lock my accounts for'.
@_date: 2013-04-14 04:06:56
It'll be a demo of the internal trading system which places and matches the orders.
@_date: 2013-04-15 08:07:17
Without trade execution, I get about 600k inserts per second. This is on a single core, and I safely can multithread this system. So with 16 cores, I could get 9M inserts per second. Perhaps my data structure isn't good for order matching, but I think my order matching logic is the fault in my system.
The most expensive part of this whole thing is reporting filled orders to the account that placed them. I have a few ideas in mind for optimizing that process.
@_date: 2013-04-12 05:14:11
No. Don't catch a falling knife.
@_date: 2013-04-15 17:25:17
@_date: 2013-04-11 15:04:25
This is what a real feed looks like at 14,000 quotes and trades per second.
@_date: 2013-04-18 15:08:21
Yep, I'm going to try to make it as generic as possible so it can be used for many other things as well.