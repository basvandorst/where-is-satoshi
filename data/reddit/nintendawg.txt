@_author: nintendawg
@_date: 2016-08-11 17:19:52
dat AB/gobblez wannabe, lulz
@_date: 2013-10-03 13:43:13
I'll take a stab at this. First and foremost, are you sure the bitcointalk.org SMF based forum was the *only* PHP based application running on this server? No PHPMyAdmin or other (administrative) apps running? Any (third-party) plugins installed on the SMF board? If the SMF install was recent and fully patched, there is only a couple of possibilities left:
* 0day in SMF (not unlikely, SMF has had serious vulnerabilities in the past)
* 0day in PHP. (They exist, fully remote ones, some more easier to exploit at all than others, all memory corruption based vulnerabilities)
* Exploit or 0day in NGINX
** Here's an (excellent) write up of a recent NGINX vulnerability:  (Affects 1.3.9/1.4.0, and upon successful exploitation can yield a remote shell)
* Administrator account theft. If you have administrator access to a forum control panel, it's *usually* game over.
The lack of a log entry for the modSettings['news'] update does NOT indicate they didn't breach an admin account initially and the news item wasn't posted in the regular way. They could have just opted to delete the log entry shortly after adding it, or directly manipulated the database to insert the entry.
Please provide more detailed information about the exact versions and OS the server machine was running. Check /var/log/auth.log or an equivalent for any (successful) PAM/sshd auth attempts. Please check the access/error logs of the webserver for any malicious looking request. The payload of such requests is often supplied through POST and unfortunately not logged. But if you see an unusual pattern of GET/POST or any other outliers, it might point us in the right direction. If you can deduce any (anonymized) IP of one of the attackers for ANY given action on the forum, you might be able to figure out what they requested/tried earlier on.
The average (patched) forum compromise looks like this: compromise admin account -&gt; leverage admin capabilities to upload PHP code (or edit in forum templates) -&gt; use arbitrary PHP code execution to get more leverage over the machine and shell command execution -&gt; sometimes it's possible to elevate privileges even further by executing a local kernel exploit -&gt; wipe tracks.
Sorry if this is rehashing a lot of trivial stuff. Hope it helps in some way. Good luck!
@_date: 2013-10-04 13:10:15
Sounds legit. :)
@_date: 2013-08-25 23:08:15
Two small issues I found:
* Image upload only checks file extension, it's still possible to upload any arbitrary data as long as the filename ends in .jpg/.png/.gif. I haven't found a way to exploit this yet (as your webserver seems to serve every .jpg with the image/jpeg Content-Type) but it could potentially be used to upload HTML and execute XSS from your domain. (Or a php shell or other evil data)
* You allow some HTML tags, and seem to properly strip attributes.. However there is nothing which checks whether an HTML tag is closed again, thus you can do UI redressing tricks where I turn the entire page into a link (by starting a &lt;a&gt; tag but never closing it) and potentially unwillingly lead visitors to other websites.
Hope it helps!