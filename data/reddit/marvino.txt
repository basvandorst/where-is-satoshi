@_author: marvino
@_date: 2017-08-17 08:37:09
Why not look it up yourself, it's all here:
I am not in any way related to trezor company - but I own a trezor and have looked at the code. In this case the security is built up on the assumption that the SoC works like it is in the spec. So all care has been taken to not even need internal storage to be encrypted. But starting this DEF CON conference people have been glitching the SoC out of spec. Trezor devs have sucessfully patched code to make currently know glitches not work. But this is for the moment.
But to answer your 3 questions - no. Until now all internal storage has been plaintext with the assumption that the SoC works like the manufacturer (STMicroelectronics) claims and software then takes care of the rest.
Moving forward I guess it would be wise to implement the 3 things that you wrote - salt+hash the pin, use pin to encrypt/decrypt mnemonic. Having software checking if the chip has been glitched out of spec is much harder to implement than to now assume that it can be done and work around it on one level deeper. But the problem with this is that the pin is only numbers and it's short, so if the attacker can somehow dump the encrypted storage it could be bruteforced.
But even if it can be bruteforced it would win some time for the owner - say you lost your trezor, you then know that in the worst case you still have XX hours to move the coins assuming whoever found your trezor has some undisclosed exploit and is already bruteforcing the encrypted storage. But this is already deep in conspiracy theories territory. It would cost a lot of money to have said undisclosed exploit and then use hashing power to decrypt the storage to only find out that the owner of the trezor was using a password and the contents of the encrypted storage is 100% worthless - making all the previous tasks a waste of money.
The lines to look at in the source:
* 449-463 loading plaintext mnemonic from storage
* 465-481 verifying user inputed PIN against one in the storage
@_date: 2017-08-17 05:48:45
My guess is the guy compiled his own version of the firmware - it is open source. You can then flash the firmware to trezor but because it's not signed trezor will immediately erase any existing key that has been set up. But now you can set up a new key, whilst running your own version of the firmware. During boot Trezor will now always show this screen as a warning:
But as you now have your firmware - you can do in it what you please.
@_date: 2017-08-17 11:28:54


I'm not arguing that hashing PIN really brings something to the table but I must reply to this. Salt is always kept as unencrypted - it's point is not to make the password/pin stronger/longer but the purpose of salt is to make precalculated hashtables impractical to use.
In the example of max 9 spaces numeric password (PIN) the precalculated table would be laughably small for todays standards. But have that 9 space pin + 128 bit random salt - no more precalculating anything. Yes you know the salt when you start bruteforcing, but you start from 0 every time.
@_date: 2017-08-17 05:38:29
No, you should be source critical. This is pure speculation if the exploit even exists! There is no source code available, just a link to supposed exploit that COSTS 2 BTC! The supposed 1.5.2 expoloit COSTS 20 BTC. This is not how vulnerability reporting works. To me it looks like the guy just read the 1.5.2 code change and saw what was fixed (it's open source) and wrote a blog post how he exploited the same thing.
More technically: this is the most important fix in 1.5.2:
And that is a fix for exactly the same thing that this blog post talks about and wants 2+20 BTC from you.