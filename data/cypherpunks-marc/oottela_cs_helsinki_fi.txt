
@_date: 2014-06-13 16:28:10
@_author: oottela 
@_subject: Re: Tinfoil Chat 
Hi Cathal. Thanks for your review!
The RxM that does the MAC verification doesn't leak data to network connected computer so attacker would have to have line of sight to display of RxM and through trial and error send tampered packets until one doesn't show the warning about tampering. By then user should have pretty good idea about what is going on. Recovering key material shouldn't be a problem since key is not reused in signing of new messages. The implementation however has now been changed while fixing more critical vulnerability with hash function input size.
Regarding second issue, LibPurple does not contribute to privacy of messages in any way. The only thing the computer that LibPurple is running on handles is OTP encrypted data. OTP keys and plaintext messages never touch that computer and malicious functionality of that computer can not possibly request the actual keys from waterfall secured TxM or RxM. The whitepaper explains why the system is secure even if attacker gains root access to computer where Pidgin is running.
I did not write the program that samples entropy via GPIO. Programs written in C generally work faster so I didn't feel the need to redo the part. Also, the installer takes care of compiling. I've done some testing and according to Ent /dev/urandom is more random (7.999995 bits somewhat concerned about seeding, pseudo randomness and effect of modern hwrng devices - can seeding of urandom be compromised by /dev/hwrng input from processor with dopant trojan even if mixing entropy from functional TRNG is done. I'll have to read about the issue before I'll change the implementation. After all, with the TRNG there should be no auto-correlation if sampling speed is slow enough, and no bias when Von Neumann correction is used, despite what statistical tests say.
Also, I'll look into the ctypes library and see about the difference in sampling speed. As user has access to source I suppose compiling doesn't endanger the security in any notable way.

@_date: 2014-06-08 02:33:39
@_author: oottela 
@_subject: Tinfoil Chat 
I'd like to share a project I came up with back in spring 2012 and begun working after the Snowden leaks started.
Highlights are
-OTP encryption for perfect secrecy
-OTP encrypted Keccak HMACs to prevent undetectable message tampering
-HW TRNG to generate truly random keys (Von Neumann whitened)
-HW Data diodes to provide immunity against message exfiltration attacks originating from network.
Source code and links to whitepaper and manual are available from
Regards, Markus

@_date: 2014-07-26 08:32:26
@_author: oottela 
@_subject: Re: Fwd: [Cryptography] hard to trust all those root CAs 
Are there any sources to the procedure how NSL's and other subpoenas / gag orders could be used to coerce certificate authorities to hand out their private keys?
My guess is the risk for using root certificate of different company for MITM is too high: EFF's SSL observatory would detect it. I'm suprised there has been no leaks about such attacks: It's fairly easy to mitigate, transparent, long term, and  extremely effective, even against Does anyone have guesses or information about how CA's handle their private keys? Are all certificates they sign for companies done on airgapped computers? How high are the security standards of these

@_date: 2015-02-04 18:46:16
@_author: Markus Ottela 
@_subject: Re: What the fark is "TFC" 
To summarise the general classess of side channels mentioned in Wikipedia:
Power analysis should be tackled with running the TCBs on batteries. I introduced the issue of electromagnetic and acoustic leaks but it's a very complex issue and I'm not an expert dealing with them. The RxM is the only device attacker can introduce faulty data to compute on. However, no feedback is available due to the implementation thus unless pre-compromised, the hardware should not have back channel. TFC does it's best effort to overwrite and verify overwriting after key material has been used. Each of these is mentioned in white paper. More work is needed to create high-assurance physical/close proximity security but again, user is informed about the issues and the main threat is automated remote exploitation.
The purpose of Pidgin is to transmit the messages. To simplify, TFC is a plugin for Pidgin that automates you doing encryption in a secure environment and typing the ciphertext to OTR encrypted Pidgin window with your keyboard. It also automates decryption of ciphertexts you receive when OTR-plugin of Pidgin decrypts the outer layer of message.
So for TFC the encryption is SSL( OTR( OTP(Message)||MAC ))
and for TFC-CEV you replace OTP(Message)||MAC with The pages 9 and 10 of whitepaper explains this in more detail. Please let me know if there's anything that needs to be clarified.

@_date: 2015-02-04 01:40:02
@_author: Markus Ottela 
@_subject: Re: Tox.im 
Tox developer team were not interested in implementing it in similar fashion. Using three computers was the main obstruction: A successor for Skype that makes the headlines is the one that you get everyone to use because it's easy to setup. It wouldn't get any attention nor media coverage if it wasn't free as in 'next, yes, next, next, install'.
I'd rather not meddle with Tox source: to quote the Norton's article you "C is good for two things: being beautiful and creating catastrophic 0days in memory management."
Tox is written in C, by people who seem to have limited understanding on computer security and programming. I do too, but a least I selected an approach that doesn't require 0-day free code, or OS.
TFC stands for Tinfoil Chat.
cs.helsinki.fi/u/oottela/tfc.pdf  // pages 9 and 10 explain how why there is no key exfiltration risk.
TCB is the Trusted Computing Base, the system responsible for cryptographic operations.
It depends on your threat model and how technically skilled your adversary is.
If adversarial government decides to buy malware from say, Hacking Team that automatically
replaces Tox IDs inside unencrypted emails to those owned by the state, it'll still get you killed unless you know what you're doing.
Just telling the user to meet the contact and exchange Tox ID in person is enough not to get MITM'd.
Just warning the user about not saying the most sensitive stuff on Tox might be enough to not to get killed.
If you're not in control of the laptop, you shouldn't be trusting your life on it; Tox does very little if there's a keylogger present, neither does TFC if you're not in control of the two TCB computers.
That part sounds like infomercial trying to overcomplicate a problem.
You need one device to store the (a)symmetric encryption keys (TCB 1)
You need another      to store the (a)symmetric decryption keys (TCB 2)
You need third one to transmit encrypted messages.
You need data diodes to enforce unidirectional communication between the devices. That's all.
The issue is global whether it's occupy movement fighting against economic segregation in the West,
or dissidents in 3rd world countries. The difference is the threat model. In west it's HSAs, in poor countries,
MSAs at top, unless it's the US doing surveillance against Afghans etc.
I get what you mean. You're trying to evaluate the skillset of developers in terms of
how things are implemented and programmed. I'm trying to say they've a bigger job
to do and so far they have failed at it.

@_date: 2015-02-03 22:54:07
@_author: Markus Ottela 
@_subject: Re: Tox.im 
They are ignoring the criticism they should be warning users about constant issues in endpoint security: Subrosa, Ricochet, TextSecure, Cryptocat and Threema have all included a threat model/warning, Tox should do so too. Notifying users about risks is what keeps them safe, not moving to slightly more secure products they assume are impenetrable. Conscious ignoring of this on the developers part equals selling "bullshit".
Lets assume they put the warning on the web page. Now every user who reads the security warning begins to think "Ok, so given my contacts, reputation and opsec, my private key is compromised with probability P. Am I still going to write this or do I upgrade my tools? Am I under constant monitoring? Do I need to regenerate my keys?". In the beginning of Citizenfour, Snowden gives a warning to Poitras about private keys: even though PGP encrypts private key at rest. After that, Laura bought an airgapped machine and created new PGP keypair.
Again, security is a process, not a product: unless the implementation of crypto is secure and users know how to use it, properly written Salsa20 implementation isn't going to do much good. Writing a good manual is the responsibility of the developer.
Here's a Metasploit payload Meterpreter. How hard do you think it's for me to automate the two Armitage GUI functionalities of browsing files and logging keystrokes once I buy a 0-day from Vupen with tax money?
Now think about Fox Acid, Metasploit, with a budget. Then think of things like Quantuminsert that automate this process on mass scale. Your seat belt is a bad analogy. There are no bulletproof solutions but there are better ones.
No, the point here is, don't put TCB on a computer that does networking. Why are you putting emphasis on the word 'might' when Snowden says NSA bypasses encryption *every day*:
No, let's not assume. I've a small desk but it's still able to handle the three laptops in a configuration that does not have the issue.
The community has already accepted the host security as part of snake oil check. What on earth is the check doing here if we should accept OS vulnerabilities as a "baseline"? If the product isn't going to address it, it better not neglect it at least, Tox doesn't do even that.
I'm not trying to hijack this Tox discussion to say TFC is the solution. I'm trying to say it's pointless to create anything secure on a setup the features of which are limited(/rigged) to begin with. That's why smartphone is part of the snake oil checklist. The very first step says the product has to be FOSS, without free OS, no encryption software stands a chance. Without endpoint security, it's the same. The community is already praising $1,300 Novena laptops - I'm saying we can achieve higher security with set of three $200 COTS laptops and a few extra

@_date: 2015-02-04 04:39:48
@_author: Markus Ottela 
@_subject: Re: What the fark is "TFC" 
Dingdingding. And we have a winner: Tinfoil Chat it is. Though I liked Gutmann's answer the most.

@_date: 2015-03-31 15:47:01
@_author: Markus Ottela 
@_subject: Re: One Laptop Per Terrorist 
Feel free to choose your own devices / micro controllers as long as it
supports the data diode and doesn't have wireless / audio devices that
provide covert channels to HSAs. Wide range of platforms makes
compromise of COTS hardware much more difficult. Netbooks are not
significantly more expensive than if one were to buy separate batteries,
chargers, displays, cables and peripherals -- It's also more convenient.
Two netbooks pushes the system price around that of a Blackphone.

@_date: 2015-03-28 22:46:08
@_author: Markus Ottela 
@_subject: Re: One Laptop Per Terrorist 
A microcontroller as TCB doing OTP with HWRNG-generated keys. Sounds a
lot like the OTP-version of Tinfoil Chat ( github.com/maqp/tfc ). It
doesn't take a spy or terrorist to create something like this: TFC was a
hobby of a CS-student.
Distribution of key material isn't the big problem, keeping the keys
secure from end-point exploitation is as TAO, ANT-implants, COMMONDEER,
VALIDATOR, QUANTUM w/ UNITEDRAKE/SALVAGERABBIT etc. make it hard. But
even these could be addressed in TFC - enforcing the need for close
access operations, close proximity malware injection or retro reflectors
and other HW implants is the only way to avoid untasked targeting from
becoming the mass surveillance of next generation; It's the sweet spot
of security, as the attack can not be automated, and the cost increases
linearly with the number of targets.

@_date: 2015-04-18 01:22:32
@_author: Markus Ottela 
@_subject: Re: One Laptop Per Terrorist 
Now that I think of it, SW implementations with the CEV version that
cascades symmetric ciphers are very very slow if SoCs such as RPi are
used. OTP and one time MAC is naturally very fast but I'm not sure how
large key storages can be added for micro controllers: users should
probably use OTF-encrypted HDDs to protect key data and avoid wear
levelling issues of flash memory.
Anyway, I pushed out 0.5.4. of TFC out yesterday. Lot's of fixes for
stability and usability, signed installer that checks SHA512 hashes of
other files. Probably the most important feature is hiding 'when' and
'how much' communication takes place. This is done by sending a constant
stream of noise messages and commands from the transmitter unit the
receivers transparently discard. This exhausts OTP keyfiles very quickly
so I'd recommend using the CEV version.

@_date: 2015-04-12 13:11:52
@_author: Markus Ottela 
@_subject: Re: Briar 
NSA gets massive amounts of text messages through it's Dishfire program.
Users should not assume they're excluded just because the program had
limited scope of 200,000,000 SMS per day -- four years ago.
The content is unavailable in both data channels, yet you get better
protection against metadata analysis by routing TextSecure traffic
through Tor.

@_date: 2015-05-24 18:43:52
@_author: Markus Ottela 
@_subject: TFC 0.5.5 out 
TFC 0.5.5 is now out
I found another vulnerability in the constant transmission feature; between each long message only one command would be sent at most. This issue has now been fixed.
After a request, I added further message authentication for CEV: In addition to GMAC it now does encrypt-then-MAC style authentication using HMAC-SHA2-512 (512-bit key) and SHA3-512 MAC (1144-bit key) before GCM authenticates and decrypts the ciphertext.
I upgraded all keys to 512-bit ones so cyclic hashing of keys won't reduce security over long period of time (there is no key negotiation in I also upgraded hashes from Keccak-256 to Keccak-512 and at the same time the Keccak-CTR key size was upgraded to 512-bits. So 1280-bits of symmetric key security in total.
As for key generation, CEV now has constant 2kHz sampling speed (1.5M samples are loaded in total), three vN whitening passes and between each of those, Keccak-512 compression with 2:1 ratio (1024 bits in, 512 out). User can now input different entropy from keyboard for each of the eight 512-bit keys generated.
Also fixed lots of bugs and typos, and as usual, updated whitepaper and manual where necessary.
UI was tweaked slightly: I added cleaner completion messages and some startup animation for the lulz (disable option available in settings).
Full update log:
