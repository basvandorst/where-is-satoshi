
@_date: 2014-01-03 17:01:46
@_author: "Scott Fluhrer (sfluhrer 
@_subject: Re: [Cfrg] Requesting removal of CFRG co-chair 
I think we agree that what Dan specified in the draft is broken.  However, =
I believe that's because Dan got it wrong (and I was busy elsewhere, and di=
d not review the draft).
I believe my suggestion is an improvement (but still needs caution; the che=
cking if x^3+ax+b is a QR must be done in constant time, or in random time =
via blinding; I believe that in this case blinding is easier).
Now, I believe the issue is 'did Kevin endorse my suggestion, or did he end=
orse Dan's implementation?'
For the record, a better implementation of my suggestion in dragonfly would=
 be:
       found =3D 0
       counter =3D 1
       n =3D len(p) + 64
       do {
         base =3D H(max(Alice,Bob) | min(Alice,Bob) | password | counter)
         temp =3D KDF-n(seed, "Dragonfly Hunting And Pecking")
         seed =3D (temp mod (p - 1)) + 1
         if (seed < p)
         then
           x =3D seed
           if ( (x^3 + ax + b) is a quadratic residue mod p)
           then
             found_x =3D x
             found =3D 1
           fi
       } while((found =3D=3D 0) || (counter < k))
       x =3D found_x
       y =3D sqrt(x^3 + ax + b)
       if (lsb(y) =3D=3D lsb(base))
       then
         PE =3D (x,y)
       else
         PE =3D (x,p-y)
       fi
(this stops on the last acceptable 'x' value found; you could try to select=
 the 'middle-value'; I picked the last because it was the easiest to specif=
As for determining if a value is a QR, the easiest way to do it without lea=
king any information in the time taken would be to blind the value randomly=
, as in:
    temp =3D (x^3 + ax + b mod p)
    r =3D 1 + random(p-2)      /* Random value between 1 and p-1) */
    temp =3D (temp * r * r) mod p
    if random(2)                   /* 0.5 chance */
        temp =3D  (temp * qr) mod p
        bit =3D 0
    else
        temp =3D  (temp *qnr) mod p
        bit =3D 1
    fi
    /* At this point, temp takes on all values between 1 and p-1 with equal=
 probability */
    output =3D bit ^ legendre_symbol(temp, p)
where qr, qnr are fixed values which are respectively a quadric residue, an=
d quadratic nonresidue mod p, and are the same size (and so the multiplicat=
ions take the same amount of time).
