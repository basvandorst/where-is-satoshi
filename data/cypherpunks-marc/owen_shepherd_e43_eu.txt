
@_date: 2014-01-12 00:07:05
@_author: Owen Shepherd 
@_subject: Re: [Cryptography] Dumb idea: open-source hardware USB key for crypto 
My initial consideration, as an open hardware design, wasn't something for
somebody to just go out and buy.
If that's what you want, there are hundreds of PKCS smart cards out
there. They're not going to be any less provaly secure than a USB stick you
buy from somebody.
The assumption is that you would at most buy it as a pre-soldered kit, hook
up a programmer, and program and lock it yourself, and finally epoxy it
yourself. Then you know the code is not tampered with.
I can't see a way to make this kind of thing at least equally provably
secure which doesn't involve some form of programming apparatus,
Owen Shepherd
 | owen.shepherd

@_date: 2014-01-11 23:29:48
@_author: Owen Shepherd 
@_subject: Re: [Cryptography] Dumb idea: open-source hardware USB key for crypto 
My thoughts:
   - An FPGA is a bad idea. You need an external ROM to contain the
   configuration data. How often are you going to verify the contents of that
   ROM? (Answer: probably never). There is no way to read protect that ROM
   - Smart card chips would be ideal but tend towards confidential specs,
   and additionally would seem to be obvious targets for a back door?
   - A commercial off the shelf micro seems like a viable option.
Why do I say this?
   - The flash is inside. No easy lines to probe.
   - Most have EFuse bits which can be set which don't let you read or
   write the device without doing a full erase
   - You can get them with large flash. 512kB flash is enough for both the
   code and a sizable collection of public/private key pairs
   - A *lot* less gates for someone to fiddle with than an FPGA. An ARM
   Cortex-M-style MCU is intrinsically no less safe than an FPGA (Note that
   there is no complicated microcode ROM to subvert, no System Management Mode
   to hide in, no motherboard embedded controller to replace the code on, etc)
Proposed layers of protection:
   - The manufacturer's provided anti-readout functionality. This is
   probably the weakest
   - Once the board has been burned, encapsulate it in epoxy to make access
   to the device pins difficult. This just leaves the USB pins as an attack
   avenue
   - Key encryption
Key encryption: Use some standard cryptographic algorithm (AES, Salsa/20,
whatever) to encrypt the keys with the user's PIN/key/password.
Side channel protection: Main one is power. Stick a resistance in series
with the power line, and a sizable capacitance after it? These micros are
pretty power efficient, that should provide quite sizable decoupling
between the internal power rails and external. Of course have all your high
frequency bypassing like normal.
Precautions to be taken by user: Don't plug into strange computers?
   - Theft by non sophisticated adversary. Mitigation: PIN/Key code
   - Theft by sophisticated adversary (e.g. NSA). Mitigation: Encrypt the
   secrets with the PIN
   - Modification by a sophisticated adversary. Primary Mitigation:
   Potting. Hardware Protection. This certainly is the strongest, though least
   likely threat model. Its' difficult to find a way to protect from this one
   in general; a smart card chip would help, though based upon disassembly by
   people like Flylogic Engineering they don't buy you much.
   - Reading of memory from a live instance by an adversary. Mitigation:
   Don't keep keys in RAM unless you're doing a cryptographic operation. Have
   relatively short timeouts after which PIN re-entry is required, preferably
   non-resettable.
   Could implement some form of "tamper detect" system, e.g fragile wires
   embedded over the chip which would provide indication of case tampering.
   Issues with these though (e.g. accidental shorting during assembly).
   Determined adversary is liable to be able to counter this.
   - Firmware bugs: Authenticated firmware update mechanism (i.e. require
   the PIN to be entered to authorize new firmware download, validate have
   user validate signature before letting it run? This is trickiest, because
   of confined flash space.
   Maximize simplicity of firmware. Obviously this is somewhat difficult in
   the face of USB. Using an off-chip USB controller avoids that issue, in
   exchange for the other that now the driver and user interface situation is
   made more complex (USB serial ports for one are seriously ugly)
Other features: At a minimum a keypad, a display. This is not going to be
Potentially: (Micro)SD card slot so can function as encrypted flash drive?
Some form of analog RNG built on PCB? Preferably in addition to some form
of hardware RNG inside the chip (though chip manufacturers are notoriously
cagey about how good their entropy generators are, it can't hurt to mix in
extra slush)
Owen Shepherd
 | owen.shepherd
