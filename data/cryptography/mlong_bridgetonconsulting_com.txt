
@_date: 2003-12-12 09:42:36
@_author: mlong@bridgetonconsulting.com 
@_subject: Super-Encryption  
I've been experimenting with ways to use XML-ENC to compact the wire format and provide a high degree of security.  The following is a notational example of the the current 'thought' of the methodology.  I would like to ask for input as to potential security holes to this method.
-Matt Long
Phalanx Systems, LLC
The concept is to super-encrypt a message.  The method would:
(1) Encrypt message with symmetric key algorithm, i.e., cipher1
(2) RSA_Encrypt (SHA1(message) + symmetric key) with sender's RSA private key
(3) Encrypt cipher1 with symmetric key algorithm, i.e., cipher2
(4) RSA_Encrypt (symmetric key2) with receiver's RSA public key
(5) Send super-encrypted message
(6) RSA_Decrypt (symmetric key2) with receiver's RSA private key
(7) Decrypt(cipher2) (8) RSA_Decrypt (symmetric key1), parse out digest, i.e., SHA1(message)
(9) Decrypt(cipher1)
(10) compare digest with SHA1(Decrypt(cipher1))
Sender's Algorithm
SymmetricKey1 = 3DES_IV1, 3DES_Key1
Cipher1 = 3DES_Encrypt(message)
Digest = SHA1(message)
RSA_Key1 = RSA_Private_Encrypt(Digest || 3DES_Key1)
SymmetricKey2 = 3DES_IV2, 3DES_Key2
Cipher2 = 3DES_Encrypt(Cipher1)
RSA_Key2 = RSA_Public_Encrypt(3DES_Key2)
Receiver's Algorithm
3DES_Key2 = RSA_Private_Decrypt(RSA_Key2)
Cipher1 = 3DES_Decrypt(Cipher2)
Digest || 3DES_Key1 = RSA_Public_Decrypt(RSA_Key1)
message = 3DES_Decrypt(Cipher1)
Compare Digest with SHA1(message)

@_date: 2003-12-15 09:25:36
@_author: mlong@bridgetonconsulting.com 
@_subject: Super-Encryption 
Quoting Ben Laurie :
The message is encrypted, i.e, cipher1, then cipher1 is encrypted yeilding Since symmetric_key1 of cipher1 is RSA_Encrypt(sender's private key), access to sender's public key can decrypt cipher1(must be *this* sender).
Since symmetric_key2 of cipher2 is RSA_Encrypt(receiver's public key), only the receiver can decrypt cipher2.
As was pointed out to me, the process of decrypting cipher2, yields an encrypted message, i.e., cipher1, that can forwarded on behalf of the original sender. This is not necessarily undesirable.  However, SHA1(message) is to ensure that cipher1 has not be altered in transport.  Therefore, the receiver knows three items.
(1) The sender who originated the message.
(2) The receiver is the intended receiver.
(3) The message was not altered during transport.

@_date: 2003-12-16 13:18:15
@_author: mlong@bridgetonconsulting.com 
@_subject: Super-Encryption 
Quoting Ben Laurie :
Without cipher1, implying (iv1, RSA(SHA1(message) || key1)) it is impossible to determine the originator of the message. Remember, I'm thinking in terms of XML-ENC where cipher1 is represented by and these scoping elements will be encrypted to the cipher2 result which is represented by another  and friends.

@_date: 2003-12-17 09:36:35
@_author: mlong@bridgetonconsulting.com 
@_subject: Super-Encryption 
Ben, Amir, et.al.
I see that cipher1 has no transparent value. Therefore, the XML-Encrypted message see (  ) must transport
(1) symmetric_IV
(2) Sign_RSA_Receiver_PK(symmetric_Key)
(3) cipher
(4) Sign_RSA_Sender(SHA1(message))
This is clearly more concise.  If this is an accurate representation of what both of you believe is required for the transport?
