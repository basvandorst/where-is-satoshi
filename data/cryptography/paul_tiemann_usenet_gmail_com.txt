
@_date: 2010-07-25 19:04:06
@_author: Paul Tiemann 
@_subject: A mighty fortress is our PKI 
Hi Peter,
I like your humorous subject line.  After reading your email, I thought of my own humorous twist on a phrase from the same tradition:
"Doth our crypto community judge any CA, before it hear him, and know what he doeth?"
I challenge your Sybil characterization.  Wikipedia's definition:
       "The Sybil attack in computer security is an attack wherein a reputation system is subverted by forging identities in peer-to-peer networks.  It is named after the subject of the book Sybil, a case study of a woman with multiple personality disorder."
       "A Sybil attack is one in which an attacker subverts the reputation system of a peer-to-peer network by creating a large number of pseudonymous entities, using them to gain a disproportionately large influence..."
In this context (SSL cert with many SAN entries for hosted CDN clients) I see these differences:
a) Identities are not being forged.  Each FQDN in the certificate is specifically authorized by the entity owning the domain in question.
b) The entities are *not* pseudonymous -- nobody is using sound-alike or look-alike domain names in there.
c) There is no attempt to gain large influence.  Just to serve content over HTTPS.
The only part that seems to fit is that this kind of certificate presents multiple personalities, however there is no intention  to fool end-users.
Since this is a certificate we (DigiCert) have issued, I'm trying to understand if there is a vulnerability here that's more apparent to others than to me, or if we're looking at something that is more an issue of taste.  If there is a vulnerability, I hope to understand its precise nature first, instead of taking a "shoot first, ask questions later" approach.
The bulk of the FQDNs included in the certificate are for subdomains like media., www-cdn., static., and the like.  Apply a different test: Is it bad for various organizations to use the same CDN for services over http?  Is it bad for all those different FQDNs to CNAME to the same DNS entry and point to the same IP address?  Is it bad for a CDN to host multiple individual SSL certificates for its customers on the same set of hardware?   If not, then what is so abhorrent about their various FQDNs being included in a single SSL certificate?  If it is considered safe to pass HTTP through your CDN, and it is considered safe to pass your HTTPS through a unique SSL certificate on your CDN, why does it cross the line when you put more than one FQDN into one certificate?  If you have 100 SSL sites to host, and they're going to live on a shared platform, is it safer to use an individual certificate for each site?  If a hacker were to compromise your servers and have root access to your filesystem, would individual certificates present a hurdle versus a single certificate with 100 SAN entries?  (Side note: It is a fair amount easier to manage the whole list in one certificate, and if needed to revoke one certificate in the event of a compromise than to hunt down and revoke all affected serials of individual certificates.)
Considering the vulnerability landscape, is it safe to assume that there will be more opportunities for exploiting vulnerabilities in web applications and 3rd party packages at the origin level where the actual web application code is executed than at the CDN level where no PHP/ASP/Java/etc is allowed to run?  There is a security maxim that says "Complexity is the enemy of security."  If you turn that around, into "Simplicity is the friend of security," can it be argued that a CDN will generally be less likely to contain things like file disclosure vulnerabilities simply by virtue of running less application code?
Considering the business incentives landscape, is it safe to assume a strong incentive for a CDN running all those sites to be vigilant about their own server security?  Are there any inherently skewed incentives that I'm just not seeing which would lead a CDN to be negligent in its management of its network security and the SSL certificates it manages?
I've spoken with my contacts at Edgecast, and they expressed that they're very willing to consider alternate approaches.  We discussed SNI as an experimental option that may interest some of their customers -- but I'm sure you are aware that  SSL certificates are not good for much if the SSL clients don't support them, and some widely used software did not add SNI support until very recently.  Of course such realities are a thorn in my side: I would _love_ to see OCSP Stapling widely supported--especially by SSL accelerators, or to see SNI widely supported.  To the extent that such things can be pushed forward by a CA, I want to help push them forward.  For example, due to discussions on the certid at ietf list, we have begun to issue all of our certificates with the Subject Alternative Name extension present, and will handle incompatibilities as they arise, instead of taking the safer, more compatible route that most CAs understandably follow for compatibility's sake.
Focusing on SNI for a second: Would that even improve the security in this scenario?  You would still be running hundreds of certificates on a common platform.  I can see technical advantages when SNI is well supported, like faster SSL handshakes due to smaller end-entity certificates, but are there technical security oriented advantages?
Wrong.  It's not an EV certificate.  EV certificates have to include the CA issuer's EV policy OID in addition to chaining up to an EV-enabled root certificate.  A list of those policy OIDS can be found here: Edgecast doesn't offer EV or wildcard in this kind of certificate, and neither does DigiCert.  One of the purposes of an EV certificate is to identify the subject organization that owns the domains included in the certificate.
In contrast, it's widely agreed that a non-EV certificate needs to at least be authorized by the domain owners.  In this case, the owners of the domains included in the certificate all had to give written approval for Edgecast to include their respective FQDNs in the certificate.  Those approvals are then verified using out-of-band communications with the domain owners.  We take our verification process seriously enough to augment our automated checks with human checks (it costs more to do it the way we do, but we take pride in our work and try to do it responsibly)  If it's hard to believe that coming from me, here's a reference from a respected voice in the security community: Cross-signed by a more ubiquitous Entrust certificate is how I would put it.  Again, SSL isn't very useful if browser clients reject it, and a cross-signed root is a reality of life for many CAs that don't have roots that come from the late nineties.  Legacy clients chain to the Entrust root because they lack the DigiCert root.  Modern clients (FF, IE, Safari, Opera, etc) chain up to the DigiCert root which they include in their trusted list.
No, a certificate is either all EV or all non-EV.  The policy OID's presence is required, and there's only one of those per certificate.
Perhaps ISACA isn't currently pointing its DNS at its Edgecast CNAMEs?  I see 12.239.13.10 for  which is IP spaced owned by ISACA itself.  It could be that ISACA switches its DNS entry to Edgecast during seasonally high traffic, and carries the traffic on its own at other times?
Here's my opinion: It's only kinda funny if there's a real and credible threat to consider.  I don't think ISACA or any other organization should be harried into yanking their FQDN from this specific certificate based on what's been said so far.  Well, I admit I'm not an XS* ninja, but I don't think that's accurate.  The Javascript same origin policy doesn't take any cues about what's considered "same origin" from the SSL cert:
I admit there are areas of XS* in practice which I do not understand perfectly.  Can anyone think of a specific vulnerability here?
As for config problems, you have to weigh the risk of downtime due to running your web presence in one datacenter versus running it at 15+ locations simultaneously via Anycast.  There is always going to be a risk of _something_ happening that can take your site offline.  Running high volume or high profile sites out of multiple locations seems to be a growing practice though.
CDNs running anycast are facing another big problem: There's not much IPv4 space left to go around.  To run anycast you'll need to have a /24 at a minimum.  Even if you put one SSL certificate on each of your spare IP addresses, you're only going to be able to run 254 certificates per block.  What if you eventually have a few thousand customers?  Two realities deserve explicit mention: 1) Most CDNs are new entities, started up long after the days when individuals could get their own giant netblock assignments.  Most CDNs are not sitting on their own /16s.
2) Most CDN customers are big enough to be running an SSL certificate on their main site, and if they are serving all their images and other media content via the CDN, they will _need_ to have SSL on the CDN or they're going to run into "Insecure mixed content" warnings when their HTTPS content refers to HTTP content on the CDN.
Should having an SSL certificate on your CDN cost you more per month than your bandwidth costs, and consume lots of IPv4 space?  What is an appropriate amount of SAN entries in one certificate?  Are two unrelated domains too many?  What about twenty or fifty?  I can tell you at the moment that we're considering putting a cap of somewhere between 25 and 50 on the number of SAN entries allowed in one certificate.  Would that solve the problem?  I'd really like more feedback on how to improve this.  True for (a) which makes it a bit of a show stopper for SNI at the moment, but (b) is not so problematic due to the internal automation that is likely to be a pre-requisite for managing many certificates across multiple locations.
I appreciate the chance to participate in the discussion.  We're very open to considering the risks, and not afraid to make changes based on feedback like this.  From my call with Edgecast I can tell you they feel the same way, and they're willing to make changes to improve.  All the best,
Paul Tiemann
CTO, DigiCert, Inc.

@_date: 2010-07-27 17:14:06
@_author: Paul Tiemann 
@_subject: A mighty fortress is our PKI, Part II 
I like that idea, as long as a verifiable timestamp is included.
Without a trusted timestamp, would the bad guy be able to backdate the signature?
Paul Tiemann

@_date: 2010-07-27 17:20:09
@_author: Paul Tiemann 
@_subject: A mighty fortress is our PKI 
Wow, I was just going to recommend Dan's book, "Security Metrics."
Anyone tasked with quantifying actual security should read his book.  There's a pretty good dissection of ALE, and a fantastic few chapters about building a balanced scorecard to measure your operations from more perspectives than just dollars and cents.
When I read that nist.gov link, the joke about the spherical cow popped into my head.
Paul Tiemann

@_date: 2010-07-27 18:07:02
@_author: Paul Tiemann 
@_subject: A mighty fortress is our PKI 
It appears Apache supports SNI as of 2.2.12 which was released 12 months ago.
The worst of the show stoppers is IE on Windows XP.  No SNI support.
IE6 is still at 7.2% as of June 2010.  It was 14.4% in June 2009.  ... is it possible to help IE6 and other non-SNI browsers to die faster?
 Perry suggested reading Orwell's essay, "Politics and the English Language."  Think about Orwell's opening sentence:
"Most people who bother with the matter at all would admit that the English language is in a bad way, but it is generally assumed that we cannot by conscious action do anything about it."
Now replace "the English language" with "PKI"
"There is a long list of flyblown metaphors which could similarly be got rid of if enough people would interest themselves in the job; and it should also be possible to laugh the not un- formation out of existence*...
*One can cure oneself of the not un- formation by memorizing this sentence: A not unblack dog was chasing a not unsmall rabbit across a not ungreen field.
There is a long list of outdated browsers which could be got rid of if enough people would interest themselves in the job.
One fast way to pressure technological change is for the world to move on to better things and leave the legacy stuff behind.  Who uses Netscape 4 or IE 5 any more?  Those were left behind because everyone in web design wanted CSS support and just started using CSS.  The web design field desperately wants to be throwing IE6-is-dead parties.  Could some intelligent web designers come up with a few snippets of code in the various web flavors (PHP, ASP, JSP, etc) for people to easily install and include on their sites (as part of a movement to discourage old browser usage and encourage better security on the web...)  If an old browser is detected, a friendly warning message or even an error message appears, along with links to the site explaining the movement...  Of course it would only be grassroots, but I've heard enough rumbling on web designer blogs to think that someone might just take up a cause like that.  The security community could encourage it maybe?  Put a Paypal button on there.  I know a lot of people who would donate money.  Looks like at least one site is out there:  but has no Paypal donate button, and doesn't offer newcomers the reasons they should switch to something more modern.
Maybe this is too utopian.  But laughing does work, sometimes.
Paul Tiemann

@_date: 2010-07-27 18:30:51
@_author: Paul Tiemann 
@_subject: A mighty fortress is our PKI 
Apache support for this came out 12 months ago.  Does any one know of statistics that show what percentage of installed Apache servers out there are running 2.2.12 or greater?  How many of the top 10 Linux distributions are past 2.2.12?  A CDN might be able to push SNI forward for its own platform, but mass adoption isn't coming until we also have broad compatibility among the client browsers.  SSL certs as they are currently being used are not good for much if they cause a bunch of browser warnings, so I can't see how you could really expect SSL suppliers to blast holes in their own "Titanic."  New standards are wonderful, but who can use them until they're well supported?
This page says iPhone IOS4 supports SNI.  That just came out.
I wasn't around when this happened, but maybe revoking for "Key compromise" was considered just as good.  And maybe it's rare enough not to need its own special if() statement in all the browsers.  The browsers don't really do different things based on the reason code anyway (to my knowledge) Paul Tiemann

@_date: 2010-07-27 19:06:28
@_author: Paul Tiemann 
@_subject: A mighty fortress is our PKI 
Hi Peter,
Yes.  SNI could have been included from the start, but it was probably hard enough back then to get SSL 1.0 or SSL 2.0 out the door.  It's difficult for a CA to push new SSL extensions if SSL clients aren't ready for what's new.
Agreed.  PKI was designed in a time when IPv4 space was a lot more plentiful too, and few had even dreamt of serving from multiple locations via anycast.  A lot of the time (for good or bad) new pressures form around a problem and people invent new ways of using old things.  It's often easier to reuse an older well supported feature of BGP, TCP or even SSL than to go invent something wonderful and new and then wait years for the world to catch up (think SNI.)
The designers of PKI couldn't foresee all possible future uses, and implementation wasn't perfect from the start.  It wasn't until 2007 that the "Subject Alternative Name" started to see mass adoption, and that was due mainly to Microsoft pushing for it (they had supported it since Windows 95!) which ought to be considered a good thing.
I won't object to 'Sybil' as long as it's understood to mean multi-personality and not deception.
I'll admit that at first it appeared to have been posted as something to be laughed at.  After reading Perry's recommended Orwell essay, I'm willing to admit that laughing at things can be a way to effect change.  Part II was nice.  Shocking and full of thought provoking questions too.
My technical contention is that it's generally going to be harder to compromise an origin caching CDN host because they do not run any web app code at all:
Pseudo code for a CDN http daemon:
while 1:
If running PHP/ASP/Java/etc then those bets are off, but a CDNs don't do this.  Many CDNs just serve up static (non-origin cached, no POST support) sites.
Well, if nothing else, the smaller certificates might at least help whatever PKI library was getting the segv.
Paul Tiemann

@_date: 2010-07-27 22:10:54
@_author: Paul Tiemann 
@_subject: A mighty fortress is our PKI 
I like the idea of SSL pinning, but could it be improved if statistics were kept long-term (how many times I've visited this site and how many times it's had certificate X, but today it has certificate Y from a different issuer and certificate X wasn't even near its expiration date...)
Another thought: Maybe this has been thought of before, but what about emulating the Sender Policy Framework (SPF) for domains and PKI?  Allow each domain to set a DNS TXT record that lists the allowed CA issuers for SSL certificates used on that domain.  (Crypto Policy Framework=CPF?)
cpf.digicert.com IN TXT ""v=cpf1 /^DigiCert/ -all"
Get the top 5 browsers to support it, and a lot of that "any CA can issue to any domain" risk goes way down.
Thought: Could you even list your own root cert there as an http URL, and get Mozilla to give a nicer treatment to your own root certificate in limited scope (inserted into some kind of limited-trust cert store, valid for your domains only)
Is there a reason that opportunistic crypto (no cert required) hasn't been done for https?  Would it give too much confidence to people whose DNS is being spoofed?
Great slides!  The TOFU/POP is nice, and my favorite concept was to translate every error message into a one sentence, easy-to-understand statement.
Paul Tiemann

@_date: 2010-07-28 10:27:52
@_author: Paul Tiemann 
@_subject: A mighty fortress is our PKI 
Ouch, I'm sorry for the mistake!  (I knew I remembered your name in connection with the book, but it's on my bookshelf in the office and I was at home.)
Thanks, my favorite so far is page 45 with the table on Risk Management Culture.  I need to tape that to the wall for inspiration.
Pathologic: Don't want to know
Bureaucratic: May not find out
Generative: Actively seek
Pathologic: Failures punished
Bureaucratic: Local repairs only
Generative: Failures beget reforms
From my point of view: The security community is being Generative (Actively seek) about finding the flaws in systems, but it's too often in the Pathologic (Failures punished) stage about how to handle those flaws once they're discovered.
My suspicion: It's fun to Actively seek, and hard to find solutions, and it can be downright frustrating to champion reforms.  If the vulnerability isn't gigantic, it's hard to even get people to listen.  Reform is maybe 20x harder and 1/5th as fun as poking the holes.
That said, here's an experience worth talking about: Dan Kaminsky did a pretty good job of being Generative in _both_ categories.  He found a hole in DNS, and then worked with LOTS of vendors and even with people not directly tied to DNS to collaborate on reforms.  He even called me (at a smaller CA) to make sure we were aware of the risks and to verify that we don't only rely on automated forms of verification.  I really appreciated the call--it felt like my chance to talk to a rock star.
All the best,
Paul Tiemann

@_date: 2010-07-28 14:17:08
@_author: Paul Tiemann 
@_subject: A mighty fortress is our PKI, Part II 
This isn't true for all OCSP services.  For example, DigiCert's is not CRL based, so it really can say "Yes" and it really can say "Unknown" meaningfully.
True for off-the-shelf OCSP responders that base themselves on CRL.
Paul Tiemann

@_date: 2010-07-28 14:30:32
@_author: Paul Tiemann 
@_subject: A mighty fortress is our PKI, Part II 
It might not be hard to determine whose OCSP responders are CRL based and whose are database backed instead.  Yes we can, and some actually do.
Even the most savvy of relying parties probably has no way of caring.  They want to know when something is positively revoked, and having a definitive Yes is a nice distinction, but having a definitive Not-Revoked appears to be good enough for most.  You're right: a manufactured-cert attack is going to really hurt that kind of an OCSP responder.
Is a manufactured-cert a trivial thing to create?  Paul Tiemann

@_date: 2010-07-28 14:40:14
@_author: Paul Tiemann 
@_subject: A mighty fortress is our PKI, Part II 
That might depend.  I tell Firefox to use OCSP if a responder is referenced in the certificate, and I check that little checkbox that says "When an OCSP connection fails, treat the certificate as invalid."
True, if you don't have that checkbox marked, then Firefox will take a failed OCSP check attempt (connection refused, socket timeout, etc) as a success.  What it ought to do is try the CRL(s) listed in the certificate too, and if both don't work then it really ought to error.
Paul Tiemann

@_date: 2010-07-28 15:30:08
@_author: Paul Tiemann 
@_subject: A mighty fortress is our PKI, Part II 
"it will CLEARLY not solve the browser security problem."
"the certifications made by even the best of those CAs are effectively MEANINGLESS"
"the users are well trained to ignore EVERY browser warning they EVER get"
"the ENTIRE question of OCSP is somewhat irrelevant."
"spritzing the SKUNK with eau de cologne."
"hanging garlands from the corpses ears."
That's all expressed in very certain terms.
Is OCSP _that_ hopeless?  You were kind enough to suggest Orwell to Jay at Edgecast (and possibly also to me.)  I read it, liked it, and I'm glad you sent it.  I sincerely think we can all learn from these two references:
A great essay by Neil Postman:
And Ben Franklin's advice, with one paragraph excerpted below:
And as the chief Ends of Conversation are to inform or to be informed, to please or to persuade, I wish well-meaning sensible men would not lessen their Power of doing Good by a Positive assuming Manner that seldom fails to disgust, tends to create Opposition, and to defeat every one of those Purposes for which Speech was given to us, to wit, giving or receiving Information or Pleasure: For If you would inform, a positive dogmatical Manner in advancing your Sentiments, may provoke Contradiction & prevent a candid Attention. If you wish Information and Improvement from the Knowledge of others and yet at the same time express your self as firmly fix'd in your present Opinions, modest sensible Men, who do not love Disputation, will probably leave you undisturb'd in the Possession of your Error; and by such a Manner you can seldom hope to recommend your self in pleasing your Hearers, or to persuade those whose Concurrence you desire.
(Part One of The Autobiography of Benjamin Franklin, 1793; from The Library of America edition of Benjamin Franklin: Writings, 1987)
All the best,
Paul Tiemann
