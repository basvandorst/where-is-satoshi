
@_date: 2017-12-12 11:33:12
@_author: Max Skibinsky 
@_subject: [Cryptography] High volume thermal entropy from an iPhone 
Hi All,
We recently run a few experiments with entropy generation from an
iPhone camera thermal noise. That turned out to be pretty practical
high volume entropy source. We just published research notes[1] and
prototype source code[2] of everything we hacked so far, feel free to
dig in if that strikes your interest.
- Max / Vault12
[1] [2]

@_date: 2017-12-13 14:05:03
@_author: Max Skibinsky 
@_subject: [Cryptography] High volume thermal entropy from an iPhone 
Alexandre, thanks for reading and suggestions! I will certainly check
out your references.
As it is probably obvious from the essay-style narrative, this is not
intended to be a tight scientific paper, just our research log of
first order ideas we coded up for minimal working prototype. You are
correct on  - current codebase doesn't addresses these issues. is interesting, because besides wide variety of camera hardware that
model should reflect, iOS camera parameters present us with an
opportunity to create optimal hardware source. This is far from our
area of expertise, so I hope somebody in open source community will
pick it up from here and figure out both formal model and what
physical settings will optimize the source.
Thanks again for great suggestions, I will further emphasize impact of
 correlations & VN sensitivity to non-IID in final section. Most
likely practical direction of course is simply use universal hash
extractor instead of VN, since it relaxes a lot of requirements.
- Max

@_date: 2017-12-14 16:22:23
@_author: Max Skibinsky 
@_subject: [Cryptography] High volume thermal entropy from an iPhone 
yes,  is certainly a thorny issue. I assume the "passive" attack
scenario here are hidden patterns in camera firmware and iOS that,
while appearing to us as "perfect" noise are in fact predictable from
low level software specifics (known to manufacturer but unknown to
us). Extreme case of active attack would be corrupt vendor that
actually produces far less noisy camera, and supplements it with
perfect noise generated from seed stamped into each camera firmware -
attack that is next to impossible to detect without reverse
engineering the silicon.
The only weak guarantee i see here is that comparing random
motherboard vendor, dedicated HSM vendor and Apple - the party i would
trust the most would be Apple for economic reasons. What is double
digit millions in reputation/brand damage to small vendors, is tens of
billions of damage to Apple - they have most motivations to keep all
parts of firm/soft ware stack secure. But of course thats just social
guarantee we are trying to avoid in first place.
 - Max

@_date: 2017-12-15 02:22:37
@_author: Max Skibinsky 
@_subject: [Cryptography] High volume thermal entropy from an iPhone 
There seems to be a bit of misunderstanding going on, since I notice a
few people keep referring to "dark frames". Two dark frames example
was used as a strawmen to demonstrate the concept (via photoshoped
file) as an intro for casual reader. The app doesn't not use "dark
frames". In fact due to VonNeumann high sensitivity to quality of raw
entropy the failure is immediately visible if someone forces "dark
frames" by generating with lens covered (χ^2 score shoots into
thousands right away). Dark frames have quite little noise in them,
only about +/-3 on pixel values.
The app/codebase captures full RGB depth frames of live static scenery
from video stream, subtracts consecutive frames from each other, and
then processes the residual noise. The amount of noise variance is
directly correlated with light intensity on the scene: +/-35 range for
well lit scenes. Not surprisingly, the best results are from capturing
mild-grey scenery in middle of the spectrum (max noise range in each
RGB channel centered around 128). [1]
As matter of fact camera does a bit of easy to detect "helpful"
processing - by forcing any non-max resolution . Since every
resolution lower then camera max is practically averaging out group of
pixels, noise drops on lower resolutions and grows quite significantly
on high resolution. We were mostly working with 2Mb frames (1920x1080)
which produce that +/-35 range as good balance between noise entropy
and memory footprint per frame. When we switch to max resolution of
latest Apple devices (3840x2160) noise variance goes all the way up to
+/-50, but processing slows down a lot due to 8mb frames.
- Max
[1]

@_date: 2017-12-15 15:22:31
@_author: Max Skibinsky 
@_subject: [Cryptography] High volume thermal entropy from an iPhone 
I would give Alexandre's point  more credibility, because realistic
scenario would be far simpler. NSA-level resources are not required to
force Apple to corrupt the firmware. NSA-level resources make it
reasonable assumption they might simply find from extensive research
some mathematical or electronical patterns in specific camera model
software stack that are not in fact "natural" thermal noise but, say,
artefacts of specific circuits. (if pixel 1 reports noise 10, pixel 2
always will report noise 11). if such patterns exist the actual
entropy could be far less than our statistical estimates. Do such
weaknesses exist at all in current stack? We simply do not know, thus
we can not give "entropy guarantee" for this method, which would be
possible only after strong mathematical validation, along with full
control own hardware and software stack. But then of course you
wouldn't have 1,000,000,000 install base of devices... Filed under
"crypto-engineer and crypto-scientist walk into the bar...."
One of the craziest story I heard recently: friend of a friend here in
SF suffered from verbal diarrhea about this Ƀ ownership. Eventually he
got what was coming for him: gang of thieves figured out his bank, the
location of safe deposit box with his seed phrase, and attacked that
branch at night to cut out with acetylene torch his individual box.
But stupidity multiplied by stupidity sometimes is equal to a big plus
- he was silly enough to use some sort of homebrew phrase derivation
schema, and that stumped thieves long enough for Mr. Stupid to move
his coins away.

@_date: 2017-12-16 11:57:52
@_author: Max Skibinsky 
@_subject: [Cryptography] High volume thermal entropy from an iPhone 
part of the reasons for choosing Von Neumann was high speed: VN is
just a huge lookup table. After precalculating VN values, the
extraction is just converting incoming sequence into an index in a
giant table, and appending bits from table to the buffer. Efficiency
itself. Nonetheless, even with VN processing 2mb frames on iPhone CPU
is about 5 sec. Just thermal noise alone is ~0.2 sec per frame.
Performance considerations was one of our top concerns to try to keep
bandwidth as high as possible.
After reading suggestions coming from various forums about what we can
do to manage various aspects (correlations etc) it is clear writing
this kind of pre-processing will slow down extraction a lot. So I'm
coming to conclusion that additive entropy via hashing or XOR as an
extra source is a way to go - running independent extractor is just
waste of CPU. With that in mind proper setup of "thermal RNG channel"
would be roughly as following:
1) Get any iPhone with security enclave (internal HRNG for boot)
2) Hard factory reset, delete all apps, update to latest iOS via USB
from secure laptop.
3) Airplane mode, wifi only
4) Install "thermal entropy" extractor from source code
5) If you trust iOS security: write hashed thermal entropy bits into
implement: just provide different (write to /dev/urandom instead of
VN) implemenaton of this interface:
6) If you do not trust iOS stack: compile Yarrow from source, feed 2
sources: thermal entropy + iOS /dev/urandom
7) Use or upload final output via our NaCl channel to final destination.
Beside leveraging common hardware, the main advantage i see is that
iPhone is small & portable mini-computer fully under owner *physical
control*. Even with NSA-level resources, i don't see obvious attack
vectors. First of, how you locate that one phone feeding my farm it if
it's disconnected from cell networks in the first place - among
billions of others?  It might be in storage box half country away. It
might be in my closet in Tahoe. Entropy is fed via zax relays (RPi in
other storage box), so phone private IP is never exposed to
destination services. How you corrupt firmware of that phone if it
never installs any apps and iOS always updated manually? Getting into
iPhone storage/state/sandboxed app over wifi? no known exploits afaik,
iPhone is ridiculously secure vs external over the wire attack.
- Max

@_date: 2017-12-17 14:19:28
@_author: Max Skibinsky 
@_subject: [Cryptography] High volume thermal entropy from an iPhone 
Ray, you are correct - thermal noise in present in live scenery, and
in fact amount of noise is proportional to light intensity:
 Well lit scenes (all the way up until oversatuation limit) on highest
resolution produce the most thermal noise per pixel.
- Max
