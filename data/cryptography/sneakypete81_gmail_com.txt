
@_date: 2016-04-18 12:29:10
@_author: Pete 
@_subject: [Cryptography] USB 3.0 authentication 
Authentication isn't part of the USB Power Delivery spec, it's a separate
document in the zipfile:
"USB Authentication/USB_AUTHENTICATION_R1_0-20160325.pdf".
Take a look - it's fairly readable and I'm sure the USB-IF would appreciate
a few more eyes.
Authentication messages can be sent either using Power Delivery messages
over the Type-C CC wire (to authenticate chargers, etc) or as USB control
transfers (to authenticate "normal" USB devices). Both transports use the
same underlying protocol.
Certificate Format: X.509v3, DER encoding
Digital signing of Certificates and Authentication Messages: ECDSA using
the NIST P256, secp256r1 curve, uncompressed point format
Hash algorithm: SHA256
Here's a brief protocol summary:
1) Initiator requests X.509 certificate chain(s) from the responder.
(Chains can be cached and just the SHA256 digests requested, to speed up
subsequent connections).
2) Initiator sends a challenge with a random nonce.
3) Responder responds with an ECDSA signature of various fields, including
the challenge from 2).
It's up to the Authentication Initiator's policy to decide what to do if
authentication fails. This might be to limit charging to a lower power from
a (potentially dangerous) uncertified charger, or an end-user (or their
employer) might configure their device to refuse access to an unrecognised
USB thumb drive or ignore keystrokes from an unrecognised "keyboard".

@_date: 2016-05-02 19:36:25
@_author: Pete 
@_subject: [Cryptography] USB 3.0 authentication: market power and DRM? 
If authentication fails, the phone can choose not to charge at the maximum
rate. Current draw is totally within the control of the phone's internal
battery charging circuitry. Lower current, less chance of fire.
The charger presents its power capabilities via USB-PD, it's up to the
phone to select which one it wants to use.
Right, no amount of magic crypto will protect a device from this. And a USB
cable with VBUS/GND swapped is usually enough to fry a laptop[1].
You're right to be suspicious, and I imagine there's some truth in this.
But as you say, these companies are already using their own proprietary
charger authentication protocols. This spec is at least providing a common
protocol to allow different vendors' products to authenticate, if they wish
to do so.
[1]
