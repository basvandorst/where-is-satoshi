
@_date: 2016-04-20 01:03:40
@_author: Valmiky Arquissandas 
@_subject: [Cryptography] Security on TRIM for full-disk encrypted SSDs 
Hello, list!
While this is more of a filesystems question, I believe it is appropriate for this topic, which is why I chose to bring it here.
I have heard that TRIMming unused blocks in an SSD is bad from a security standpoint, as it reveals information about the underlying filesystem - which blocks are available, and potentially what that filesystem is.
But in a practical perspective - especially since SSDs have a limited write lifetime and TRIM gives them a better judgement about which blocks to reuse - is that really important?
I understand at least some of the theory - encrypted information is supposed to be indistinguishable from random noise, and TRIM reveals patterns; and a plausible deniability scenario would probably be My use case is the "stolen laptop" scenario. While it contains sensitive information that neither I nor my employer would be exactly happy about losing, I don't see any actor - either criminal or from law enforcement - being interested enough in devoting resources to it, so in practice I am trying to avoid revealing information from a random thief, in which case I believe that full-disk encryption, even with TRIM, more than If we consider that this random thief happens to be a cryptography/infosec/dfir expert, what's the worse they would be able to find out? That I (hypothetically) would be using ext4 and 70% of the drive? Or what the partition scheme is? Or the sizes of each file?
I would find it unlikely that they would be able to recover actual mission-critical contents that could jeopardize me, my employer or our (This is somewhat academic - I believe that for about 90% of the cases, simply using Linux is already enough obfuscation for the random thief :-) )
Valmiky Arquissandas

@_date: 2016-04-20 21:09:22
@_author: Valmiky Arquissandas 
@_subject: [Cryptography] Security on TRIM for full-disk encrypted SSDs 
The pattern is not in the ciphertext, but in the blocks marked by the TRIM operation as unused. Without decrypting the block device, you know which blocks are being used or not.
Since you can tell which blocks are unused, you can definitely infer information like the disk usage, and I *think* these blocks of free space may form patterns that can be used to identify the filesystem (as different filesystems organize their information in their own unique structure, and how they free their space should also be unique).
The plausible deniability scenario should be obvious by now: one can hardly argue their drive is just full of random data when there are visibly scattered unused blocks (that may form an identifiable pattern).
(I'm taking an uncompromising stance on whether these patterns exist because I don't know if wear-leveling makes a difference. I'm supposing it works at a lower level and is irrelevant to this discussion, but I can't say I'm sure.)

@_date: 2016-04-22 01:21:10
@_author: Valmiky Arquissandas 
@_subject: [Cryptography] Security on TRIM for full-disk encrypted SSDs 
This sounds about right to me, and Linus' link is precisely the kind of information I was looking for. It confirms that an attacker may infer how much space is used, and what the underlying filesystem is. My only remaining question is whether this is as far as it gets, or if there is knowledge of something even deeper.
The threat model is responsible for deciding what inferences are acceptable or not; I'm trying to understand what those inferences are.
"how many files on t'internet are 2798954788 bytes long?" -- when a device is FDE'd, and it discards unused blocks, is it ever possible to find out that one of the files is exactly 2,798,954,788 bytes long?
Since files may be fragmented, and their blocks would be fully marked as used - even if they weren't filled - the best guess I would imagine an attacker could make - if there was no fragmentation, the data was completely contiguous, *and* the attacker already knew that - is that the file would be between 2,798,954,496 and 2,798,955,008 bytes long (if blocks are of 512 bytes). When fragmentation scatters a file's contents, I would guess all bets are off.
I use full disk encryption for two purposes - keep the contents of the information I store from being read if my laptop (or backup drive) is stolen, and protect the (Linux) partition that contains it from being readable from the Windows system (dual boot). Should my Windows installation become a target of the likes of ransomware (or plain old spyware), it may encrypt my irrelevant files, but it won't ever be able to read or overwrite those that matter (unless it nukes the LUKS metadata, or it is so advanced it poisons the boot process to recover the passphrase). Worst case, I have to reach my backups, but nothing should have been revealed.
