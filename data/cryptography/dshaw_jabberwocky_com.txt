
@_date: 2001-12-02 02:56:59
@_author: David Shaw 
@_subject: wu-ftpd-2.6.2 fails GPG & PGP2 signature verifications, passes PGP6! 
The immediate problem is in the signature:
:signature packet: algo 1, keyid 0ECD082462885875
        version 3, created 1007126392, md5len 5, sigclass 01
        digest algo 1, begin of digest ea 0d
        data: [1024 bits]
Note the sigclass.  Sigclass 0x01 means "signature on a canonical TEXT
document".  The signature is calculated after changing the end-of-line
characters to CRLF, and stripping trailing blanks.
The wu-ftpd tarball is certainly not text, and as such, seems to be
causing problems with the text canonicalization code in at least one
of the programs.  Basically, PGP 6.5.8, PGP 2.6.3i, and GnuPG 1.0.6
are canonicalizing this "text" differently.  It's nearly 3am here, so
I'm not going to delve into which is correct. ;)
After running a few experiments, I was able to successfully verify the
signature with GnuPG by modifying the text canonicalization code (this
doesn't mean the problem is in GnuPG - just that I'm more familiar
with it, so it was easier for me to test with).  I'm not surprised the
signature verified correctly with PGP 6, as it was made with PGP 6 in
the first place.
In any event, since the wu-ftpd tarball is certainly not text, a
signature on a binary document (sigclass 0x00) would avoid all these
problems and would likely verify without any difficulty.  To do this,
the signer needs to remove "TextMode" or "-t" from their PGP

@_date: 2001-10-10 09:04:22
@_author: David Shaw 
@_subject: Richard Clarke 
So, according to CNN:
 Richard Clarke, already on the National Security Council as a special
 adviser for cyber security, will take over a new post in charge of
 combating cyber terrorism and protecting essential information
 networks.
I've been rummaging around looking for some statements as to what he
believes.  Some interesting bits follow, both positive and negative.
They're somewhat out of context, so read the originals for the full
 By not preparing for the worst-case scenario, we may be endangering
 the public's civil liberties, according to Clarke, who argued that "a
 lot of people are going to be willing to throw civil liberties out
 the window" in an effort to recover from an attack that cripples
 large portions of the nation's critical infrastructure.
 (Some history)
 For two years or so, this Dr. Strangelove of the Clinton
 administration has rattled his chains and groaned repeatedly about
 e-terror. Oddly, the more Clarke has flailed publicly, calling for
 the gutting of FOIA or the funding of more cybersnooping agencies,
 the less effective he appears to have been. The current
 Republican-dominated Congress has not been overwhelmed by the
 strident hectoring. An even greater paradox is the fact that Clinton
 appointed Clarke, a veteran of the Reagan administration who warned
 of international terror in the mid-80's, to help kill Republican
 accusations that he was weak on Net evil.
 (Clarke himself):
 Through the use of strong encryption and authentication, ideally at
 the packet level, network traffic can be kept private and much more
 secure. Encrypting and authenticating switching protocols and network
 enterprise management systems is also essential.
 [..]
 Participation in a secure zone with dedicated fiber and switches, with
 portal monitoring, strong encryption, and authentication, should be
 voluntary and the zone should be designed, built, and operated largely
 by the private sector.

@_date: 2001-10-23 18:38:32
@_author: David Shaw 
@_subject: My HP printer talking to the FBI? 
FWIW, the IP address is in a block owned by the "National White Collar
Crime Center" ( who runs the Internet Fraud Complaint
Center for the FBI.

@_date: 2002-01-15 23:19:57
@_author: David Shaw 
@_subject: PGP & GPG compatibility 
I recently spent a good bit of time working out various compatibility
issues between GnuPG and different versions of PGP.  In the process, I
added a --pgp2 flag to the new (not yet released) GnuPG which sets up
the various options for a PGP 2.x message, and also prints a warning
if the user does something that would render the message not PGP 2.x
I've gotten some interest in a --pgp6 flag, but there is less of a
need for this as the default options in GnuPG now do the right thing
for PGP 6/7 in nearly all circumstances within the constrains of the
RFC.  Plus, a --pgp6 would then imply a --pgp7 followed by a --pgp8
someday and it's a path I'm reluctant to head down. :)

@_date: 2002-01-21 17:02:07
@_author: David Shaw 
@_subject: PGP & GPG compatibility 
I don't believe this means GPG will ship with IDEA.  The new GPG does,
however, make things terribly obvious at to what needs to happen to
enable IDEA by printing out a URL for a web page that explains the
whole situation when IDEA is needed but not present.  I'm not sure if
that web page currently has a link to download the IDEA plugin, but
(IMO) it should.
The --pgp2 option requests PGP2 compatibility.  It causes no harm to
leave it enabled all the time, in which case it effectively gives you
With --pgp2 set, GPG will be PGP2 compatible if at all possible, and
if the user insists on doing something that would render the message
not usable by PGP2, it prints a message explaining what the user did
that was not compatible and warns that the message will not be usable
by PGP2.  Either way, the message should still be usable with GPG and
PGP 6 & 7, of course.
I am very concerned with interoperability issues using GPG.  If
someone is having a particular problem, I'd love to hear it so I can
at least try to do something about it (I wrote the --pgp2 option as

@_date: 2002-01-22 11:46:56
@_author: David Shaw 
@_subject: PGP & GPG compatibility 
Multiple receipients where some are PGP2 [1] users and some are
OpenPGP-ish (GnuPG/PGP6/PGP7) users are simply impossible to support
in all but a very small (and rare) set of circumstances.  This is not
a flaw in GnuPG or PGP - it's in the nature of the two different
standards that govern PGP2 and OpenPGP, and how the original PGP2 was
This is somewhat long, so feel free to skip to the conclusion: It is
not completely true that GnuPG has no way of knowing what version a
particular key corresponds to: OpenPGP keys contain a list of the
ciphers (as well as hashes and other details) that key is willing to
accept.  This doesn't give the name/version of the implementation the
user is using, but it does show its capabilities.
With ciphers, if 3DES isn't on the list, it is implicitly tacked on at
the end.  This lets implementations resolve any problems that can
happen if two different keys from two different implementations
support two different sets of ciphers.  If all else fails, 3DES is
always there.  IDEA may be on this list, but this is not required in
OpenPGP.  There is a special exception to the "tack 3DES on at the
end" rule for PGP2-style keys.  In this case, the implementation is
allowed to pretend that there is a cipher list consisting of only
See where this leaves us: OpenPGP uses 3DES as the one cipher that
every implementation must support, and is not required to support
IDEA.  PGP2 uses IDEA as the one and only cipher, period.  We're
heading for trouble.
So, in the case when a user encrypts to a PGP2-style and OpenPGP-style
key that does not have a preference listing for IDEA at the same
time... what is the right thing to do?  There is no cipher that both
keys are willing to accept.  If the implementation follows the PGP2
key fake "preference", it violates the OpenPGP spec (and may not be
decryptable to boot).  If the implementation follows the OpenPGP key
preference, it might be sending a message that the PGP2 key cannot
decrypt.  The only hope is that the PGP2 key could be being used in a
OpenPGP implementation, which by definition could handle a 3DES
message.  A reasonable thing to do here is to figure that a "might
work" is better than a "violates the spec and probably won't work
anyway", use 3DES, warn the user, and hope.
Now that I've said all that, ignore it: it's true, but it doesn't
matter in the real world.  This is because PGP2 is extraordinarily
sensitive to *anything* it doesn't understand in a message.  Even if
you happen to be encrypting to an OpenPGP key that accepts IDEA along
with your PGP2 key, you're likely in trouble unless the OpenPGP key is
RSA and <=2048 bits (which there are nearly none of, as most are
DSA/ElGamal and most programs couldn't even generate OpenPGP RSA keys
until fairly recently).  On top of that you have a handful of fiddly
differences in how packets are constructed, and the bottom line is
that your comment earlier is absolutely right - trying to encrypt to
multiple recipients (unless they're *all* PGP2 people) is an exercise
in futility.
So basically, this is a long winded way of saying you can be PGP2
compatible, and you can be OpenPGP compatible, but you can't really do
them both at the same time.  One answer, and how I implemented --pgp2
in GnuPG, is to try and force the issue: just do *everything* the PGP2
way and keep an eye on what the user is requesting.  If they request
something that just won't work with PGP2, say so and say why, so at
least the user knows what is going on and won't be surprised when they
try to use PGP2 to process the message.  Since GnuPG/PGP6/PGP7 all
understand PGP2 messages, this does give you one configuration for all
messages, but of course, you don't get to use most of the new OpenPGP
Probably more detail than most people care about, but the point I'm
eventually getting to here is that this is not something that can be
trivially fixed with code.  The real problem here is that PGP2 and the
OpenPGP-ish programs (GnuPG/PGP6/PGP7) follow two different (albeit
related) standards, and PGP2 is almost completely unforgiving with
anything that is not exactly to its standard.  Interoperating between
GnuPG and PGP6 or 7 even with varying levels of conformance to the
OpenPGP standard is a walk in the park compared to interoperating with
a different standard altogether.
The answer?  Upgrade from PGP2 to something more OpenPGP-ish.  You get
to keep your old keys, you gain lots of interesting OpenPGP features,
and you make life easier for all the people who communicate with you.
[1] "PGP2" here means "MIT PGP 2.6.2".  There are other variations on
    PGP2, including the high-octane PGP 2.6.3ia-multi
    ( which supports lots of
    modern ciphers and other features.  Unfortunately, there is no way
    to tell just from looking at the key that a receipient is using
    this version, so the sender usually must assume otherwise.

@_date: 2002-03-31 18:08:14
@_author: David Shaw 
@_subject: on the state of PGP compatibility (2nd try) 
I sympathize with your problems, but frankly (and I suspect you know
this, despite your justified irritation) some of the problems you had
are well beyond the scope of "PGP compatibility".  It's not a flaw in
PGP compatibility that PGP5.x won't compile cleanly any longer because
of changes to your build platform, nor is it a flaw in PGP
compatibility that some buggy program you were working with ate your
PGP 2.x keyring files.
The OpenPGP spec handles compatibility issues quite well.  The catch,
of course, is that PGP 2.x isn't OpenPGP and PGP 5.x isn't OpenPGP.
PGP 6 and 7 aren't really OpenPGP either, but they're generally close
enough for all practical purposes.
PGP 7 or GnuPG with the IDEA plugin can handle messages from any
version of PGP, OpenPGP or not.
The IDEA plugin is available at:
   ftp://ftp.gnupg.dk/pub/contrib-dk/idea.c
   ftp://ftp.gnupg.dk/pub/contrib-dk/idea.c.sig
I doubt it's intentionally hidden, though it's certainly a pain to

@_date: 2002-03-31 22:27:08
@_author: David Shaw 
@_subject: what is GPG's #1 objective: security or anti-patent stance ( Re: on the state of PGP compatibility (2nd try)) 
============================== START ==============================
The fragmented user base is unfortunate.  Sometimes I almost wish that
PGP 5 had completely broken backwards compatibility with PGP 2 and
started clean.  At least then there would be no expectation of
I have spent hours upon hours poring over GnuPG messages, PGP 2
messages, PGP 6 messages and PGP 7 messages in an effort to reach the
one magical configuration that just plain *works*.  The sad fact is
that it is just not possible.  This shouldn't be surprising - version
n+1 of a computer program adding new features over version n.  Version
n then doesn't work with a version n+1 message.  It's a story as old
as computing.  OpenPGP fixes it by giving one spec for everyone to
follow, and by including a fairly rich syntax of "this is what I can
handle" notations in the keys.  It works quite well.  Problems tend to
arise mostly between the PGP6/PGP7/GnuPG and PGP2 worlds which OpenPGP
can't help of course.
Again, PGP 6 isn't OpenPGP, and neither is PGP 7 (though it is closer
than PGP 6).  I'm sure that PGP 8 would have followed OpenPGP even
more closely than PGP 7 did, but that doesn't look like it's going to
happen now.
GnuPG does follow OpenPGP.  It also has dozens of tricks and traps to
work around PGP behavior where PGP doesn't follow OpenPGP.  It even
(in GnuPG 1.0.7 (coming soon)) has a pgp2 and pgp6 modes to
"downgrade" messages it generates to what those versions of PGP can
handle (it can read messages from any version of course).
Since GnuPG can read a message from any version of PGP, and can
generate a message for any version of PGP (obviously doing a better
job of it the closer that version of PGP follows the OpenPGP spec),
and runs on your chosen platform (Linux), I think the real meat of
your complaint is in regards to the IDEA plugin:
I would not call this a bug.  A bug is a failure of the system to act
as described.  It is not a bug if the system annoys a user to the
point of not using the system :)
Still, yes, the IDEA plugin situation is far from ideal.  The bottom
line is that GPLed software can't use patented algorithms as it
contradicts the GPL.  It doesn't matter that the IDEA licence
basically allows free non-commercial use - it still contradicts the
I would be quite happy if it became possible to include IDEA (maybe a
compile-time option?), but the reality is that IDEA is not required by
OpenPGP and every version of PGP from 5 onwards can communicate
without it.

@_date: 2003-08-21 23:33:40
@_author: David Shaw 
@_subject: PRNG design document? 
"Software Generation of Practically Strong Random Numbers" by Peter
and the followup:

@_date: 2003-12-05 23:44:46
@_author: David Shaw 
@_subject: Additional Proposed Hash Function (Forwarded) 
Does anyone know what the story is behind this?  It seems to be the
same sort of relationship that SHA-384 has to SHA-512 - that is, the
same basic algorithm, the same amount of work to calculate it, but
with different initial values, and some bits chopped off at the end.
It all seems a lot of effort just to save 4 bytes in the final hash.

@_date: 2003-06-17 20:40:56
@_author: David Shaw 
@_subject: The meat with multiple PGP subkeys 
The problem is that the PKS keyserver was not written to handle keys
with multiple subkeys.  This was around the era of PGP 5.0, RFC-2440
hadn't been published yet, and there was some uncertainty on that
topic.  So PKS was never written to handle multiple subkeys, and as an
unfortunate side effect of that, it mangled any keys it saw that did
have multiple subkeys.  On top of that, since keyservers synchronize
with each other, every other server would learn this mangled key.
Alas, PKS is still in wide use, but never got the ability to handle
multiple subkeys.  I contributed some fixes so PKS would at least not
mangle keys, but not every keyserver has upgraded.
Yes, and both PGP and GnuPG handle them correctly.  It's just this one
particular keyserver program that doesn't.
The ultimate solution is to either fix or replace PKS.  Both of these
have been happening, with a fair edge to the "replace" camp.  There
are several different keyservers (SKS [1], ONAK [2], etc) that are
truly 2440 compliant.  SKS is probably the most mature at this point,
and can replace a PKS installation.
Note that the LDAP keyserver from PGP.com works correctly as well, but
is not a free (in cost and in freedom) product so is generally not
used as part of the public keyserver net.  The PGP folks run one at
ldap://keyserver.pgp.com, but it is not synchronized with the rest of
the servers.
A reasonable question would be "Why don't all the PKS operators
replace their server with SKS or something else?".  I don't have a
good answer to that.  It's certainly been asked.[3]
Recently, the number of working keyservers reached the point where it
became possible to establish a simple way to reach them.  Similar to
the "wwwkeys.pgp.net" round robin keyserver address, the
"subkeys.pgp.net" name will reach one of the unbroken keyservers
(keyserver.kjsl.com being one of them), ignoring the broken ones.
So, the short answer to all of this is to use "subkeys.pgp.net" as
your keyserver and you should be fine.  The next version of GnuPG will
ship with this set as the default keyserver.
[1] [2] [3]

@_date: 2003-06-18 10:54:39
@_author: David Shaw 
@_subject: The meat with multiple PGP subkeys 
These servers are *broken*, and harming the use of PGP.  Countless
FAQs and other documents extol the keyserver network, and so new PGP
users try it and get their keys eaten.  One would hope that
never-change-a-running-system wouldn't apply when the running system
was actively causing damage.  It's not just subkeys: PKS allows for a
number of denial of service attacks against keys stored in it.
It's a question, but the way I see it, if a keyserver operator doesn't
want to fix critical bugs for fear of messing with a stable system,
then just turn the thing off.  That's stable too, and doesn't harm
At least now there is subkeys.pgp.net so users can ignore the servers
that aren't being fixed (and we "just" have to educate everyone to use

@_date: 2004-08-17 01:10:16
@_author: David Shaw 
@_subject: MD4 collision reproduced 
I have reproduced both MD4 collisions from the recent paper.  The
example given had endian problems similar to those noted by Eric
Rescorla for the sorta-MD5 collision.  Also similar to Eric's results,
the hash value (while a collision) does not match what the authors
give in the paper.
Example one:
$ od -tx1 file1.bin 0000000 83 9c 7a 4d 7a 92 cb 56 78 a5 d5 b9 ee a5 a7 57
0000020 3c 8a 74 de b3 66 c3 dc 20 a0 83 b6 9f 5d 2a 3b
0000040 b3 71 9d c6 98 91 e9 f9 5e 80 9f d7 e8 b2 3b a6
0000060 31 8e dd 45 e5 1f e3 97 08 bf 94 27 e9 c3 e8 b9
$ od -tx1 file2.bin
0000000 83 9c 7a 4d 7a 92 cb d6 78 a5 d5 29 ee a5 a7 57
0000020 3c 8a 74 de b3 66 c3 dc 20 a0 83 b6 9f 5d 2a 3b
0000040 b3 71 9d c6 98 91 e9 f9 5e 80 9f d7 e8 b2 3b a6
0000060 31 8e dc 45 e5 1f e3 97 08 bf 94 27 e9 c3 e8 b9
$ cmp file1.bin file2.bin
file1.bin file2.bin differ: char 8, line 1
$ openssl md4 file1.bin file2.bin
MD4(file1.bin)= 4d7e6a1defa93d2dde05b45d864c429b
MD4(file2.bin)= 4d7e6a1defa93d2dde05b45d864c429b
Example two:
$ od -tx1 file1.bin 0000000 83 9c 7a 4d 7a 92 cb 56 78 a5 d5 b9 ee a5 a7 57
0000020 3c 8a 74 de b3 66 c3 dc 20 a0 83 b6 9f 5d 2a 3b
0000040 b3 71 9d c6 98 91 e9 f9 5e 80 9f d7 e8 b2 3b a6
0000060 31 8e dd 45 e5 1f e3 97 40 c2 13 f7 69 cf b8 a7
$ od -tx1 file2.bin 0000000 83 9c 7a 4d 7a 92 cb d6 78 a5 d5 29 ee a5 a7 57
0000020 3c 8a 74 de b3 66 c3 dc 20 a0 83 b6 9f 5d 2a 3b
0000040 b3 71 9d c6 98 91 e9 f9 5e 80 9f d7 e8 b2 3b a6
0000060 31 8e dc 45 e5 1f e3 97 40 c2 13 f7 69 cf b8 a7
$ cmp file1.bin file2.bin file1.bin file2.bin differ: char 8, line 1
$ openssl md4 file1.bin file2.bin MD4(file1.bin)= c6f3b3fe1f4833e0697340fb214fb9ea
MD4(file2.bin)= c6f3b3fe1f4833e0697340fb214fb9ea

@_date: 2004-09-14 18:25:15
@_author: David Shaw 
@_subject: pci hardware for secure crypto storage (OpenSSL/OpenBSD) 
Since your environment includes GPG, then I think the OpenPGP
smartcard meets pretty well what you are requesting.  Combine it it
with a USB smartcard reader, and the card becomes USB, too ;)

@_date: 2006-04-26 22:34:23
@_author: David Shaw 
@_subject: PGP "master keys" 
It sounds rather like a misunderstanding/mangling of PGP's Additional
Decryption Key feature.

@_date: 2006-09-15 09:48:16
@_author: David Shaw 
@_subject: A note on vendor reaction speed to the e=3 problem 
GPG was not vulnerable, so no fix was issued.  Incidentally, GPG does
not attempt to parse the PKCS/ASN.1 data at all.  Instead, it
generates a new structure during signature verification and compares
it to the original.

@_date: 2006-09-15 14:22:39
@_author: David Shaw 
@_subject: A note on vendor reaction speed to the e=3 problem 
GPG generates a new structure for each comparison, so just doesn't
include any extra parameters on it.  Any optional parameters on a
signature would cause that signature to fail validation.
RFC-2440 actually gives the exact bytes to use for the ASN.1 stuff,
which nicely cuts down on ambiguity.

@_date: 2006-09-16 17:34:23
@_author: David Shaw 
@_subject: A note on vendor reaction speed to the e=3 problem 
That is correct.  OpenPGP passes the hash identification in the
OpenPGP data as well as encoded in ASN.1 for the PKCS-1 structure.
Since there is another source for the information, it is unnecessary
to generate or parse ASN.1.  In the case of GPG specifically (other
implementations may do the same, but I can't say for sure), all ASN.1
data is hardcoded opaque strings.

@_date: 2009-08-31 20:34:22
@_author: David Shaw 
@_subject: [Macgpg-users] GPGMail & Snow Leopard 
============================== START ==============================
To be strictly accurate, the problem is with GPGMail, the plugin that  integrates GPG with Apple's Mail application (as Mail internals  changed significantly between Leopard and Snow Leopard).  GPG itself  seems to work just fine under Snow Leopard, albeit on the command line.

@_date: 2010-04-09 15:33:39
@_author: David Shaw 
@_subject: Wikileaks video "crypto". 
According to an interview with Julian Assange (one of the Wikileaks founders) at  , the decryption was essentially passphrase guessing.   From Google Translate: "He and a team of cryptographers had then worked for about three months out.  The aim was to find among a few million of the most likely the correct passwords."
See also  around the 1:22 mark.
For what it's worth, the original encrypted file (encrypted with OpenSSL's 'enc' tool it seems) is claimed to be at   They do not provide the passphrase that managed to decrypt it.
