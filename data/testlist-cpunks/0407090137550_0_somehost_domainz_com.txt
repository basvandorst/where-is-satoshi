
@_date: 2004-07-09 01:03:34
@_author: Justin 
@_subject: Querying SSL/TLS capabilities of SMTP servers 
References: <0407081735340.-1275484700
  <20040708215044.GA20069
  <0407090137550.0
This should work much better, and has some additional keywords that help
to figure out what's going on.  This works on hotmail.
I noticed one host was hanging until I started using \r\n.
It might be worthwhile to ensure nagle is turned off between the EHLO
and the QUIT.
use IO::Socket;
use Net::DNS;
$dlevel = 0;
sub debug {
    ($str, $mlevel) =     if ($mlevel <= $dlevel) {
    }
sub checkmailtls {
    my ($domain, $mpri, $mrelay) =     my $proto = "";
    my $hastls = "no-tls";
    my     my $mhost = IO::Socket::INET->new (
 	    Proto => "tcp",
    );
    if (! defined $mhost) {
    }
    debug("testing $mrelay $mpri\n", 1);
    $greeting = <$mhost>;
    if ($greeting =~ /\*\*\*\*\*\*\*\*/) {
    }
    if ($greeting =~ /(esmtp|postfix|sendmail)/i) {
    }
    elsif ($greeting =~ /[^eE][sS][mM][tT][pP]/) {
    }
    else { $proto = "smtp"; }
    print $mhost "EHLO I-love-my-country.whitehouse.gov\r\n";
    print $mhost "QUIT\r\n";
    while (<$mhost>) {
    }
    print "$domain $mpri $mrelay $proto $hastls     close $mhost;
 begin debug("argc: $ 1);
if ($ >= 0) {
  for ($i = 0; $i <= $ $i++) {
    push ( $ARGV[$i]);
  }
} else {
  while (<>) {
    chomp;
    push ( $_);
  }
while ($domain = shift( {
    # $res = Net::DNS::Resolver->new();
    #  = mx($res, $domain);
    my  = mx($domain);
    if ($ == -1) {
    }
    foreach $record ( {
        my $mrelay = $record->exchange ;
        my $mpri = $record->preference ;
    }
