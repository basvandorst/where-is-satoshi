
@_date: 2005-08-17 14:16:19
@_author: Nicolas Gieczewski 
@_subject: tor failing to receive directory on FreeBSD 
I can't get tor v0.1.0.14 to work on FreeBSD. It looks like it's failing to receive a directory, which results in the inability to build a circuit. I've been able to reproduce this problem on two different boxes running FreeBSD 5.4-STABLE with both versions 0.1.0.14 and 0.1.0.11 of tor. When running the same versions of tor on Linux and Windows, on the other hand, tor successfully receives a directory and builds a circuit in under 5 seconds.
Debugging information output by tor on FreeBSD:
Aug 17 13:11:01.356 [notice] Tor v0.1.0.14. This is experimental software. Do not rely on it for strong anonymity.
Aug 17 13:11:01.357 [notice] Initialized libevent version 1.1a using method kqueue
Aug 17 13:11:01.357 [info] connection_add(): new conn type App listener, socket 4, nfds 1.
Aug 17 13:11:01.357 [info] connection_add(): new conn type App listener, socket 5, nfds 2.
Aug 17 13:11:01.357 [info] connection_add(): new conn type Control listener, socket 6, nfds 3.
Aug 17 13:11:01.360 [info] crypto_seed_rng(): Seeding RNG from /dev/urandom
Aug 17 13:11:01.632 [info] read_file_to_str(): Could not stat /var/db/tor/cached-directory.
Aug 17 13:11:01.632 [info] directory_get_from_dirserver(): No router found for directory; falling back to dirserver list
Aug 17 13:11:01.633 [info] connection_add(): new conn type Dir, socket 7, nfds 4.
Aug 17 13:11:01.865 [info] connection_dir_finished_connecting(): Dir connection to router 18.244.0.114:80 established.
(Nothing else happens.)
Debugging information output by tor on Linux:
Aug 17 11:30:13.856 [notice] Tor v0.1.0.14. This is experimental software. Do not rely on it for strong anonymity.
Aug 17 11:30:13.857 [notice] Initialized old libevent (version 1.0b or earlier)
Aug 17 11:30:13.857 [warn] You have a very old version of libevent.  It is likely to be buggy; please consider building Tor with a more recent version.
Aug 17 11:30:13.858 [info] connection_add(): new conn type App listener, socket 6, nfds 1.
Aug 17 11:30:13.862 [info] crypto_seed_rng(): Seeding RNG from /dev/urandom
Aug 17 11:30:14.493 [info] read_file_to_str(): Could not stat /home/maple/.tor/cached-directory.
Aug 17 11:30:14.494 [info] directory_get_from_dirserver(): No router found for directory; falling back to dirserver list
Aug 17 11:30:14.494 [info] connection_add(): new conn type Dir, socket 7, nfds 2.
Aug 17 11:30:14.540 [info] connection_dir_finished_connecting(): Dir connection to router 18.244.0.188:9031 established.
Aug 17 11:30:15.660 [info] connection_dir_client_reached_eof(): Time on received directory is within tolerance; we are 559 seconds skewed.  (That's okay.)
Aug 17 11:30:15.680 [info] connection_dir_client_reached_eof(): Received directory (size 856002) from server '18.244.0.188'
Aug 17 11:30:15.978 [info] connection_dir_client_reached_eof(): updated routers.
Aug 17 11:30:15.978 [info] directory_has_arrived(): A directory has arrived.
Aug 17 11:30:15.978 [info] conn_close_if_marked(): Cleaning up connection (fd 7).
Aug 17 11:30:15.978 [info] connection_remove(): removing socket 7 (type Dir), nfds now 1
Aug 17 11:30:15.978 [info] _connection_free(): closing fd 7.
Aug 17 11:30:16.495 [info] circuit_predict_and_launch_new(): Have 0 clean circs (0 internal), need another exit circ.
Aug 17 11:30:16.496 [info] choose_good_exit_server_general(): Found 132 servers that might support 0/0 pending connections.
Aug 17 11:30:16.496 [info] choose_good_exit_server_general(): Chose exit server 'ned'
Aug 17 11:30:16.496 [info] connection_add(): new conn type OR, socket 7, nfds 2.
Aug 17 11:30:16.541 [info] connection_or_finished_connecting(): OR connect() to router at 140.247.62.121:9001 finished.
Aug 17 11:30:16.806 [info] circuit_finish_handshake(): Finished building circuit hop:
Aug 17 11:30:16.806 [info] circuit_log_path(): exit circ (length 3, exit ned): rodos(open) xefyc(closed) ned(closed)
Aug 17 11:30:16.948 [info] circuit_finish_handshake(): Finished building circuit hop:
Aug 17 11:30:16.949 [info] circuit_log_path(): exit circ (length 3, exit ned): rodos(open) xefyc(open) ned(closed)
Aug 17 11:30:17.207 [info] circuit_finish_handshake(): Finished building circuit hop:
Aug 17 11:30:17.207 [info] circuit_log_path(): exit circ (length 3, exit ned): rodos(open) xefyc(open) ned(open)
Aug 17 11:30:17.207 [info] circuit_send_next_onion_skin(): circuit built!
Aug 17 11:30:17.207 [notice] Tor has successfully opened a circuit. Looks like it's working.
Any ideas? I'll be happy to provide any additional information that may help debug this.
Thanks in advance,
