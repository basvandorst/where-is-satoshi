
@_date: 2005-07-15 14:57:19
@_author: Jan Tore Morken 
@_subject: tor 0.1.0.11 crash on Debian testing 
I had tor suddenly stop working for me last night, running tor 0.1.0.11 on Debian testing.
Checking /var/log/tor/log I found this:
[err] routerlist.c:242: mark_all_trusteddirservers_up: Assertion router->dir_port > 0 failed; aborting.
tor dies almost immediately after running it. A core dump is saved in /var/lib/tor.
# sudo -u debian-tor tor RunAsDaemon 0
Jul 15 13:21:41.566 [notice] Tor v0.1.0.11. This is experimental software. Do not rely on it for strong anonymity.
Jul 15 13:21:41.568 [notice] Configuration file '/etc/tor/torrc' not present, using reasonable defaults.
routerlist.c:242 mark_all_trusteddirservers_up: Assertion router->dir_port > 0 failed; aborting.
# sudo -u debian-tor gdb /usr/sbin/tor /var/lib/tor/core
GNU gdb 6.3-debian
Copyright 2004 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "i386-linux"...Using host libthread_db library "/lib/tls/libthread_db.so.1".
Core was generated by `/usr/sbin/tor'.
Program terminated with signal 6, Aborted.
warning: current_sos: Can't read pathname for load map: Input/output error
Reading symbols from /usr/lib/libz.so.1...done.
Loaded symbols for /usr/lib/libz.so.1
Reading symbols from /usr/lib/i686/cmov/libssl.so.0.9.7...done.
Loaded symbols for /usr/lib/i686/cmov/libssl.so.0.9.7
Reading symbols from /usr/lib/i686/cmov/libcrypto.so.0.9.7...done.
Loaded symbols for /usr/lib/i686/cmov/libcrypto.so.0.9.7
Reading symbols from /lib/tls/libpthread.so.0...done.
Loaded symbols for /lib/tls/libpthread.so.0
Reading symbols from /usr/lib/libevent-1.1a.so.1...done.
Loaded symbols for /usr/lib/libevent-1.1a.so.1
Reading symbols from /lib/tls/libc.so.6...done.
Loaded symbols for /lib/tls/libc.so.6
Reading symbols from /lib/tls/libdl.so.2...done.
Loaded symbols for /lib/tls/libdl.so.2
Reading symbols from /lib/ld-linux.so.2...done.
Loaded symbols for /lib/ld-linux.so.2
  0x401a583b in raise () from /lib/tls/libc.so.6
(gdb) bt
  0x401a583b in raise () from /lib/tls/libc.so.6
  0x401a6fa2 in abort () from /lib/tls/libc.so.6
  0x08086f11 in mark_all_trusteddirservers_up () at routerlist.c:237
  0x080869db in router_pick_directory_server (requireothers=1, fascistfirewall=0, for_runningrouters=0, retry_if_no_servers=1) at routerlist.c:112
  0x0806cfa6 in directory_get_from_dirserver (purpose=1 '\001', resource=0x0, retry_if_no_servers=1) at directory.c:178
  0x08078ce8 in run_scheduled_events (now=1121423699) at main.c:671
  0x08078f64 in second_elapsed_callback (fd=0, event=0, args=0x0) at main.c:835
  0x08079406 in do_main_loop () at main.c:943
  0x0807a105 in tor_main (argc=0, argv=0x0) at main.c:1614
  0x0808dd3b in main (argc=0, argv=0x0) at tor_main.c:19
Now, by renaming /var/lib/tor/cached-directory and running tor again to get a new version of it, the problem is solved.
A copy of the file not working and the core file is here: Sorry, I'm a bit of a hurry when writing this, but if you have any further questions, feel free to ask.
