
@_date: 2018-04-17 23:27:51
@_author: Masayuki Hatta 
@_subject: [tor-talk] Fixing Orchid (Tor reimplementation in Java) 
Hi everyone,
As some of you might remember, there was a thing called Orchid, an
independent Tor client/library implementation written in pure Java.
Unfortunately, Orchid became an abandonware (I suppose) and doesn't
work at all for a while.
Recently, I was interested in Orchid and could fix most of the
important bugs.  Now Orchid works again.
I'm not really a Java (and Tor) guy, so this is basically for my
education, but if you are interested, please give it a try (and send
me patches or PRs if you find anything bad).
You may find new Orchid:  Best regards,

@_date: 2018-12-11 15:18:00
@_author: Masayuki Hatta 
@_subject: [tor-talk] comparison of Tor and Kovri in regards to 
I might be a kind of a rare bird here since I'm involved with both I2P
and Tor.  I was also involved with Freenet, too.
I don't know I2P is by design safer than Tor or vice versa, but at
least Tor has been more researched than I2P, both technically and
legally.  Tor also seems to have far richer resources.
I agree that there are many areas I2P needs to catch up.  One of the
great things about Tor is Tor Metrics.  I2P has some stats sites, but
not on par with Tor Metrics.  I heard someone is interested in working
on I2P Metrics or something like that next year, and I will definitely
help him.
BTW, I believe it's really nice to have multiple implementations for
the similar purpose.  Trying out all of them is very educational and
quite fun.  Recently I wrote a short introduction for I2P with Tor
users on my mind.
It's true that I2P is basically a closed network, but I think I2P plus
Orchid can skim the cream of both.  With the I2P Orchid plugin, you
can access I2P eepsites (*.i2p) via the I2P network and *.onions or
clearnet sites via the Tor network, seamlessly.
Best regards,
Masayuki Hatta
Associate Professor, Faculty of Economics and Management, Surugadai
University, Japan
mhatta at gnu.org  / mhatta at debian.org / mhatta at opensource.jp /
hatta.masayuki at surugadai.ac.jp

@_date: 2018-12-11 16:13:34
@_author: Masayuki Hatta 
@_subject: [tor-talk] WTF? [was Re: Why do you use Tor?] 
I got this too.  Seems a list member (allmyjenks at gmail.com?) uses
this service and reply to the author of the mail.  Very annoying.
Best regards,
Masayuki Hatta
Associate Professor, Faculty of Economics and Management, Surugadai
University, Japan
mhatta at gnu.org  / mhatta at debian.org / mhatta at opensource.jp /
hatta.masayuki at surugadai.ac.jp

@_date: 2018-11-08 20:10:56
@_author: Masayuki Hatta 
@_subject: [tor-talk] Fixing Orchid (again), need help! 
As I wrote here some time ago, I fixed Orchid the Java Tor, and it
worked for a while.
Recently (I think it was around July-Aug), Orchid became unworkable
again.  I'm trying to but can't figure out the cause, so I appreciate
your help.
Orchid's repo is here: As far as I could see, now Orchid hangs because it can't receive
VERSIONS cells so the first handshake with Directory Authorities can't
be finished.  Some change at Dir Auths (updating new version of Tor, I
guess)  might cause this, but I can't figure out which changes affect
this.  Do you have any idea?
Best regards,
Masayuki Hatta
Associate Professor, Faculty of Economics and Management, Surugadai
University, Japan
mhatta at gnu.org  / mhatta at debian.org / mhatta at opensource.jp /
hatta.masayuki at surugadai.ac.jp

@_date: 2018-11-09 18:16:50
@_author: Masayuki Hatta 
@_subject: [tor-talk] Fixing Orchid (again), need help! 
Hi, thanks for the comment!
Orchid sends "3".
In src/main/java/com/subgraph/orchid/connections/ConnectionHandshakeV3.java,
void runHandshake() throws IOException, InterruptedException,
Connection IOException {
                sendVersions(3);
                receiveVersions();
                recvCerts();
                recvAuthChallengeAndNetinfo();
                verifyCertificates();
                sendNetinfo();
        }
Currently, Orchid is stuck inside receiveVersions.
Best regards,
2018年11月9日(金) 0:14 Nick Mathewson :

@_date: 2018-11-18 15:12:27
@_author: Masayuki Hatta 
@_subject: [tor-talk] Fixing Orchid (again), need help! 
Some follow-up on fixing Orchid.
AFAIK Orchid connects one of dir auths and sends a (variable length)
VERSIONS cell, which seems to be correct.  After a while, the
connection to the dir auth is closed and gets:
2018-11-18 14:55:18,919 DEBUG - ConnectionImpl - Closing connection to !bastet!
connectionControlCells.take = Cell: circuit_id=0 command=0 payload_len=3
I think command=0 is weird (padding?), but I don't know what is
supposed to be.  Appreciate any hints.
Best regards,
2018年11月9日(金) 10:16 Masayuki Hatta :

@_date: 2018-11-20 05:35:18
@_author: Masayuki Hatta 
@_subject: [tor-talk] Fixing Orchid (again), need help! 
Seems I could fix Orchid.
The problem is neither Tor nor Orchid, seems the list of OpenJDK's
CipherSuites has been changed (I'm using Debian's OpenJDK 10).
Currently, Orchid contains the code in
private static final String[] MANDATORY_CIPHERS = {
                      "TLS_DHE_RSA_WITH_AES_256_CBC_SHA",
            "TLS_DHE_RSA_WITH_AES_128_CBC_SHA",
            "SSL_DHE_RSA_WITH_3DES_EDE_CBC_SHA",
            "SSL_DHE_DSS_WITH_3DES_EDE_CBC_SHA",};
Then calls socket.setEnabledCipherSuites(MANDATORY_CIPHERS).
Now I changed this MANDATORY_CIPHERS to the result of
socket.getSupportedCipherSuites() and Orchid works again!
private static final String[] MANDATORY_CIPHERS = {
                    "TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384",
            "TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256",
            "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384",
            "TLS_RSA_WITH_AES_256_GCM_SHA384",
            "TLS_ECDH_ECDSA_WITH_AES_256_GCM_SHA384",
            "TLS_ECDH_RSA_WITH_AES_256_GCM_SHA384",
            "TLS_DHE_RSA_WITH_AES_256_GCM_SHA384",
            "TLS_DHE_DSS_WITH_AES_256_GCM_SHA384",
            "TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256",
            "TLS_RSA_WITH_AES_128_GCM_SHA256",
            "TLS_ECDH_ECDSA_WITH_AES_128_GCM_SHA256",
            "TLS_ECDH_RSA_WITH_AES_128_GCM_SHA256",
            "TLS_DHE_RSA_WITH_AES_128_GCM_SHA256",
            "TLS_DHE_DSS_WITH_AES_128_GCM_SHA256",
            "TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384",
            "TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384",
            "TLS_RSA_WITH_AES_256_CBC_SHA256",
            "TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA384",
            "TLS_ECDH_RSA_WITH_AES_256_CBC_SHA384",
            "TLS_DHE_RSA_WITH_AES_256_CBC_SHA256",
            "TLS_DHE_DSS_WITH_AES_256_CBC_SHA256",
            "TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA",
            "TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA",
            "TLS_RSA_WITH_AES_256_CBC_SHA",
            "TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA",
            "TLS_ECDH_RSA_WITH_AES_256_CBC_SHA",
            "TLS_DHE_RSA_WITH_AES_256_CBC_SHA",
            "TLS_DHE_DSS_WITH_AES_256_CBC_SHA",
            "TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256",
            "TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256",
            "TLS_RSA_WITH_AES_128_CBC_SHA256",
            "TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA256",
            "TLS_ECDH_RSA_WITH_AES_128_CBC_SHA256",
            "TLS_DHE_RSA_WITH_AES_128_CBC_SHA256",
            "TLS_DHE_DSS_WITH_AES_128_CBC_SHA256",
            "TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA",
            "TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA",
            "TLS_RSA_WITH_AES_128_CBC_SHA",
            "TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA",
            "TLS_ECDH_RSA_WITH_AES_128_CBC_SHA",
            "TLS_DHE_RSA_WITH_AES_128_CBC_SHA",
            "TLS_DHE_DSS_WITH_AES_128_CBC_SHA",
            "TLS_EMPTY_RENEGOTIATION_INFO_SCSV",
            "TLS_DH_anon_WITH_AES_256_GCM_SHA384",
            "TLS_DH_anon_WITH_AES_128_GCM_SHA256",
            "TLS_DH_anon_WITH_AES_256_CBC_SHA256",
            "TLS_ECDH_anon_WITH_AES_256_CBC_SHA",
            "TLS_DH_anon_WITH_AES_256_CBC_SHA",
            "TLS_DH_anon_WITH_AES_128_CBC_SHA256",
            "TLS_ECDH_anon_WITH_AES_128_CBC_SHA",
            "TLS_DH_anon_WITH_AES_128_CBC_SHA",
            "SSL_RSA_WITH_DES_CBC_SHA",
            "SSL_DHE_RSA_WITH_DES_CBC_SHA",
            "SSL_DHE_DSS_WITH_DES_CBC_SHA",
            "SSL_DH_anon_WITH_DES_CBC_SHA",
            "TLS_RSA_WITH_NULL_SHA256",
            "TLS_ECDHE_ECDSA_WITH_NULL_SHA",
            "TLS_ECDHE_RSA_WITH_NULL_SHA",
            "SSL_RSA_WITH_NULL_SHA",
            "TLS_ECDH_ECDSA_WITH_NULL_SHA",
            "TLS_ECDH_RSA_WITH_NULL_SHA",
            "TLS_ECDH_anon_WITH_NULL_SHA",
            "SSL_RSA_WITH_NULL_MD5",
            "TLS_KRB5_WITH_DES_CBC_SHA",
            "TLS_KRB5_WITH_DES_CBC_MD5",
        };
I'm pretty sure I don't need some of (or maybe most of) them, but it
doesn't exactly correspond to the fixed ciphersuite list (torspec
2.1),  so need some more investigation.
Best regards,
2018年11月18日(日) 23:12 Masayuki Hatta :
