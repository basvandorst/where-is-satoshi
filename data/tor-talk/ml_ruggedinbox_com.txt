
@_date: 2014-08-09 00:38:20
@_author: ml@ruggedinbox.com 
@_subject: [tor-talk] Three questions 
Hi sorry if wrong list.
Well first of all, thanks for developing and supporting Tor !!
We are trying to build a decent email service and have two questions that weren't able to answer on our own :)
1. when running a service as a hidden service, for example a web server, the client IP address is always 127.0.0.1.
Is there a way to have some more 'unique' information about the visitor, in order to mitigate a DDOS attack ?
2. when I connect to a hidden service, as a client, for example using TBB or ssh, does any of the nodes in the circuit know my final destination ?
Or Tor is so great that also the onion name is encrypted end-to-end ? :)
3. about connecting to ssh as a hidden service: many howtos explain to edit ~/.ssh/config and add a 'ProxyCommand' definition, for example this resource: but we found that also torsocks (for example: torsocks ssh root at s4bysmmsnraf7eut.onion) works well.
We did some (simple) packet sniffing and analysis and weren't able to find any leak.
We prefer using torsocks because if you forget to add the ProxyCommand definition (thus trying to directly connect to the onion address), the onion address may be DNS leaked.
What do you think about using torsocks to connect to ssh as a hidden service ?
Thank you very much for your attention and sorry again if wrong list,
RuggedInbox team

@_date: 2014-08-11 17:01:14
@_author: ml@ruggedinbox.com 
@_subject: [tor-talk] Three questions 
Thanks Lunar and grarpamp for your time and feedback.
Thanks for the link, also (re)read this one: and wonder how still actual it is.
About connecting to an ssh server with keys, just a little doubt: if I connect to all my servers without changing my ssh private and public keys (so without deleting '/etc/ssh' and re-creating the keys every time), would an attacker be able to observe that the same client (my pc) is connecting to those different servers ?
In short .. can my ssh client be tracker / fingerprinted if I use always the same public and private keys ?
Thank you very much for supporting and for your wisdom!!
RuggedInbox team

@_date: 2014-08-23 18:36:35
@_author: ml@ruggedinbox.com 
@_subject: [tor-talk] =?utf-8?q?Tor_TransparentProxy_with_iptables_breaks_co?= 
Hello again :)
At  we are running a 'standard' email server, using postfix, dovecot, and so on ..
The server is also able to receive and send emails to the onionland, thanks to Tor providing DNS resolution for onion addresses and 'unbound' for the clearnet.
As you may know, the full setup needs some iptables magic, as documented so we run the following rules:
1. iptables -t nat -A OUTPUT -p tcp -d 10.192.0.0/10 -j REDIRECT --to-ports 9040
2. iptables -A OUTPUT -m conntrack --ctstate INVALID -j DROP
3. iptables -A OUTPUT ! -o lo ! -d 127.0.0.1 ! -s 127.0.0.1 -p tcp -m tcp --tcp-flags ACK,FIN ACK,FIN -j DROP
4. iptables -A OUTPUT ! -o lo ! -d 127.0.0.1 ! -s 127.0.0.1 -p tcp -m tcp --tcp-flags ACK,RST ACK,RST -j DROP
but it looks like the third rule breaks connections: the mail client timeouts while checking POP mailboxes, randomly but very often.
Do you think that is safe to discard the third and forth rules ?
And if not, do you have other suggestions to be safe and prevent leaks ?
Thank you very much for supporting,
we look forward to publish all ruggedinbox's configuration as soon as everything works ok
(and perhaps a 'ruggedinbox distro')
in order to have a starting base on which discuss and request for which will help people to build their private email server, secure, spam-resistant and Tor-aware :)

@_date: 2014-08-24 17:56:13
@_author: ml@ruggedinbox.com 
@_subject: [tor-talk] 
=?utf-8?q?nnections_=3F?=
Hi elrippo thanks for the inputs.
Your implementation is good (in our opinion) because you block everything (INPUT DROP) and then allow only the strict necessary.
We'll take your path, it will require some testing on a test server because you know what happens when you cut yourself out of the server with iptables .. :)
or block the entire service because of a mistyped rule :)
Wish you a nice sunday,
RuggedInbox team
