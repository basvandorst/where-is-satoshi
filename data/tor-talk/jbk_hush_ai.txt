
@_date: 2006-08-21 21:31:54
@_author: Joseph B Kowalski 
@_subject: tor trying to pop mail from random IPs on win32 
Hi guys,
Just wanted to add that I had seen this behavior before several months back. At the time, I was running AVG anti-virus, which includes a real-time email scanning component. Basically, what it came down to was that there was a Tor server running it's ORPort on either port 25 or 110 (Can't remember which right now). So, whenever my Tor client would establish a connection to that server, I would get a message popping up indicating that Tor was trying to establish an SMTP or POP3 connection, whichever it was. I was suspicious at first, of course, but ended up looking at the IP it was indicating that Tor was connecting to, taking that IP over to the Tor network status site (
bin/exit.pl), and looking for the IP in question. Sure enough, it was a Tor server, and sure enough, it was running it's ORPort on 25 or 110, whichever it was.
There is a good chance that you are experiencing something similar, and if so you should be able to verify it the same way that I did.
Best regards,
Joe Kowalski

@_date: 2006-05-04 14:14:05
@_author: Joseph B Kowalski 
@_subject: Tor & DNS Requests 
Hash: SHA1
Hello everyone,
I have a few questions about how the Tor network handles DNS lookup
requests that I couldn't find answers to in any of the
documentation I went through, so hopefully I can find an answer
1) It is clear that the Tor network only handles TCP traffic and
not UDP, which is, of course, what standard DNS lookup requests use
(UDP). So, when directing DNS lookup requests into the Tor network
(whether by setting the network.proxy.socks_remote_dns flag in
Firefox or using Privoxy or whatever), is the application or proxy
(Firefox or Privoxy, in this example) handing the DNS lookup
request to the Tor client using TCP already, or does the Tor client
translate the UDP DNS lookup request into a TCP DNS lookup request
before passing to the first OR (entry node)?
2) Once the DNS lookup request reaches the exit node, does the exit
node perform a standard UDP DNS lookup using it's configured
nameservers, or does it do it using a TCP DNS lookup?
3) Is it necessary to allow traffic to port 53 in the exit policy
of an OR in order for that OR to perform DNS lookups on the behalf
of client requests? I know that common sense appears to suggest
that this is so, but I couldn't find anything in the documentation
stating if DNS lookups are just something all exit nodes handle
automatically and by default, or if only exit nodes configured to
allow outbound traffic to port 53 allow them. Furthermore,
depending on what the answer to question number 2 is, one might
think that allowing outbound traffic to port 53 in an exit policy
is only necessary if the operator wants to allow TCP connections to
port 53, since that is, of course, the case with every other port
you could put in an exit policy (TCP-ONLY).
Any clarification would be appreciated. If I wasn't clear on any of
the questions, please feel free to let me know, and I'll try to do
a better job explaining.
Thank you.
Best regards,
Joe Kowalski
PGP Key ID: 0xA96A2EE0

@_date: 2006-05-04 17:16:12
@_author: Joseph B Kowalski 
@_subject: Tor & DNS Requests 
Hash: SHA1
On Thu, 04 May 2006 15:41:34 -0700 Roger Dingledine Hi Roger,
Your reply is very clear and very helpful. Thank you for taking
the time to compose it.
You are right that there is a lot of documentation. For what it's
worth, I feel that it is generally very helpful and quite
comprehensive. This may be the first series of questions on Tor
that I havn't been able to find answers to myself, either in the
documentation or in previous mailing-list posts. I know I could
have looked through the source to find the answers to my
questions, but figured asking would be a bit easier.
If I were to suggest a place in the documentation to cover this
area, I think that a good place might possibly be in the
"Tor Technical FAQ Wiki"
possibly in section 4 (Running a Tor client), adding a new FAQ
right after question number 17. It might be titled "How does
Tor handle DNS lookup requests?".
Of course, what is intuitive for me may not be for others, and
you could easily make things quite complex by trying to decide
what pieces of the pertinent information apply to clients, what
pieces apply to server operators, making appropriate entries in
the respective sections, etc. Such is part of the challenge in
clearly documenting something very technical, I suppose.
Once again, thank you for your answers, and a big thank you to
you and everyone else who has put so much work into making Tor
Best regards,
Joe Kowalski
PGP Key ID: 0xA96A2EE0

@_date: 2006-11-05 22:02:27
@_author: Joseph B. Kowalski 
@_subject: Tor Network Status Website 
Hey all,
Seeing how lately it seems that several of the Tor network status websites have not been available, I got motivated to try my hand at creating one. For those who are interested in seeing the result, here is a url:
It's written in PHP, using a MySQL database on the backend. It obtains directory information by way of the "cached-status" directory of a running Tor server. The link above is making use of said directory on my Tor server, 'bitcircle'.
Anyways, some features are:
- Config option to specify which Authority servers you trust (by - Round-robin usage of Authority servers cached-status docs, so it's not always using just one
- Config option to specify how often the local cache (MySQL database) should be refreshed with new info (Speeds page loading, - Direct links to descriptors of routers on current directory server
- Some other basic config options
- Various stats about the Tor network - Stats about the directory server currently in use
- Several custom-query options
- (Hopefully) useful visual cues
If there is any interest, I can package up the code and DB creation script and distribute it. Or, feel free to use the site where it is. Let me know.
Best regards,

@_date: 2006-11-06 09:17:54
@_author: Joseph B. Kowalski 
@_subject: Tor Network Status Website 
Cool, I'm glad to see your site is still around. I was not aware of the link change. For what it's worth, when I made that comment, I actually had two sites in mind: your site and also the status site which doesn't seem to be available as of late. Best regards,
On Sun, 05 Nov 2006 23:32:45 -0800 BlueStar88

@_date: 2006-11-06 23:24:43
@_author: Joseph B. Kowalski 
@_subject: Tor Network Status Website - Reduce the page size!! 
Hi Xiando,
Thanks for your feedback.
Yeah, the page size was too big. I hadn't really spent any time on optimization yet when I sent out my original post. Anyways, I have went through and re-done a lot of the HTML and made moderate use of CSS to reduce the page size. I've also enabled gzip Content-
Encoding on the web server. Here is the difference from all of that, doing a full listing of all Tor routers (~1100):
Old page, uncompressed (What you saw): 2,204,353 bytes
Old page, gzip compressed: 89,676 bytes
New page, uncompressed: 610,700 bytes
New page, compressed: 66,380 bytes
So, from ~2.2 MB to ~66 KB being transferred on the wire.
Yes, it could be. Just another way of doing things.
While this is certainly an interesting feature, this is actually something that I respectfully disagree with. First, a server operator may not necessarily want to advertise to the world that he has a web server running (Sure, I know it's easy to find out, but I'm talking about actually pointing it out). Second, it may be a server shared by multiple people, and the person running the Tor server may have nothing to do with the person running the web server. Third, you would have to access the web server by IP. A lot of web servers nowadays run multiple sites on port 80, distinguishing between them by way of the HOST header provided by the client (HTTP 1.1). You would not know (off hand) what HOST headers you would need to provide to access the various content of the site if they operated in such a way. As an aside, on web servers I administer, I usually have all access directly by the IP go to a seperate virtual server that just serves up a blank page, has access to no content, etc., since nowadays usually the only things accessing by IP are various worms and malware, etc. You need to know a HOST header to get to any content. This won't stop a smart attacker, of course, but it cuts out 90% of the automated scan crap. This is also a reasonable idea, and might be something I do in the future, although it's probably less critical with the page size being smaller now.
Done. Such a link now exists at the bottom of the page:
Best regards,

@_date: 2006-09-08 08:52:37
@_author: Joseph B Kowalski 
@_subject: Tor server question regarding hidden services. 
Hi Caitlin,
Someone correct me if I'm wrong, but I'm fairly sure the answer to your question is "No". You should not need to configure your server to exit on port 80 in order to run a hidden service.
In any case, this should be fairly easy to test. Once you have your hidden service configured, set your server to NOT exit to port 80, and then try to access your hidden service through the Tor network.
Hope that helps.
Best regards,

@_date: 2007-04-26 09:58:35
@_author: Joseph B. Kowalski 
@_subject: ip-port.torhosts.nighteffect.us and exim 
Hi Mike,
There are a couple of things going on here. First, the reason why you see the first line returned from the 'host' command as successful, followed by two 'SERVFAIL' lines is that the 'host' command, by default, sends an 'A' request followed by an 'AAAA' (IPv6 Lookup) and 'MX' (Mail Exchanger) request. The DNSEL server only supports 'A' requests, and so in the case of the second and third queries, the DNSEL server is actually returning a 'NOTIMP' (Not Implemented) error message, and your local upstream DNS server is returning that to you as a 'SERVFAIL' error message. If you run the 'host' command with the "Type" flag set, you can prevent 'host' from sending the 'AAAA' and 'MX' requests altogether, eliminating the two error lines. For example, your query could be:
time host -t A 20.136.234.85.109.123.123.123.123.ip-
Second, to address the speed issue, it's likely that your local upstream DNS server has some method of operation that really slows things down when there is an error returned from the DNSEL server, like the two 'NOTIMP' messages I described above. It may be retrying those same 'AAAA' and 'MX' requests several times before returning the 'SERVFAIL' message to you, holding things up a bit. So, the good news is, the speed issue is probably already gone just by you using the "Type" flag with the 'host' command, like I discussed above. Personally, I know there is no extra delay from the DNSEL server when it's returning a 'SERVFAIL', 'NOTIMP', or 'NXDOMAIN' message, as opposed to a successful lookup.
If necessary, for troubleshooting, you can easily see where the delay is occuring by taking your upstream DNS provider out of the loop temporarily by telling the 'host' command to talk to the DNSEL server directly. So, you could do this (If you still wanted it to do the 'A', 'AAAA', and 'MX' requests:
time host 20.136.234.85.109.123.123.123.123.ip-
port.torhosts.nighteffect.us 216.55.190.201
Or do this (To exclude the 'AAAA' and 'MX' requests):
time host -t A 20.136.234.85.109.123.123.123.123.ip-
port.torhosts.nighteffect.us 216.55.190.201
This will let you see the real speed that the DNSEL server is responding with.
Please let me know if you have any other questions. I hope that Best regards,
Joe Kowalski

@_date: 2007-01-16 12:03:11
@_author: Joseph B. Kowalski 
@_subject: Question for DEVs -- Write/Read Limiting 
Ok, thanks for giving such complete answers Roger & Nick. I updated sections 5.17 and 5.18 of the FAQ at:
to remove the points talking about how only incoming bytes are considered during bandwidth regulation.

@_date: 2007-01-23 11:05:43
@_author: Joseph B. Kowalski 
@_subject: Another Write/Read Limiting Question 
To the Tor developers (Or anyone qualified to answer):
I really don't know how reasonable this request is, but I thought I'd ask:
Would it be possible to make the Write/Read limiting not apply to connections to the Tor control port? I have noticed that since Tor 0.1.2.5-alpha, when write limiting was enabled, responses from the Tor control port seem to be throttled back (Which makes sense, technically, because it is the server "writing"). The problem is that on a busy server which runs right at its set BandwidthRate pretty much all the time, big requests of the control port that used to take 30 seconds might now take 15-20 minutes, or more, depending on circumstances. By "big requests", I mean a request like "GETINFO desc/all-recent" or "GETINFO ns/all". The reason this matters to me personally is that the Tor Network Status application control port like this frequently. I might be wrong, but I would imagine it's entirely possible other Tor status or control applications may also do this.
Anyways, please let me know your thoughts. I would love to be in a situation to submit a patch for this myself, but my C skills are quite old and tarnished (That doesn't mean that I won't attempt it at some point. I just figured that it may be a quick fix for someone familiar with the code base, and therefore worth asking about first).
As always, thanks for all the great work on Tor.
Best regards,
Joe Kowalski

@_date: 2007-01-23 21:47:32
@_author: Joseph B. Kowalski 
@_subject: Another Write/Read Limiting Question 
Hi Roger,
I tried SVN rev. 9396, and it is much better. It is at least as fast on big control port requests as it was in 0.1.2.4-alpha, and quite possibly faster.
Thanks a bunch!
Best regards,
Joe Kowalski

@_date: 2007-03-12 12:39:45
@_author: Joseph B. Kowalski 
@_subject: Tor + Hushmail? 
Hi Jay,
You can use Hushmail in Java mode or non-Java mode. I tested creating an account with Java disabled, and it worked fine. Note, though, that Javascript is still required, and also that using Hushmail in non-Java mode costs you a bit of security (Let me know if you want details on why this is, they also have an FAQ that addresses this on their site somewhere).
Hope that helps.
Best regards,
Joe Kowalski
On Mon, 12 Mar 2007 12:25:48 -0700 Jason Edwards

@_date: 2007-03-24 11:32:47
@_author: Joseph B. Kowalski 
@_subject: Is this a Tor exit node connecting to me? 
Hi all,
When Roger sent out that email about the Google summer of code thing, I took a look at the Volunteer page ( and one item caught my interest: Item  under "Coding and Design". To quote from the page:
[We need an official central site to answer "Is this IP address a Tor exit server?" questions. This should provide several interfaces, including a web interface and a DNSBL-style interface. It can provide the most up-to-date answers by keeping a local mirror of the Tor directory information. The tricky point is that being an exit server is not a boolean: so the question is actually "Is this IP address a Tor exit server that can exit to my IP address:port?" The DNSBL interface will probably receive hundreds of queries a minute, so some smart algorithms are in order. Bonus points if it does active testing through each exit node to find out what IP address it's really exiting from.]
For greater depth on the subject, see this page: So anyways, I have implemented a Tor DNSBL server interface. The address of the DNSBL is "tor.dnsbl.nighteffect.us".
Here are some details on how to use it:
The DNSBL server responds to two different types of 'A' record 1) The first type is to simply provide an answer as to whether a given IP is an active Tor server or not. So, assuming the DNSBL domain name is 'tor.dnsbl.nighteffect.us', and you want to check if IP '1.2.3.4' is a Tor server, you would send the following 'A' record query:
Note that the octets of the IP address have been reversed, like a PTR record, only this is an 'A' request.
If '1.2.3.4' is an active Tor server, the DNSBL server will respond with a '127.0.0.2' 'A' record. If '1.2.3.4' is NOT an active Tor server, the DNSBL server will respond with a 'Non-Existent Domain (NXDOMAIN)' error.
2) The second query type provides an answer for the question "Is this IP an active Tor server, and, if so, would it's exit policy allow an exit to this destination IP and port?" So, assuming the DNSBL domain name is
'tor.dnsbl.nighteffect.us', and you want to check if IP '1.2.3.4' is an active Tor server capable of exiting to '55.66.77.88', on port 60000, you would send the following 'A' record query:
If '1.2.3.4' is an active Tor server, AND if that Tor server can exit to
'55.66.77.88', port 60000, the DNSBL server will respond with a '127.0.0.2' 'A' record. If '1.2.3.4' is NOT an active Tor server, or if '1.2.3.4' IS an active Tor server, but is using an exit policy that would prevent exit to '55.66.77.88', port 60000, the DNSBL server will respond with a 'Non-Existent Domain (NXDOMAIN)' The DNSBL server will always respond with an NXDOMAIN error if a client tries to lookup anything outside of the DNSBL domain name. So, if a client sends an 'A' request for ' the DNSBL server will return an NXDOMAIN error.
The DNSBL server will set the 'Authoritative' flag to true for responses that are within it's root domain name, and will set it to false for responses that are outside of it.
If you're still cloudy on why this is useful, please refer to this This has been implemented as part of my TorNetworkStatus site, so the source code for both the site and the DNSBL server are available at:
Currently, the database is updated with fresh info every 5 minutes.
I've also put up a web interface to do these kinds of lookups:
Hopefully somebody finds this useful.
Best regards,
Joe Kowalski

@_date: 2007-03-25 10:58:19
@_author: Joseph B. Kowalski 
@_subject: Is this a Tor exit node connecting to me? 
Hi Hanru,
Yes, since when you are performing the first type of query, you are simply asking whether an IP address is an active Tor server or not, of any kind. Now, if anyone wanted to see if your Tor server would exit to their location or not, they could perform the second type of query (See my original post for details on the two query types, if necessary), which, in your case, would always return NXDOMAIN since you don't allow any exiting.
Hope that helps!
Best regards,
Joe Kowalski

@_date: 2007-03-25 18:00:18
@_author: Joseph B. Kowalski 
@_subject: Is this a Tor exit node connecting to me? 
Hi Matto,
Differentiation between exit nodes and middlemen is exactly what
the first query type is NOT designed to do, and exactly what the
second query type IS designed to do since, as the Tor volunteer
page I quoted in my original post states "...being an exit server
is not a boolean..." Saying that "Tor server X is an exit server"
is exactly what we're attempting to get away from here, as that
is really not a valid statement unless Tor server X actually allows exit to every IP on every port. Assuming it does not, then
Tor server X is an exit from the perspective of some and not an
exit from the perspective of others, hence the second query type.
As a matter of fact, there really is not much reason to have the
first query type at all, I mainly just did it cause I thought it
would be a neat feature. In fact, unless I'm misunderstanding your comment, the second query type would be
well suited for the example you give, which is "allow sendmail
dnsbl configurations to easily do the 'right' thing". I'm
presuming you are saying that you have a sendmail server running
that would like to determine if the machine making a connection
to it is a Tor server that would allowing exiting to it. In this
case, the second query type will provide exactly that information.
Knowing that the machine connecting to you is STRICTLY a Tor
'middleman' node is useless, I would think, since in that case
I would imagine it would be getting treated the same as any other
Internet machine making a connection (Again, unless I'm missing
something here).
Hope that helps, and let me know if I'm missing something...
Best regards,
Joe Kowalski

@_date: 2007-03-26 14:48:30
@_author: Joseph B. Kowalski 
@_subject: Is this a Tor exit node connecting to me? 
You're welcome.
I have been thinking exactly the same thing. I've pretty much
decided at this point that the first query type should go -- It
just encourages people to continue to look at the whole "exit or
not" thing the old way. Like you've noted, there are other resources they can use to get finer-grained details if they really
want them.
Yes, this is something that is possible. One problem that comes to
mind immediately with this setup is that we have no "port" info
to go off of, just the connecting IP, and so we're already getting
into muddy waters by giving them an answer about exit policies that
may not be completely correct. But I'd like to hear opinions on this
Best regards,
Joe Kowalski

@_date: 2007-03-26 23:05:42
@_author: Joseph B. Kowalski 
@_subject: Is this a Tor exit node connecting to me? 
....And this is now done. I have removed the first query type and now
(what was) the second query type is the only query type.
Please refer to the start of this thread for usage instructions, if
Best regards,
Joe Kowalski

@_date: 2007-03-31 09:31:01
@_author: Joseph B. Kowalski 
@_subject: Example hidden service issue 
Guys, this, noted in the original post is incorrect:
GET / HTTP/1.1
Host: youronionaddress
When you contact  your request goes like this:
GET / HTTP/1.1
Host: You are telling the web server which web site to serve you, using
the name as an identifier. To clarify, The "HOST" field is not to
identify you, but to tell the web server you are connecting to which website you would like (Since many servers host multiple
Hope that helps.
Best regards,
Joe Kowalski

@_date: 2007-03-31 09:34:22
@_author: Joseph B. Kowalski 
@_subject: Example hidden service issue 
Oops, sorry. Accessing it at a .onion address... Please disregard my above message. That's what I get for trying to send an email before I have had my coffee. :)
As you were...
Best regards,
Joe Kowalski
