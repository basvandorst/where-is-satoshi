
@_date: 2007-11-03 01:44:43
@_author: tabi meta 
@_subject: tor-0.1.2.18 build issues with zlib 
hi torizens...
1 - how can i tell tor to compile and use the zlib in /usr/local ?  there are two zlib versions on the system. the older supports
 legacy apps. there doesn't seem to be a --with-zlib-dir option
 to do this.
2 - i get a gzip test error as below.
i've checked the bugtracker for both, no entries.
ideas? thx.
# installed in /usr
 openssl-0.9.7d
 zlib-1.1.4
# installed in /usr/local
 libevent-1.3e
 openssl-0.9.8g
 zlib-1.2.3
# host
pentiumII, freebsd 4.11-STABLE [really RELENG_4 as of a week ago]
# build info
ports/packages are not used, all from original sources.
configure options: --prefix, --mandir
configure, make, make install output is completely clean as usual, no
tor itself runs fine, no problems. just ignore the torrc and socket
stuff below.
# build output - zlib related
cf.std: checking zlib.h usability... yes
cf.std: checking zlib.h presence... yes
cf.std: checking for zlib.h... yes
mk.std: gcc  -g -O2 -Wall -g -O2  -L/usr/local/lib -o tor  ../common/libor.a ../common/libor-crypto.a -lz -lssl -lcrypto -levent
-lssl -lcrypto
mk.std: gcc  -g -O2 -Wall -g -O2  -L/usr/local/lib -o test  ../common/libor.a ../common/libor-crypto.a -lz -lssl -lcrypto -levent
-lssl -lcrypto
# ldd
        libz.so => /usr/lib/libz.so (0x28105000)
        libssl.so.0.9.8 => /usr/local/lib/libssl.so.0.9.8 (0x28112000)
        libcrypto.so.0.9.8 => /usr/local/lib/libcrypto.so.0.9.8
        libevent-1.3e.so.1 => /usr/local/lib/libevent-1.3e.so.1
        libc.so.4 => /usr/lib/libc.so.4 (0x2828e000)
        libz.so => /usr/lib/libz.so (0x28119000)
        libssl.so.0.9.8 => /usr/local/lib/libssl.so.0.9.8 (0x28126000)
        libcrypto.so.0.9.8 => /usr/local/lib/libcrypto.so.0.9.8
        libevent-1.3e.so.1 => /usr/local/lib/libevent-1.3e.so.1
        libc.so.4 => /usr/lib/libc.so.4 (0x282a2000)
# exec - works fine, this is just a test
[notice] Tor v0.1.2.18. This is experimental software. Do not rely on
it for strong anonymity.
[notice] Configuration file "/usr/local/tor01218/etc/tor/torrc" not
present, using reasonable defaults.
[notice] Initialized libevent version 1.3e using method kqueue. Good.
[notice] Opening Socks listener on 127.0.0.1:9050
[warn] Could not bind to 127.0.0.1:9050: Address already in use. Is Tor
already running?
[warn] Failed to parse/validate config: Failed to bind one of the
listener ports.
[err] Reading config failed--see warnings above.
# exec - excess .'s trimmed
Running Tor unit tests on FreeBSD i386
========================== Buffers =========================
========================== Crypto ==========================
========================= Util ============================
File test.c: line 1136 (test_gzip): assertion failed:
(!tor_gzip_compress(&buf2, &len1, buf1, strlen(buf1)+1, GZIP_METHOD))
========================= Onion Skins =====================
========================= Directory Formats ===============
========================= Policies ===================
========================= Rendezvous functionality ========
Do You Yahoo!?
Tired of spam?  Yahoo! Mail has the best spam protection around

@_date: 2007-11-03 02:47:56
@_author: tabi meta 
@_subject: tor-0.1.2.18 build issues with zlib 
more info. src/or/test PASSES under the conditions below.
you're wondering about zlib123. still don't know how to
resolve this during build without LD_LIBRARY_PATH though.
 ktrace accesses during build
# configure  84749 cpp0     NAMI  "/usr/local/include/zlib.h"
 84765 cpp0     NAMI  "/usr/local/include/zlib.h"
# make  87693 cpp0     NAMI  "zlib.h"
 87693 cpp0     NAMI  "../../zlib.h"
 87693 cpp0     NAMI  "/usr/local/include/zlib.h"
 88263 ld       NAMI  "/usr/local/lib/libz.so"
 88292 ld       NAMI  "/usr/local/lib/libz.so"
ldconfig -r | egrep 'libz'
        41:-lz.2 => /usr/lib/libz.so.2
        200:-lz.1 => /usr/local/lib/libz.so.1
ldconfig -r | egrep 'ssl|crypto'
        52:-lcrypto.3 => /usr/lib/libcrypto.so.3
        53:-lssl.3 => /usr/lib/libssl.so.3
ldconfig -r | egrep 'event'
        115:-levent-1.3e.1 => /usr/local/lib/libevent-1.3e.so.1
 setting preference to library path
ldd /usr/local/bin/tor         libz.so => /usr/lib/libz.so (0x28105000)
        libssl.so.0.9.8 => /usr/local/lib/libssl.so.0.9.8 (0x28112000)
        libcrypto.so.0.9.8 => /usr/local/lib/libcrypto.so.0.9.8
        libevent-1.3e.so.1 => /usr/local/lib/libevent-1.3e.so.1
        libc.so.4 => /usr/lib/libc.so.4 (0x2828e000)
LD_LIBRARY_PATH=/usr/local/lib ldd /usr/local/bin/tor
        libz.so => /usr/local/zlib123/lib/libz.so (0x28105000)
        libssl.so.0.9.8 => /usr/local/lib/libssl.so.0.9.8 (0x28117000)
        libcrypto.so.0.9.8 => /usr/local/lib/libcrypto.so.0.9.8
        libevent-1.3e.so.1 => /usr/local/lib/libevent-1.3e.so.1
        libc.so.4 => /usr/lib/libc.so.4 (0x28293000)
LD_LIBRARY_PATH=/usr/local/lib ldd src/or/test               libz.so => /usr/local/zlib123/lib/libz.so (0x28119000)
        libssl.so.0.9.8 => /usr/local/lib/libssl.so.0.9.8 (0x2812b000)
        libcrypto.so.0.9.8 => /usr/local/lib/libcrypto.so.0.9.8
        libevent-1.3e.so.1 => /usr/local/lib/libevent-1.3e.so.1
        libc.so.4 => /usr/lib/libc.so.4 (0x282a7000)
Do You Yahoo!?
Tired of spam?  Yahoo! Mail has the best spam protection around
