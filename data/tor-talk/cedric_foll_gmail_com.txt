
@_date: 2009-08-03 22:47:02
@_author: Cedric Foll 
@_subject: Issue creating a private tor network 
my lab works now.
I've add memory on my vm (32Mb instead of 16Mb) and it solved my problem.

@_date: 2009-08-03 22:47:02
@_author: Cedric Foll 
@_subject: Issue creating a private tor network 
my lab works now.
I've add memory on my vm (32Mb instead of 16Mb) and it solved my problem.

@_date: 2009-08-02 19:12:11
@_author: Cedric Foll 
@_subject: Issue creating a private tor network 
I'm trying to create a private tor network using netkit [
I have the following lab:
auth1 & auth2 are directory authorities, or1, or2 and or3 are relay.
I'm using  Tor v0.2.1.19 (but get same issues with 0.2.1.17-rc).
This is my conf for auth1:
SocksPort 9050 # what port to open for local application connections
SocksListenAddress 127.0.0.1 # accept connections only from localhost
ORPort 9001
Nickname auth1
ContactInfo titi at toto.com
DirPort 9030 # what port to advertise for directory connections
TestingTorNetwork 1
ServerDNSDetectHijacking 0
DirServer auth1 v3ident=805CC92863F31F9CFA9DFBBD3E3B23153527C392
193.168.2.1:9030 276B CDBD 3742 7196 156D CC5E 83A9 8DAC 0743 BE42
DirServer auth2 v3ident=76F90B3FCCD52335A39B4A84CDD8B0945198FAA2
193.168.2.2:9030 3849 E849 5E12 A852 E658 63B7 0290 0F50 48A1 C8D3
AuthoritativeDirectory 1
V3AuthoritativeDirectory 1
V2AuthoritativeDirectory 1
Log info file /var/log/tor/tor.log
DataDirectory /tmp/tor
This is my conf for or1, or2, or3:
SocksPort 9050 # what port to open for local application connections
SocksListenAddress 127.0.0.1 # accept connections only from localhost
ORPort 9001
ExitPolicy accept *:*
TestingTorNetwork 1
ServerDNSDetectHijacking 0
DirServer auth1 v3ident=805CC92863F31F9CFA9DFBBD3E3B23153527C392
193.168.2.1:9030 276B CDBD 3742 7196 156D CC5E 83A9 8DAC 0743 BE42
DirServer auth2 v3ident=76F90B3FCCD52335A39B4A84CDD8B0945198FAA2
193.168.2.2:9030 3849 E849 5E12 A852 E658 63B7 0290 0F50 48A1 C8D3
Log info file /var/log/tor/tor.log
DataDirectory /tmp/tor
When i run the lab I have this on auth1 and auth2:
auth1   Aug 02 16:15:02.159 [notice] Bootstrapped 90%: Establishing a
Tor circuit.
And then it loop here:
auth1   Aug 02 16:19:21.689 [notice] Time to vote.
auth1   Aug 02 16:19:21.697 [notice] Choosing valid-after time in vote
as 2009-08-02 16:20:00: consensus_set=1, last_interval=300
auth1   Aug 02 16:19:21.711 [notice] Vote posted.
auth1   Aug 02 16:19:21.719 [notice] Uploaded a vote to dirserver
auth1   Aug 02 16:19:21.722 [notice] Uploaded a vote to dirserver
auth1   Aug 02 16:19:31.759 [notice] Time to fetch any votes that we're missing.
auth1   Aug 02 16:19:41.777 [notice] Got a signature from 193.168.2.2.
Queuing it for the next consensus.
auth1   Aug 02 16:19:41.859 [notice] Time to compute a consensus.
auth1   Aug 02 16:19:41.865 [notice] Added 1 pending signatures while
building consensus.
auth1   Aug 02 16:19:41.865 [notice] Consensus computed; uploading signature(s)
auth1   Aug 02 16:19:41.866 [notice] Signature(s) posted.
auth1   Aug 02 16:19:41.867 [notice] Got a signature from 193.168.2.1.
Adding it to the pending consensus.
auth1   Aug 02 16:19:41.868 [notice] Uploaded signature(s) to
dirserver 193.168.2.1:9030
auth1   Aug 02 16:19:41.872 [notice] Uploaded signature(s) to
dirserver 193.168.2.2:9030
auth1   Aug 02 16:19:51.929 [notice] Time to fetch any signatures that
we're missing.
auth1   Aug 02 16:20:01.999 [notice] Time to publish the consensus and
discard old votes
auth1   Aug 02 16:20:02.001 [notice] Choosing expected valid-after
time as 2009-08-02 16:25:00: consensus_set=1, interval=300
auth1   Aug 02 16:20:02.002 [notice] Consensus published.
auth1   Aug 02 16:20:02.003 [notice] Choosing expected valid-after
time as 2009-08-02 16:25:00: consensus_set=1, interval=300
And on or1 (same on or2 and or3): i've got this:
or1     Aug 02 16:10:40.027 [notice] Tor 0.2.1.19 opening log file.
or1     Aug 02 16:10:40.046 [notice] Parsing GEOIP file.
or1     Aug 02 16:10:45.939 [notice] Your Tor server's identity key
fingerprint is 'or1 A85017DFBD191F460AB3E13F8E48A5B6EB3A61CE'
or1     Aug 02 16:10:45.944 [notice] No current certificate known for
authority auth1; launching request.
or1     Aug 02 16:10:45.945 [notice] No current certificate known for
authority auth2; launching request.
or1     Aug 02 16:10:45.951 [notice] Couldn't read
or1     Aug 02 16:10:45.954 [notice] I learned some more directory
information, but not enough to build a circuit: We have no
network-status consensus.
or1     Aug 02 16:10:46.030 [notice] I learned some more directory
information, but not enough to build a circuit: We have no
network-status consensus.
or1     Aug 02 16:10:46.043 [notice] I learned some more directory
information, but not enough to build a circuit: Only 0 descriptors
here and believed reachable!
or1     Aug 02 16:21:04.676 [notice] Self-testing indicates your ORPort is
reachable from the outside. Excellent. Publishing server descriptor.
or1     Aug 02 16:22:57.945 [notice] Bootstrapped 45%: Asking for
relay descriptors.
or1     Aug 02 16:22:57.945 [notice] I learned some more directory
information, but not enough to build a circuit: We have only 0/5
usable descriptors.
or1     Aug 02 16:22:57.958 [notice] Bootstrapped 50%: Loading relay
or1     Aug 02 16:22:57.958 [notice] We now have enough directory
information to build circuits.
or1     Aug 02 16:22:57.958 [notice] Bootstrapped 80%: Connecting to the
Tor network.
or1     Aug 02 16:22:58.947 [notice] Bootstrapped 90%: Establishing a
Tor circuit.
or1     Aug 02 16:23:59.295 [warn] No available nodes when trying to
choose node. Failing.
or1     Aug 02 16:23:59.295 [warn] No available nodes when trying to
choose node. Failing.
or1     Aug 02 16:23:59.295 [warn] No available nodes when trying to
choose node. Failing.
or1     Aug 02 16:23:59.295 [warn] Failed to find node for hop 1 of our
path. Discarding this circuit.
What may be wrong?

@_date: 2009-08-02 22:43:19
@_author: Cedric Foll 
@_subject: Issue creating a private tor network 
thanks for your reply.
This is the content on or1 and i have the same content on every
or1:~# cat /tmp/tor/cached-consensus
network-status-version 3
vote-status consensus
consensus-method 5
valid-after 2009-08-02 20:15:00
fresh-until 2009-08-02 20:20:00
valid-until 2009-08-02 20:30:00
voting-delay 20 20
known-flags Authority Exit Fast Guard HSDir Running Stable V2Dir Valid
dir-source auth2 76F90B3FCCD52335A39B4A84CDD8B0945198FAA2 193.168.2.2
193.168.2.2 9030 9001
contact titi at toto.com
vote-digest 16E94BA5EDA8E9AA4E5C6D1B46BCB0ED7299DC86
dir-source auth1 805CC92863F31F9CFA9DFBBD3E3B23153527C392 193.168.2.1
193.168.2.1 9030 9001
contact titi at toto.com
vote-digest E0833E396DCC3C8BBECC5071B610B206BB5EEE6D
r auth1 J2vNvTdCcZYVbcxeg6mNrAdDvkI Gwck5kCdZoilHS1KdggMCr+KN+k
2009-08-02 20:09:27 193.168.2.1 9001 9030
s Authority Exit Fast Guard Running Stable V2Dir Valid
v Tor 0.2.1.19
w Bandwidth=0
p reject 25,119,135-139,445,563,1214,4661-4666,6346-6429,6699,6881-6999
r auth2 OEnoSV4SqFLmWGO3ApAPUEihyNM 6gGETnnK3WSY2o2WG42YrDQb+BU
2009-08-02 20:09:31 193.168.2.2 9001 9030
s Authority Exit Fast Guard Running Stable V2Dir Valid
v Tor 0.2.1.19
w Bandwidth=0
p reject 25,119,135-139,445,563,1214,4661-4666,6346-6429,6699,6881-6999
r or3 gkckUkLTdrN+9QDNMfEhAZIxwSI uCCX+ihq48N5QjSrP2D4rh8LFKk
2009-08-02 20:10:37 193.168.3.3 9001 0
s Exit Fast Guard Running Stable Valid
v Tor 0.2.1.19
w Bandwidth=0
p accept 1-65535
r or2 v+G418pDFhzgKBlS0wbJCc2r9vw rdC2/apa6lbSMkE6FtN3Dh7RuAE
2009-08-02 20:10:40 193.168.3.2 9001 0
s Exit Fast Guard Running Stable Valid
v Tor 0.2.1.19
w Bandwidth=0
p accept 1-65535
r or1 3UJmJWzw4WyLmDiyItcXEqK+vVQ 7ZM01SRriHH+NcD2rrW0JIyodLg
2009-08-02 20:10:40 193.168.3.1 9001 0
s Exit Fast Guard Running Stable Valid
v Tor 0.2.1.19
w Bandwidth=0
p accept 1-65535
directory-signature 76F90B3FCCD52335A39B4A84CDD8B0945198FAA2
-----BEGIN SIGNATURE-----
-----END SIGNATURE-----
directory-signature 805CC92863F31F9CFA9DFBBD3E3B23153527C392
-----BEGIN SIGNATURE-----
-----END SIGNATURE-----
