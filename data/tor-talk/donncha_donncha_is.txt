
@_date: 2015-07-01 17:26:20
@_author: Donncha O'Cearbhaill 
@_subject: [tor-talk] OnionBalance 0.1.1 Alpha released - Hidden Service Load 
Hello all,
Today I've released the first version of my OnionBalance tool which is
being developed as part of Tor's Summer of Privacy program.
What is OnionBalance you ask? OnionBalance provides load-balancing and
redundancy for Tor hidden services by distributing client requests to
multiple backend Tor instances. By acting at the Tor circuit level,
OnionBalance can overcome the current issue where all traffic for a Tor
hidden service needs to pass through a single Tor instance (running
mostly on a single core).
This is an alpha release. There are likely bugs which cause the
OnionBalance service to crash or not operate correctly. I would very
much appreciate any feedback or bug reports. In particular I would like
to improve the documentation and make the tool easier for operators to
install and run.
The latest release can be installed right now via the PyPI repository or
from Github [1, 2]
Documentation: Kind Regards,
Donncha O'Cearbhaill
[1] [2] For reference all OnionBalance releases will be signed by my PGP key:
pub   4096R/0x3B0D706A7FBFED86 2013-06-27 [expires: 2016-07-11]
      Key fingerprint = 7EFB DDE8 FD21 11AE A7BE  1AA6 3B0D 706A 7FBF ED86
uid                 [ultimate] Donncha O'Cearbhaill

@_date: 2015-06-03 14:12:01
@_author: Donncha O'Cearbhaill 
@_subject: [tor-talk] Hidden Service Scaling Summer of Privacy Project 
Hi all,
Firstly, thank you to all of the onion service operators who took the
time to get in touch with me. Your feedback has been very helpful.
It is clear that there are a multitude of use-cases and requirements
which can be quite different for people running 'public onion services'
or anonymous onion services. A couple of common points have stood out
which I will try to summarize here for future reference.
1. Redundancy, Failover and Scaling
Many of the onion service operators that I talked to said that the
ability to have redundant service hosting and avoid a single point of
failure is a big priority. The current situation with a single Tor
process on a single physical server is not ideal.
Some operators have experimented with running multiple Tor daemons which
then "compete" with one another to publish hidden service descriptors.
Early results suggest that this basic approach shows promise.
Operators also said that it is important that the deployment of onion
services should not require much Tor specific 'magic'. Ideally it should
be possible to deploy and manage onion services using much the same
tools and process as regular internet services (e.g Puppet, Chef, Ansible).
2. Multicore Tor
Operators were also interested in development of the Tor daemon to more
fully utilize the resources on their multi-core systems. Currently onion
services running on multi-core systems have difficulty utilizing much of
the available processing resources beyond a single core. This work is
outside the scope of my project, but I'll note these problems here anyways.
My project may allow some degree of multicore utilization with onion
services as onion service could be served by multiple Tor instances
running on a single multicore system. Clients could then split
connections between different cores by choosing an intro point managed
by a particular Tor process/core. This was something I hadn't though
about before but which might provide some easy improvements.
3. Instrumentation for Onion Service Monitoring
Some operators have been trying to monitor and understand the
performance and reliability of their onion services but have run into
trouble due to a lack of information available on the Tor control port.
In particular the following limitations were outlined:
  - No metrics about concurrent onion service connections over time
  - No metrics for data transfer over the onion service.
  - No data about resource constraints (Tor bandwidth, entry guard
  - No data about connection rates, failed introductions, rendezvous..
  - Difficult to monitor if a service is actually reachable.
Attempts to use information currently available via the control port was
not perceived to be very insightful or useful. Due to lack of available
metrics only anecdotal information is available when users contact the
operator with complaints. As a result the operator currently has little
options for debugging and diagnosis except for restarting Tor process
and hoping for the best.
I'll contact this list again when more design designs have been
finalized and when I have more to report.
Thank you all again,

@_date: 2015-06-04 11:21:16
@_author: Donncha O'Cearbhaill 
@_subject: [tor-talk] DocTor's 'Possible Sybil Attack' (2015-06-03) report 
Well spotted nusenu!
These relays have previously been excluded from the Tor network. They
have now tried rejoining with new fingerprints. All of the following
relays are confirmed as being managed by the same operator.
Could these be excluded from the network again?
? python corrolate.py -p 9251 --fields
--counter='as,tor_version,bandwidth' --ip-file ../bigsybil/ips3.txt
2015-06-04 11:12:04,501 [DEBUG]: Loaded MaxMind AS database
2015-06-04 11:12:04,504 [DEBUG]: Successfully connected to the Tor
control port
2015-06-04 11:12:06,815 [DEBUG]: Finished loading Tor relay descriptors
2015-06-04 11:12:06,995 [DEBUG]: Filters matched 97 relays
2015-06-04 11:12:07,010 [DEBUG]: Prepared final relay info, outputting now!
address            or_port    dir_port  as       tor_version    uptime
           average_bandwidth  nickname
---------------  ---------  ----------  -------  -------------
---------------  -------------------  -------------------
23.239.19.120         9007        9036  AS3595   0.2.4.27       8:16:08
                      524288  LimpyPurse
23.239.19.120         9008        9037  AS3595   0.2.4.27       12:45:36
                     524288  AlongProxy
23.239.19.153         9009        9038  AS3595   0.2.4.27       13:00:48
                     524288  IrateConcept
23.239.19.153         9010        9039  AS3595   0.2.4.27       12:16:04
                     524288  ObnoxiousLiar
23.239.29.65          9001        9030  AS36351  0.2.4.27       1 day,
6:46:16                524288  blahrelayblah
23.239.29.65          9002        9031  AS36351  0.2.4.27       1 day,
2:46:20                524288  blahrelayblah2
50.116.29.54          9001        9030  AS36351  0.2.4.27       0:18:18
                      524288  ChromeAutopsy
50.116.29.54          9002        9031  AS36351  0.2.4.27       7:16:09
                      524288  UncommonAngel
50.116.32.217         9007        9036  AS3595   0.2.4.27       4:45:41
                     1048576  RelayOfTheMagic
50.116.32.217         9008        9037  AS3595   0.2.4.27       10:30:20
                    1048576  UndercoverRelay
50.116.47.171         9009        9038  AS3595   0.2.4.27       13:45:32
                    1048576  RelayUprising
50.116.47.171         9010        9039  AS3595   0.2.4.27       14:00:47
                    1048576  PrimoRelay
66.175.214.149        9003        9032  AS8001   0.2.4.27       7:30:23
                     1048576  Barnaby
66.175.214.149        9004        9033  AS8001   0.2.4.27       4:00:57
                     1048576  Loki
66.228.62.91          9005        9034  AS3595   0.2.4.27       0:18:18
                     1048576  PlethoraTor
66.228.62.91          9006        9035  AS3595   0.2.4.27       14:16:02
                    1048576  LoadedDetermined
74.207.224.63         9001        9030  AS3595   0.2.4.27       5:46:41
                      524288  LocustModest
74.207.224.63         9002        9031  AS3595   0.2.4.27       7:30:23
                      524288  AllergyOfUniverse
74.207.237.167        9001        9030  AS3595   0.2.4.27       0:16:16
                     1048576  TORtastic
74.207.237.167        9002        9031  AS3595   0.2.4.27       14:45:31
                    1048576  AtlantaTORJunction
80.85.84.240          9009        9038  AS15830  0.2.4.27       0:16:16
                      524288  BionicNavel
80.85.84.240          9010        9039  AS15830  0.2.4.27       5:00:56
                      524288  HealthyNevada
97.107.142.218        9001        9030  AS8001   0.2.4.27       10:31:21
                    1048576  FreeAndRiseUp
97.107.142.218        9002        9031  AS8001   0.2.4.27       12:46:34
                    1048576  FreeAndRiseUpAgain
104.200.16.86         9007        9036  AS36351  0.2.4.27       7:45:38
                      524288  LavenderSouth
104.200.16.86         9008        9037  AS36351  0.2.4.27       8:00:53
                      524288  FuzzyPharoah
104.200.18.182        9005        9034  AS36351  0.2.4.27       12:15:03
                     524288  CinematicPlunger
104.200.18.182        9006        9035  AS36351  0.2.4.27       2:30:28
                      524288  UndefeatedAlloy
104.237.128.84        9003        9032  AS36351  0.2.4.27       1 day,
2:15:50                524288  RelayMonastery
104.237.128.84        9004        9033  AS36351  0.2.4.27       1 day,
10:15:42               524288  SecureExorcism
104.237.129.52        9007        9036  AS36351  0.2.4.27       12:00:49
                     524288  DidacticTerrorism
104.237.129.52        9008        9037  AS36351  0.2.4.27       15:01:47
                     524288  CrapMage
104.237.129.78        9005        9034  AS36351  0.2.4.27       21:00:40
                     524288  BleachSoul
104.237.129.78        9006        9035  AS36351  0.2.4.27       23:01:39
                     524288  ClassroomRealm
104.237.129.142       9009        9038  AS36351  0.2.4.27       0:16:16
                      524288  HerdOfOffense
104.237.129.142       9010        9039  AS36351  0.2.4.27       9:46:37
                      524288  SexualBinge
104.237.131.75        9009        9038  AS36351  0.2.4.27       12:00:49
                     524288  NebulaScript
104.237.131.75        9010        9039  AS36351  0.2.4.27       11:31:20
                     524288  DerelictWhale
104.237.131.107       9007        9036  AS36351  0.2.4.27       20:45:25
                     524288  LiberalWhisper
104.237.131.107       9008        9037  AS36351  0.2.4.27       1 day,
0:15:52                524288  PhotoFearTheOutlaw
104.237.134.102       9009        9038  AS36351  0.2.4.27       1 day,
7:15:45                524288  RepublicanCrib
104.237.134.102       9010        9039  AS36351  0.2.4.27       21:01:41
                     524288  ReverentVan
106.185.28.113        9009        9038  AS2516   0.2.4.27       0:16:16
                     1048576  RiotSpiral
106.185.28.113        9010        9039  AS2516   0.2.4.27       12:30:18
                    1048576  OpticalRelay
106.185.31.129        9003        9032  AS2516   0.2.4.27       7:46:39
                      524288  VegetableJockey
106.185.31.129        9004        9033  AS2516   0.2.4.27       5:30:25
                      524288  RumpFrolic
106.185.36.183        9005        9034  AS2516   0.2.4.27       15:00:46
                     524288  RiskSlide
106.185.36.183        9006        9035  AS2516   0.2.4.27       10:00:51
                     524288  LanceHumor
106.185.39.58         9007        9036  AS2516   0.2.4.27       14:15:01
                     524288  PeanutEternity
106.185.39.58         9008        9037  AS2516   0.2.4.27       3:46:43
                      524288  EstrangedAir
106.185.48.214        9009        9038  AS2516   0.2.4.27       0:15:15
                      524288  UntilLight
106.185.48.214        9010        9039  AS2516   0.2.4.27       12:01:50
                     524288  PatheticOcean
106.186.117.65        9007        9036  AS2516   0.2.4.27       0:16:16
                     1048576  RelayOfTheMiracle
106.186.117.65        9008        9037  AS2516   0.2.4.27       8:45:37
                     1048576  PornoLiberation
106.187.38.198        9001        9030  AS2516   0.2.4.27       5:16:11
                     1048576  kanpai
106.187.38.198        9002        9031  AS2516   0.2.4.27       3:00:58
                     1048576  Maru
106.187.92.163        9003        9032  AS2516   0.2.4.27       12:16:04
                    1048576  Scorpio
106.187.92.163        9004        9033  AS2516   0.2.4.27       9:00:52
                     1048576  JungleOfTheUnhappy
106.187.94.69         9001        9030  AS2516   0.2.4.27       5:15:10
                      524288  KillerHumanity
106.187.94.69         9002        9031  AS2516   0.2.4.27       15:00:46
                     524288  ThrashingCobra
106.187.94.254        9005        9034  AS2516   0.2.4.27       5:45:40
                     1048576  EliteRelay
106.187.94.254        9006        9035  AS2516   0.2.4.27       12:45:33
                    1048576  SumoConfidence
151.236.222.27        9007        9036  AS15830  0.2.4.27       4:45:41
                      524288  GroupIsland
151.236.222.27        9008        9037  AS15830  0.2.4.27       9:45:36
                      524288  WantedLube
162.216.19.237        9009        9038  AS8001   0.2.4.27       11:31:20
                    1048576  Chronos
162.216.19.237        9010        9039  AS8001   0.2.4.27       15:01:47
                    1048576  Ananke
173.230.131.207       9003        9032  AS3595   0.2.4.27       2:00:59
                      524288  CapitalDensity
173.230.131.207       9004        9033  AS3595   0.2.4.27       15:16:01
                     524288  DanalFrequent
173.230.134.56        9003        9032  AS3595   0.2.4.27       0:15:15
                     1048576  TorScorpion
173.230.134.56        9004        9033  AS3595   0.2.4.27       15:00:46
                    1048576  TorOfTheFreedom
178.79.133.64         9001        9030  AS15830  0.2.4.27       3:30:27
                      524288  FlyTheFlag
178.79.133.64         9002        9031  AS15830  0.2.4.27       0:17:17
                      524288  Tortuga
178.79.134.183        9003        9032  AS15830  0.2.4.27       0:16:16
                      524288  FrictionVerbose
178.79.134.183        9004        9033  AS15830  0.2.4.27       0:16:16
                      524288  SearingFreeway
178.79.142.224        9001        9030  AS15830  0.2.4.27       5:30:25
                      524288  AnarchyFlashing
178.79.142.224        9002        9031  AS15830  0.2.4.27       0:15:15
                      524288  SalineGodfather
178.79.144.28         9005        9034  AS15830  0.2.4.27       11:16:05
                     524288  DazzleIntrospection
178.79.144.28         9006        9035  AS15830  0.2.4.27       12:45:33
                     524288  RelayOpus
178.79.157.36         9003        9032  AS15830  0.2.4.27       4:45:41
                      524288  ForumAnimator
178.79.157.36         9004        9033  AS15830  0.2.4.27       9:45:36
                      524288  RoundAlgae
178.79.161.237        9007        9036  AS15830  0.2.4.27       4:45:41
                      524288  TORExtravaganza
178.79.161.237        9008        9037  AS15830  0.2.4.27       14:15:01
                     524288  OutlawRelay
178.79.170.181        9005        9034  AS15830  0.2.4.27       2:15:13
                      524288  GogglesSausage
178.79.170.181        9006        9035  AS15830  0.2.4.27       2:15:13
                      524288  DelicateJacket
192.155.95.122        9005        9034  AS3595   0.2.4.27       9:45:36
                      524288  MightyMercury
192.155.95.122        9006        9035  AS3595   0.2.4.27       9:00:52
                      524288  ProactiveBox
198.58.103.147        9001        9030  AS36351  0.2.4.27       15:00:46
                     524288  GarlicPriest
198.58.103.147        9002        9031  AS36351  0.2.4.27       12:45:33
                     524288  LoopyAfternoon
198.58.106.245        9003        9032  AS36351  0.2.4.27       13:45:32
                     524288  OnionOfIncision
198.58.106.245        9004        9033  AS36351  0.2.4.27       9:30:21
                      524288  HackerOfPhysics
198.58.109.82         9003        9032  AS36351  0.2.4.27       3:45:42
                      524288  FairSharp
198.74.58.206         9005        9034  AS8001   0.2.4.27       9:15:06
                     1048576  Batman
198.74.58.206         9006        9035  AS8001   0.2.4.27       0:16:16
                      524288  Joker
198.74.62.107         9007        9036  AS8001   0.2.4.27       0:17:17
                     1048576  Scotch
198.74.62.107         9008        9037  AS8001   0.2.4.27       7:45:38
                     1048576  Soda
212.71.249.69         9009        9038  AS15830  0.2.4.27       7:16:09
                      524288  GaussianVisual
212.71.249.69         9010        9039  AS15830  0.2.4.27       12:31:19
                     524288  AuralSecurity
as           tor_version          average_bandwidth
-------  --  -------------  --  -------------------  --
AS36351  27  0.2.4.27       97               524288  68
AS15830  20                                 1048576  29
AS2516   20
AS3595   20
AS8001   10
2015-06-04 11:12:07,018 [DEBUG]: Output complete. Finished

@_date: 2015-03-03 10:19:25
@_author: Donncha O'Cearbhaill 
@_subject: [tor-talk] Revoking a hidden service key 
Alternatively the original hidden service operator could publish hidden
service descriptors with a normal validity period which contain a
revocation field. A HSDir which receives a descriptor containing the
revocation could replace the (potentially malicious) HS descriptor
stored in its cache.
A client could be show an alert that the hidden service they are
attempting to access has been compromised/revoked and should not be used
in future. A HS operator would then keep broadcasting the revocation
descriptor until such time that all clients are likely to have been
notified. This kind of replacement approach would allow revocation
without placing any more load or memory demands on the network.
In practice do HS operators have a need to revoke hidden service keys?

@_date: 2015-03-12 13:22:54
@_author: Donncha O'Cearbhaill 
@_subject: [tor-talk] Load Balancing/High Availability Hidden Services 
I've been thinking a little about this problem. It seems like one simple
solution would be to find a way of combining the
descriptors/introduction points from multiple Tor HS instances into one
hidden service descriptor from which the client can pick intro points at
To implement such a solution like that, there needs to be a means for
the hidden service instances to communicate with other. They can then
either selected a common set of intro points or combine the individual
sets of intro points selected by each instance.
In one straight forward implementation a hidden service operator could
set up a Tor relay and a hidden service on each of their load-balancing
nodes. These load balancing hidden services SHOULD have different hidden
service keys and could use stealth authentication for privacy (so that
their introduction points are encrypted).
A management server would contain the actual hidden service key but
would not need to run any hidden services. The role of the management
server would be to regularly fetch descriptors for the load-balancing
hidden services, combine the introduction points into a single
descriptor for the hidden service which is then published as normal.
After the signature on the hidden service descriptor is verified there
is the hidden service protocol doesn't user the permanent key/onion
address. As such there is no need for each of the relays to have a copy
of the hidden service key.
I think this provides a couple of advantages:
holding the key would generate very little traffic and would not be
locatable by the publically known hidden service attacks.
simply needs to stop including its introduction points in the
descriptor. This should minimise the need to 'revoke' hidden service keys.
The number of introduction points in a HS descriptor is currently
limited to 10 in Tor. This sets a limit on the number of load-balancing
nodes that could be deployed at present.
This approach doesn't require any changes to the Tor code base at all. I
hope to implement a management server in the next few weeks to test how
this works in practice.
It would be great to get any feedback about this proposal!

@_date: 2015-03-13 12:50:41
@_author: Donncha O'Cearbhaill 
@_subject: [tor-talk] Load Balancing/High Availability Hidden Services 
Those kind of race conditions will definitely be an issue to some
extent. Is there any data about how often IP circuits fail in practice?
Is there a limitation to introduction point attempts or timeout's in
little-t tor at present?
For now I'll poll every 15 minutes. If the management server detects
that the IP set has changed it can then republish the descriptor.
Hopefully that will minimise how often clients receive expired IP's.
Ah I misspoke, I meant to say a Tor instance not a Tor relay.
For the management server to retrieve and upload descriptors via an
unpatched Tor instance  and  would need to be merged.
Thanks for the feedback,

@_date: 2015-05-26 10:36:07
@_author: Donncha O'Cearbhaill 
@_subject: [tor-talk] Hidden Service Scaling Summer of Privacy Project 
Hi all,
I'll be working this summer on a project to help scale hidden services
and make them more resilient as part of Tor's Summer of Privacy [1].
I am interested in hearing from all existing hidden service operators.
In particular I'd like to understand the use-cases, priorities and
limitations for people who are experience the current limitations of the
hidden service subsystem. There have been anecdotal reports on the Tor
bug tracker that hidden services have trouble scaling to more than 100
concurrent connections [2]. Is this something that operators here have
experienced? There has also been recent DoS campaigns affecting Tor
hidden services which have been challenging to mitigate.
In my project I hope to produce a tool which will allow a hidden service
to be backed my multiple Tor instances which can be spread across
multiple servers and geographical locations. I am considering some of
the following features and I'd be interested to hear how useful they
might be for your onion service:
 - Redundant hidden service hosting with no single point of failure.
 - Secure storage of hidden service keys away from the Tor service on
   smartcards or HSM's
 - From a security perspective, would you prefer to minimize the
software running on the onion service instance servers or minimize
connections to the management server which has access to the service keys?
I've anyone has time to share, I'd be very interested in learning about
your experiences and current challenges. I'd also be delighted to hear
about any other features that may be useful to the HS community. Thank
you in advanced for your consideration, I hope that my project may be
useful for your onion services after the summer.
Kind Regards,
Donncha O'Cearbhaill
[2] Full Proposal:
