
@_date: 2007-05-16 03:25:03
@_author: tup 
@_subject: Exit-node keeps .$mynode.exit in dns name 
What's happening is that your Tor client strips the .$mynode.exit suffix
before initiating a stream through an exit node. At the exit node, Tor
resolves whitehouse.gov and tries to connect to it, but your packet filter
redirects the connection to Squid. Squid then looks up the original
destination address and ignores it, preferring to use the HTTP host header
specifying whitehouse.gov.$mynode.exit.
If I understand correctly, Privoxy has an option to strip the
.$mynode.exit suffix from host headers. This is something you'd want to
do next to your Tor client.
This does raise the issue of exit nodes redirecting HTTP streams
(and even non-HTTP port 80 traffic) through transparent caching proxies.
If people know exit nodes are logging not only "connection" data, but also
actual content of traffic they relay, exit nodes become a more valuable
target for attackers.
Also, since HTTP proxies won't pass non-HTTP traffic (setting aside
CONNECT, which is part of HTTP), it seems these exit nodes are lying in
their exit policies. They claim to allow port 80, but non-HTTP streams on
port 80 will fail unexpectedly.

@_date: 2007-05-08 12:01:13
@_author: tup 
@_subject: Testing a DNS-based exit node list? 
I've written another implementation of the DNS-based exit list for Tor
nodes specified in [1]. It provides some advantages over Joe Kowalski's
implementation [2] including active testing through exit nodes, lower
resource usage, and fewer dependencies. Unfortunately, to gain these
advantages it maintains more internal state and thus has a greater
potential for bugs.
You can find it here: It needs public testing before it can become official, so this message is
a request for somebody to set it up publicly. If you're comfortable
building a program written in Haskell using GHC on Unix and delegating a
DNS zone to an authoritative name server, you might be qualified to help
test this out. You should be willing to stick around and upgrade to newer
versions when they are released.
[1] [2]

@_date: 2007-10-02 03:54:56
@_author: tup 
@_subject: funneling a wireless net's outbound connections through tor 
The second loopback interface is simply a kludge I found that allows
pf to apply rdr rules to locally-originated traffic. You don't need it if
you're only trying to redirect others' traffic; see section 3.2 in that
wiki page.
You'll still want to set VirtualAddrNetwork to an unused, private
address space so that .onion and .exit names will resolve to routable
addresses when you specify 'AutomapHostsOnResolve 1'.
This is a platform-specific implementation detail, which explains why
it's not documented. What happens is that the route-to rule routes
traffic to lo1, where the rdr rule actually rewrites the destination
address and port to 127.0.0.1:9040. The original destination is kept
around in the connection state table, so it can be looked up by Tor
with the right ioctl(2) command on /dev/pf; see pf(4).
