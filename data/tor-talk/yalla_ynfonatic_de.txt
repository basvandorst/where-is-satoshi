
@_date: 2006-11-07 09:05:01
@_author: Alexander W. Janssen 
@_subject: ciruit history 
I hope not... If it would do that automatically it would mean that server
logfiles could be correlated with your TOR-daemon *shiver*

@_date: 2006-10-10 10:32:34
@_author: Alexander W. Janssen 
@_subject: Tor 0.1.2.2-alpha is out 
Is that related to our lengthy "More bad tor server?" thread?
Thanks a lot and keep up your good work!

@_date: 2006-10-13 17:57:40
@_author: Alexander W. Janssen 
@_subject: tor bandwith ratio 
Uhhh... What is that supposed to do? I only see that you mark the traffic,
then immediately leaving the chain.
Only marking them doesn't do anything. You usually mark the traffic if you
want to handle it differently later, either with the mark-match inside
iptables again, via the fwmark-option in iproute2 or tc.
If you're going to redirect the traffic you won't acchieve anything - you need
to consider the way the packets traverse through the indiviudal chains inside
the Netfilter framework.
1) Packet enters machine
2) Packet enters mangle-table, PREROUTING chain (you may MARK here)
3) Packet enters nat-table, PREROUTING chain (DNAT/redirection happens here)
4) Packet enters Linux routing-code (tc and iproute2 use fwmark here) (*)
5) Packet enters filter-table, FORWARD chain (usual filtering-rules)
6) Packet enters mangle-table, POSTROUING chain (do some stuff)
7) Packet enters nat-table, POSTROUTING chain (SNAT and MASQUERADE)
Coming back to your question: Since redirecting happens in step 3 you already
missed the point where the packet got marked. Therefore: No, that won't
happen. You'd need to mark the packet in the PREROUTING chain of the
mangle-table onto port 110, and THEN redirecting it.
That's the way it work with the Netfilter stuff.
Where and how are you actually accessing the packets you've marked with MARK
I repeat: Only MARKing does nothing. It just puts a label on the packet to
identify the packets in other parts of the kernel. (*) I'm not sure where tc integrates itself; but i think that happens in the
routing-code. Please correct me if I'm wrong. However, that doesn't help you
with your MARK and DNAT problem.

@_date: 2006-10-03 18:10:48
@_author: Alexander W. Janssen 
@_subject: More bad tor server? 
Is it possibly the same as what i got here?
If yes, i really need to apologize...

@_date: 2006-10-04 18:33:14
@_author: Alexander W. Janssen 
@_subject: Analyzing TOR-exitnodes for anomalies 
Hi all,
considering that I heard from several people that they notice strange
sideeffects since a couple of days - altered webpage, advertisement where no
ads should be - I started a little investigation if there are any obviously
bogus exitnodes in the wild:
I welcome you to start your own investigation; if there are really bogus
exitnodes we should be aware of those and we should know their node's nickname
to put them on a shitlist.
This might leed to an escalation in the future when marketeers realize the
possibilities of altering traffic.
Comments, ideas, pointers to other projects?

@_date: 2006-10-05 09:47:05
@_author: Alexander W. Janssen 
@_subject: Analyzing TOR-exitnodes for anomalies 
One or the other way, brute forcing my way through all exit-nodes should
reveil it. Hopefully...
Could be either way. Things which popped up in my mind:
1) DNS poisoning
2) Exit-node is behind a transparent proxy which is compromised or modified in
some way
3) Outbound traffic from the exit-node gets DNATed away by some firewall
Things you could do:
1) Replacing complete websites with link-farms (that's what happened me)
2) Using a modified web-proxy which insert advertisement into the HTML-code
(possible, it's exactly the reverse of what Privoxy does)
3) Filter content
4) Replacing valid downloads by trojaned versions
5) Replace all pictures of a website with a picture of the goatse-man...
6) Modifying text in a subtle way using simple lex-programs (e.g. replace all
"must" by "could" or "police" by "SS")
7) My first run during the night was not very successful, most of the exitnodes
refused to talk to me. I'm in timezone GMT+2 and that's pretty normal for that
time of the day, I started another scan just minutes ago. Usually the
TOR-network is not that congested in the morning.

@_date: 2006-10-05 15:48:57
@_author: Alexander W. Janssen 
@_subject: Analyzing TOR-exitnodes for anomalies 
Exactly the same page is at The content of that page is (gathered with tcpdump):
I don't know what the variable a_id is about - maybe a customer-id? However,
domainname can be set to any arbitrary value.
This seems to be the company behind it: Maybe, that would be an explantion considering how the searchportal-thing is
However, I'm 75% through my second run with no results so far.
Will keep you updated.

@_date: 2006-10-05 17:41:05
@_author: Alexander W. Janssen 
@_subject: Analyzing TOR-exitnodes for anomalies 
Hi Claude!
Aha? I'm still scanning with no result so far, although i found a couple of
exitnodes which have misconfigured local proxies...
OK, well, i checked that whistlersmother as well and got this picture:
landing.domainsponsor.com point again to information.com.
Stupid nonetheless. However, I'll let my scan finish, will publish my results
Thanks mate, that really helped; and my node also didn't have those exit-nodes
in his routing-table.
Cheers, Alex.

@_date: 2006-10-05 17:56:51
@_author: Alexander W. Janssen 
@_subject: First results of analysis 
============================== START ==============================
Hi all,
i checked 1161 nodes in total.
269 of them where responsive exit-nodes, all behaving correctly.
9 exitnodes where responsive, but their had some proxy installed which didn't
behave quite correct when you accessed a webpage with the notation
original.url.$nodename.exit; the error-messages varied from
"could not resolve" (looks like a DNS-leak to me) over "502 Bad Gateway"
through "502 Proxy Error".
However, in my list of exit-nodes i couldn't find any host which showed the
described behaviour. My test-URL was So there is still some space left for discussion: Did i miss the "bad" or
"banned" exitnode?
I tend to agree with Claude; at the moment it doesn't seem likely that we have
some sort of bad exitnodes in place.
However we probably should think if we should install some kind of early
warning system. I could imagine something like this: Every client checks once
per day some random website on the internet via, let's say, 10 random
exit-nodes and compares the results. If something is wrong the exitnode could
be signalled to a real human which could verify the claim.
How do you think about that?
Cheers, Alex.

@_date: 2006-09-12 19:08:15
@_author: Alexander W. Janssen 
@_subject: confiscating middleman-tor-nodes 
I'd also like to point to a roundup I've written together:

@_date: 2006-09-28 13:25:32
@_author: Alexander W. Janssen 
@_subject: Off topic: need help getting tripwire to work 
If you're using gcc version 4 or higher, than this is due to the pickyness of
the compiler; see
You could either use an older gcc (<4) or try to fix the code manually; this
was already done for the older version of tripwire, for details see:
 at lists.debian.org/msg24375.html
Hope that helps,
Alexander Janssen.

@_date: 2006-09-28 19:06:43
@_author: Alexander W. Janssen 
@_subject: Tor with ssh port forwarding 
What i do is set up a tunnel in Putty like this:
Configuration -> Connection -> ssh -> tunnels:
Don't forget to save the settings.
In Firefox set the SOCKS-Proxy to 127.0.0.1, Port 9050. You can leave
everything else blank.
ADDITIONALLY you want to tell your Firefox to send DNS-lookups through the
SOCKS-tunnel; open a tab, enter "about:config" as the URL, search for the key
"network.proxy.socks_remote_dns" and set it to "true".
