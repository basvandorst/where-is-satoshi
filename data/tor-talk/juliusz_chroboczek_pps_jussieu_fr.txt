
@_date: 2006-08-22 20:14:30
@_author: Juliusz Chroboczek 
@_subject: Traffic Logging Suggestion 
It would have the effect of making the web uncacheable by standard web
proxies.  Which would be a pity.
I think the point here is that ``HTTP basic'' (RFC 2617) authentication
over plain HTTP is hopelessly insecure.  As to ``HTTP digest'', my
feeling is that it can be implemented wrongly, and I'm not sure it can
be implemented to be secure.
I think the solution would be to make sure that your web browser never
uses HTTP authentication without also using SSL.  If anyone wrote a
firefox extension to make sure of that, he'd be doing us a favour.
                                        Juliusz

@_date: 2006-08-23 03:02:48
@_author: Juliusz Chroboczek 
@_subject: Polipo web proxy 
Roger Dingledine:
I guess I'll simply special-case ``localhost'' in the async resolver.
Yes.  In particular, Polipo will never modify an instance's body, only
the headers.  That would be very difficult to change.
As Fabian notes (see below), you can use Polipo together with Privoxy
if you really must.
Please report any such issues on polipo-users (I don't check or-talk
regularly).  But first check whether setting dontCacheCookies and
dontCacheRedirects fixes your issues -- if it does, the website's
... and has been stuck for months.  Sigh.
A workaround is to use runit to monitor Polipo.
The Cygwin build is believed to be fully functional.  There's an
experimental native build, but it's very new.
This cannot be stressed enough.  Unfortunately, use of Via is a MUST
according to RFC 2616 (it's not completely useless -- Polipo uses it
to detect proxy loops).
Hmm, I guess I could have Polipo choose a random name on each startup

@_date: 2006-08-23 03:07:08
@_author: Juliusz Chroboczek 
@_subject: Polipo web proxy 
It's actually an unintended feature ;-)
                                        Juliusz

@_date: 2006-08-23 20:12:13
@_author: Juliusz Chroboczek 
@_subject: Polipo web proxy 
That's a somewhat radical approach to proxy loop avoidance ;-)
(It would disallow chaining proxies, and chaining proxies is a
somewhat common usage scenario -- when evading firewalls, or when
trying to work around a lossy wireless link.)
I guess I'll just make disableVia the default, and give up on my
policy of conforming by default.  People who actually care about loop
avoidance can enable it manually.
                                        Juliusz

@_date: 2006-08-23 20:22:59
@_author: Juliusz Chroboczek 
@_subject: Polipo web proxy 
Roger Dingledine:
This should no longer be necessary -- I've made the async resolver
hard-wire ``localhost'' and ``localhost.'' to 127.0.0.1.
disableVia is now the default.
                                        Juliusz

@_date: 2006-08-23 23:00:56
@_author: Juliusz Chroboczek 
@_subject: Polipo-20060823 native Windows binary 
Hi all,
I've put an experimental native Windows binary of Polipo in
    This is still very experimental; for serious use, I still recommend
using the Cygwin binary.
Unlike the previous Windows binary, this version has support for
tunnelling (https proxying) and SOCKS, which should make it usable
with tor.  A number of features are still disabled, notably the
asynchronous resolver and the on-disk cache.  (Dan! help!)
There are a a number of other issues, notably error reporting (you'll
see a lot of ``unknown error'' messages).
This binary has never seen a real Windows system (I test under Linux
with a Windows emulator -- sorry, but I don't have a Windows machine),
and I'd be very grateful for feedback from Windows users.
                                        Juliusz

@_date: 2006-11-20 23:51:12
@_author: Juliusz Chroboczek 
@_subject: ANNOUNCE: Polipo 0.9.99.0 
Hello to all,
I'm attaching the announcement of Polipo-0.9.99.0, which is the first
officially released version with support for Tor.
This is a one-off: I will no longer announce new Polipo versions on
or-talk.  If you with to be informed about Polipo releases, please
subscribe to Polipo-users on
  or follow it through Gmane on one of
  news://news.gmane.org/gmane.comp.web.polipo.user
                                          Juliusz

@_date: 2006-09-11 15:32:26
@_author: Juliusz Chroboczek 
@_subject: Tor Defense Fund...an idea. 
What about people behind NAT/firewalls that they don't control?
What about people with battery-powered devices?
                                        Juliusz

@_date: 2006-09-21 17:24:44
@_author: Juliusz Chroboczek 
@_subject: (unknown) 
Polipo is a web proxy that is significantly faster than both Privoxy
and Squid, and does work well with tor.
You will find a description of Polipo and a link to the manual on
  If you use Polipo rather than Privoxy, be aware that Polipo does no
application-layer scrubbing by default, and can optionally perform
only scrubbing of headers.  If you don't understand this paragraph,
please stick to Privoxy[1].
Note that the stable version of Polipo doesn't support tor; you'll
need to use the latest beta.  This means that you might (or might not)
encounter crashes, you might (or might not) have security issues, and
you will (or will not) send me helpful bug reports.  This warranty is
void in case of nuclear conflict, whether caused by Polipo or not.
If you are under Unix (Linux, BSD Unix, Mac OS X, etc.), you will need
to grab the sources of the latest beta and compile it yourself,
e.g. by doing
  darcs get or, if you don't have Darcs,
  wget -r -l1 If you're under Windows, I've put an experimental Windows binary (one
that is believed to be fully functional) on
    Once you got yourself a binary suitable for your platform, run Polipo
as so:
  ./polipo socksParentProxy=localhost:9050
and point your browser at the proxy on Your feedback is very much needed, especially if you are a Windows
user.  Please write to polipo-users at lists.sourceforge.net.
                                        Juliusz
[1] My previous comments about the Via header are now obsolete --
    Polipo no longer uses Via by default.

@_date: 2006-09-29 16:56:52
@_author: Juliusz Chroboczek 
@_subject: Tor with ssh port forwarding 
Don't do that.  Squid will add the ``X-Forwarded-For'' header, and
hence leak your IP.
Instead of Squid, you should run either Privoxy or Polipo.
                                        Juliusz

@_date: 2006-09-29 22:36:08
@_author: Juliusz Chroboczek 
@_subject: Tor with ssh port forwarding 
Ah, sorry, I didn't know that.
                                        Juliusz

@_date: 2007-04-18 01:08:05
@_author: Juliusz Chroboczek 
@_subject: Importance of HTTP connection keep-alive 
Michael Gersten:
Fabian Keil:
I've just tested this by running
   wget -p That's 87,607 bytes in 14 files -- a small page with a few images.
I'm using tor 0.1.2.8, Polipo 1.0.0, and, for the second series,
Polipo with the attached patch applied.
Polipo was run with no on-disk cache, and was restarted between every
two tests.  The test was run 5 times, and I alternated between the two
versions of Polipo, so there should be no correlation between a given
version and a particular tor circuit.
Average after removing outliers (smallest and largest value):
  Persistent: 33s
  Non-persistent: 61s
Average of all values:
  Persistent: 66s
  Non-persistent: 98s
All times (sorted):
  Persistent: 19 39 40 52 114
  Non-persistent: 44 61 91 92 107
Please feel free to repeat my tests and report the results on this list.
                                        Juliusz
diff -rN -u old-polipo/server.c new-polipo/server.c
--- old-polipo/server.c 2007-04-18 01:01:39.000000000 +0200
+++ new-polipo/server.c 2007-04-18 01:01:39.000000000 +0200
 -1661,6 +1661,7          }
     }
+    request->flags &= ~REQUEST_PERSISTENT;
     n = snnprintf(connection->reqbuf, n, bufsize,
                   "\r\nConnection: %s\r\n\r\n",
                   (request->flags & REQUEST_PERSISTENT) ?

@_date: 2007-04-18 19:04:31
@_author: Juliusz Chroboczek 
@_subject: Importance of HTTP connection keep-alive 
[CC-ing the Polipo-users list]
It will certainly facilitate grouping requests into sessions.
I'm not sure it counts as an anonymity threat, since the session
itself is still anonymous; furthermore, there are easier ways to track
requests into sessions (cookies, ``Referer'' headers, unique tokens
embedded into URLs, If-Modified-Since requests, etc.).  But I agree
that it should at the very least be documented somewhere.
Polipo will keep a persistent connection open as long as possible, but
it will shut an idle connection down after its normal timeout (120s by
Additionally, the server's idle timeout will usually come into play;
in my experience, it's usually between 4 and 15 seconds.  But that's
irrelevant, since a malicious server could choose a much larger
For people who do believe this is a serious threat, I can think of the
following mitigations:
  (1) use a smaller timeout for idle connections;
  (2) shut down a connection after some number of serviced requets;
  (3) shut down a connection after it's been used for some time.
Trouble is, either of these will harm performance in some cases; the
obvious example being two polipi on the two ends of an ssh or ssl
tunnel, where avoiding the intial handshake helps a lot.  So I guess
I'd have to implement different behaviour for parent proxies and
direct connections.
Roger, I'd like to know whether you think this is worth implementing
for the next version of Polipo (and of course whether you have any
better ideas).  As I've stated, I don't believe this threat is real,
but I'm quite willing to do the work if you disagree.
                                        Juliusz

@_date: 2007-04-18 19:25:09
@_author: Juliusz Chroboczek 
@_subject: Importance of HTTP connection keep-alive 
So according to this test, this page downloads roughly two times
faster through Polipo/tor than through Privoxy/tor, right?
This test is not representative: this is an HTTP/1.0 site.  There are
fortunately very few of these left nowadays.
(Interesting that you should have chosen to test with this particular site.)
And notwithstanding the fact that you so carefully crafted this test
to advantage Privoxy, Polipo/tor was still 13% faster?
I guess there's no point in continuing this discussion, then.
                                        Juliusz

@_date: 2007-04-18 22:42:25
@_author: Juliusz Chroboczek 
@_subject: Importance of HTTP connection keep-alive 
[CC-ing polipo-users again]
HTTP/1.0 keepalives and HTTP/1.1 persistent connections are not quite
the same thing.  From memory, the limitations of HTTP/1.0 are
 - HTTP/1.0 kept-alive connections must be broken after every dynamic
   object;
 - pipelining is not allowed in HTTP/1.0;
 - HTTP/1.0 keepalives are not allowed when speaking to a proxy.
Polipo respects the first two limitations.  It doesn't respect the
third limitation, but instead plays a number of tricks that ensure
that it works with common HTTP/1.0 proxies (Squid, WWWOFFLE, Privoxy).
In order to be nice to the network, Polipo limits itself to
2 connections when speaking to a server that can do persistent
connections or keepalives.  This works fine when there are
opportunities for pipelining, but results in poor performance
You can customise the magic value 2 with the variable serverSlots.
I'd actually be very curious to see the results for your previous test
with serverSlots set to 5.  (I guess I should be more aggressive with
HTTP/1.0 servers by default; ideally, I'd like to work-out a scheme
to tune serverSlots automatically depending on our traffic patters.)
There's a paper about the tradeoffs involved on
  There's no good answer to that, unfortunately, as there are so many
variables involved; I don't think there's a typical web site, there
are a few classes of web sites that I believe are typical, and that
Polipo should deal with pretty well.
The easiest case is an HTTP/1.1 web server with purely static content,
or dynamic content generated by people who knew what they were doing.
Unfortunately, such servers have been becoming rare as most sites have
moved to dynamic content generation.
The KDE site is what I believe is quite typical of a modern web site:
on the one hand the content is dynamically generated by crufty PHP
scripts (no useful validators are provided), but the HTTP is generated
by a fully HTTP/1.1 web server (Apache 2).  Polipo is slightly
suboptimal in such a case, but it should be reasonably good.
Another fairly common case is that of a mis-configured server that
doesn't do persistent connections at all -- for example
  Polipo will notice that after a few requests,
and switch to using up to 8 connections to that server.  Unless
there's something really wrong in either Polipo or Privoxy,
performance should be roughly identical in the two implementations
(except for the effects of caching and range requests, of course).
The Spiegel.de web site that you tested against is actually an
interesting case.  It appears to be a bunch of typical PHP scripts (no
ETags) running on an HTTP/1.0 web server hidden behind no less than
two HTTP/1.0 front-end proxies (somebody is probably trying to do
load-balancing with a total budget of 12 pf. and an old button).
While such interesting configurations are uncommon, single HTTP/1.0
front-end proxies do happen sometimes, so I'll increase serverSlots
when speaking to such a site in the next version of Polipo.
                                        Juliusz

@_date: 2007-04-18 22:44:34
@_author: Juliusz Chroboczek 
@_subject: Importance of HTTP connection keep-alive 
Sorry, I got confused.
My apologies, I got carried away.
                                        Juliusz

@_date: 2007-04-20 02:16:21
@_author: Juliusz Chroboczek 
@_subject: Importance of HTTP connection keep-alive 
This is done now.
                                        Juliusz

@_date: 2007-04-20 03:02:54
@_author: Juliusz Chroboczek 
@_subject: Importance of HTTP connection keep-alive 
Sigh.  Here I am, brain the size of a planet, and they're asking me to
implement timeouts.
I've done all three, for the paranoid among you.  Since I don't
believe in this particular threat, the default values are very large
for (2) and (3).  They're controlled by the following variables :
  (1) serverIdleTimeout, default 45 s;
  (2) maxConnectionRequests, default 400;
  (3) maxConnectionAge, default 21 m.
Ahem... you're expecting to get a new persona without flushing
Polipo's cache, your browser's cookies and your browser's cache?
There's no need for that -- whoever is sending the NEWNYM signal
should restart both the web browser and Polipo.
                                        Juliusz

@_date: 2007-08-18 14:14:36
@_author: Juliusz Chroboczek 
@_subject: Privoxy usage? 
Ahem... if your VPN software is using TCP rather than UDP or raw IP,
then I strongly recommend that you choose a different VPN vendor.
Which means that until Roger, Nick and their basementful of slaves
implement a datagram transport for tor, it will not be possible to run
a well-designed VPN over tor.
                                        Juliusz

@_date: 2007-08-18 19:35:27
@_author: Juliusz Chroboczek 
@_subject: Privoxy usage? 
No, you're doing fine.  I'm just going to explain it differently.
You missed the two important cases ;-)
  TCP over IP works (duh)
  TCP over UDP works
This last case is why things like OpenVPN can do their job.
TCP over TCP is extremely inefficient; it will cause spurious
retransmissions, seriously impair the throughput you get and congest
the tor network.
(This does not apply to tunnelling over ssh, since ssh tunnels the
higher-layer data stream rather than the TCP packets.)
                                        Juliusz

@_date: 2007-08-19 00:19:36
@_author: Juliusz Chroboczek 
@_subject: Privoxy usage? 
That's not a VPN.  That's encryption at the application layer, and
that's fine.
That's not TCP over TCP.  That's two TCP connecitons put end to end,
and that's fine.
There is no nested TCP in normal tor operation; there's multiple
layers of SSL encryption over a single TCP connection.
On the other hand, if you run a layer 2 VPN over tor, you get TCP
within IP within multiple layers of SSL within TCP.  And that's not
good, either for your performance, or for the network.
                                        Juliusz

@_date: 2007-08-19 16:25:14
@_author: Juliusz Chroboczek 
@_subject: Privoxy usage? 
This approach is described in RFC 1925 section 2.3.
                                        Juliusz

@_date: 2007-12-02 20:23:02
@_author: Juliusz Chroboczek 
@_subject: Insecurities in Privoxy Configurations  - Details 
FWIW, both the cache index and the list of recently accessed servers
are disabled by default.  Reconfiguring Polipo is enabled by default,
and I agree that it is a good idea to disable it, ass suggested by
Roger above.
I'm trying to put together all hints about running Polipo with Tor on
  Please send your additions to the Polipo-users at lists.sourceforge.net
mailing list.
                                        Juliusz

@_date: 2007-12-02 20:28:55
@_author: Juliusz Chroboczek 
@_subject: Help me understand tor with SSL? 
Firefox should in principle not use the DNS if
  network.proxy.socks_remote_dns
is set to true (in about:config).
This is better done in the browser, for quite a few reasons, including
the fact that there is no way a proxy can do that for SSL connections.
                                        Juliusz

@_date: 2007-12-02 21:56:54
@_author: Juliusz Chroboczek 
@_subject: Help me understand tor with SSL? 
You're correct, this is only true for direct connections to tor.
                                        Juliusz

@_date: 2007-12-30 21:45:17
@_author: Juliusz Chroboczek 
@_subject: Running on embedded hardware 
Nice router.  The CPU is a 260 MHz MIPS core from Broadcom that
implements almost all of the MIPS32 instruction set (the one exception
being the WAIT instruction).
Switch to Kamikaze.  It's much more pleasant to work with, and I've
found it to be somewhat more stable than Whiterussian.
You're cross-compiling, so you'll probably want to say something like
  CC=mipsel-linux-gcc CFLAGS='-Os -march=mips32' ./configure --whatever
As coderman noted, this might indicate a mis-compiled binary.  Make
sure you compile for MIPS32, and that you use at least gcc 3.4.4.
Upgrading to Kamikaze is good, since it will have been compiled with
a more recent release.
                                        Juliusz

@_date: 2007-07-20 23:50:22
@_author: Juliusz Chroboczek 
@_subject: constrained socket buffers patch 
Your information might be somewhat obsolete...
Have a look at my machine (a pretty ordinary recent Linux) connecting
to tor.eff.org:
  lanthane.45747 > 209.237.230.67.www: SWE 4264190125:4264190125(0) win 5840   209.237.230.67.www > lanthane.45747: S 3004159902:3004159902(0) ack 4264190126 win 65535 Lanthane (my machine) opened a connection to tor.eff.org.  Since it
doesn't have any information about the connection's RTT yet, it
declares a very small TCP window (5.8 kB).  Tor.eff.org has a somewhat
more traditional implementation of TCP, so it starts with a window
size of 64 kB.
(Note that both sides negociated the wscale option, so from now on we
need to multiply lanthane's values by 64, and tor.eff.org's by 2).
A little while later, the situation has evolved as so:
209.237.230.67.www > lanthane.pps.jussieu.fr.45747: P 4112:4445(333) ack 4629 win 33304 lanthane.pps.jussieu.fr.45747 > 209.237.230.67.www: . ack 4445 win 408 As you may see, tor.eff.org has grown its receive window to 67 kB,
while Lanthane has gone up to 26 kB.
                                        Juliusz

@_date: 2007-07-02 01:16:52
@_author: Juliusz Chroboczek 
@_subject: [Polipo-users] Polipo 1.0.1 Windows binary 
Is the async resolver working?  I tested it under 10.3 at some point,
but I'd be glad to hear whether I've broken anything since then.
Could you please explain that?  (I'm unfortunately unable to unpack
your dmg file since I replaced my installation of MacOS 7.1 with
NetBSD 1.5.  So now you know why Polipo contains `` __mc68020__''.)
Conveniently, Andrew's key (31B0974B) is signed by Roger's (28988BF5)
which is signed by more or less everyone, so you should have no trouble
veryfing it.
Thanks a lot for your work, Andrew.
                                        Juliusz

@_date: 2007-07-02 21:30:39
@_author: Juliusz Chroboczek 
@_subject: [Polipo-users] Polipo 1.0.1 Windows binary 
(Andrew -- are you on polipo-users?  If so, I suggest we move there,
no need to clutter or-talk.)
Thanks.  (For anyone listening and who's not familiar with Apple's
marketing talk, a ? Universal binary ? is what us mere mortals call
a fat binary or a multiarch binary.  It's merely a binary that
contains the object code for multiple architectures.  In Apple's case,
it's PPC and x86.)
I'd just replace this hunk with
  PLATFORM_DEFINES=-sysroot ... -arch i386 -arch ppc
This way, you can still say something like
  make CDEBUGFLAGS='-O0 -g'
and get the expected result.
I'm following the X11 makefile conventions (with a few additions from
GNU), and the idea is that:
 - CDEBUGFLAGS should have a reasonable default value, but it can be
   changed by the user;
 - PLATFORM_DEFINES is reserved for platform-dependent stuff;
 - EXTRA_DEFINES is reserved for the user -- it should never be set in
   the makefile;
 - all other variables are internal to the makefile and should not be
   changed by the user.
That's not necessary -- there's an ?  MINGW ? around mingw.c.
That's already the default.
That's not necessary if you set proxyAddress.
Hmm... I'm wondering whether it's a good idea to have this enabled by
default -- after all, Polipo is useful without tor.  If you do so, may
I kindly request that you should put a prominent notice in the README
file about that?
I guess that if you're running Mac OS X, fifty megs is small change ;-)
Thanks again for your work,
                                        Juliusz

@_date: 2007-07-13 03:44:49
@_author: Juliusz Chroboczek 
@_subject: constrained socket buffers patch 
I'd like to know how this will interact with tor's circuit selection.
If I understand this patch correctly, it sets the SO_SNDBUF and
SO_RCVBUF socket options so as to limit the maximum size of the TCP
send and receive windows respectively.
Now the throughput (``bandwidth'') of a TCP connection is limited by
window/rtt.  What this means is that with ConstrainedSockets enabled,
your tor server will have basically unlimited throughput on a local
connection, but be limited to roughly 40 kB/s per connection (that's
bytes, not bits) over a transatlantic link[1].
Perhaps one of the tor developers could clarify whether tor's circuit
selection and congestion control can deal with server's whose per-
connection throughpout (but not necessarily aggregate throughput) is
widely dependent on where you come from?
                                        Juliusz

@_date: 2007-07-13 11:05:55
@_author: Juliusz Chroboczek 
@_subject: constrained socket buffers patch 
You asked for it ;-)
The distance between Paris to New York is 5851 km, which is pretty
close to 20 ms * c.  The speed of light in fiber is almost exactly
2/3 * c, which means that just the signal propagation gives a round
trip time of 60 ms; make it 70 ms to allow for router latency.
A 4 kB window contains 2 Ethernet-size packets (I'm assuming that your
TCP is sending full-size packets, i.e. that's it's doing SWS-avoidance),
so you send 3 kB of data every 70 ms, or 43 kB per second.
Good to hear -- I guess this solves the issue.
There is another issue, which doesn't appear in the above.  TCP is
extremely sensitive to packet loss when the window is smaller than
4 packets (fast retransmit doesn't work in that case).  So could
I suggest a default value for ConstrainedSockSize of 8 kB?
                                        Juliusz

@_date: 2007-06-27 12:05:47
@_author: Juliusz Chroboczek 
@_subject: HTTP response is "Connection: close" 
Then you should get a ? 502 Server dropped connection ? error.  If you
don't, please report it as a bug.
This shouldn't happen -- unless Polipo's immediate upstream happens to
be an HTTP/1.0 implementation.  (Even if the upstream is HTTP/1.0,
this should only happen if the upstream sends no Content-Length *and*
the connection is broken just after the CR-LF-CR-LF that ends the
Please let me state this once more.  HTTP/1.0 is obsolete, it is slow,
it is unreliable.  I've done my best to make HTTP/1.0 reasonably
reliable in Polipo, but there's really not much that one can hack
around with such a deficient protocol.
(Note that, since HTTP/1.1 is backwards compatible with 1.0, it is
possible to send an HTTP/1.0 reply with an HTTP/1.1 header.)
Then don't do that.  Privoxy is downgrading perfectly good HTTP/1.1
replies down to the old, unreliable, HTTP/1.0 kind.  (Note that it
does tag them with ? HTTP/1.1 ?, which it is perfectly allowed to do.)
Tested with Privoxy 3.0.6.
Yes, there's a special hack to ensure that objects served as HTTP/1.0
are less sticky than normal.  (File server.c line 2086.)
                                        Juliusz

@_date: 2007-06-27 12:21:52
@_author: Juliusz Chroboczek 
@_subject: HTTP response is "Connection: close" 
Oops, I mis-read your message.  Running Polipo upstream of Privoxy is
fine, it's running Privoxy upstream of Polipo that causes lossage.
Sorry for that,
                                        Juliusz

@_date: 2007-05-04 21:44:16
@_author: Juliusz Chroboczek 
@_subject: Exiting only port 80 
Please add port 22 (ssh).
                                        Juliusz

@_date: 2007-05-04 22:22:51
@_author: Juliusz Chroboczek 
@_subject: OT: French laws on data retention [was: We won't need Tor anymore] 
My German is next to nonexistent, but I understand it's about the data
retention provisions of the so-called LCEN law (? law about trust in
digital economy ?), more precisely Art. 6 of law 2004-575 dated 21 June 2004:
  It's old news, unfortunately.  These laws were voted in June 2004 by
both ruling conservative parties (UMP and UDF), while the Socialist
and Green parties voted against them.
(Aside: there is a growing suspicion of an alliance between the ruling
UMP party and media companies, something that would appear to be
confirmed with the forcing through parliament of the infamous DADVSI
laws in December 2005 through June 2006 by Christian Vanneste, Renaud
Donnedieu de Vabres and Mich?le Alliot-Marie, the latter being most
probably our next prime minister.  The position of the UDF party is
less clear, at least to me.  Aside ends.)
According to our best-beloved government, LCEN is merely the
transposition into French law of the European directive 2000/31/CE.
The critics of the laws claim that LCEN goes beyond what the directive
requires, but this might bear veryfing.
The forthcoming electoral campaign for the French parliament might be
a good time to campaign for revising the LCEN law.  (If you're
a French citizen, writing to your d?put? or main opposition candidate
is definitely a good idea.)
My understanding is that the data retention provisions of LCEN
(Art. 6.II) only apply to service providers (as defined in Art. 6.I
paragraphs 1 and 2), so it's not clear to me whether Tor servers are
On the other hand, Tor hidden services are clearly made illegal by
Art. 6.III.  (Punishable by up to one year in jail and a E$65000 fine.)
Sorry for the off-topic post,
                                        Juliusz

@_date: 2007-05-06 21:49:05
@_author: Juliusz Chroboczek 
@_subject: Exiting only port 80 
As far as I understand you, you're trying to work out a traffic
engineering policy that will cause tor to work better for most people
while only impacting a minority.
Ssh doesn't use much bandwidth; what it needs is low latency and
stable servers.  So if you are setting up a fast stable tor server,
you'd be doing some people a favour by opening port 22.  Since ssh
uses negligible bandwidth, you won't be impacting web traffic at all.
                                        Juliusz

@_date: 2007-11-25 20:37:00
@_author: Juliusz Chroboczek 
@_subject: Questions about a TOR server 
Folks, please open port 22.  587 and 5222 would be helpful too.
                                        Juliusz

@_date: 2007-11-25 20:47:44
@_author: Juliusz Chroboczek 
@_subject: Tor appliances 
As far as I know, this is proprietary software.  Since there are
a number of Free Operating Systems available for embedded platforms[1],
I am not quite sure why you are posting this on or-talk.
                                        Juliusz
[1] My favourite happens to be OpenWRT, the latest version of which
    has been ported to x86 hardware.

@_date: 2007-11-26 13:33:44
@_author: Juliusz Chroboczek 
@_subject: Tor appliances 
Sorry, I looked at the web site of a company who have proprietary
Linux distributions called Wrap and Alix.  The similarity of names is
probably not coincidental.
That's all right, then.  Sorry for the confusion.
                                        Juliusz

@_date: 2007-10-10 21:33:56
@_author: Juliusz Chroboczek 
@_subject: Incognito Live CD using Polipo 
If you provide me with the precise semantics of the whitelist, I can
implement something compatible in Polipo.
                                        Juliusz

@_date: 2007-10-27 12:56:18
@_author: Juliusz Chroboczek 
@_subject: Firefox IPv6 Anonymity bypass 
Nonsense.  At the time at which Firefox decides whether to make
a request through a proxy, it doesn't yet know whether the target
server has an IPv6 address.
What you're seeing is probably some other issue, which it would be
good to clarify.
                                        Juliusz

@_date: 2007-10-09 19:50:29
@_author: Juliusz Chroboczek 
@_subject: Incognito Live CD using Polipo 
Do you have a script you'd be willing to share?  I'd be glad to link
to it from the Polipo page.
                                        Juliusz

@_date: 2007-10-01 03:33:46
@_author: Juliusz Chroboczek 
@_subject: funneling a wireless net's outbound connections through tor 
============================== START ==============================
Do not do that.
You should not make traffic go transparently through tor, unless the
people using your network fully understand what tor is about, and what
are the associated security risks (such as exit nodes performing MITM
attacks on SSL certificates).
Instead, put a simple stateless firewall on your network, and redirect
port 80 traffic to a web server that explains how to set up their web
browser to go through tor.
Please make sure that your HTTP proxy allows CONNECT to TCP ports 22,
80, 109-110, 143, 443, 873, 993 and 995.  22 is especially important
if there are any geeks in your neighbourhood.
                                        Juliusz

@_date: 2007-09-03 20:37:47
@_author: Juliusz Chroboczek 
@_subject: [Polipo-users] ANNOUNCE: Polipo-1.0.2 
Could I please see a copy?  I'm rather keen on having the default
installation of Polipo be roughly the same on all platforms.
DJB is annoying, but he often has a point.  Please see
  especially the last paragraph.
                                        Juliusz

@_date: 2007-09-16 00:29:13
@_author: Juliusz Chroboczek 
@_subject: I break the silence: My arrest 
That is very interesting stuff.
Alex, perhaps you or somebody could put up a web page, in German, that
explains in simple terms what Tor is about, aimed at explaining to the
average German police officer what tor is about.  This might (or might
not) prove useful if other German tor operators get into a similar
kind of situation.
                                        Juliusz

@_date: 2007-09-20 17:04:45
@_author: Juliusz Chroboczek 
@_subject: About HTTP 1.1 Cache 
You're right.  This is one of the reasons why you must purge your
browser cache and your proxy cache regularly when you use tor, typi-
cally whenever you switch from one persona too the other.
This is also why I recommend that people using Polipo with tor should
not use an on-disk cache, unless they understand the consequences.
                                        Juliusz

@_date: 2007-09-22 17:11:57
@_author: Juliusz Chroboczek 
@_subject: Reminder: running Polipo with Tor, no need to mail me 
Dear all,
In an attempt to reduce the amount of queries I receive by personal
mail, please make a note of the following.
Running Polipo with Tor is described in excruciating detail on
  The Polipo manual is included in the Polipo distribution, and is also
available online on
  There is also a detailed FAQ on
  If the above do not answer your question, please feel free to ask on
either the polipo-users or the or-talk list, both of which are full of
knowledgeable people and both of which I try to monitor regularly.
Do not contact me by private mail, unless you have a good reason.  If
you do, I'll probably ask you to repeat your query on the mailing list.
                                        Juliusz

@_date: 2007-09-22 17:26:11
@_author: Juliusz Chroboczek 
@_subject: Load Balancing 
Not quite.  Polipo will try to use up to n simultaneous connections to
a given server, where n is
  - 2 for a server that can do pipelining;
  - 4 for a server that can do persistent requests but not pipelining;
  - 8 for a server that cannot do persistent requests.
These magic constants are configurable.
Ideally, Polipo should choose the number of simultaneous connections
depending on an estimate of average queue length, but I haven't
thought about it seriously yet.
I think so too, but some people disagree.  Since I don't want to get
into this discussion again, I refer you to the following friendly flamewar.
(Note that while the tone was not always as polite as it should have
been, Fabian and I live in good friendship and mutual respect.)
  Fabian Keil:
    Me clarifying:
  You may also find this paper interesting:
                                          Juliusz

@_date: 2007-09-22 17:52:53
@_author: Juliusz Chroboczek 
@_subject: [Polipo-users] Reminder: running Polipo with Tor, no need to mail me 
Point taken.  Patches welcome.
                                        Juliusz

@_date: 2007-09-22 18:25:03
@_author: Juliusz Chroboczek 
@_subject: About HTTP 1.1 Cache 
I believe you're referring to the following functionality:
  > The "randomize" option overwrites the value of the
  > "Last-Modified:" header with a randomly chosen time between the
  > original value and the current time.
Most servers treat Last-Modified values as opaque validators --
i.e. ``IMS: foo'' matches if the modification date is not exactly foo,
rather than matching if the modification date is more recent than foo.
Hence, in practice the randomize setting will bust the cache.
(The reason for that is that this approach is more reliable in the
presence of broken clocks somewhere in the universe.)
We're in violent agreement.
                                        Juliusz

@_date: 2007-09-23 16:46:02
@_author: Juliusz Chroboczek 
@_subject: About HTTP 1.1 Cache 
Interesting -- thanks for the info.
                                        Juliusz

@_date: 2007-09-05 13:22:11
@_author: Juliusz Chroboczek 
@_subject: ExitPolicy questions 
Huh?  According to  ,
it's supposed to be used by X.25 PDNs:
  014/8   Jun 91   IANA - Public Data Network
Please file a bug against your favourite IBM mainframe operating system.
                                        Juliusz

@_date: 2007-09-24 13:49:23
@_author: Juliusz Chroboczek 
@_subject: [Polipo-users] Testing Polipo on Windows 
[CC-ing or-talk, in case somebody there has already heard about this
Windows thing]
It's not like Polipo development breaks things daily.  If the Mingw
code starts rotting, you'll get plenty of advance notice (months).
For now, I'm simply doing my best not to break anything, but not
actively testing under Windows.
But it does make me uneasy to have this blob of code in Polipo which
I'm not able to maintain.  Unless this changes, I am unwilling to
commit to anything.
World domination is my plan.  Please pick a different one.
I think that would be more effective if Hv3 used a pristine copy of
Polipo rather than a local copy, and tracked the head branch
regularly -- this would make you notice faster if anything broke.
Of course, if there were one or two Windows users willing to check
every release candidate for Windows-specific regressions, that would
do a lot to make me more comfortable.
It looks like we're all struggling to support an obsolete OS that none
of us use any longer.  It reminds me a little of the `` VMS''
fetish we used to have in the nineties.
                                        Juliusz

@_date: 2007-09-26 21:04:26
@_author: Juliusz Chroboczek 
@_subject: Clone nodes 
Could you please clarify?  What's an onion, how does it differ from
the current design?
                                        Juliusz

@_date: 2008-04-14 02:06:49
@_author: Juliusz Chroboczek 
@_subject: Curious about the way Tor makes cells 
This is called cargo-cult science, I believe.
It makes no difference whatsoever.
It multiplies by four the amount of traffic you generate during
transient routing loops.  But even multiplied by four, this remains
a negligible amount of traffic.
Let me explain.  In a stable Internet, there are no routing loops;
every packet follows a path to the destination, or is blackholed early
However, the Internet is not stable: routers crash, transatlantic
links are nibbled by sharks.  So the routing protocols need to switch
routes when the previously selected route to a given destination changes.
Now most of the routing protocols used in the Internet do not
guarantee loop-freeness during reconvergence (OSPF does not, BGP
almost does, EIGRP always does).  For that reason, every IP packet is
equipped with a hop count (called a TTL for historical reasons) that
is decremented whenever the packet is forwarded.  Thus, an IP packet
stuck in a routing loop is forwarded at most MaxTTL hops.
You want MaxTTL to be as low as possible (so that such packets are
dropped as early as possible), but to be larger than the longest path
in the Internet.  The current default of 64 should be good enough to
cover the most extreme cases in today's Internet; setting it to 255
will uselessly forward your packets 255 times before deciding we're
stuck in a loop.
                                        Juliusz

@_date: 2008-04-14 02:14:37
@_author: Juliusz Chroboczek 
@_subject: TTL settings for Tor 
Short answer -- no.  Tor's slowness is at the application layer, you
won't achieve much by tweaking the transport layer.
This is not specific to tor -- you should set this to be larger than
your bandwidth-delay product.  Since Internet paths tend to be in the
20 to 300 ms range, if you've got enough memory you may want to set it
to one-third your throughput in *bytes* per second.
For example, if you're running on a 1Mbit ADSL line, you should set it
to 42 kB or more (1000000 / 8 / 3).
A few caveats:
 - do *not* tweak your TCP windows if you're running Windows Vista or
   a recent Linux (don't know about the BSDs); these systems do
   automatic tuning, and are likely to do a better job than you;
 - do *not* tweak your TCP windows if you are a gamer; increasing
   your TCP windows will increase your latency;
 - do *not* tweak your TCP windows if you're short on memory; you pay
   for one TCP window for every single TCP socket.
                                        Juliusz

@_date: 2008-07-07 19:35:06
@_author: Juliusz Chroboczek 
@_subject: Traffic routed through Sweden 
I cannot but strongly disagree with that notion.
I expect my automobile vendor and my car mechanic to guarantee my
safety while I know little more about cars than how to check the
tyres' pressure.  I expect the people who built the bridges in my area
to guarantee that they won't fall down without me needing to know much
about statics.  And I expect to be able to go from Calais to Dover by
ferry without knowing anything about ship buidling.
This is not to say that we should guarantee anything at the exit-node
level, but please don't take the elitist attitude that your car
mechanic, your civil engineer and your ship-builder should know whether
AES-128 is more or less secure than Blowfish.
                                        Juliusz

@_date: 2008-03-18 11:48:55
@_author: Juliusz Chroboczek 
@_subject: Changing configuration depending on local IP? 
My laptop is running tor, and its connectivity to the global Interned
depends on where I connecti it to.  I'd like to change the tor
configuration depending on my IP address.
More precisely, I'd like to usually run as a client in the default confi-
guration, as a client behind a paranoid firewall if I'm in 192.168.4.0/24,
and as a server if I'm on a certain (globally routable) prefix.
Yes, I know I could manage with a bunch of sed scripts in if-up.d, but
it would be much more convenient if I could just tell tor about the
various IP prefixes and be done with that.
                                        Juliusz

@_date: 2008-03-29 23:48:28
@_author: Juliusz Chroboczek 
@_subject: Proposal: Incorporate Unreachable ORs into the Tor Network 
My opinion would be that this is better achieved by making tor able to
use both IPv4 and IPv6 for communication between nodes.
In 99% of cases, a node cannot accept inbound connections because of
a NAT box in the middle.  Such a node can accept IPv6 connections in
most cases, as long as it establishes a Teredo tunnel.
                                            Juliusz

@_date: 2008-03-02 19:34:24
@_author: Juliusz Chroboczek 
@_subject: "Your system clock just jumped" on Debian+VMware ESX 
Using select (or poll) and gettimeofday, while not technically
correct, is the only portable way of writing an even-driven program
under Unix.  I can't believe that vmware might not support this technique.
The issue with the above technique is that it's vulnerable to clock
stepping.  The correct wa is to use clock_gettime(CLOCK_MONOTONIC)
rather than gettimeofday, but it's supported on precious few systems.
(The older BSD technique of using select and checking the time spent
in select is not only not portable, but it's also not correct since it
causes skew.)
                                        Juliusz

@_date: 2008-05-26 20:46:09
@_author: Juliusz Chroboczek 
@_subject: Default Exit Policy 
4.3.  Require Authentication
   The MSA MUST by default issue an error response to the MAIL command
   if the session has not been authenticated using [SMTP-AUTH], unless
   it has already independently established authentication or
   authorization (such as being within a protected subnetwork).
In other words, SMTP-submit MUST use authentication, but the
authentication may be something as weak as deciding depending on the
IP address.
Folks, unless you are running on a network that allows unauthenticated
SMTP-auth, please allow port 587 in your exit policy.
                                        Juliusz

@_date: 2008-11-20 21:40:42
@_author: Juliusz Chroboczek 
@_subject: Any plans to fix tor for OpenDNS? 
This is on a server that is recursive for a small user community (2 to 10
users, depending on the time of day), and authoritative for a small network
(a dozen machines).
  $ ps -ubind lw
  F   UID   PID  PPID PRI  NI    VSZ   RSS WCHAN  STAT TTY        TIME COMMAND
  1   103  2728     1  18   0  31100  3884 rt_sig Ssl  ?          0:10 /usr/sbin/named -u bind
FWIW, this machine is a 600 MHz Pentium III with 128 MB RAM, and it serves
as a name server, a firewall (for both IPv4 and IPv6), a router (using two
different routing protocols, over both IPv4 and IPv6), and a VPN endpoint
for 6 tunnels.  I've never seen it swap.
It's running a heavily customised version of Debian, which makes it lighter
than whatever you'll be able to achieve with proprietary software.  Still,
it makes my point -- building your own network infrastructure is cheap.
                                        Juliusz

@_date: 2008-11-25 20:13:53
@_author: Juliusz Chroboczek 
@_subject: RetroMessenger over Tor / TorMessenger 
I've only had a quick look, but there are good arguments that the PGP web
of trust is not necessarily the right framework for IM.  I suggest that you
look into OTR, which arguably is a better model *for this particular application*.
    OTR is layered above the IM protocol, and to a great extent it's agnostic
to the underlying protocol -- it works over Jabber just like it works over
GG or MSN.
                                        Juliusz

@_date: 2008-10-24 23:25:56
@_author: Juliusz Chroboczek 
@_subject: GnuPG through Tor 
Note that this only happens when the server uses an obsolete protocol (RFC
2068).  However, this is definitely a bug, and will be fixed in Polipo 1.0.5.
                                        Juliusz

@_date: 2008-10-24 23:28:54
@_author: Juliusz Chroboczek 
@_subject: Performance 
Polipo has been shown to be faster than most browsers' implementation of
As for resources consumed, people are running Polipo on embedded routers
with 16 MB of memory.
                                        Juliusz

@_date: 2009-04-18 00:14:05
@_author: Juliusz Chroboczek 
@_subject: exit counts by port number over 61 days 
Please don't give this kind of advice.  Somebody might think you know what
you're speaking about.
Your list includes Bittorrent, which is a highly optimised protocol for
sending massive amounts of data.  Running BT over the tor network is
considered as an abuse of the network.
Your list doesn't include for example 22 (ssh), which is absolutely
essential for many of us.
                                        Juliusz

@_date: 2009-04-21 00:58:03
@_author: Juliusz Chroboczek 
@_subject: exit counts by port number over 61 days 
Dear Marco,
The issue is somewhat controversial, and as far as I know it's not
discussed in detail anywhere.
1. Bittorrent is optimised for bulk transfer.  Tor is designed to be
a low-latency network.  Using high-throughput applications such as
Bittorrent over tor is pointless.  One should instead implement
anonymity in the P2P applications themselves (as Freenet tried, and
failed, to do).
2. Tor currently doesn't include proper fairness algorithms.  Hence,
running a Bittorrent client gives you an unfair share of the available
bandwidth, and kills the latency for the rest of us.
1. Tor should be able to deal with Bittorrent.  Running Bittorrent over
tor is what might finally get the tor developers to implement proper
inter-flow fairness.  (Yes, I know, it's a *very* difficult problem.)
2. People do want to run Bittorrent anonymously.   Allowing Bittorrent
on the tor network might bring more interest to tor.
I think that's it.  Take your pick.
                                        Juliusz

@_date: 2009-04-24 20:29:55
@_author: Juliusz Chroboczek 
@_subject: Be ready: We're switching version control systems 
This is excellent news.
This also means that occasional contributors will be able to use the
A centralised RCS, such as CVS or SVN, segregates contributors into two
categories: those who have commit rights, and are able to enjoy all the
nice features of the RCS, and those who don't, for whom the RCS is
little more than a way to get the latest sources.
With a decentralised RCS, all contributors are able to use the RCS; if
you're a non-comitter, you work on his private branch, which can be on
a different server or simply on your laptop.  When your code is ready,
you either ask somebody with commit rights to pull your changes into the
official repository, or you push over e-mail.
                                        Juliusz

@_date: 2009-01-23 01:29:59
@_author: Juliusz Chroboczek 
@_subject: tor over ipv6 
If you're running Linux, there's a write-up on
                                          Juliusz

@_date: 2009-06-01 20:52:07
@_author: Juliusz Chroboczek 
@_subject: TOR and HADOPI 
Fortunately, the ISP market in France has been fairly healthy since
Proxad/Free.fr successfully challenged France Telecom's monopoly.  There
are at least 5 major players competing in the mass market on razor-thin
margins, plus a number of higher-priced professional offers, plus at
least one non-profit organisation that manages to actually provide ADSL
to peoples' homes (fdn.fr).
I really don't see how an ISP could significantly increase the costs
without losing a significant part of the French market share.
                                        Juliusz

@_date: 2009-06-01 20:57:54
@_author: Juliusz Chroboczek 
@_subject: SoC Project: Improving Hidden Service Security and Usability 
Not to get into a ? my Emacs is better than your vi ? discussion, but
I've had excellent experiences with Lighttpd.  I've also found the code
to be much cleaner than that of thttpd.
Whatever the web server, PHP is a security disaster, and I wouldn't
dream of putting it on a hidden service.
                                        Juliusz
P.S. ? PHP is a minor evil perpetrated and created by incompetent amateurs,
       whereas Perl is a great and insidious evil, perpetrated by skilled
       but perverted professionals. ? ? Jon Ribbens

@_date: 2009-06-01 21:01:06
@_author: Juliusz Chroboczek 
@_subject: GSoC Introduction! (TorButton) 
Just for the record, this feature first appeared in Polipo:
                                            Juliusz

@_date: 2009-03-16 22:31:46
@_author: Juliusz Chroboczek 
@_subject: Why Tor is slow and what we're going to do about it 
Interesting.  A couple comments.
1. The congestion control issues are interesting indeed.  I really wish
I had some time to work on tor.
2. I'm not sure that user education is the way; better fairness within
tor's congestion control algorithms feels more promising to me.  The TCP
community has done quite a bit of research about per-aggregate fairness of
congestion control; my favourite algorithm happens to be Stochastic Fair
Blue [1,2], which is cheap and reasonably fair.
3. One point you fail to mention is the lack of NAT traversal in tor.  I'm
sure it'd help if a tor relay could be run behind a NAT without the need to
manually punch holes.
Rather than developing our own variant of STUN, I'd recommend we simply get
tor to work over IPv6.  Then a user will be required to run Teredo, which
is a NAT-punching protocol for tunnelling IPv6 over IPv4; it's built into
Windows since XPSP2, and available for Unix as Free Software [3,4].
                                        Juliusz
[1] [2] [3] [4]

@_date: 2009-05-28 23:01:44
@_author: Juliusz Chroboczek 
@_subject: TOR and HADOPI 
Using tor to evade the French data retention and HADOPI laws is no different
from using tor for evading the surveillance of other police states.
Now don't get me started about how stupid HADOPI is.
Under HADOPI, the ISP is required to monitor your Internet usage, at
their cost.  After three warnings, they are meant to disconnect you
while you continue paying your ISP bill.  I'm sure that's going to do
wonders for the ISPs' customer relations.
While HADOPI mandates massive surveillance of Internet users, the total
budget voted for enforcing it is a mere 6.7 M? per annum, which implies
that enforcement will be entirely from the ISPs' pockets.  I'm sure
they'll love it.
                                        Juliusz

@_date: 2009-11-07 19:24:59
@_author: Juliusz Chroboczek 
@_subject: Tor WIN in germany :) 
Please publish an English translation, so it gets Googlified.
                                        Juliusz
To unsubscribe, send an e-mail to majordomo at torproject.org with
unsubscribe or-talk    in the body.

@_date: 2009-09-25 23:54:58
@_author: Juliusz Chroboczek 
@_subject: private vs. public tor network ... any other options ? 
Trouble is -- you don't have a way of reserving part of the throughput
to yourself.  The whole point of tor is that exit and middleman nodes
don't know which flows belong to which user, and hence reserving
resources to a given user is not doable.
If you're mostly accessing a small set of servers, you could restrict
your exit policies to those particular IPs; this way, you'd only be
sharing resources with those users that are also accessing those
servers.  Similarly, if you're only using rare ports (e.g. 22), then you
could set up your exit policies to only allow those ports.
I doubt, however, that this will help much.  The proper solution is to
improve the tor network, in particular to implement fair sharing of
bandwidth between flows, prioritisation of interactive traffic, and
especially IPv6 support (so that hosts behind NATs can accept incoming
connections from other tor nodes with no special tricks).
                                        Juliusz
To unsubscribe, send an e-mail to majordomo at torproject.org with
unsubscribe or-talk    in the body.

@_date: 2010-08-20 21:25:37
@_author: Juliusz Chroboczek 
@_subject: polipo 
It works for me.
It's "user-agent", not "useragent".
  censoredHeaders = user-agent
                                        Juliusz
To unsubscribe, send an e-mail to majordomo at torproject.org with
unsubscribe or-talk    in the body.

@_date: 2010-08-23 19:43:01
@_author: Juliusz Chroboczek 
@_subject: polipo 
My personal opinion (and I'm the author of Polipo) is that all content
munging should be done in the browser -- munging in the proxy is
a broken design.  Unfortunately, the browser vendors care more about
functionality than privacy.
I'd rather see privacy features in the browser core, not slapped-on as
                                        Juliusz
To unsubscribe, send an e-mail to majordomo at torproject.org with
unsubscribe or-talk    in the body.

@_date: 2011-02-10 19:17:50
@_author: Juliusz Chroboczek 
@_subject: [Geoff Down] [Polipo-users] Polipo crash (Vidalia Bundle) on OSX10.3.9 
An embedded message was scrubbed...
Size: 1267
URL:

@_date: 2011-01-12 18:19:35
@_author: Juliusz Chroboczek 
@_subject: [Polipo-users] Polipo moved back to PPS 
An embedded message was scrubbed...
Size: 2996
URL:

@_date: 2011-01-31 07:09:10
@_author: Juliusz Chroboczek 
@_subject: Polipo bug reporting 
Please note that Polipo is very short on manpower -- there's only me
working on it in my copious free time, and it's my nth project, for some
large value of n.  As Robert mentioned, you're welcome to report your
bug on the Polipo mailing list, but please don't expect a timely fix.
To unsubscribe, send an e-mail to majordomo at torproject.org with
unsubscribe or-talk    in the body.
