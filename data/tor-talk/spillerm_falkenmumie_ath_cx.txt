
@_date: 2006-09-06 14:45:16
@_author: Marianne Spiller 
@_subject: Assertation -> tor crashes 
Hi there,
via pkgsrc, I installed tor-0.1.1.23 and privoxy-3.0.3_(stable).
I did a tor server setup; it works for minutes - web access, instant messaging and so on. Then it crashes without any comment. I understood: it ran as a daemon, so I put in into foreground and get this message:
assertion "tv->tv_usec >= 0" failed: file "event.c", line 665, function [1]   Abort trap              ${command} --Use...
It's a NetBSD-3.0_sgimips box, running on a SGI Indy, 256MB, 200MHz r4600.
Any suggestions?
   Mary

@_date: 2006-09-06 15:25:43
@_author: Marianne Spiller 
@_subject: Assertation -> tor crashes 
> Please provide the Debugging output.
 > "Log debug" in torrc
I only add the last lines for the moment, the whole debug output is much too long:
Sep 06 15:16:57.478 [debug] read_to_buf_impl(): Read 18 bytes. 18 on inbuf.
Sep 06 15:16:57.478 [debug] connection_ap_handshake_process_socks(): Sep 06 15:16:57.479 [debug] fetch_from_buf_socks(): socks4: destip not in form 0.0.0.x.
Sep 06 15:16:57.479 [debug] fetch_from_buf_socks(): socks4: successfully read destip ([scrubbed])
Sep 06 15:16:57.480 [warn] fetch_from_buf_socks(): Your application (using socks4 on port 80) is giving Tor onl
y an IP address. Applications that do DNS resolves themselves may leak information. Consider using Socks4A (e.g
. via privoxy or socat) instead. For more information, please see Sep 06 15:16:57.482 [debug] fetch_from_buf_socks(): socks4: Everything is here. Success.
Sep 06 15:16:57.482 [debug] connection_ap_handshake_rewrite_and_attach(): Client asked for [scrubbed]:80
Sep 06 15:16:57.484 [debug] connection_ap_handshake_attach_circuit(): Attaching apconn to circ 24777 (stream 0
sec old).
Sep 06 15:16:57.485 [info] exit circ (length 3): utcluj(open) pouf(open) Sep 06 15:16:57.485 [debug] link_apconn_to_circ(): attaching new conn to circ. n_circ_id 24777.
Sep 06 15:16:57.486 [debug] connection_ap_handshake_send_begin(): Sending relay cell to begin stream 29324.
Sep 06 15:16:57.486 [debug] connection_edge_send_command(): delivering 1 cell forward.
Sep 06 15:16:57.487 [debug] circuit_package_relay_cell(): crypting a layer of the relay cell.
Sep 06 15:16:57.487 [debug] circuit_package_relay_cell(): crypting a layer of the relay cell.
Sep 06 15:16:57.488 [debug] circuit_package_relay_cell(): crypting a layer of the relay cell.
Sep 06 15:16:57.489 [debug] write_to_buf(): added 512 bytes to buf (now 512 total).
Sep 06 15:16:57.489 [info] connection_ap_handshake_send_begin(): Address/port sent, ap socket 32, n_circ_id 247
Sep 06 15:16:57.490 [info] connection_edge_process_inbuf(): data from edge while in 'waiting for connect' state
. Leaving it on buffer.
Sep 06 15:16:57.490 [debug] conn_write_callback(): socket 20 wants to write.
Sep 06 15:16:57.492 [debug] flush_buf_tls_impl(): flushed 512 bytes, 0 ready to flush, 0 remain.
Sep 06 15:17:05.358 [debug] conn_read_callback(): socket 14 wants to read.
Sep 06 15:17:05.359 [debug] connection_read_to_buf(): 14: starting, inbuf_datalen 0 (0 pending in tls object).
at_most 4096.
Sep 06 15:17:05.359 [debug] read_to_buf_tls(): start: 0 on buf, 0 pending, at_most 4096.
Sep 06 15:17:05.359 [debug] read_to_buf_tls_impl(): before: 0 on buf, 0 pending, at_most 4096.
Sep 06 15:17:05.360 [debug] TLS error: unexpected close while reading
Sep 06 15:17:05.360 [debug] tor_tls_read(): read returned r=0, err=-4
Sep 06 15:17:05.360 [info] connection_read_to_buf(): tls error. breaking (nickname tor26, address 86.59.21.38).
Sep 06 15:17:05.361 [debug] conn_close_if_marked(): Cleaning up connection (fd -1).
Sep 06 15:17:05.362 [debug] circuit_n_conn_done(): or_conn to tor26, Sep 06 15:17:05.363 [debug] connection_remove(): removing socket -1 (type OR), nfds now 25
Sep 06 15:17:05.419 [debug] conn_read_callback(): socket 4 wants to read.
Sep 06 15:17:05.420 [debug] connection_handle_listener_read(): Connection accepted on socket 14 (child of fd 4)
Sep 06 15:17:05.421 [debug] connection_add(): new conn type OR, socket 14, nfds 26.
Sep 06 15:17:05.422 [debug] connection_tls_start_handshake(): starting TLS handshake on fd 14
Sep 06 15:17:05.424 [debug] connection_tls_continue_handshake(): wanted read
Sep 06 15:17:05.442 [debug] conn_read_callback(): socket 14 wants to read.
Sep 06 15:17:05.982 [debug] connection_tls_continue_handshake(): wanted read
Sep 06 15:17:06.064 [info] dnsworker_main(): DNS worker exiting because Tor process closed connection (either p
runed idle dnsworker or died).
Sep 06 15:17:06.072 [info] dnsworker_main(): DNS worker exiting because Tor process closed connection (either p
runed idle dnsworker or died).
Sep 06 15:17:06.079 [info] cpuworker_main(): CPU worker exiting because Tor process closed connection (either r
otated keys or died).
Sep 06 15:17:06.072 [info] dnsworker_main(): DNS worker exiting because Tor process closed connection (either p
runed idle dnsworker or died).
Von allen Dingen, die mir verloren gegangen,
hab ich am meisten an meinem Verstand gehangen.

@_date: 2006-09-06 15:54:02
@_author: Marianne Spiller 
@_subject: Assertation -> tor crashes 
It seems to be 1.1b.
This should be the output you mean:
Sep 06 15:48:15.818 [notice] Initialized libevent version 1.1b using method kqueue. Good.
   Mary

@_date: 2006-09-14 23:04:02
@_author: Marianne Spiller 
@_subject: Now tor does not work at all... 
Hi there,
I tried to find a workaround for the error I described a few days ago,
but it was not possible. Then I would exactly know the time until tor
crashes, but - surprisingly - now it doesn't work at all:
$ /etc/rc.d/tor start
.: Out of file descriptors
So I added a short line in the startup script (after  ulimit
-a; the output is the following:
time(seconds)        unlimited
file(blocks)         unlimited
data(kbytes)         131072
stack(kbytes)        2048
coredump(blocks)     unlimited
memory(kbytes)       251064
locked memory(kbytes) 83689
process(processes)   160
nofiles(descriptors) 64
sbsize(bytes)        unlimited
.: Out of file descriptors
The line nofiles(descriptors) seemed not so okay to my, so I changed the
line in the startup script to ulimit -n 1200
$ /etc/rc.d/tor start
script loops endlessly.
I had a look to the currently opened files via fstat/pstat, p.e.
$ pstat -T
200/1772 files
Tor was great, I would like it to run - but now I just don't know what
to do. *Any* suggestions? ;)
  Mary

@_date: 2006-09-15 01:38:45
@_author: Marianne Spiller 
@_subject: Now tor does not work at all... 
Ideed, it *is* NetBSD-3.0_RELEASE. But I don't understand: the software
went fine for four or five days, and *then* the error happens. Even a
reboot doesn't change.
The hardware is an SGI Indy without graphics board, R4600 200MHz 256MB.
