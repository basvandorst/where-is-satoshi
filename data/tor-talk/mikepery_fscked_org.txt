
@_date: 2005-08-04 21:20:55
@_author: Mike Perry 
@_subject: Still logged on after AIM logoff 
Is anyone else experiencing issues with remaining logged on to AIM
(specifically gaim) after signing off when using Tor? For some reason
even after explicitly going to signoff, my screenname remains online
and I lose IMs. When I go to sign on again I get the annoying "Your
AIM account is being used in another location", sometimes even hours
I don't really know the AIM protocol, but doesn't it log you out
automatically normally as soon as the TCP connection dies? Perhaps Tor
isn't properly terminating randomly dropped circuits? But what about
when I deliberately go to signoff?
This is obviously distressing, because what is to stop someone from
say, intercepting and then dropping my logoff at an exit server and
then keeping the connection alive to recieve copies of my IMs..

@_date: 2005-08-05 19:13:34
@_author: Mike Perry 
@_subject: Malicious Exit Nodes? 
Thus spake Hideki Saito (hidekis at gmail.com):
That may solve the problem of stolen messages after you log back in,
but what about while you are offline.
Is this "keeping a connection open" actually a property of Tor? Or is
it some bug? Or do we actually have rogue exit nodes operating here?
Should I make some effort to make a list of exits this happens for?

@_date: 2005-02-01 15:25:33
@_author: Mike Perry 
@_subject: SORBS blacklisting tor servers [off topic] 
Thus spake Michael Laccetti [c] (michael at s2g-limited.com):
Good luck. My experience has been that the SORBS people are completely
unwilling to compromise and seem to believe that since their blackhole
list is optional, they don't have to hold themselves to any particular
standards or burden of proof. You might consider a combination of the following tools in lieu of
I just recently added DSPAM to my SpamAssassin setup, and in two weeks
it has reduced my spam from 5/day to 1-2/week. Supposedly it will get
much better over time as it continues to learn. My spam folder gets 25
I'm particularly curious about the SBL tool, but I haven't had time to
set it up. It seems to be The Right Way to blacklist, IMO. At least if
you value such principles as "Innocent until proven guilty" and
similar ideological pillars of a non-fascist society that SORBS and
other blacklist maintainers seem to view as inconvenient in their War
Against Spam.

@_date: 2005-02-01 22:26:32
@_author: Mike Perry 
@_subject: Thoughts on IRC. 
Thus spake Jack Cummings (jack at mudshark.org):
A couple more:
 -1) This really doesn't solve the problem from the IRC admin's
perspective. I'm assuming in this case you mean the hidden IRC server
would be linked into the EFnet network or something. In this case, the
other EFnet IRC ops having problems with network-wide abuse that's
eminating from the hidden server will have no choice but to unlink the
hidden service IRC server.
  0) It is a temporary solution. Even a single IRC service may have
problems with abuse. Obviously the attackers already know how to use
IRC through tor. As soon as either tsocks supports SOCKS 4A or the
addressmap feature exists, the barrier to entry is removed.
  4) It has dangerous consequences in that it sends the message that
it is OK to blacklist tor servers. An alternate solution must be
found sooner rather than later. You might claim that a stop gap solution might enable more time for a
proper IRC solution to be made while still allowing people to use tor
for IRC.
My feeling is, however, that if people are using tor to IRC, they're likely
not working on a solution to the tor/IRC problem :)

@_date: 2005-02-02 13:40:22
@_author: Mike Perry 
@_subject: Tor Network response slowing to zero 
Thus spake clifnor at warpmail.net (clifnor at warpmail.net):
Well, in the past two weeks the number of nodes and available network
bandwidth has fallen due to a combination of stability and
blacklisting issues.  I've been wondering for some time if it might be possible to attempt
more intelligent node selection when building circuits. I've noticed
that connection setup time has quite a bit of variance to it, and I'm
guessing that this is due to occasional selection of heavily loaded
nodes. Would it be possible to include a statistic in the directory
for node load? Maybe something as simple as using the ratio of a
throughput stat to expected bandwidth as the node selection criteria
instead of uptime?
How quickly can the directory be updated? Would this introduce cyclic
load problems, or perhaps other security concerns?

@_date: 2005-02-03 11:58:39
@_author: Mike Perry 
@_subject: Tor Network response slowing to zero 
Thus spake Roger Dingledine (arma at mit.edu):
How about a patch to warn people running in server mode if they have a
1024 ulimit? and perhaps also spew out warnings whenever socket
creation fails with ENFILE so that server admins are more quick about
making sure they up this limit? I like this last plan a lot better than restricting port access, even
if it is limited to attempting to shut out P2P traffic. It seems much
healthier just to throttle it down than outright deny it.
I'm thinking you probably don't want ports to be specified in the
cell, because it would make it easier to associate connections through
the network.
Maybe the top two bits of the length field in RELAY could be borrowed
to create a "priority class" field? Length should never exceed 498
anyways, right?  0 - Interactive stuff: ssh, telnet, maybe rdesktop?
 1 - Application buffered: web, IRC, POP, etc
 2 - Data Xfer: ftp, ??
 3 - Bulk: bit torrent, and so on.
The port to class mappings should probably be hardcoded and verified
at the exit servers to prevent a rogue tor client from jacking its
priority to 0 at all times.
As far as queuing, my initial impulse is that priority be strict. If
any level 0's are ready, send them first. Then handle the level 1s,
and so on. Though since ssh and telnet are likely to not fill cells to
completion, this could be wasteful. Is this a concern? Are there other
Are tor clients and servers able to version handshake so that we can
implement this protocol gradually without making servers puke when
they see 16 and 32k length fields?
Heh, unfortunately I don't really have the bandwidth to throw at it
now. I'll gladly donate some devel time towards either of the above
two mentioned features, though.

@_date: 2005-01-27 02:47:41
@_author: Mike Perry 
@_subject: Reusing Exit Nodes? 
So I've noticed my patch to reuse exit nodes that match certain
domains hasn't showed up in CVS. Was there anything wrong with it?
I've been using it for a while now, and have tested to make sure that
it doesn't interfere with the ExitNodes option. I've also noticed that
sometimes exit servers go down overnight and such, and have since
added code to expire associations between hosts and exit nodes after
30 minutes of not connecting to the host (tunable through
TrackHostExitsExpire, which is also documented in the manpage in the
patch). Attached are patches against both 0.0.9.3 and CVS. Please do let me
know if there is something wrong with the patch, I don't mind fixing
it. It seems to work well for me, and I find it useful.

@_date: 2005-01-27 12:00:26
@_author: Mike Perry 
@_subject: Reusing Exit Nodes? 
Thus spake Roger Dingledine (arma at mit.edu):
Is there a particular reason why this is more desirable than just
having gethostbyname do the work of tor-resolve?
Is this preferable to RedirectExit because it avoids having to restart
tor? Otherwise, the functionality is the same, correct?
So in this case it probably wouldn't use the controller protocol at
all, but instead touch the address mapping data structures directly?
Yeah, once the map address code exists it seems like it would be a
replacement for the exit_history data structure, at which point about
half my patch should just go away.. But it looks like a sizeable
chunk of work though (since it's basically blocked on the entire TC
and remote). Is there an ETA?

@_date: 2005-01-30 12:32:24
@_author: Mike Perry 
@_subject: Reusing Exit Nodes? 
Thus spake Roger Dingledine (arma at mit.edu):
How's this? I kind of just haphazardly placed the addressmap_remap
function close to where I needed it. It turned out to be a much
smaller patch than my previous one.
Do you think this is good enough to use as a starting point for the
full addressmap feature?

@_date: 2005-01-05 12:54:42
@_author: Mike Perry 
@_subject: No longer able to connect to hidden services 
Despite having been able to do so in the past, recently (past couple
days or so) I've become unable to connect to any hidden services
within the timeout period. This includes connection to
 (the hidden wiki).
When attempting to connect, I get the following error:
Jan 05 10:23:21.003 [notice] connection_ap_handshake_attach_circuit():
Giving up on unattached conn (60 sec old).
Is this due to increased saturation of the network and/or the recent
addition of low capacity nodes by any chance? Or is there some other
problem with the network?
Increasing the CONN_AP_MAX_ATTACH_DELAY to 180 in circuituse.c gives errors of the following variety:
Jan 05 10:33:48.937 [notice] circuit_send_next_onion_skin(): Tor has
successfully opened a circuit. Looks like it's working.
Jan 05 10:34:03.001 [notice] connection_ap_expire_beginning(): Stream
is 15 seconds late on address '18.244.0.188'. Retrying.
Jan 05 10:34:03.001 [notice] circuit_log_path(): circ (length 3, exit
triphop): ned(open) hexten(open) triphop(open)
Jan 05 10:36:26.001 [notice] connection_ap_handshake_attach_circuit():
Giving up on unattached conn (181 sec old).
I see some magic numbers in connection_edge.c in
connection_ap_expire_beginning(). A 15 and a 45 second value for
timeout of streams and rendevous.. Increasing these values just has me
waiting for the duration until finally getting:
Jan 05 10:44:48.001 [notice] connection_ap_handshake_attach_circuit():
Giving up on unattached conn (181 sec old).
Jan 05 10:44:48.001 [warn] rend_client_desc_fetched(): Failed to fetch
service id '6sxoyfb3h2nvok2d', and not in cache. Closing conn.
Is anyone else experiencing these problems? I'm using tor 0.0.9.2.

@_date: 2005-01-12 17:50:43
@_author: Mike Perry 
@_subject: Tor exit nodes by country 
Thus spake Roger Dingledine (arma at mit.edu):
Not to look a gift horse in the mouth (and this is pretty awesome),
but what might also be neat is a query option for hidden service
Introduction Points, so you could query the db for nodes that you can
use for your HiddenServiceNodes option, and have it sort by bandwidth
and uptime. This might help recent issues with poor performance of
hidden services (or it might not.. I don't know enough about the
network to know why hidden service performance is poor lately, I just
know that it is..) Perhaps future versions of Tor could automatically try to connect to
such low-load, high uptime introduction points, and eliminate the
HiddenServiceNodes option entirely?

@_date: 2005-01-16 18:22:32
@_author: Mike Perry 
@_subject: Option to reuse same exit node? 
I've recently run into a few websites that expire all of my cookies if
I try to use them from different IPs (ie two different successive exit
nodes). Some sort of security feature to prevent auth theft most
likely. I expect it to become more common.
Are there any plans for adding an option to reuse the same exit node
for all connections to a given IP? I could hack in a fixed array that
keeps track of the exit nodes used for the past N connections if some
config option was set. Should I bother? Is there a better way of doing
this? Or is there a reason why this option should not exist?

@_date: 2005-01-17 04:13:25
@_author: Mike Perry 
@_subject: Option to reuse same exit node? 
Thus spake Echo Nolan (hellish at comcast.net):
I dunno about based on site... I made it an all or nothing config
variable: TrackHostExits. The patch also updates the tor manpage to
describe the option.
It is my opinion that this option isn't THAT harmful, since all it
really enables is the ability to track a user through a given site. A
determined web app can do this merely by setting a unique random
cookie on every browser that connects, removing any protection you
might think you gain from a random IP for each TCP connection.  Many
sites already do this to track users across DHCP sessions for
marketing info.
If desired, I could make the option only work for certain ports that
the user specifies. I suppose it really is only relevant to ports 80
and 443. Let me know if this is desired. If you put up a good argument
for making the config option take hostnames instead (and it is easy to
code), maybe I'll hack that up as well.
Attached are patches against both CVS and 0.0.9.2. I've tested it to
the point of recycling through the array a couple times. Seems to work
for me.

@_date: 2005-01-17 06:41:38
@_author: Mike Perry 
@_subject: Option to reuse same exit node? 
Thus spake Mike Perry (mikepery at fscked.org):
So I couldn't sleep and it turned out to be not too hard to satisfy
both our wishes. So it's done. The new option accepts a CSV that can contain host names or domain
names. Domain names start with a '.'. So for example, to have the
option apply to fscked.org and all subdomains, you would include
'.fscked.org'. Otherwise, you can just list plain hosts, like
' This is explained in the manpage, but it might be a
little muddled.. Also, '.' by itself matches every host.
One thing I don't do is free any of the memory in the exit node cache
on exit (I do free it when the entries are reused). I don't think this
is a big problem, unless there is some policy you guys have on always
freeing all memory before exiting.
It should also be noted I did not test this feature with the .exit
SOCKS capabilities, nor any of the config options that allow you to
otherwise specify/limit exit nodes.. I think it should be ok though. I
believe that I placed the modifications such that they take precedence
over everything else once a host appears in the cache, which IMO is
how it should work.

@_date: 2005-03-22 13:04:53
@_author: Mike Perry 
@_subject: Low-Cost Traffic Analysis of Tor [QoS Solution?] 
Thus spake Mike Perry (mikepery at fscked.org):
Ok, so in an attempt to solidify my point, I decided to think about it
more specifically in terms of the interaction with the queuing itself
instead of the relative priorities. Upon doing this, I realized that
queuing by itself is not sufficient, but that it is still possible to
defeat the attack. I basically broke down the scenarios into the
following outline, which I believe covers all cases:
A). Probe and Server in the same queue: ATTACK SUCCEEDS
B). Probe and Server in different queues
   1). Server traffic fills an empty or emptying queue: ATTACK SUCCEEDS
       a). Server traffic is in a previously empty queue
       b). Server traffic prevents a queue from draining
   2). Server traffic is in a queue that has longer length* than
       probe queue: ATTACK FAILS
PROOF OF SCENARIO OUTCOMES:
A. If the probe and the server are in the same queue, and queuing
conditions are otherwise the same for both baseline and the attack,
then this is essentially the same queuing condition as in the original
attack but with added noise. Theoretically, the attack should continue
as normal.
The success of the attack may be more sensitive to traffic arriving
from higher priority classes, but end of the day, this is just
noise and can be averaged out through many successive trials.  It may
be possible that this averaging takes too many trials to be practical,
however, but this probably should not be relied upon.
B. If the probe and the server are in different queues: 1. The burst traffic must use a previously empty queue class (point a)
or prevent an existing queue class with weighted service length*
shorter than the probe class from draining before the probes are
serviced (point b). If either of these conditions hold (a or b), the
attack succeeds.
Point a:
If the burst traffic uses a previously empty queue class, then this
means that there is increased delay felt by the probe traffic, since
at least SOME time will be spent servicing this new queue that wasn't
spent before. If the difference between the priorities of probe and
queue is great enough, this time difference may be negligible and
impossible to detect through traffic noise. But theoretically, the
attack is still possible.
Point b:
If the burst traffic prevents a queue from draining that would
normally have drained, then once again there is delay that has been
introduced in the probe traffic that normally would not have been
2. If the burst traffic falls into a queue class that already had
equal or greater length* than the probe traffic, then the attack fails. In this case, the probe traffic would experience the same delay as it
would have if there was no burst from the server, since it was already
in full competion with that queue. It should not be delayed any more
than usual. ATTACK FAILS.
POSSIBLE SOLUTIONS TO DEFEND AGAINST ATTACK:
So, it would appear that my original QoS solution isn't as good as I
thought it was. However, I'm not quite ready to give up yet. There are
3 potential solutions that come to mind which essentially aim to drive
the queuing system into the safe Scenario B2. These solutions can be
combined as desired. Note that none of the solutions depend on WFQ. FQ
can be substituted if desired (and in fact FQ may actually be more
robust against variant attacks, as discussed below).
I. Change the WFQ algorithm to send cover traffic (Fix Scenario B1) Cover traffic by itself does not defend against the attack, as is
pointed out in the paper. However, in the context of queuing, it would
at least prevent Scenario B1 from developing, since there would be
no such thing as adding delay if all queues were always busy. Basically this solution removes the "empty queues lose their turn"
Unfortunately, this does add some unnecessary delay, since queues with
real traffic in them will have to wait on the cover traffic queues. It
also limits each class to only achieving a certain percentage of
network traffic (ie web+irc+aim could never exceed 30% of total
network load).  The weights can be altered based on statistical info
about the tor network exit node traffic, gathered over the coming
months via a patch that I can submit shortly, if desired.
II. Attempt to detect attack and queue appropriately (Fix Scenario A+B1)
I implement my WFQ as I described, but if I see numerous successive
packets of 500 length from a given circuit (like 2-3 seconds worth), I alter its class.
Note that simply lowering the priority will not work, since this may
still induce probe delay as proven in Scenario B1.
What will work is moving circuits with numerous successive 500byte
payloads to the longest** queue. This can also be done with regular
non-weighted Fair Queuing, if QoS is still opposed. This should
effectively create Scenario B2 from either Scenario A or B1.
However, in the event that the burst traffic IS the longest** queue,
this approach will fail. In this case, cover traffic should be
temporarily inserted as per Solution I until the burst circuit slows
down or closes. Or, if Solution I is deemed acceptable on its own,
cover traffic can always be inserted.
If it is possible to produce a variant of the attack where the probe
server sends high bandwidth traffic, then the queuing algorithm needs
to attempt to balance all high bandwidth circuits evenly among all
queues. This probably will prevent any attempts at WFQ, or at least
make WFQ considerably more difficult. Is such an attack possible?
III. Prevent tor nodes from operating near capacity (General Solution)
It seems to me that the attack hinges on the ability to drive tor
nodes to their full capacity. It is also suspected that the attack
operates optimally when tor nodes are also already loaded.
If tor was modified to automatically close its highest traffic circuit
as soon as the bandwidth threshold was reached (or as soon as the
window for transmitting data to the next hop was empty), this may
prevent the optimal attack scenario from developing. Moreover, it may
help limit the appeal of P2P/bulk data transfer.
Also, perhaps a "high watermark" bit can be added to the directory
entry for each node, and clients can try to avoid picking nodes with
this bit set, since they will be operating close to capacity and may
drop circuits. We could combine solutions II and III and instead of dropping these
circuits, move them to the longest queue and also set the "high
watermark" directory flag so clients can avoid that server. Or, if everyone hates fair queuing as a general principle, this
solution may be suitable by itself.
But note that if very few tor nodes are operating near capacity, the
high watermark bit can be used to reveal paths without a probe.
However, the time frequency of update for the directory server (on the
order of 20 minutes) is much greater than your typical connection, so
this is unlikely to be practical.
Thoughts? I have attempted to make the case for these modifications as
rigorously as I could. I would really like to see this attack fixed,
and I don't mind doing the all of the work to do so (in fact, I would
enjoy it. I find this problem very interesting). But someone needs to
make sure I'm not crazy ;)
* The weighted service length is defined as the number of full
dequeuing cycles through all 4 queues. It is measured in multiples of
10 packet service times (4+3+2+1=10). If WFQ is abandoned for plain
FQ, the length is then measured in round-robin cycles through all four
queues. ** When defending against the attacks, the circuit that is being
moved from queue to queue should NOT be counted in the length

@_date: 2005-03-30 02:32:30
@_author: Mike Perry 
@_subject: Tor 0.1.0.1-rc is out 
Thus spake Roger Dingledine (arma at mit.edu):
Awesome. Hidden services are a *LOT* quicker. At least for web.
Though, as an aside, what is the potential weakness for them that was
mentioned offhand in your latest draft paper? Is this
exacerbated/lessened/unchanged by the changes?
Also, got a few other random questions:
Are there any plans to use the ReadHistory/WriteHistory fields in the
directory servers to also guide circuit creation? Like choosing nodes
whose bandwidth history is less than their average?
Do directory servers otherwise refuse to accept servers that just come
online and immediately report high uptime? Otherwise there could be a
possible attack to try to get more people to use a node.
Is this option tunable? Does it have any effect on hidden service

@_date: 2005-03-15 13:21:51
@_author: Mike Perry 
@_subject: Low-Cost Traffic Analysis of Tor 
Thus spake Steven J. Murdoch (tortalk+Steven.Murdoch at cl.cam.ac.uk):
Really nice work! I do have a few questions about the results, though,
if you have the time:
Why do some target nodes yield such drastic results? For example,
where there any particular properties of C, K, and L (and perhaps A)
in Figure 4 that might explain why the technique worked so much better
on them? Were these nodes already operating at full capacity or
operating on really low-bandwidth/high latency links? Or is there some
other explaination?
What is your estimate on the minimum amount of time the pseudorandom
traffic from the corrupt server must run in order for results to be
picked up by the probe server? What is the nature of the 'echos' that might cause false positives to
which you refer? It would seem to me that echos would be lulls in
traffic propogating to other nodes that would normally be recieving
non-generated relayed data. In this cause, would they really cause
false positives? Or am I confused on the nature of the echo effect?
Thanks for posting this paper, it was very interesting and

@_date: 2005-03-20 19:09:23
@_author: Mike Perry 
@_subject: Low-Cost Traffic Analysis of Tor [QoS Solution?] 
============================== START ==============================
Thus spake Steven J. Murdoch (tortalk+Steven.Murdoch at cl.cam.ac.uk):
So I've got another question actually. A few weeks ago, I proposed a
possible QoS solution to the bittorrent/general network load issue to
this list and then to or-dev
Basically, the idea was to seperate traffic into 4 classes based upon
exit port, and then use some form of Weighted Fair Queuing algorithm
to balance between them
The classes were:
  0 -- Unbuffered interactive traffic (ssh, telnet, rdesktop, tcp dns)
  1 -- Application buffered interactive traffic (web, irc, aim)
  2 -- Data transfer (ftp)
  3 -- Bulk Traffic (bit torrent and the rest)
My current idea is to do the WFQ with something like serving class 0
four times, class 1 three times, class 2 twice, and class 3 once
(staggered in a round-robin fashion). If a class queue is empty, it
loses its turn.  I also intend to bump class 0 traffic with full 500
byte payloads up to class 1 or 2, to limit abuse.
This scheme was met with resistence for fear of cheating and
unfairness, but I think it might help to mitigate your attack. As I see it, it basically creates 4 scenario clases for your attack
based on the relative priorities of the probe and the corrupted
service traffic:
00. Both probe and server traffic have high precedence (class 0). In
this case, it would seem that there should be little to no effect on
the attack. This may just have to be the price you pay for using class
0. However, on the flip side, it may be that having the server
response traffic at high precedence may exacerbate false positives due
to amplified echo effect. Also note that the corrupted server would
have to ensure its burst traffic will not fill a 500 byte tor payload,
which may be difficult.
01. Probe traffic has higher precedence, server has lower precedence. In
this case, probe traffic should be only minimally delayed by the burst of
server response. This should impede the attack.
10. Probe traffic has lower precedence, server has higher. In this case,
the probe traffic would be delayed by just about any traffic. The
unknown is if it would experience a detectable increase in delay during
the burst from the server. Thoughts?
11. Both probe and server have lower precedence. In this case, the probe
response would again experience arbitrary delays due to other higher
priority traffic, and it is not clear that the low priority server
traffic would be able to generate enough load to be detected.
Does this make sense? Might some form of QoS mitigate this attack?
What do the tor maintainers think?

@_date: 2005-11-02 18:46:39
@_author: Mike Perry 
@_subject: DNS block in place at 151.8.40.35 (molly) 
Thus spake Geoffrey Goodell (goodell at eecs.harvard.edu):
It seems to be pretty arbitrary.. Except for porn. Just about every
porn site I could google up is blocked. Plus the ones I bookmarked ;)
Of note: slashdot.org and fark.com are blocked. Though most other
popular blogs are not. Also chase.com, and it also seems to be trying
to do something with xinhua.com, but breaking somewhere along the way.
Interestingly the expected targets (indymedia, al jazeera, the real xinhua, 2600) are left unmolested. Other than porn, there doesn't seem to be
any political bias to blockings. In fact, I was unable to find any
extremist right or left wing sites that were blocked.
(They didn't even block fox news! :)

@_date: 2005-11-03 18:29:11
@_author: Mike Perry 
@_subject: DNS block in place at 151.8.40.35 (molly) 
Thus spake mr.wolf at sprawl.it (mr.wolf at sprawl.it):
Actually, I can't speak for all Tor users, but I would think a fair
number of them would object to any sort of blocking on the exit node,
even porn. If nothing else, for the reason that you have no idea how
slashdot, fark, and chase got in there (which is quite common with
blacklists.. as we all know from dealing with SORBS, they simply Do
Not Work).
Is there any way to set it such that this dns block does not apply to
your Tor exit traffic?
Or, alternatively (to everyone else on the list), is there a config
option that I can use to exclude molly as an exit node? I think
ExcludeNodes is a bit harsh in this case, cause the dns filter
obviously doesn't apply if I'm using him as a middle-man node.
Otherwise, I would ask that molly not be listed as an exit node at

@_date: 2005-11-24 20:52:25
@_author: Mike Perry 
@_subject: Let's pay our dues! 
Thus spake clifnor at warpmail.net (clifnor at warpmail.net):
Hear hear! I regret that I have but one node to give for my mixed
network! ;)
I imagine fund raising effort is probably focused on finding high
level sponsorship, but a donations page probably would help a good
deal, at least short term. Also merchandise might work: bumper
stickers, t-shirts (in some other colors than green :), perhaps
preconfigured usb drives w/ TorPark, maybe even Linksys WRT54G's with
Tor/Privoxy preinstalled and listening on the internal interface.
Though I suppose selling devices could add up to more work than
maintaining Tor itself. Depends on how easy it is to rig an installer
to make them quickly..
Eh, ideas are a dime a dozen, but best of luck! I know I certainly
have become addicted to using Tor and would be very sad to see
development cease.

@_date: 2005-11-25 14:01:24
@_author: Mike Perry 
@_subject: ATTN: for-profit Tor operators 
Thus spake Matt Ghali (matt at snark.net):
Actually, before the EFF is badmouthed for this action, it may be wise
to consider that there are things going on behind the scenes that we
simply cannot know. As I see it, there are a series of possibilities,
in order of increasing likelyhood:
1. Some large EFF donator decided Tor was a Bad Idea.
This would be very unfortunate and scary. There were days when EFF was
much more beholden to the corporate interests of its donors than it is
currently. I believe those days are over, and furthermore would be
surprised if anyone who would fund EFF would think Tor was a Bad
2. The EFF is busy litigating new cases that require far more
financial resources than they anticipated for this fiscal year.
This is entirely possible. Litigation is extremely expensive, and EFF
has taken on a handful of high profile cases in the past year.
3. Sponsoring Tor is not possible when doing test cases
This is the most likely scenario, IMHO. IANAL, but I would guess that
sponsoring Tor opens up the EFF to greater legal liability when
attempting to defend operators in test cases. After all, the decision
to take up a DMCA test case was made about a month ago, right around
the time funding supposedly ran out. For this reason I believe it is
most likely that funding was terminated so that the EFF would be
better able to help Tor operators. But I'm a chronic optimist.
It is also possible that a test case would be extremely expensive, and
given finite funding, it had to be either test case or development
support, and the choice was consciously made for a test case.
So before we go badmouthing the EFF, I would suggest giving them the
benefit of the doubt. They do good work, and hopefully this decision
was made on sound, uncoerced reasoning that the action was good for
both EFF and Tor.
I imagine that for any number of reasons, the EFF will not be able to
disclose their exact reasoning for stopping funding, especially if it
is part of some legal strategy involving Tor.
The most pressing question is has the EFF's position on doing DMCA
test cases changed? I see the website material on the matter has not
been taken down, so hopefully that's a good sign.
P.S. I should note that ALL of this is entirely speculation on my
part. I have received no information from the EFF or anyone else.

@_date: 2005-11-25 14:45:04
@_author: Mike Perry 
@_subject: ATTN: for-profit Tor operators 
Thus spake circut at youtopia.homelinux.org (circut at youtopia.homelinux.org):
Um, selling a p2p client is essentially impossible, at least in the
United States, thanks to MGM vs. Grokster. You have to be extremely
careful with marketing it, and even then the RIAA probably will try to
kick your door in just for the fun of it.
Running p2p over Tor is also a bad idea. The network is having enough
problems with people running p2p data over Tor despite numerous pleas
to back off. If a legitimate p2p app was created and its use
encouraged, the network could become entirely unusable. (As an aside,
there are several anonymous P2P nets available, for those who are
interested in such things.. MUTE, ANTS, I2P, WASTE, etc).
What is a possibility is if development could be devoted to making
software work reliably on marketable devices. I've been looking for an
excuse to hack on a Linksys for a while now. Not sure how much
interest there would be in such a device, but if they could be
purchased wholesale and sold for little more than retail price, people
might buy one. Could be an easy way to torify an apartment, house, or
small office. Not sure if Linksys would get its panties in a bundle
or not though, either. IMO, they should love it. But who knows,
corporations are strange beasts.
If Tor is interested in pursuing the merchandise route, I can
volunteer to work on setting up a Linksys Tor firmware image. It looks
like OpenWRT already has some (older) packages available, so the work
wouldn't be starting from zero..

@_date: 2005-11-25 16:35:53
@_author: Mike Perry 
@_subject: ATTN: for-profit Tor operators 
Thus spake Anthony DiPierro (or at inbox.org):
Well, being a single operator is different than funding the entire
project. I would guess EFF's ideal case would be some blockhead
issuing a DMCA takedown against a Tor node and filing suit against
that node operator, rather than all node operators.. But if the EFF
were funding development, maybe the copyright holder could argue they
have some responsibility also, and they have incentive to do so since
the EFF has deeper pockets than joe random Tor node...
Though this still may be unlikely. Perhaps they just ran out of $
unexpectedly.. This also seems strange though.
Yeah, this is probably true. I think this is why the EFF is so sure it
could win a DMCA case. But I agree it would probably be very unlikely
that a DMCA notice against a Tor node would ever make it to court, esp
since the supplied EFF letter to ISPs is already pretty close to a
DMCA put-back notice
Your points about registering as a service provider are very
interesting. Is this a common practice of Tor operators? Is it even
possible?  is nearly unreadable
bureaucrat-ese, and it seems like they still haven't set up the red
tape for a proper process yet, referring to this "interim" nonsense..
Also registering with the government for anything like this rubs me
the wrong way on principle, since I do not agree with the DMCA in the
first place. Registering seems to be a second-order endorsement of it
somehow.. Not to mention my belief that a "service provider" should be
a legal definition in the DMCA itself rather than some tangle of red
tape and "official iterim" database lists..
Lasly, if I am registered as a service provider, presumably I would
get complaints and takedown notices directly. Who do I deliver them
to? They would basically just have to go in the trash. I guess this
might be your point, but it just seems so insanely pointless and more
likely to irritate someone who is accustomed to being handled by the
bureaucracy for a bit before being ignored :)

@_date: 2005-11-02 17:10:29
@_author: Mike Perry 
@_subject: DNS block in place at 151.8.40.35 (molly) 
It seems the tor server "molly" is behind some kind of DNS block.
Attempting to access various sites through this tor exit results in
redirection to

@_date: 2005-10-13 19:30:39
@_author: Mike Perry 
@_subject: Same entry and exit node? 
Thus spake Arrakistor (arrakistor at gmail.com):
I think the problem Arrakistor is concerned about is the ability of
the endpoint to correlate its exit traffic with the traffic entering
it from his actual IP. This has nothing to do with protecting exit
nodes. It's the fact that in general, you don't want your circuits to
Alice (You) -> Eve -> Charlie -> Eve -> Bob
because Eve could then have a chance of deducing the correlation
between Alice and Bob.
Does Tor protect against this? Is there any reason why it should not?
I suppose you could argue that it is pointless, since Eve could be
controlling two different machines. But I thought the point of the
directory servers/node verification was to combat this attack.

@_date: 2005-10-13 21:27:52
@_author: Mike Perry 
@_subject: Increasingly large number of "404"s 
I'm getting an increasingly large number of 404 error messages from
privoxy. Up until recently I've just been mashing the reload button
until it works, but they're becoming frequent enough that usage of tor
is becoming impossible. This is with tor 0.1.0.15
They seem to be correlated with a bunch of log notices to the effect
Oct 13 19:18:31.982 [info] circuit_log_path(): exit circ (length 3,
exit err): serifos(open) greybeard95a(open) err(open)
Oct 13 19:18:33.026 [info] connection_edge_reached_eof(): conn (fd 12)
reached eof. Closing.
Oct 13 19:18:33.026 [info] conn_close_if_marked(): Cleaning up
connection (fd 12).
Oct 13 19:18:33.026 [info] connection_remove(): removing socket 12
(type App), nfds now 6
Oct 13 19:18:33.026 [info] _connection_free(): closing fd 12.
Oct 13 19:18:33.332 [info] connection_edge_process_relay_cell(): data
cell dropped, unknown stream.
Oct 13 19:16:10.892 [info] connection_edge_process_relay_cell(): data
cell dropped, unknown stream.
Oct 13 19:16:10.892 [info] connection_edge_process_relay_cell(): data
cell dropped, unknown stream.
Oct 13 19:16:10.892 [info] connection_edge_process_relay_cell(): end
cell (closed normally) dropped, unknown stream.
The problem is intermittant, possibly related to exit node. Is that
last node in circuit_log_path the exit node? Should I harvest a list of
exit nodes causing me the most trouble, or is this likely a problem on
my end?

@_date: 2005-10-16 01:28:24
@_author: Mike Perry 
@_subject: questions about hidden service hashes, and experiences running hidden services 
Thus spake loki tiwaz (loki_tiwaz at hotmail.com):
A couple of points. First, unless I've fallen behind, SHA1 is only
broken to the point where you can generate two different arbitrary
datum and have them result to the same hash. This is not the same as
being able to "undo" SHA, or to even determine an arbitary collision
to a fixed hash. Unless I've missed something.
Second, even if this were the case, the hidden service is supposedly
only listed with the introduction points that the service connected to
through Tor. Assuming Tor remains unbroken, these Intro Points cannot
reveal the hidden service IP, and the public key of the hidden service
is not secret information anyway.
Here are some slides that illustrate the process of connecting to a
hidden service: The one thing I would advise against is running your hidden service on
the same IP as your Tor server (or at least do not announce this
fact). This can leave you vulnerable to an intersection attack, where
the attacker keeps track of uptime of your hidden service and compares
it to uptime stats of the various tor servers. You only have 300-some
nodes to hide among.
Incidentally, I would like to know exactly which directory server listing
hidden services are published in. I don't see any of them in
 for example..

@_date: 2005-10-16 01:28:24
@_author: Mike Perry 
@_subject: questions about hidden service hashes, and experiences running hidden services 
Thus spake loki tiwaz (loki_tiwaz at hotmail.com):
A couple of points. First, unless I've fallen behind, SHA1 is only
broken to the point where you can generate two different arbitrary
datum and have them result to the same hash. This is not the same as
being able to "undo" SHA, or to even determine an arbitary collision
to a fixed hash. Unless I've missed something.
Second, even if this were the case, the hidden service is supposedly
only listed with the introduction points that the service connected to
through Tor. Assuming Tor remains unbroken, these Intro Points cannot
reveal the hidden service IP, and the public key of the hidden service
is not secret information anyway.
Here are some slides that illustrate the process of connecting to a
hidden service: The one thing I would advise against is running your hidden service on
the same IP as your Tor server (or at least do not announce this
fact). This can leave you vulnerable to an intersection attack, where
the attacker keeps track of uptime of your hidden service and compares
it to uptime stats of the various tor servers. You only have 300-some
nodes to hide among.
Incidentally, I would like to know exactly which directory server listing
hidden services are published in. I don't see any of them in
 for example..

@_date: 2005-10-16 01:34:45
@_author: Mike Perry 
@_subject: Increasingly large number of "404"s 
Thus spake Mike Perry (mikepery at fscked.org):
So far, the most broken exits seem to be:
(in that order)
Though the error messages are not always the same. Anyone care to add
to this list? Maybe we should create a wiki page with a list of
malfunctioning exists so people can put them in an 'ExcludeNodes'
directive until their operators figure out what's going on?

@_date: 2005-10-27 15:00:01
@_author: Mike Perry 
@_subject: best way to recover from bad circuit 
Thus spake Jay Goodman Tamboli (jay at tamboli.cx):
Are you running the latest alpha Tor? Roger recommended this to me the
last time I was bitching about it, and it actually seems to be working
well. I still do get the rare "404" (about once every couple days -
vast improvement), but when I do, simply mashing "reload" fixes the
problem, unlike before.

@_date: 2006-04-27 02:02:01
@_author: Mike Perry 
@_subject: Firefox through Tor 
Thus spake Eric H. Jung (eric.jung at yahoo.com):
Just a heads up about this. The I2P folks are very vocal against doing
exactly this for .i2p addresses. The reason is say I run
foo.onion/foo.i2p and also bar.org. I can put images/embedded object
links on my foo.onion page that refer to bar.org. The links can even
have an automatically generated identifier to do 1:1 association
between the Tor connections to foo.onion and the non-Tor accesses of
The problem is even worse for the regular Intarweb, where email and
other sites may have ad content from DoubleClick and co.  Unique
identifiers can be handed to the ad sites that will associate the
torrified email account access with the non-torrified ad server
Does XPCOM allow you to solve this problem somehow? A hack around it
using the about:config method would be to change the proxy for the
duration of the page load including embedded objects, but then you
have major concurrency issues with multiple tabs/windows loading at
the same time. Does XPCOM give you per-tab proxy granularity?
If you can't solve this problem automatically, you should be sure to
warn users of these side-effects.
But otherwise this looks like an awesome extension! Thank you very

@_date: 2006-04-27 14:20:18
@_author: Mike Perry 
@_subject: Firefox through Tor 
Thus spake eric.jung at yahoo.com (eric.jung at yahoo.com):
So the problem is that a motivated adversary can subpoena or simply
ask DoubleClick to hand over their IP/cookie logs. If you are using
Tor for /everything/, then what they get from DoubleClick for that
email address is just a Tor IP, no harm no foul. However, if the user
had set up a filter that only sends *yahoo.com through Tor, then
DoubleClick will have their /real IP/ on file in association with
whatever unique ID yahoo passed for that email address, even though
yahoo's records show only the Tor IP.
See the problem?
Yes, excellent. That is the property that is needed. If you use that
level of control, you are fine.
Incidentally, the problem above can happen with ftp://, gopher:// and
whatever other protocol the browser might accept, so make sure you are
updating all proxy settings for each page.

@_date: 2006-04-27 14:55:31
@_author: Mike Perry 
@_subject: Firefox through Tor 
Thus spake Mike Perry (mikepery at fscked.org):
So I've noticed a couple other gotchas when looking at the html
content of a couple of sites.
1. Frames and iframes. Frames are not very common on email sites, but
I believe about.com does use them and has been known to pass
information between frames. iframes are used by google adsense. I
could easily see XPCOM interpreting frames/iframes as being distinct
pages. 2. Links. Say I want to know who baz at yahoo.com is. I send them a mail
(possibly spoofed to look like it's from a previous correspondent of
theirs) instructing them to click on some link that I control that no
one else has seen. This can happen inadvertantly or accidentally even,
I know I've accidentally clicked on an ad banner/stray link here or
Can you provide some sort of option so that the proxy stays enabled
for links clicked from a proxy-enabled page? Would be useful for those
of us with over-sensitive touchpads :)

@_date: 2006-04-27 15:00:21
@_author: Mike Perry 
@_subject: Firefox through Tor 
Thus spake Michael Holstein (michael.holstein at csuohio.edu):
Just clearing cookies every time there is a switch is not enough if
there is an automatic Tor filter in place.
The problem is that yahoo can custom-generate its links to DoubleClick
so they encode your email address (dunno if they do do this, but I'm
sure some sites and ad parters do). Therefore identifiying information
is sent independent of the cookie.

@_date: 2006-04-27 17:50:46
@_author: Mike Perry 
@_subject: Firefox through Tor 
Thus spake Michael Holstein (michael.holstein at csuohio.edu):
Agreed. This is also why an automatic filter is dangerous if it is not
done properly. Just one slip-up, accidental click, etc, and you're

@_date: 2006-04-28 22:48:42
@_author: Mike Perry 
@_subject: Firefox through Tor 
Thus spake Eric H. Jung (eric.jung at yahoo.com):
Depending on the flexibility of XPCOM, it should be possible to solve
this problem programatically (but it is error-prone).
I probably should summarize everything from this thread again just so
you have it all in one place:
The way to solve the problem is to make sure that all embedded object
links are in fact loaded through the active proxy for the parent
tab/page. This includes frames, iframes, css, js, images, java, flash,
and other misc plugin objects. Probably some other stuff too.
So long as the 'evil' link-object is loaded through Tor, the problem
is solved. The assumption is that the information encoded in the
link isn't compromising by itself, but that the danger is that the
browser will autoload the link in the clear and thus your real IP will
be in that server's logs associating you with your Torrified email
Also, because of accidental clicks, phishing attacks, and referrer
urls, user followed links should also be protected. Pretty much
anything the user follows from a protected, proxied page should
inherit that page's proxy settings (including links followed by
opening them in a new tab/window).
Lastly, as Michael pointed out, you have to clear all cookies
everytime a proxy switch is done (mega bonus points for a mechanism to
protect certain cookies from deletion a-la
 If you do not do this, a cookie
accessed from an ad banner displayed while you are visiting a site in
the clear can be transmitted again when you access your email account
through Tor, thus ruining your pseudonymity against an adversary with
access to the ad server's data (assume everyone). The reverse is also
possible, so cookies have to be cleared in each direction of the
Even with all these countermeasures, the type of filter where you
specify only untrusted/Tor sites is error prone and should carry heavy
warnings for people who truly need anonymity, and needs to be tested
heavily by vigilant people with a wide variety of usage habits.
I do think that it should be possible to build such a filter though.
And it would be very very nice to have.
Yes, inverting the filter so that you list only sites that you trust
to connect to in the clear is a much safer option (and much easier to
implement!), but my guess is that it will be much less popular than
the ability to specify the sites you only want to visit through Tor
(ie gmail/yahoo/.onion). There in lies the dillemma.

@_date: 2006-04-29 05:54:10
@_author: Mike Perry 
@_subject: Firefox through Tor 
Thus spake glymr (glymr_darkmoon at ml1.net):
I regularly purge tons of cookies from doubleclick, informit,
googlesyndication, ad nauseum that have been collected even through
privoxy. Unfortunately privoxy really should only be depended upon as
a SOCKS to HTTP proxy converter. It is not a reliable privacy tool
While I'm at it, let me strengthen this statement by saying that such
a filter for selective torrification is pretty much a necessity for
the simple reason that every Tor user *has* to do all the
countermeasures by hand anyway as-is if they ever turn Tor off (which
I imagine most of them do, esp during periods of network lag).
If an extension such as Foxyproxy can perform these tasks
automatically, and can be verified to be performing them correctly
each time, this is a vast improvement over everyone doing it by hand
(especially for Tor newbies).

@_date: 2006-04-06 00:58:43
@_author: Mike Perry 
@_subject: Circuit failure after IP changes 
So I'm having problems with tor establishing new circuits after an IP
change on my laptop. Tor seems unable to build new circuits after this
happens, and I get tons of logs to the effect of:
Apr 05 21:47:09.391 [warn] onion_extend_cpath(): Failed to find node
for hop 0 of our path. Discarding this circuit.
Connecting to the control port shows no circuits are built.
I'm using 0.1.1.17-rc, and I'm also using the
EntryNodes/StrictEntryNodes config directives to specify a list of
trusted entry nodes. Perhaps reachability problems during the downtime
between IP changes causes all of my entry nodes to be invalidated?

@_date: 2006-04-06 01:09:03
@_author: Mike Perry 
@_subject: Unique properties and realtime entry-exit check 
Thus spake Total Privacy (nosnoops at fastmail.fm):
That depends on your profile directory.. If torpark and firefox are
sharing the same profile, cookies will be shared. If they are sharing
profiles, extensions probably will be shared also. An easy to check this without devling through arcane browser settings
is to install a cookie monitoring extension. I really like Add N' Edit
cookies myself. You can search for yahoo via each browser and make
sure no cookies are cross-populating.
I think that unless you have installed a client certificate, there
should be no identifying information in an SSL handshake. If you do
have a client certificate installed (you will know if you do), I think
the client only uses it if the server requests it.

@_date: 2006-08-18 18:42:28
@_author: Mike Perry 
@_subject: Tor and Google Image search 
Thus spake mr.wolf at sprawl.it (mr.wolf at sprawl.it):
Actually, I've started noticing this even though my privoxy config
hasn't changed in a long while. I think its something new that
images.google.com is doing that privoxy doesn't like.
If you add:
{ fragile } to your Privoxy action file, it works again. To declare everything as
{ fragfile }
Perhaps the images.google.com declairation should be added to the
Privoxy that is shipped with vidalia/tor. It is likely to be pretty
frustrating to new users.

@_date: 2006-08-18 19:19:58
@_author: Mike Perry 
@_subject: following on from today's discussion 
Thus spake Roger Dingledine (arma at mit.edu):
I'd like to also add that it is possible for rogue Tor servers to go
beyond simply evesdropping on traffic. On one occasion I recieved a
corrupt .exe file via Tor.. It appeared to be just noise, but it woke
me up to the possibility that it is quite feasible that Tor exit nodes
can do all sorts of things to traffic: modifiying .exes, injecting
browser/media format exploits, etc etc. Since the Tor client scrubbs
logs, it can be difficult to tell which exit server was in fact
responsible, especially if they only target a small percentage of
It might be nice if Vidalia had an option to retain some connection
history in-memory only for a period of time on the order of 10s of
minutes for the purposes of monitoring for malicious/censored exit
nodes.

@_date: 2006-08-18 19:22:23
@_author: Mike Perry 
@_subject: Tor and Google Image search 
Thus spake Mike Perry (mikepery at fscked.org):
Ouch. Two typos, one caused by me, one by mailinglist/MTA. This should be one period. And { fragile }, just like before.
 { fragile }
 .

@_date: 2006-08-18 19:49:56
@_author: Mike Perry 
@_subject: Polipo web proxy (was Re: Tor and Google Image search) 
Thus spake Roger Dingledine (arma at mit.edu):
7) The definition of parent proxy is different between Polipo and
Privoxy. It turns out Privoxy has teh awesoma poweru of being able to
have an HTTP proxy after Tor. This is useful for sites that block Tor,
such as slashdot & wikipedia (for posting), craigslist, IRC, etc etc
etc. I was unable to find a way for Polipo to do this. It made me
sad. Course it aint exactly convenient for Privoxy, but at least it's
there when you absolutely need to start some flame wars on /. ;)

@_date: 2006-08-18 20:30:54
@_author: Mike Perry 
@_subject: Polipo web proxy (was Re: Tor and Google Image search) 
Thus spake Roger Dingledine (arma at mit.edu):
Woah. That's very odd behavior, especially that it would magically
decide to put the HTTP one after the socks one. From the manual I
assumed they were mutually exclusive.
Privoxy also allows the flexibility to do it for specific
hosts/domains/wildcards (ex: irc.) though, which is nice.

@_date: 2006-08-19 17:54:25
@_author: Mike Perry 
@_subject: following on from today's discussion 
Thus spake Roger Dingledine (arma at mit.edu):
Time for a nice tinfoil-amplified SSL rant..
Is anyone in the world actively watching and tracking SSL certs beyond
simply verifying CA key signatures?  By looking at teh OCSP RFC
( it appears as if you are hard
pressed to tell if a cert is a dup or not:
'The "good" state indicates a positive response to the status inquiry.
At a minimum, this positive response indicates that the certificate is
not revoked, but does not necessarily mean that the certificate was
ever issued or that the time at which the response was produced is
within the certificate's validity interval.'
I mean good goddess. So even if you are watching for revokations, you
are only handling half of the SSL threat model... Some form of
ssh-like fingerprint tracking really needs to be coupled with
CRL-style checks so that you only accept a different cert than normal
for citibank.com if a revocation has been actually issued by them.
Especially when we have over 100 root certs spanning multiple
countries trusted by most browsers now.
To add insult to injury, the only public OCSP server I can find seems
completely broken. Everything comes back with 'unknown' with bad
timestamps. Yes, even their demo key.
This client seems to be somehow issuing correct queries to verisign's
OCSP according to ethereal (even though it is configured to use
openvalidation.org), but the UI reports the same 'unknown' status as
'openssl ocsp' did:
Madness.

@_date: 2006-08-19 21:04:02
@_author: Mike Perry 
@_subject: following on from today's discussion 
Thus spake Matej Kovacic (matej.kovacic at owca.info):
So what about a stochastic solution instead:
1. Create some listing of exe files, commonly vulnerable doc formats,    and SSL sites that changes periodically, possibly scraped off google
2. Use some perl glue to go through the Tor node list and try each exit
   to make sure they aren't modifying this data.
   a. Certs can be checked byte by byte to make sure they don't differ
      across exit nodes.
   b. Images, doc files, ppt files, exes can be verified by multiple
      sources
A handful of hosts could run this thing and publish their results,
perhaps along with some other manually created list of undesirable
I think this is doable with perl, the Tor control port, wget, md5sum,
tsocks and 'openssl s_client', and is a lot more efficient than having
everyone verify everything always. The testing can be periodic, can
manually associate streams with connections so exits are known, etc.
If I'm not distracted by something shiny in the next couple days I'll
give it a shot. I mean, we've got to get these motherfuckin snakes off
this motherfuckin plane.

@_date: 2006-08-20 15:50:14
@_author: Mike Perry 
@_subject: tor trying to pop mail from random IPs on win32 
Thus spake Tor question (torquestion at yahoo.com):
Actually if you send me your tor.exe I can have a look at it in IDA to
see if I notice anything obvious.. and shiny. I'd especially be
interested in the installer package if you happen to still have this
The version number of Tor would be extremely helpful in tracking the
modified code down post-haste.

@_date: 2006-08-21 13:18:29
@_author: Mike Perry 
@_subject: following on from today's discussion 
Thus spake Matej Kovacic (matej.kovacic at owca.info):
Yeah, thats why we need a few people running it continuously over a
long period of time. It serves as a deterrent that the network
is actually monitoring for this behavior, since nodes doing
this will eventually be noticed.
Though for botnet operators who presumably are able to sign up their
botnet hosts as tor nodes anonymously via their own relay network,
they may not care if the individual nodes are caught or not.. Scary
I've managed to keep myself sufficiently insulated from shiny things,
and have finished a script that uses Tor to md5sum a list of URLs and
also track the SSL certs of a list of https hosts. This script saves
corrupted files, so if we catch infected exes, it's possible we can
use these samples to go after botnet command and control. That ability
may also be a sufficient deterrent to keep teh snakes off teh Tor.
I also have a seperate script that parses the Tor directory and choses
nodes based on exit port policy and bandwidth. I'm working to make
this one operate with the tor control port to actually build and
attach circuits and inform the first script which exit node it is
choosing via a named pipe. This way we can experiment with different
strategies for choosing exit nodes to scan, short path lengths, and so
on easily.
I'd guestimate about 2 days before I have a prototype that works
fully with a fixed list of URLs. Possibly end of next weekend before I
have something that picks docs & exes randomly off google.
P.S. Does anyone know a clean way to do line-buffered select()able
socket IO via perl? From looking at IO::Socket it seems like the
timeout is only used for accept/connect... I may have to restort to
multithreaded perl.. *shudder*.

@_date: 2006-08-24 03:25:39
@_author: Mike Perry 
@_subject: Snakes On A Tor 
So I've hacked up some crazy perl to scan for changes in md5sums of
urls and SSL certs by exit nodes. Doesn't scrape google yet. Maybe I
will get to that, maybe not. Probably not in the immediate future. My
attention span is running out on this project. I'm thinking it's in
the "good enough" state, and I did manage to produce some fun toys for
y'all up to this point.
Here are some excerpts from the README:
The project essentially consists of two perl files. One called
'soat.pl', which is the scanner, and the other called 'metatroller.pl'
which is a meta-controller for Tor that can do all sorts of neat
tricks. The Metatroller can be run without SOAT, but SOAT requires the
These both have been tested on perl v5.8 on Linux. The Metatroller has
also been tested on Windows ActivePerl 5.8.8 and does in fact play
nice with Vidalia. However SOAT itself depends on wget, openssl, and
md5sum, which are not likely to be present outside of Cygwin.
Once the Metatroller is up and running, you can telnet localhost 9052
and type HELP. You should get this:
220 Welcome to the Tor Metatroller v0.0.1! Try HELP for Info
214 Commands:
214  COUNTRY 214   - Pick a two letter country code to select exits from, or ALL
214  COUNTRIES
214   - List countries that have tor nodes (not necessarily full exits)
214  PERCENTFAST <
214   - What % of the network is considered 'fast' for node selection
214  BWCUTOFF <
214   - Minimum observed bandwidth (KB) that a node must have to be selected
214  UNIFORM <1|0>
214   - Should selection among fast nodes be uniform (or bandwidth-biased)?
214  ORDEREXITS <1|0>
214   - Should exits be chosen one after another instead of randomly?
214  FASTEXITS <1|0>
214   - Should exits be chosen from 'fast' nodes or all nodes?
214  PATHLEN <
214   - What should the path length of circuits be?
214  QUERYEXIT
214   - Reports the current exit
214  NEWNYM
214   - Throw away all circuits and choose a new exit
Hopefully this is self-explanatory. I particularly like the COUNTRY
option. Since I'm a xenophobic American who's never left the country
except for the occasional visit to America Junior, it's like my own
little international travel simulator, but without all the laptop
scaning, stolen carryon items, and cattle prodding.
--------------  BIG FAT WARNING  -----------------
While many of these options may seem desirable at first glance, a
consideration of how Tor works can actually reveal that they are
extremely dangerous to your anonymity.
The major risk factors are:
PATHLEN - This is a bad idea all around to mess with if you need
anonymity. Since Tor uses telescoping to build circuits, it is
trivial for the first hop to fingerprint you based on the number of
packets that traverse it during circuit construction. If you are
the only one on the network building 6 hop circuits, you are
essentially giving nodes a unique fingerprint to track you with.
Likewise short paths are dangerous because it becomes trivial for a
node or pair of nodes to trace your exact path through the network.
BWCUTOFF/PERCENTFAST - these option may seem like a good way to
improve Tor speed, but in actual fact it doesn't help you much once
you get beyond about 60% or so in my experience. This is where Tor
node bandwidths start to grow beyond 50kb/sec a piece. After this
point, not only are you skewing the load balancing on the Tor network,
you are starting to seriously limit the number of nodes your client
chooses, making it much more likely that high-bandwidth adversaries
observe the first and last node in your circuit and can correlate
them. It also doesn't help speed that much either past that point.
Also, note that the metatroller itself may introduce weird timing
and/or circuit usage signature patterns that may or may not give you
away. I did my best to make the defaults look as much like Tor as
possible, but there may be subtle differences that can be picked up
on. Perhaps the most obvious one is the fact that wget and not Tor is
being used to fetch directory information. I have set the user agents
to be identical, but there may be other differences.
Another possible giveaway is that I do not use uptime information in
the node selection process. Nodes may be able to tell you are a
Metatroller client if one of their neighbors for that circuit has
extremely low uptime.
A couple of caveats/rough edges with SOAT:
1. You should customize the list of exe's yourself to add some random
stuff, various document/image URLs, and so on. This list shouldn't be
published if you intend to post results, except in the case of
corruption. You should change it every once and a while. Future
versions may automate this by scraping shit off google/sourceforge.
2. Some nodes simply return "Connection: close" for URLs, perhaps
because of a malfunctioning upstream squid proxy or who knows what.
I've decided to let this trigger the MD5 warning, because it is
freaking annoying when I use Tor normally, and it might be nice to
build a list of nodes that do this to either fix them or simply
shitlist them.
3. Some SSL websites (for example citibank.com) actually have a whole
collection of SSL certificates for some unknown reason. Even saving
SSL certs specific to each IP of a round-robin DNS host still isn't
good enough.  Ugh.
4. When you exit via multiple control-C's, the last couple MD5s will
show up as bogus because system() function causes the SIGINT to be
delivered to wget and not perl. The fix for this listed in the perlfaq
did not work. :(
5. SOAT is likely to not work optimally if you are using the same Tor
client for other things. In some cases this can cause the exit to
change between the time that SOAT uses it and the time that it detects
an error and asks Metatroller what exit was used. It is probably best
to run a secondary Tor client with a different control port just for
SOAT and the Metatroller. You probably want this for anonymity reasons
also, especially since the default path length used by SOAT is only 2.
Note that Tor node operators can concievably run SOAT on their Tor
nodes with a path length of 1, since for them scanned nodes won't be
able to tell for sure if they are the originators, or just relaying
another circuit.
I will be running this thing myself. If I notice anything interesting,
I'll post it to the list. Of course my own exit node is always clean
and never ever ever injects malicious code. So no one needs to scan it
at all. You can all trust me. Nobody else should scan. ;)
So far my "Connection: close" list is:
- baphomet
- err
- moulticastfrsrv
- ni
- pax
Anyone know what causes this? They don't do it all the time. Just

@_date: 2006-08-24 14:01:54
@_author: Mike Perry 
@_subject: Snakes On A Tor 
Thus spake clifnor at warpmail.net (clifnor at warpmail.net):
Sorry I'm an idiot. Forgot to also set grsec permissions for teh file.

@_date: 2006-08-24 14:29:58
@_author: Mike Perry 
@_subject: Snakes On A Tor 
Thus spake Mike Perry (mikepery at fscked.org):
Oh, I also forgot to implement guard nodes. Woops. Maybe I will get to
that later.
It also bothers me slightly I don't verify directory signatures, but
unless there's a perl RSA implementation that's compatible with the
one used to sign the dir, there's not much chance in me doing that
ever. I do use key names instead of node names for path specification.
So the worst that could happen is that nodes disappear/change their
exit policies. Just don't download the directory through Tor for now
and it should be fine.
P.S. Nick/Roger, where is the TorCtl.py module mentioned in
contrib/TorControl.py? Not seeing it on the SVN web portal. It's a
pity I didn't see this contrib python before I went on my mad quest.
I've been looking for a reason to learn Python.

@_date: 2006-08-24 14:59:05
@_author: Mike Perry 
@_subject: Snakes On A Tor 
Thus spake Matej Kovacic (matej.kovacic at owca.info):
Heh, no thanks. So then we know what? That when given guns, people
are likely to shoot themselves with them? Big surprise ;)
I do have to fight my evil twin nearly every day to not write a script
to watch google queries on my exit. It's a harder battle than quitting
smoking. I bet Tor users google for some really interesting stuff. I
considered proposing using aggregate query stats for research purposes
(hey, could be another reason for Universities to run tor nodes), but
in light of this AOL deal (and also US wiretap law), such a thing
would probably be suicide. The wiretap thing is debatable though.. my
ISP informs me they record whatever they feel like, I should be able
to do the same why not.
One idea that I did consider was asking if anyone ran or would care to
run any honeypots, and then log into those with unique
POP/IMAP/telnet/web/whatever logins/passwords for each exit (or a
group of exits). Then we could tell if certain exits were actually
USING this plaintext data.
But keeping the IPs of these honeypots a secret would be incredibly
hard, if nothing else because malicious exit owners probably would be
able to figure it out over a preriod of time based on usage patterns.
Once the honeypots are known, malicious exits would just not use them.
For stuff like this, I agree with Roger, everyone should be using SSL
anyway.  Those who don't use IMAPS/POPS should be weeded from the
population via death by embarassment. Bring on the Wall of Sheep.
Unfortunately for exe/doc formats, there is seldom the option for even
an MD5, let alone gpg sig. And SSL is out of the question for most of
these sites. So some other stopgap was needed.

@_date: 2006-08-27 00:53:43
@_author: Mike Perry 
@_subject: Skype Call Traced 
Thus spake phobos at rootme.org (phobos at rootme.org):
Hrmm.. According to:
Skype does TCP if UDP attempts fail. However it appears to encode your
IP address in messages. Sort of defeats the purpose of Torifying it.
Probably the case with a lot of voice clients, unless you can find a
way to get them to not discover your IP...
I also find it unpossible that actual watermarking was used against
this fellow as opposed to simple IP tracking.

@_date: 2006-08-27 01:33:22
@_author: Mike Perry 
@_subject: Skype Call Traced 
Thus spake Taka Khumbartha (scarreigns at gmail.com):
Academic research leads reality by at least 5-10 years.. For shit that
requires infrastructure changes (like this), sometimes 20. Also dude
had way too large amounts of false positives/negatives for wide-spread
use, if you ask me. Maybe possible for targeted use, but I would bet
they'd only haul this out if IP failed. They also would have to be
global/working with Skype unless they had his destination ahead of
time. And to use it against Tor, where you have no idea what the
nature of incoming traffic is to watermark.. unthinkable. Paper
actually says this if you'd read it.
Remember kids, tinfoil hats cause cancer. Research at MIT proved it.

@_date: 2006-08-27 02:44:06
@_author: Mike Perry 
@_subject: Skype Call Traced 
Thus spake Andrew Del Vecchio (firefox-gen at walala.org):
Yes, I actually am an agent of an unknown branch of an unmentionable
TLA dedicated to the slow and subtle corruption of teh english
language to suit our nefarious ends for world domination.  Snakes On A
Tor was just my cover to distract you long enough to become infected
by our neurolinguistic virus, and the Metatroller has hidden code in
its regular expressions that report your wearabouts directly to our
array of orbiting mind control lasers. ;)

@_date: 2006-08-27 20:24:06
@_author: Mike Perry 
@_subject: Holy shit I caught 1 
I would have bet good money against this, but there actually IS a
router on the tor network spoofing SSL certs. The router '1'
(218.58.6.159 - $BB688E312A9F2AFFFC6A619F365BE372695CA626) is
providing self-signed SSL certs for just about every SSL site you hit
through it. Nice. Is there a wiki page with bad tor nodes anywhere?
Let's hear it for paranoia! Hip hip hooray.
Is anyone else scanning? My list of hits on for this zip is awefully
small.. It appears we may actually need to scan, folks. An assortment of SSL certs provided by this router is attached in a
.zip file.
Go ahead and hit up  with
socks_remote_dns and only a socks proxy (privoxy breaks the .exit
notation), and be prepared to shit yourself. Does anyone know if
firefox verifies cert sigs when downloading extension updates?

@_date: 2006-08-27 21:10:05
@_author: Mike Perry 
@_subject: Holy shit I caught 1 
Thus spake Roger Dingledine (arma at mit.edu):
Yeah. For this reason it's not cause to panic yet. Hopefully. I
suppose it depends on extension-update behavior. I could easily see
that UI eating SSL errors somehow. Esp right after a firefox upgrade
when the whole beast hasn't properly launched and it is just "scanning
for updates".
However, I also have whole collection of corrupted Torparks I need to
have a look at.  May just be a bug in my script, though. Or maybe the
Torpark mirrors automagically provide localized versions? They're
coming from a lot of what I would expect to be trustworthy exits.
Just updated it to 0.0.2 to change the behavior on tor exits that kill
the connection before an SSL cert could be obtained to just warn
rather than save an empty cert.
Yeah, this essentially does that. I suppose you would want it built in
to Tor proper though? I dunno if I can commit the time for that,
unfortunately. Plus C really bothers me.. Been spoiled by C++ & STL :)
Also, is there a complete python Tor controller? contrib/TorControl.py
referrs to new version in CVS, but I can't find it. Perl is starting
to bother me for the same reasons C did.. OO support is an abysmal
Will do. Maybe at some point I will create real web presence for this
deal. Maybe a third script that enumerates all the output files and
makes that into a web-friendly listing page. Maybe after it stabilizes
for a few weeks.

@_date: 2006-08-27 21:44:06
@_author: Mike Perry 
@_subject: Holy shit I caught 1 
Thus spake Anothony Georgeo (anogeorgeo at yahoo.com):
I'm guessing actually scanning is going to be WAY over your head. It's
really meant for people who run Tor servers on Linux boxen and know
what they're doing, because right now you have to manually eyeball the
SSL certs and MD5 error files to double-check everything is Ok. I'll
try to improve that in a few weeks.
But, the Metatroller is a neat toy if you just want to investigate
censorship conditions in China/Germany for a day or whatever.
For that you DO NOT actually need md5summer, wget, and openssl. You
only need those if you want to run soat.pl.
For the Metatroller to work, you need to tell Vidalia to start
Tor with an alternate torrc. Open a new 'torrc' textfile on your
Desktop somewhere and put the lines:
ControlPort 9051
__LeaveStreamsUnattached 1
in it. Tell Vidalia in its config window to use this file as an
alternate torrc location. Restart Tor.
Once you have everything in your path, ActivePerl installed and
Vidalia set up to use this Torrc, either Start->Run.. "cmd.exe" or
launch cygwin, and cd to the directory you unzipped SOAT into.
You should be able to type 'metatroller.pl cached-directory country-codes'
and it shoud print a WARN and a NOTICE that it is ready.
Periodically you should hit up  and save
that output to 'cached-directory' in the SOAT dir. Ditto for
 Save that
to 'country-codes' in the same dir.
Once it's all set up, if you want to play with the Metatroller's
options, you can open another cmd.exe and type 'telnet 127.0.0.1 9052'
and you should be able to give it the commands it lists under 'HELP'.
You can actually watch the metatroller build circuits in the Vidalia
network status window. Now mind the warnings I gave about the Metatroller and anonymity,
ESPECIALLY if you fire up soat.pl also. If you run soat.pl, you should be running it on a seperate machine
than you are using normally (or inside a vmware image or simply
another instance of Tor) because of shortened pathlengths, strange
exit selection strategy, etc etc etc.
To actually scan, you need md5summer to be renamed to md5sum.exe, and
you need all those tools to be in your path. Perhaps c:\windows if you
don't mind the clutter. Hopefully the output from md5summer is the
same as UNIX md5sum..
I'm guessing these complications probably will make it beyond your
ability to actually scan at this time.. Between these ramblings and
the README file, hopefully you can at least tinker with the
Metatroller for a bit so you can bask in the glory of some orbiting
mind control lasers. Winter is coming, maybe you can save on the
heating bill.

@_date: 2006-08-27 22:16:22
@_author: Mike Perry 
@_subject: Holy shit I caught 1 
Thus spake Jay Goodman Tamboli (jay at tamboli.cx):
Hrmm. Depends... Using the same Tor client as soat.pl uses is really
bad of course, because for those circuits, pathlen is only 2 and exits
are chosen in a round-robin fashion. Also it will likely confuse
soat.pl as well.
However, in the case where your internet IP is being shared by a
Metatroller/SOAT client, it essentially boils down to how dangerous it
is for entry nodes, over time, to infer that there is an abnormal Tor
client at your IP. I'm not sure exactly how damaging this could be. It would seem to me
that so long as your regular, important connections go through a Tor
client NOT running the Metatroller, middle and exit nodes should not
be able to tell you are running Metatroller, and should not be able to
partition/fingerprint you (which I think is the most dangerous
aspect). Maybe Roger/Nick can shed more light on this, though.

@_date: 2006-08-27 22:49:46
@_author: Mike Perry 
@_subject: Holy shit I caught 1 
Thus spake Roger Dingledine (arma at mit.edu):
An interface to suck a signature-verified directory out of Tor via the
control-port or some other means would also be nice.
Ok, I will consider rewriting it for this python interface. Have to
learn python first, which has been on my TODO list for some time, so
hopefully it will happen. I would guess the directory notification
interface won't appear for a while in Tor either, so I probably have
time. When 0.1.2 stabilizes?
In the meantime I will keep my rickety perl running and will keep in
contact with the list when I notice things.
I actually had a look at blossom, but didn't see that it was using a standard torctl interface. Probably just me not groking python tho.

@_date: 2006-08-27 23:38:08
@_author: Mike Perry 
@_subject: Holy shit I caught 1 
Thus spake Arrakistor (arrakistor at gmail.com):
Weirdest shit in the world. Privoxy is dumping temporary failure
messages mid-stream into the binaries, yet keeping the sizes exactly
the same. Perhaps this was the source of the original mysterious
binary corruption that sent me on this quest oh so long ago.
Unfortunately then I was in a hurry and just deleted the file without
thinking :)
So even so, it's unsettling.. You download some app, iso, video, or
whatever via Privoxy and it kindly tells you there's a temporary
failure mid-binary stream. How nice of it.

@_date: 2006-08-28 04:10:22
@_author: Mike Perry 
@_subject: Holy shit I caught 1 
Thus spake Roger Dingledine (arma at mit.edu):
Gah. I just assumed that hitting a 0.1.1.x dir server at the tor
directory url (eg  pulled down the
complete v2 directory version, and the rest of the spec governed
proccess for updates.. This is not the case? They /have/ to be
feteched sepately based on the network status or they may be
Wow so this is exactly what I meant.. Heh. Completely didn't see it in
the control port spec. Why is it that getinfo desc/all-recent and getinfo network-status is
different than the dir/status/all, dir/server/all messages? Shouldn't
they converge to the same thing once the client has been running long
enough to download all the routers it sees in network-status?
Is there any reason I would want to try to use a Useless descriptor? I
assumed Useless (starts with ! in network status, right?) meant
Hrmm. I definitely have to run this thing for a while first.. Lots of
assurance issues with actually having it inform the dirservers about a
bad node, especially with this Privoxy noise randomly being inserted
on the wire. Suppose using just plain socks will cut that out, but
then I have to worry about remote-resolution issues. I'm sure there
are other gems waiting to be discovered as well that may or may not
change what knowledge and what logic sits where. I imagine the biggest problem is the fact that malicious nodes have
the option of being bad infrequently enough that it could be mistaken
for transient failure.

@_date: 2006-08-28 14:19:50
@_author: Mike Perry 
@_subject: Holy shit I caught 1 
Thus spake Fabian Keil (freebsd-listen at fabiankeil.de):
I assumed that anyone who actually cared to reproduce the problem
would just run the script, because that's all I did.
Running the script out of the box with the default settings
will reproduce the problem within a few hours of scanning. You will
get tons of corrupted Torpark exes in your docs dir. Seems to really
like Torpark more than anything else. Probably cause its the biggest.
Here is the error:
  503 - Connect failed (Privoxy at localhost.localdomain)
          This is Privoxy 3.0.3
on localhost.localdomain (127.0.0.1), port 8118,
It's embedded in the exe. strings won't find it, but grep will.
Client is wget. Apparently it does retry after failure. Manpage says
nothing about status codes. Maybe it doesn't know what to do with 503.
Yeah, I'm thinking the connection most likely broke down, wget retried
and tried to continue the stream, but Privoxy came back with its 503
status error page instead, probably not something wget was looking
for. Wget probably tried once more after that connection closed, and
picked up the stream again.
Unfortunately my copy of curl is ignoring HTTP proxy environment
variables and --proxy command line settings, so I can't check to see
if it has the same property.

@_date: 2006-12-01 15:28:28
@_author: Mike Perry 
@_subject: How can I trust all my Tor nodes in path 
Thus spake Robert Hogan (robert at roberthogan.net):
It is also wise not to log in to any form over plain http, even if the
form posts to an https url. This is true not just over Tor, but pretty
much anywhere an attacker can manage to position themselves to rewrite
your traffic, which is pretty much anywhere.
Many, many, many banking sites completely disregard this attack vector
in favor of ease of use. Even if the target action of a form is https,
if you have retrieved the form via plain http, that post can be
rewritten to go anywhere. An http redirect later and you're logged in
to your banking site, no harm no foul. Except to your account balance,
of course :)
If your bank is braindamaged in this way, usually giving it a bullshit
login until you can verify you are actually connected via https to it
is probably the easiest way to deal with this.

@_date: 2006-12-01 15:32:01
@_author: Mike Perry 
@_subject: How can I trust all my Tor nodes in path 
Thus spake Martin Toron (tr_tor1122 at yahoo.com):
So I'm guessing you're thinking something like someone heading over to
Amazon's Elastic Computing Cloud and setting up 10,000 tor servers?
I believe tor servers have to be manually approved by tor-ops before
they begin to be used for normal traffic. This used to be the case at
least. Perhaps it has been abandoned due to scaling issues?

@_date: 2006-12-16 20:31:17
@_author: Mike Perry 
@_subject: A Brief Study on Circuit Construction Speed and Reliability 
While testing the latest relese of my Tor scanner, I decided to do a
study on circuit reliability and how long it takes to construct a
circuit then fetch the html of  and also to
fetch  via that same constructed circuit.
Using tor-0.1.2.4 (actually SVN r9067), I sorted the routers by their
bandwidth capacity, divided them up into 15% segments of the network
from 0 to 90, and for each segment timed 250 circuits as well as used
the new failure tracking abilities of my scanner to track the failure
rates of nodes as well as the failure reasons for circuits and
streams. Times are seconds:
RANGE 0-15 250 build+fetches: avg=20.89, dev=31.23
RANGE 0-15 250 fetches: avg=3.66, dev=2.69
RANGE 15-30 250 build+fetches: avg=33.44, dev=47.01
RANGE 15-30 250 fetches: avg=7.28, dev=12.86
RANGE 30-45 250 build+fetches: avg=81.47, dev=79.55
RANGE 30-45 250 fetches: avg=12.66, dev=38.63
RANGE 45-60 250 build+fetches: avg=63.56, dev=67.56
RANGE 45-60 250 fetches: avg=7.51, dev=12.80
RANGE 60-75 250 build+fetches: avg=40.85, dev=42.76
RANGE 60-75 250 fetches: avg=10.13, dev=11.28
RANGE 75-90 250 build+fetches: avg=48.87, dev=56.11
RANGE 75-90 250 fetches: avg=6.82, dev=7.48
As you can see, the high bandwidth nodes in 0-15% are much quicker
than the rest both at using existing circuits and at building new
ones. My guess is that the circuit build speed increase is likely due
to the fact that running a fast node requires a fast machine to be
able to do all the crypto, and thus crypto-intensive circuit builds
execute faster on these nodes.
The rest of the results for circuit construction and speed seem only
loosely tied to bandwidth, however. Probably other factors like
network connection and stability come into play there. A few bad nodes
can slow those averages down a lot, as is hinted at by the large std
deviation in some of the classes.
So what of the failure rates and reasons then? Lets have a look at the
FAILTOTALS line from each class: 0-15.naive_fail_rates:  FAILTOTALS 131/473 54+6/603 OK
15-30.naive_fail_rates: FAILTOTALS 224/750 135+40/726 OK
30-45.naive_fail_rates: FAILTOTALS 559/1221 130+29/737 OK
45-60.naive_fail_rates: FAILTOTALS 273/845 138+22/752 OK
60-75.naive_fail_rates: FAILTOTALS 140/592 85+33/678 OK
75-90.naive_fail_rates: FAILTOTALS 187/637 76+18/656 OK
By looking at the README for the scanner, we see the format of these
lines is:
250 FAILTOTALS CIRCUIT_FAILURES/TOTAL_CIRCUITS DETACHED+FAILED/TOTAL_STREAMS
So it looks that nodes in the 30-45% range seemed to have a good deal
higher rate of circuit failure than the rest (if you're wondering, the
overall circuit failure rate is 33%). Looking at the top of the 30-45.naive_fail_rates file shows us a
handful of nodes with slightly higher failure rates than normal, but
several of the other classes have a few bad nodes also. So why was
this class so much slower? It turns out if you look at the naive_fail_reasons file, the largest
portion of failures comes from CIRCUITFAILED:TIMEOUT reason:
250 REASONTOTAL 522/1277
or 522 timeout failures out of all the total node failures. Note that
reason-based failure counting and reason totals are node-based, where
as the FAILTOTALS lines just count circuits and streams, hence the
large number there.  In general, the most common failure reasons were circuit timeouts,
stream timeouts, and OR connection closed (TCP connections between
nodes mysteriously dying or failing to open).
Here's the top failure reasons by class. When there are 3 reason terms
paired together, the reason was reported from an upstream node and not
deduced locally.
0-15:   1. CIRCUITFAILED:OR_CONNECTION_CLOSED (174/322 node failures)
  2. CIRCUITFAILED:TIMEOUT (72/322 node failures)
  3. STREAMDETACHED:TIMEOUT (41/322 node failures)
  1. CIRCUITFAILED:OR_CONN_CLOSED (182/623)
  2. CIRCUITFAILED:DESTROYED:OR_CONN_CLOSED (116/623)
  3. CIRCUITFAILED:TIMEOUT (124/623)
  1. CIRCUITFAILED:TIMEOUT (522/1277)
  2. CIRCUITFAILED:OR_CONN_CLOSED (396/1277)
  3. CIRCUITFAILED:DESTROYED:OR_CONN_CLOSED (192/1277)
  1. CIRCUITFAILED:TIMEOUT (306/706)
  2. CIRCUITFAILED:OR_CONN_CLOSED (164/706)
  3. STREAMDETACHED:TIMEOUT (138/706)
  4. CIRCUITFAILED:DESTROYED:OR_CONN_CLOSED (72/706)
  1. CIRCUITFAILED:TIMEOUT (112/398)
  2. CIRCUITFAILED:OR_CONN_CLOSED (110/398)
  3. STREAMDETACHED:TIMEOUT (85/398)
  4. CIRCUITFAILED:DESTROYED:OR_CONN_CLOSED (56/398)
  1. CIRCUITFAILED:TIMEOUT (216/468)
  2. CIRCUITFAILED:OR_CONN_CLOSED (96/468)
  3. STREAMDETACHED:TIMEOUT (76/468)
  4. CIRCUITFAILED:DESTROYED:OR_CONN_CLOSED (56/468)
So if you total the two OR_CONN_CLOSED (local and remote), you see
that for some reason node to node TCP connections are fairly
unreliable and prone to being closed (or are difficult to
open/establish?). This is strange...
I should also note that stream failure reasons are only counted for
the exit node, where as circuit failure reasons are counted for 2
nodes - the last successful hop and the first unsuccesful one. So in
effect, the STREAMDETACHED reason really is 2x more common than in
those lists. On the other hand, it is mostly alleviated by making
compute_socks_timeout() always return 15 (this was not done for this
study, however).
Well that's about all the detail I have time to go into right now. The
complete results are up at
As soon as I finish polishing up my README and change log, I will put
up the new release of SoaT itself up. Should be by sometime today.

@_date: 2006-12-16 21:35:21
@_author: Mike Perry 
@_subject: Snakes on a Tor 0.0.5 
I've finished off another release of my scanner and wrote another perl
script to perform the timing/reliability measurments in the previous
Release is at:
 Metatroller:
  - "suspicious" vs "naive" failure rate information
  - New commands to support exporting these stats to SpeedRacer+SoaT
  - Subscribes to Network status events to get new router information
    from Tor
  - Now better able to handle concurrent streams at once
 SoaT:
  - Now scans SSH hosts present in ./known_hosts for key changes
  - Attributes DNS resolution to proper exit, even if different than     actual data circuit
  - Checks for content changes outside of Tor to eliminate false
    positives
  - Filters out dynamic content ahead of time before scanning stats
  - Allows wildcard filetype "all"
 SpeedRacer:
  - Implemented. This is the last release that will be written in perl (unless some
huge bug is discovered). I'm going to rewrite it in Python so I can
get some decent OO support to implement some more advanced features.
There might not be another release for a few months.

@_date: 2006-12-17 17:17:30
@_author: Mike Perry 
@_subject: A Brief Study on Circuit Construction Speed and Reliability 
Thus spake Ringo Kamens (2600denver at gmail.com):
Yeah, it's not quite as immediately relevant as exit scanning, but it
is a little more interesting with respect to studying the network as a
whole I think. What I'm really looking forward to is gathering some
statistics on most common peers during failure. I'm curious if those
OR_CONN_CLOSED are happening because certain nodes are
unreachable or partitioned from one another somehow, or if it is
something else. But I need better structure & object support for that
than perl can provide sanely, unfortunately.
I've gone back to scanning exits in the meantime. If anyone wants to
join me with a different wordlist.txt, set of filetypes and other ssh
hosts, it might be nice.

@_date: 2006-12-04 05:01:22
@_author: Mike Perry 
@_subject: Bootstraping Tor manually to get past the Great Firewall 
Thus spake Nick Mathewson (nickm at freehaven.net):
Can't find the article now, but I once read it is more difficult for
China to add IP-based blocks than keyword/url ones. It takes them
longer to add IP blocks as opposed to new keywords. Couple this with
the fact that there is probably a lot of churn a lot of the Tor nodes
towards the middle-bottom, and a way to get this directory information
across might be enough for a while...

@_date: 2006-12-04 05:10:08
@_author: Mike Perry 
@_subject: Tor DNS lookups failing 
Thus spake Jay Goodman Tamboli (jay at tamboli.cx):
Yeah, I just started noticing a lot of DNS failures on my most recent
batch of scanning as well. I've got a fair amount of work to do before
SoaT 0.0.5 is ready (I think I've just about hit the limit of
maintainable complexity in a perl script :), but when it's done it
should be able to help us figure out which servers this is happening
at, as well as a shitload of other interesting info as well.
I'm hoping to make the release next weekend.

@_date: 2006-12-07 01:46:39
@_author: Mike Perry 
@_subject: Nodes frequently changing keys... 
Several nodes seem to be rapidly rotating keys.. Over the past 24
hours or so the following nodes have changed keys:
Unnamed - 11 changes, 7 keys
ididedittheconfig - 6 changes, 3 keys
waldi - 5 changes, 2 keys
iddbadfpi2 - 3 changes, 2 keys
oinc - 3 changes, 2 keys
anonymous - 2 changes, 2 keys
Is there any reason why these nodes are doing this? It's been going on
for a while (month or more?), finally got around to recording it.

@_date: 2006-12-07 03:23:34
@_author: Mike Perry 
@_subject: how to prevent Tor from auto-buiding circle? 
Thus spake xiangw at fudan.edu.cn (xiangw at fudan.edu.cn):
Unfortunately I think there is no tor option for this. In my case I
ignore the circuit extends I didn't cause. You can build a table/list
by watching for 250 EXTENDED ([\d]+) right after you send the
EXTEND.. Any events for other circuit IDs you can then ignore. However, I'm guessing you want to completely avoid touching nodes that
are known to be unreachable from your location? Is it bad if you
try to connect to firewalled nodes?

@_date: 2006-12-07 12:58:35
@_author: Mike Perry 
@_subject: Nodes frequently changing keys... 
Thus spake Nick Mathewson (nickm at freehaven.net):
Ah. I thought the purpose of using keys was to get the same nodes
after name changes. I thought names were enforced to be unique.
You're right, I should have just looked at the directory. All those
but waldi and oinc actually have different IP addresses. I will try to
be more thorough next time.

@_date: 2006-02-12 03:56:12
@_author: Mike Perry 
@_subject: Circuits still shared? 
Are multiple TCP connections still multiplexed across a single Tor
circuit? It would seem to me that this should be a serious compromise
to anonymity. Frequently I am browsing sites that know who I am (or
using AIM, etc) concurrent to accessing those that I'd prefer not to
know me.

@_date: 2006-02-13 05:21:38
@_author: Mike Perry 
@_subject: Circuits still shared? 
Thus spake Roger Dingledine (arma at mit.edu):
So the naive best-effort-first approach would be to send all
connections to the same host (or maybe even second level domain)
through the same circuit. Each time a new domain is encountered, a
different circuit is chosen, preferably a clean one if available. If
no clean circuits are left, then perhaps the user could be notified
that Tor is now fully "nym-dirty" and would have the option of
specifying to reset their circuits via the control you proposed in
the next post. Otherwise the control ap would continue rotating
through the circuits.
What do you think about the load of this approach? Is the load based
on the number of circuits the client generates at a given time? Does
doubling the number of circuits in the tor client double CPU usage at
the servers? Or is there some other factor here? It would obviously be easier to keep the user from running out of
circuits if the circuit pool size was increased to their average
number of domains visited in a 10 minute interval.
As I have a bad habbit of thinking I will have time to do something
when in fact I do not (day jobs.. ugh), I should probably say that
right now I probably don't have time to implement this, but if I
notice it often enough where it gets annoying and worrysome, maybe I
will have a go at it.

@_date: 2006-05-13 22:22:33
@_author: Mike Perry 
@_subject: Some legal trouble with TOR in France 
Thus spake Olivier Barbut (olivier.barbut at free.fr):
Do french police need a warrant or some form of approval to conduct
this sort of search? In the US they should require a warrant, and some
judge would have to approve that. A US judge exercising proper
dilligence should be able to realize that the search was not likely to
produce relevant evidence to the case in question, or so one would

@_date: 2006-05-14 18:15:49
@_author: Mike Perry 
@_subject: Some legal trouble with TOR in France 
Thus spake Eric H. Jung (eric.jung at yahoo.com):
Where is your source on this? As I understand it, there are a few
fundamental principles of the US legal system that should render this
statement completely false. One is Habeas Corpus.. You can't just
throw someone in jail indefinitely without a criminal charge and a
trial.  Though it seems Bush&Co are violating it with "enemy combatant"
charges, I do not think they have the political power (at least
anymore) to name an anonymity provider as an "enemy combatant"
(especially if they are a natural born US citizen). The same applies
to the 72 hour warrant deal, at least as far as I can tell from
Second, if it is a criminal charge, you are not under any obligation
to testify against yourself in a criminal court of law (5th
ammendment). There are various exceptions to this, main one being if
you are not the person charged of the crime (though I think you can
still claim that such testimony may incriminate you for unrelated
matters). I suppose it could also be argued that the passphrase does
not count as testimony, but it sure seems like it is.
Finally, some googling on subpoena compliance seems to indicate that
punishment for subpoena non-compliance is 'contempt of court' charge
and fines.
That page advises you not to answer any subpoenas without challenging
them first, among other things (ie one state's court cannot usually
subpoena someone from another state). Contempt of court charges for
non-compliance may be repeated, but any contempt law I can find on
the web has some form of maximum limit. The longest I've seen so far
is North Carolina, which is a max of 1yr in 90 day increments:
Also, dunno how accurate it is, but Wikipedia seems to claim that the
key disclosure provisions of the RIPA (Part III) are not yet in force
in the UK:
We seriously have to watch our paranoia on this one. This is one of
those situations that if we believe we have no rights, it will be very
easy to knock us over, simply by playing off our fears and demanding
keys without any legitimate basis to do so.
If any Tor operator is arrested/detained in the US, they would do well
to refuse to surrender any passphrase until they are actually in court
and ordered to do so by a Judge (and then only after voicing protest,
to allow for clear appeal to a higher court). Cops will probably just
lie to you and try to convince you that you are required on the spot.
Ask for a lawyer immediately. This is not just to protect the Tor network either. With computer laws
as crazy as they are, and with the IPPA coming down the road, soon
simply having something like an Open Source DVD player or archiver on
your machine will be enough to land you in jail for a while, if it's
not already...

@_date: 2006-05-15 04:54:46
@_author: Mike Perry 
@_subject: Some legal trouble with TOR in France 
Thus spake Ringo Kamens (2600denver at gmail.com):
According to wikipedia (
"In all U.S. jurisdictions retaining the grand jury, the defendant has
the right under the Fifth Amendment not to give self-incriminating
testimony. However, the prosecutor can call the defendant to testify
and require the defendant to assert the right on a
question-by-question basis, which is prohibited in jury trials unless
the defendant has voluntarily testified on his own behalf."
A meandering writeup of the 5th ammendment at
"If the government gives an individual immunity, then that individual
may be compelled to testify. Immunity may be "transactional immunity"
or "use immunity"; in the former, the witness is immune from
prosecution for offenses related to the testimony; in the latter, the
witness may be prosecuted, but his testimony may not be used against
him. The Supreme Court has held that the government need only grant
use immunity to compel testimony. The use immunity, however, must
extend not only to the testimony made by the witness, but also to all
evidence derived therefrom."
So it would seem then that granting immunity to you to divulge your
passwords should protect you from anything found. This is probably the
most likely scenario if you are asked to provide (non-existent)
evidence against a Tor user and you have asserted your rights up to
the point of a court hearing. If you make the mistake of divulging
passwords/data to an officer before immunity was granted, you're
Ah, thanks for the clarification. At least there is some check though.
I should also add that they will probably tell you that if you just
let them see what they want, you can be out of there much quicker.
They usually will also ask you why you have anything to hide. This
has happened to friends of mine. It makes it very hard to say no to
search or interrogation.
In our case, the best response is "What you claim to be looking for is
not recorded by Tor. Furthermore, I have a lot of personal material on
that computer such as emails, pictures of my significant other, and
other private material that I do not believe you have the right to
look at simply because you want to. I would like to speak with a
A more general response probably would be something like "I resent the
idea that the police should be allowed to look through my personal
belongings simply because I have nothing to hide. I find this
offensive, and I feel it violates me personally. I do not consent to
I do not think that Tor operators really have to worry about the
government using the full powers of the Patriot Act against us. The
amount of effort (and monetary expense!) required to do so simply does
not make sense, particularly because it accomplishes so little in the
context of a legitimate investigation against a Tor user.
Key word being legitimate.
I agree that the Patriot Act is a horrible thing, and makes an
excellent tool for the government to use to silence opposition. But I
like to think that Tor is a high enough profile project, and that the
administration is so completely unpopular now that a full
roving-wiretap, sneak and peek search, wireless keylogger, laser-mic
surveillance, CIA mind control attack on a Tor operator would be
political suicide, and would only serve as further example to the
unconstitutional nature of the act. At least this is how I sleep at
night ;)
The main danger is exactly what happened here. Some local cops show up
and try to take a machine and get you to provide data/keys because
they do not understand what Tor is or how it works. This is the
situation everyone who runs an exit node should be prepared for, and
should mentally rehearse.
As a preemptive measure, I have placed a form of disclaimer on my exit
node. It is at  So far I have recieved
minimal complaints (only 2 - one turned out to be a mistake, and
the other was IRC spam). But my share of the tor bandwidth is very
small (40-60k/sec).

@_date: 2006-05-15 22:37:24
@_author: Mike Perry 
@_subject: Some legal trouble with TOR in France + 
Thus spake Ringo Kamens (2600denver at gmail.com):
The other issue is why is law enforcement energy being wasted at
targeting people who *look* at child porn instead of those who
actually provide the porn - or worse, create the porn.
While all three groups of people are unquestionably sick, two groups
are actively engaging in the exploitation of children where the other
is just watching it like a train wreck. Since law enforcement capacity is clearly finite, you would think even
fanatical people should be able realize that if you really want to
protect children, you go balls to the wall to find or at least shut
down the PRODUCERS of the content, and stop wasting valuable resources
going after small time consumers who for all we know may actually be
less likely to harm real children if they are able to satisfy their
sick fantasies via imagination and not reality. Hell, "consumers" can
even be framed by crackers using their machines to download/store the
Targeting consumers of child porn seems to be too convienient a way to
ram all sorts of BS legislation through congress, wasting both tax and
ISP $$ in the process, and doing way more harm to the rights of
average people than to pedophiles.

@_date: 2006-05-17 12:25:10
@_author: Mike Perry 
@_subject: TOR on Academic networks (problem) 
Thus spake Tor User (toruser at googlemail.com):
I would really consider trying to make  be
instead  like Anthony
suggested. It shouldn't have to be a very fast IP, since I would guess
journal accesses though your node would be infrequent.
Consider the case where someone needs to do anonymous research using
one of these journal sites, has obtained a pay acccount (or simply
uses bugmenot.. for a while bugmenot had a few Lexis academic accounts
available and may still get new ones on occasion), but then hits your
goofy warning page. It is a massive inconvienience for this person to
have to manually find another exit that might work, or to list your
node as an ExcludeNodes...
At the very least the warning page needs to provide very clear,
newbie-ready instructions, and probably also a link to a torrc they
can download that blocks your exit node from being used (along with
clear instructions on where to put the file).
Still, I would also agree that rejecting *:80 would be the best until
this IP as authentication issue is resolved.

@_date: 2006-05-18 19:03:02
@_author: Mike Perry 
@_subject: Speak of the Devil 
British govt just started pushing for Part III of RIPA citing
terrorism and kiddie porn as major reasons to require people to
disclose encryption keys...
Seems we may have a strong ally on our side on this one. International
bankers might not want the local police requiring them to hand over
keys either, though they certainly have enough political influence to
stop investigations before they start I'm sure...
The UK Crypto thread that spawned this article is here:
One can only hope that the Bill of Rights is enough to keep this
bullshit out of the US, but who knows.

@_date: 2006-05-20 06:53:02
@_author: Mike Perry 
@_subject: Disclaimer Update 
So I was doing some research into the EFF vs. AT&T case because it's
happening right in my backyard and it's fascinating as all get-out,
and I came across 18 USC 2707 (of the ECPA):
This seems to state that if a server or traffic is seized without
good faith and probable cause (and a warrant) that the owner of that
server has civil avenues of remedy against the government ($1000/email
account + legal costs).
Since several friends of mine have email accounts on the machine that
also runs my Tor node, it would seem this is applicable here. I
updated my disclaimer at
 to reflect this, as well as to better identify a Tor node for what it
is (as far as the law is conerned): an Internet router just like any
other, except that it does not maintain the source address of packets.
Based on these grounds, it would seem that what happened in France
should be pretty impossible in the US, at least legally, since
probable cause should not exist.
But as we know, the US government doesn't seem to be too fond of
following the law anymore. So there's always that element of risk.
I suppose they probably will try to claim in EFF v AT&T that they DO
have probable cause to tap the Internet traffic of the entire
west coast... But of course that claim is classified, so none of us (nor
even EFF) will get to see it. Genius and insanity oft go hand in hand.

@_date: 2006-05-20 16:46:00
@_author: Mike Perry 
@_subject: Disclaimer Update 
Thus spake Watson Ladd (watsonbladd at gmail.com):
Oh yeah, I'm very much aware of this. This is what I was referring to
in the preceding paragraph (the last paragraph of my post). The cases
listed in
are quite horrifying indeed (esp Maher Arar and Sibel Edmonds).
It would seem that they could not in good faith make the claim that
their search would yield evidence sought against a Tor node, even
(or especially) after the fact.
I agree that the insanity of secrecy surrounding the courts
essentially means that you cannot expect to make such an argument
after the fact anymore and have any guarantee that it will be heard
properly, because the government seems to be just using secrecy to
conceal neglegence and incompetence now. So I think the best course of
action is to try to make the argument first in public, before it
escalates into secrecy and you disappear.

@_date: 2006-05-20 18:26:28
@_author: Mike Perry 
@_subject: Disclaimer Update 
Thus spake Mike Perry (mikepery at fscked.org):
So it occurred to me that the government could just begin claiming
that they believe that the Tor operator themselves is simply using Tor
to conceal the fact that they are really an international kingpin in a
terrorist kiddie porn ring directly connected to Osama and Saddam (who
as we know, are great friends).
I think this argument can be dismissed by the fact that Tor relays all
traffic. So inbound traffic should roughly equal outbound traffic, the
only exception being the amount of traffic devoted to directory server
mirror lookups.
On my node, the directory server traffic seems to be relatively minor,
and outbound and inbound traffic on port 443 (the tor server port) are
in fact pretty close to equal (though inbound does exceed outbound
slightly, probably due to drops from the fact that I am on an ADSL
line?). Is this the case for everyone who is not an authoritative
directory server?
Note I am still running 0.1.0.17 on my node..

@_date: 2006-05-22 20:04:08
@_author: Mike Perry 
@_subject: Threats to anonymity set at and above the application layer; HTTP headers 
Thus spake Anothony Georgeo (anogeorgeo at yahoo.com):
This has all sorts of issues with certificate verification and so on.
Not to mention that I think that any sort of user configurable
scrubber is not going to be used effectively by more than 1% of the
population (if even that). Hell, I don't understand privoxy's
configuration to the degree I'd feel safe relying on it by itself
and I'm a programmer.
The only way to do this is via extensions to the browser. That way you
do not interfere with CRL/OCSP for true cert verification (which sadly
seems very broken in Firefox currently) and it makes it easy to switch
components on/off if something doesn't work because one of your
filters isn't quite right. And you get SSL for free, because your
extensions see the web data AFTER the browser has performed (optional)
rigorous checks to make sure the cert has not been revoked or
otherwise compromised/spoofed.
I really think that we desperately need an intelligent proxy selection
mechanism such as Eric Jung's FoxyProxy (so long as it properly
isolates cookies for each proxy and does the proxy filtering on a
per-tab basis as discussed previously). Combine this with NoScript,
Adblock, and a user agent switcher, and I really don't see any reason
for privoxy anymore (except to remove maybe a stray HTTP header here
and there, but since those aren't logged, that may not be needed).
It sucks that we lose browser independence with this mechanism, but
thems the breaks. They should all should be compatible with xpi
anyways ;)

@_date: 2006-05-12 16:10:02
@_author: Mike Perry 
@_subject: Mike Perry's FoxyProxy concerns with Tor 
Thus spake Eric H. Jung (eric.jung at yahoo.com):
So in the process of my composing this email it seems ganba has posted
pretty much the same thing in that forum post, but what the hell.
URLs should be viewed as being a seperate problem from cookies. I like
this cookie solution a lot, esp if it is easy to edit/purge the
cookies for each proxy seperately. The solution becomes truly awesome
if you are able to define collections of cookies as selectable "nyms"
under each proxy, but I could see the interface for this becoming
URLs however should be rigged so as to load in the current proxy for
that page, be they frames, css, js, image links, flash objects, java, ftp,
gopher, or just plain http links that the user clicked on. This
corresponds to the "page action problem" ganba mentions. The problem
extends to the loading of multiple pages concurrently under two
different proxy rules. You need to make sure there are no concurrency
problems with either URLs or cookies.
Again, so long as encoded URLs are loaded with the same proxy settings
as the parent page, I believe that the URL problem is solved (even if
they do happen to encode cookie values).
I (and I'm sure many others too) am really glad you are working on
these problems. I think it is a very important practical step towards
real privacy on the web for the average user. A big thank you from
those of us who wish they had the time to offer to help!

@_date: 2006-11-13 19:32:59
@_author: Mike Perry 
@_subject: still slow browsing 
Thus spake gabrix (gabrix at gabrix.ath.cx):
I assume this was supposed to be in reply to my message. If you
produce a port-based one please repost and/or post on the wiki. That
may be useful to more people than my IP based one.

@_date: 2006-11-16 05:06:45
@_author: Mike Perry 
@_subject: ff 1.5.0.7 & 2.0 (remote) dns leaks when using tor 
Thus spake lester psigal (lesterpsigal at yahoo.de):
Well, just so you don't feel that everyone is ignoring you, I'll voice
most of our reactions: *shock*, *eyes popping*. Woops, time to turn
privoxy back on (use HTTP proxy port 8118 and don't list anything in
the SOCKS line).
Were you able to determine exactly what network.proxy.failover_timeout
governed? Was it just DNS? Did it have any effect at all on the
behavior? Perhaps the units are miliseconds. Sometimes Tor takes as
long as a minute to build a new circuit...
It would be logical if either 0 or -1 meant infinite.. Did you try

@_date: 2006-11-19 17:05:26
@_author: Mike Perry 
@_subject: ff 1.5.0.7 & 2.0 (remote) dns leaks when using tor 
Thus spake lester psigal (lesterpsigal at yahoo.de):
Yeah, like others have said it is most likely some extension you are
running. Maybe google toolbar, yahoo toolbar, something of this nature
that interacts with each page? I tried watching Torbutton and
socks-only and got no DNS leaks w/ ff 1.5, no matter what my timeout
settings were. I did get a few "Try Again" timeout messages from
firefox, but no leaks.

@_date: 2006-11-27 21:59:06
@_author: Mike Perry 
@_subject: False certificates 
Thus spake Christian Kellermann (Christian.Kellermann at nefkom.net):
Yeah, I'm still working on it. Got blocked by holidays + having to
review a large amount of Tor source code to do things properly. I'm
trying to do some reliability checks as well for Tor nodes, so I've
been slacking a little on scanning at the moment.  Was hoping to get
some hints from the tor devs, but they were probably similarly
occupied with holiday matters.
Probably best if I review all the source myself, but that is going to
delay things considerably.. I should be able to get a simple
exit scanner back up and running in the meantime though.

@_date: 2006-11-28 18:52:29
@_author: Mike Perry 
@_subject: False certificates 
Thus spake force44 at Safe-mail.net (force44 at Safe-mail.net):
Confirmed (I've found an alternate machine to do dev on, so I should
be able to continuously scan now). Bach is self-signing certs still,
and not just for e-gold.  It is also likely the culprit as opposed to
an upstream ISP, since the CN name is "bach".  Based on this, I'm
guessing they're not intending to stop anytime soon.
Is there any way to manually de-list this as an exit in the tor
directory servers while we develop a way to integrate this automated
scanning solution?
Having everyone add this node into their ExcludeNodes is not
practical. There should be some way for the Tor maintainers to
override supplied exit policies for misbehaving nodes. Or is the plan
going forward just to tell everyone to upgrade to alpha and have it
listen to the BadExit flag? Can this be set manually right now?

@_date: 2006-11-28 19:56:41
@_author: Mike Perry 
@_subject: False certificates 
Thus spake Roger Dingledine (arma at mit.edu):
Heheh, I guess this goes in the "never blame conspiracy when you can
blame incompetence" column. Damn, it's so much more exciting to find
malicious nodes ;)

@_date: 2006-11-12 17:20:42
@_author: Mike Perry 
@_subject: still slow browsing 
Thus spake gabrix (gabrix at gabrix.ath.cx):
Well, if you're willing to sink some time into it, you can try to
follow the ADSL bandwidth shaper howto:
(Gentoo version: Unfortunately it's probbaly hard to do if you're running an exit node
and there are lots of exit ports, unless you have spare IPs and can
use one for the Tor node and one for normal traffic. This is what I
do. My script based on this howto is attached. It works EXTREMELY well
(Tor load has NO effect on normal traffic. I don't rely on
BandwidthRate/BandwidthBurst at all). The key property is that you cap your total bandwith through the box
(via the shaper) to be slightly lower than your link bandwidth so that
your box controls the queue size and thus ordering, not your uplink
I haven't posted my script anywhere cause I figured that having a
spare IP for your Tor node is probably pretty rare. However if you are
not an exit and thus only have one port for Tor traffic, it should be
readily adaptable based on port instead of IP.

@_date: 2006-10-13 23:20:41
@_author: Mike Perry 
@_subject: Snakes On A Tor Scanner - 0.0.3 
Over the past month or so I've been testing and improving my Tor
network scanner, and it seems to be shaping up pretty nicely.
As a quick refresher, the scanner consists of two parts:
The Metatroller:
   A Tor Controller that allows you to customize properties of your
   Tor routes. You can control path length, exit country, "fast node"
   cutoff, and lots of other neat things.
Snakes On A Tor:
   A Scanner that uses the Metatroller to scan the network for nodes
   that are unstable and/or modifying exit traffic. Docs are now
   obtained randomly from google queries.
Metatroller will work in ActivePerl on Windows without any other
dependencies, however SOAT will require curl, md5sum, and openssl. I think SOAT and Metatroller are in good enough shape that they
should make for good QA tools for Tor to help reduce circuit failure,
and also useful tools for people who would like to monitor the Tor
network. I'm also suspicious of the 7/8 node cutoff for "fast" nodes.  I think
that perhaps it should be raised to 65% or so, but I have no hard data
as of yet to illustrate this cutoff point. Since adoption is critical
to anonymity, and regular people won't use Tor if they think it is
slow, I believe it is far more imporant that we have known reliable,
fast nodes than lots of slow ones that are prone to dropping circuits.
Hopefully we can discover these cutoffs using this tool.
Here's the CHANGELOG for 0.0.3:
 Metatroller:
  - Now gets its node list directly from Tor using the control port
  - Implemented guard nodes
  - Added circuit/stream failure statistics
  - Improved reliability/recovery from circuit and stream failures
  - All commands can now take no arguments to print current value
 Soat:
  - obtains its doc list via google filetype queries
  - verifies this list contains no dynamic content
  - Saves long-term aggregate failure stats from metatroller
I've given Roger and Nick some patches to expose circuit failure
reason codes to the controller. I think part of these made it into
0.1.2.2-alpha, and hopefully the rest will be in 0.1.2.3. Metatroller
does not need these reason codes to record failures, but it is more
accurate if they are present.
Here's the current list of Metatroller commands:
214  COUNTRY 214   - Pick a two letter country code to select exits from, or ALL
214  COUNTRIES
214   - List countries that have tor exits
214  PERCENTFAST <
214   - What % of the network is considered 'fast' for node selection
214  BWCUTOFF <
214   - Minimum observed bandwidth (KB) that a node must have to be selected
214  UNIFORM <1|0>
214   - Should selection among fast nodes be uniform (or bandwidth-biased)?
214  ORDEREXITS <1|0>
214   - Should exits be chosen one after another instead of randomly?
214  FASTEXITS <1|0>
214   - Should exits be chosen from 'fast' nodes or all nodes?
214  GUARDNODES <1|0>
214   - Use guard nodes?
214  PATHLEN <
214   - What should the path length of circuits be?
214  NEWEXIT
214   - Throw away all circuits and choose a new exit
214  SETEXIT 214   - Hardcode an exit for all future circuits
214  GETLASTEXIT
214   - Lists the last used exit
214  FAILRATES
214   - Print out the failure rates of nodes
While it is still not advisable for you to use SOAT on a machine you
wish to preserve your anonymity with, Metatroller is perhaps not as
dangerous as I thought.
I've looked into the Tor source, and it turns out that in some cases
Tor does make circuits out of low-uptime nodes. With that, and the
addition of Guard Nodes to Metatroller, it is perhaps not nearly as
dangerous as I had originally thought. The main dangers revolve around
PATHLEN and PERCENTFAST, and are explained in the README.
I believe normal usage should be comparable to Tor in safety at this
point, though there are a couple of attractive fixes in 0.1.2.x I
would like to adopt.
Plans for the future include more finer-grained failure statistics,
node max/min/avg bandwidth stats, and possible integration with the
directory servers to help avoid unstable/malicious nodes (or at the
very least, an internally saved blacklist for high failure-rate
Also, the metatroller currently does not subscribe to router info or
(non-existent) network status events, so it should be restarted
periodically. When network-status events are available in 0.1.2.x I'll
support them.

@_date: 2006-10-14 15:40:12
@_author: Mike Perry 
@_subject: Snakes On A Tor Scanner - 0.0.3 
Thus spake Mike Perry (mikepery at fscked.org):
Found another DNS poisoner/injector/evil upstream ISP. Exit node
Andrewgao poisoned the scanners access of
to give me instead:
Seems to be a javascript popup to set a cookie and then close the
window. Seems to be slightly broken (the window is never closed for
me), but the scary thing is if it worked, the user's experience would
be that they had accessed the page un-hindered.
Also, as an FYI, I'm exporting my scanner's failure statistics to
Right now it's probably difficult to do anything with that. I will
try to enhance it to be broken down by failure type RSN, then it should be more clear which nodes are failing circuits/streams and

@_date: 2006-10-14 18:06:02
@_author: Mike Perry 
@_subject: Snakes On A Tor Scanner - 0.0.3 
Thus spake Roger Dingledine (arma at mit.edu):
Ok, I'll try to get to this. Might be a while though. In the short
term I'm going to hack on the reason stats so we can figure out why
these circuits are failing, but perl's data structure limitations are
proving even that to be a bit too much...
Yes, but in this case Tor doesn't close the circuits when they are
old/unused, and I would have to maintain that info myself. I'm opting
for letting Tor maintain the destruction of them for me.
However, that's not the problem with concurrent SOAT+normal usage. The
problem is mainly that if you try to connect to some port where the
current SOAT exit can't connect to, a new circuit will be built and a
new exit will be chosen. Right now there is no notion of circuits in
SOAT, so it just asks for the last exit used. Hence, if you caused
metatroller to build a new circuit while SOAT was using an old one,
and there is an MD5 error for some URL, the wrong exit will be blamed
for it.
Yeah, we'll need to wait for me to do stream bandwidth statistics to
best figure this out. This may be a while out, but I thought I'd throw
it out there for consideration.
Yeah. If that shows up, I will make use of it. I'm a bit
over-committed to do this myself though.
Here's my task list:
1. Failure stats based on reason codes
2. Network/routerinfo status events
3. Node stats for stream bandwidth
4. Statstics on reasonable cutoff %-age
5. Not get fired from my day job A "Rewrite in Python" task may be inserted in there anywhere from 0-5,
depending on how many brick walls perl presents.  alone is getting
extremely annoying because of limitations on thread-shared structures.
Due to Task 5, other tasks may experience arbitrary delays ;)

@_date: 2006-10-15 13:59:00
@_author: Mike Perry 
@_subject: Snakes On A Tor Scanner - 0.0.4 
Thus spake Roger Dingledine (arma at mit.edu):
Ok, I've got a new release up with this fix and some others. No more
torrc editing needed.
 Metatroller:
  - Failure stats based on reason codes
  - Sets __LeaveStreamsUnattached via controller. No config needed
    anymore.
 Soat:
  - Fixed counting bug (ratios were OK, but errors+connects were
    counted multiple times)
  - Saves REASON statistics from Metatroller   - Changed scanning node selection to be fully uniform for both exits
    and other hops
Reason-based statistics are now exported to:
The first number is the failcount for that type, the second one
is the total failcount, and the third is the total circuits
made via this node.
For reason statistics, it reasontotal/totalfailed.
For The first number is the total failcount, and the second is
the number of circuits made via this node.

@_date: 2006-10-16 15:25:56
@_author: Mike Perry 
@_subject: hijacked SSH sessions 
Thus spake Taka Khumbartha (scarreigns at gmail.com):
Interesting. Could be another upstream chinese ISP, or DNS poisoning
again. Were you using SOCKS4A/SOCKS5 or did you connect direct to an
I just wrote a scanner for this for SOAT and have been scanning for an
hour or so now. Haven't seen it yet, but I'm using tsocks so if they
did it with DNS, I'm not gonna see it yet.. Or perhaps they saw your
mail and shut 'er down. I'll keep scanning though.
Anyone know a clever way to get a random sampling of ssh hosts
without brute-force IP scanning? I don't need logins, just IPs.

@_date: 2006-10-17 02:27:34
@_author: Mike Perry 
@_subject: hijacked SSH sessions 
Thus spake Taka Khumbartha (scarreigns at gmail.com):
Hrm. Guess it wasn't random DNS redirect then.
Well either they must have been scared off, or I'm blind. Cause
I'm not seeing this now. Been through almost every exit node in the
directory a few times now..
Probably actually malicious though, since I don't think China would be
intimidated by some posts on the Tor list ;)
Please post if you notice it again.

@_date: 2006-10-18 00:58:30
@_author: Mike Perry 
@_subject: "Practical onion hacking: finding the real address of Tor clients" 
Thus spake Jacob Appelbaum (jacob at appelbaum.net):
Wow. I think the most telling statement is that most of the people
they got were from China. Probably unfortunate side effect of most of
the Tor docs being in English..
Incidently, I tried out TorPark the other day, and I must say it is
pretty magnificent. Having a well-configured browser like that for Tor
usage solves nearly every one of these problems. Would be nice if NoScript defaulted to All-Off instead of All-On, and
they used AdBlock Plus with some feeds instead of just AdBlock, but
otherwise excellent for casual "only sometimes" Tor users who are
likely to be tripped up by this sort of stuff.

@_date: 2006-10-18 12:47:51
@_author: Mike Perry 
@_subject: "Practical onion hacking: finding the real address of Tor clients" 
Thus spake Chris (millions.of.stones at gmail.com):
We're working on it. I'm running a multi-purpose scanner right now
(see Snakes On A Tor threads in the archives), but results still have
to be sifted through manually, no automatic directory integration yet.
It's not easy to do this automated and be right all the time,
especially in the face of changing content and dropped
connections/truncation. Probably will end up having the script email a
human/humans with results that they can verify.

@_date: 2006-09-02 17:21:56
@_author: Mike Perry 
@_subject: Holy shit I caught 1 
Thus spake Roger Dingledine (arma at mit.edu):
There is another subtle problem with this.. For sites that provide the
login form via plain http and then submit via https, a MITM can
rewrite the POST form to submit anywhere they have a "valid" CA-signed
CERT (which as we've established costs the attacker $25 and a pay
phone  Since this submission can go to ANY domain, it's much easier
to spoof a valid cert this way without a browser warning.
It's scary just how many banks, email providers (yahoo), and other
sites try to make things "easier" by providing the login on their
front (non-https) page. Trial by fire...
You should only use login forms on https pages. Especially via Tor.

@_date: 2006-09-02 17:21:56
@_author: Mike Perry 
@_subject: Holy shit I caught 1 
Thus spake Roger Dingledine (arma at mit.edu):
There is another subtle problem with this.. For sites that provide the
login form via plain http and then submit via https, a MITM can
rewrite the POST form to submit anywhere they have a "valid" CA-signed
CERT (which as we've established costs the attacker $25 and a pay
phone  Since this submission can go to ANY domain, it's much easier
to spoof a valid cert this way without a browser warning.
It's scary just how many banks, email providers (yahoo), and other
sites try to make things "easier" by providing the login on their
front (non-https) page. Trial by fire...
You should only use login forms on https pages. Especially via Tor.

@_date: 2006-09-04 16:39:06
@_author: Mike Perry 
@_subject: (FWD) Re: Something Strange Happens to google when Tor is enabled 
Thus spake Roger Dingledine (arma at mit.edu):
Actually, this has never worked for me... However what does work is
changing the action line to be google.ca, google.us, or - action="
+ action="

@_date: 2007-03-31 22:24:11
@_author: Mike Perry 
@_subject: Securing teh Intarwebs (Ultimate Solution ;) 
Thus spake Mike Perry (mikepery at fscked.org):
No, this is stupid. The adversary can just walk the DOM and look for A
tags. You have to be pro-active and walk the whole DOM first yourself,
and strip the attributes off of each A tag as you find it.
Or, perhaps getting the history clearing thing to work is the real
Ultimate Solution. You can use fileio in javascript to read
history.dat (see jshooks.js), but the main issue is file locking on
windows may prevent you from writing it out again since it appears firefox
never actually closes the file. It's worth a shot though. Perhaps they
don't lock the file while they have it open, and maybe they seek to the
beginning of it each time they read it out...
Ok, I promise I won't reply to myself any more. ;)

@_date: 2007-03-31 23:18:34
@_author: Mike Perry 
@_subject: Securing teh Intarwebs (Ultimate Solution ;) 
Thus spake light zoo (lightzook at yahoo.com):
Was going to wait 2 hours to answer this, but what the hell, it's
already tomorrow according to my Torbutton extension ;). Happy new
The key to Illumination is not so much what you eat, it's more so what
you don't eat. First, you have to purge your diet of all processed
foods and chemical additives. This is the first step in freeing
yourself from the stranglehold of poor health inflicted upon the
masses by the Dark Illuminati in order to better subjugate them. Right
now I'm drinking a nice tall glass of unpastuerized, unhomoginzed
milk. Yum.
Once you purify the body it is time to purify the mind. This is
accomplished by staring Death in the face. Only by realizing that when
you die, your existance is no more than the set of desires you
manifest at the moment of death, are you able to achieve immortality.
Write your 5 core personal values on a sheet of paper right now! Do
not hesitate. Now burn this paper. This is the secret of the Dali Lama
and the key to immortality. Use it well.
Once the mind is clean, it is time to purify the spirit. Every week
for N weeks or until you get bored you must devote yourself fully to a
new diety. Yin, Yang, Yaweh, Allah, Gozer, Baphomet, Chaos, Chronos,
Eros, Erebus, Nyx, Bob, Xenu, Yoda, and Lord Sidius are all excellent
choices. Once you realize the power of devotion is not to pray to a
god, or beg them to help you, but instead to channel their Force
through you to affect change in the world, you unify with that diety,
and are thus enlightened in selfless pursuit of the one Unifying
Force: Change.
That's it. That's all you need to know. I hereby dub you Illuminated.
You shall now henceforth be known as Sir Renegade Buddhist Light Zoo.
Watch out, the inmates are running the asylum.

@_date: 2007-04-18 21:13:30
@_author: Mike Perry 
@_subject: My ISP block Tor Servers 
Thus spake Koh Choon Lin (open07 at gmail.com):
Heh. This reminds me of a lawfirm one of my friends used to work at.
They told me when they tried to visit my website the content filter
denied them with that same message: "Criminal skills". Never did get a
copy of the censor page though. This was in the USA.
Content filters are awesome.

@_date: 2007-03-31 18:21:35
@_author: Mike Perry 
@_subject: Securing teh Intarwebs (Ultimate Solution ;) 
Thus spake Mike Perry (mikepery at fscked.org):
UNKNOWN ISSUES (AKA HELP PLZ!):
If there are any javascript gurus on the list (or if anyone has the
time to do the research to become one, it doesn't take that long and
is the path to Real Ultimate Power ;), we need to consider if there
are any other javascript issues that we should be concerned about. Researching techniques on  is a good place
to start.  and
 can't hurt
Obviosuly all sorts of AJAX/XMLHttpRequest stuff can be done by exit
nodes to steal your sessions and such, but they can do that with plain
old cookies anyways. Presumably for anything that matters, you either
use https, disable js, or don't use that site.
Interestingly enough, Tor DOES protect you from JS doing crazy things
like reconfiguring your router and portscanning your intranet (yes,
this CAN be done), since JS will always use proxy settings (modulo
browser vulnerabilities). So hey, we can claim we do in fact provide
some added security! ;)

@_date: 2007-03-31 21:13:31
@_author: Mike Perry 
@_subject: Securing teh Intarwebs (Ultimate Solution ;) 
Thus spake Mike Perry (mikepery at fscked.org):
The long-standing firefox bug is:
It should be noted that the reason commonly given for not fixing is
that they don't care about specific URLs being queried and would
rather have styles work properly (why not have both? Obviously they
haven't heard the phrase "Ultimate Solution" :). However Billy
Hoffman's talk at shmoocon pointed out that you can query 10s of
thousands of urls per second on a fast machine, more than enough to
troll for permutations of google keyword searches.
This is probably also worth investigating:
That technique uses CSS to fetch background images for visited links.
Bear in mind that images probably can be encoded with unique IDs by
exit nodes, so this probably is relevant. It is posisble to enumerate and edit CSS stylesheets using javascript,
so perhaps this can be eliminated with an additional hook in
jshooks.js as well, but there may be issues with getting an event
handler that fires at the right time. You can find archives of me
harassing the mozilla extensions people about event handlers at:
Also, it appears that we also need to hook
somehow (perhaps by hooking getComputedStyle and clearing all
properties for its return value if it is an "A" tag like I do with
document.getElement*, or possibly by hooking the getPropertyValue
method on the returned object) in order to defeat
This technique does not seem to work on FF2.0.0.3:
Sorry I don't have time for this stuff right now, it is really
interesting and I wish I could do it. I should have more time in ~1
month (unless I discover one of these to be particularly low hanging
fruit and have some downtime on a train one day).

@_date: 2007-02-19 14:37:35
@_author: Mike Perry 
@_subject: Removing 1 modular exponentiation 
Thus spake Watson Ladd (watsonbladd at gmail.com):
Well, one immediate problem is that b/k has to be an integer.. So b=rk
for some random r and b is thus not completely random.. To clarify the
effects of this, you should rewrite your protocol as follows from
Round 2 on:
Round 2: Ricky picks positive integer b=rk. Let h=g^b = g^rk = y^r
Key calculation: Ricky computes the session key as s = f^r = y^ar = g^kar.
Alice computes the session key as s = h^a = g^ba = g^rka
All is well and good until Echelon Eve drops in for a spell. Having
recently upgraded her interception points to both evesdrop AND inject
traffic, Eve has her way with Ricky and Alice in the following racy
3-way secenario (hide the kids):
Alice and Eve:
R1: Alice picks her f=y^a
Alice sends to Ricky, intercepted by Eve.
R2: Eve picks a random number e. Let h_e=y^e. Sends to Alice
Key caluclation: Eve computes the session key as s=f^e=y^ae
Alice computes the key as h_e^a=y^ea
Eve and Ricky:
R1: Eve picks her f_e=y^v
Eve sends to Ricky.
R2: Ricky picks his random number r. let h=y^r=g^rk. Sends to "Alice" (Eve)
Key calculation: Ricky computes the session key as s=f_e^r=y^vr
Eve computes the session key as h^v=y^rv
Eve then happily relays traffic for Alice and Ricky. The fundamental problem is that all you've done is created a new (yet
equivalent) generator y for the exact same group G (since the group is
finite, cyclic and of prime order). Thus the same MITM authentication
problems with DH still exist, our demonic overlords win, begin reading your "improved" Tor traffic, and start executing whistleblowers
for exposing their satanic sex rings again. :(
Plus a few kittens probably die too.

@_date: 2007-02-19 15:58:16
@_author: Mike Perry 
@_subject: Security concerning Tor, BitTorrent and Firewall 
Thus spake a a (werner12345 at hotmail.com):
This is extremely unlikely. Most firewalls create holes for outgoing
TCP connections based on tuples of (IP dest, IP src, TCP dest, TCP
source). Unless your firewall is braindamaged, Tor should not open
incoming holes for bittorrent, since Tor only connects to Tor IPs and
ports for that first hop (which is all your firewall will see). (UDP is a different story, but neither Tor nor bittorrent use UDP).
One way to verify if your firewall is braindamaged is to download the
utility wireshark ( and start it up.
Once it's running, the following filter will show you all INCOMING TCP
connections to the machine running bittorrent:
(tcp.flags == 2) && (ip.dst == 192.168.0.XXX)
Replace 192.168.0.XXX with your bittorrent machine's IP.
You should see no packets other than for other holes opened in your
One alternate way your firewall could be broken is that it is allowing
UPNP (or Apple's equivalent.. forget its name). UPNP is used by client
applications to negotiate ports to open on the firewall. If your
bittorrent client supports UPNP and has it enabled, and your firewall
has it enabled, holes will open automatically independent of Tor.
You can also tell your dad that you are probably just as vulnerable
with just a single fixed (non-UPNP) port open for bittorrent as you
are running bittorrent with outgoing connecitons. So long as nothing
other than bittorrent listens on that port, the only thing exploitable
via that port should be bittorrent, and bittorrent is already
exploitable via traffic travelling over the outbound connections it
made (though outbound connections aren't visible to people scanning
your IP for exploitable clients).
It's likely, see above ; ) It certainly should have nothing to do with Tor unless your firewall
manufacturer is really really dumb (not very likely).
Very few sane people shoot down public discussion exploring
exploitation. The only way systems can hope to remain secure is if the
net IQ of people securing them exceeds that of those attempting to
break them. The only way for this to happen is public oversight and
discussion (ESPECIALLY of exploits involving closed-source systems -
closed-source companies have finite and small IQ compared to the rest
of the world). Unfortunately, fewer and fewer people in control of systems and law
are sane these days. So the world is about to get mighty interesting ;)

@_date: 2007-02-19 17:07:47
@_author: Mike Perry 
@_subject: Removing 1 modular exponentiation 
Thus spake James Muir (jamuir at scs.carleton.ca):
My abstract algebra is a bit rusty, but isn't finding this value as
hard as the DLP?
Problem is: (g^X)^k = g for some given k. Find X equivalent to 1/k.
Rewrite as (g^k)^X = g
Seems like you need to take the Discrete Log of both sides to get your
X=1/k value. This is hard.
Perhaps you are thinking that g^(b/k)=g^b*g^(1/k).  But it doesn't, it
is (g^b)^(1/k).
If I'm wrong, please enlighten.

@_date: 2007-02-19 17:30:17
@_author: Mike Perry 
@_subject: Removing 1 modular exponentiation 
Thus spake James Muir (jamuir at scs.carleton.ca):
Doh! You're right. The kittens are saved! (For now)

@_date: 2007-02-19 17:33:34
@_author: Mike Perry 
@_subject: Removing 1 modular exponentiation 
Thus spake Mike Perry (mikepery at fscked.org):
Oh wait, heh, this is an extra modular exponentiation hidden in the
f^(b/k) step then. The kittens have been put in jeopardy for nothing! ;)

@_date: 2007-02-19 22:01:41
@_author: Mike Perry 
@_subject: Removing 1 modular exponentiation 
Thus spake Watson Ladd (watsonbladd at gmail.com):
Ah, right. My proof should still apply because even though b/k is not
an integer, it can still be written as b = r*k mod p. r is the
exponent of g you get when you do (g^b)^(1/k) after finding (1/k) mod
p using the Eucliean Algorithm as James pointed out. Right?
It's all coming back to me now (maybe). ;)

@_date: 2007-02-21 15:09:33
@_author: Mike Perry 
@_subject: Running Tor on a v-server with limited number of TCP sockets 
Thus spake Stephan Walter (stephan at walter.name):
Actually, it probably is as bad as that. Each time accept() is called
on this server socket to handle a new SSH connection a new socket is
formed.. Unless their limit has a special exemption that they coded
themselves for accept().. But most likely its some garbage usermode
Linux thingy with ulimit -n set on the usermode linux process.
On the plus side, if they did code this exception for accept(), it
should apply to Tor as well, at least for incoming connections to the
OR port.  Eventually most routers should connect to you, and Tor will
just use those OR connections (though they may get closed if no
circuits are on them.. not sure about how long Tor keeps idle OR
connections open).
However, my scanner (if it ever works :) probably will end up flagging
your node as unreliable.. But you've got a while before that actually
means anything.

@_date: 2007-01-12 14:44:38
@_author: Mike Perry 
@_subject: Block directory authorities, is it possible? 
Thus spake Pei Hanru (peihanru at gmail.com):
If the problem right now is just IP blocking you can try the tor
option HttpProxy which will route your dirserver traffic through an
http proxy you specify. Unfortunately, certain areas have begun
blocking by the /tor/ url postfix that dirservers use, independent of
IP. There is an option in 1.2.x/SVN to tunnel this traffic via other
tor nodes (via SSL), but I believe it is prone to exploding at this
point in time.

@_date: 2007-01-02 15:29:12
@_author: Mike Perry 
@_subject: Tor and Thunderbird: Outgoing Email Unsafe? 
Thus spake Paul Syverson (syverson at itd.nrl.navy.mil):
Hmm, maybe a middle ground might be to make note of which SMTP servers
are authenticated and operate on an SSL port, and provide such a list
on the wiki so that node operators can consider writing specific exit
policy lines for just those SMTP servers' IPs.

@_date: 2007-01-25 18:11:34
@_author: Mike Perry 
@_subject: tor and p2p 
Thus spake Robert Hogan (robert at roberthogan.net):
Yeah, I'm going to say that I2P is much better suited to this than
Tor, especially when you're talking about creating a new network
anyway. For as much bashing as poor jrandom takes on this list and the
wiki, I think he deserves a bit of praise for the fabulous job of
software engineering he has done with I2P. The code is clean,
flexible, and elegant bordering on sexy. It also exports Java Socket
compatible interfaces that Java apps can readily use to be ported over
(and there are python and I think C bindings as well). This has
enabled the pretty straight-forward port of the Phex gnutella client,
the Azureus plugin, and a native I2P bittorrent client I2PSnark.
Not to mention the vast bulk of I2P performance tuning and development
effort is focused on making their hidden service-like features work
well, where as Tor only devotes minimal effort to this component,
focusing instead on relaying to the external Internet. Plus I2P has
configurable path lengths built into the GUI allowing you to sacrifice
anonymity in certain applications to boost performance (either as a
client or server).
However, as was pointed out by enigma, any P2P mix network is going to
suffer a lot more at the lack of residential upstream than normal P2P.
In fact, if you use the standard pathlen of 3, any hidden
service-style system is going to only have 1/6 of the total bandwidth
a normal P2P system would have :(
(I fear that this residential limit will likely continue to the point
where the ratio is only sufficient to get ACKS back for the downstream
channel... Doesn't anyone ever have to email/upload large files to
work or email vids to friends? Maybe there will eventually be demand for this not to take aeons...)
Yes, this is absolutely correct... In the degenerate case where there
is only 1 tor network per torrent, and you were sufficiently
inebriated enough to handwave cells into the same abstract concept as
file segments, they are the same!
Oh, and also sometimes bittorrent encrypts traffic. Plus they both
use the Internets to communicate between peers! So really there is no
difference. (Who wrote this garbage? ;)

@_date: 2007-01-02 16:17:58
@_author: Mike Perry 
@_subject: Exit ports 465 and 587 [was: Tor and Thunderbird] 
Thus spake Michael Holstein (michael.holstein at csuohio.edu):
For the Tor nodes that allow 465 and 587, have any of you seen abuse
complaints or problems with SORBS and other vigilante spam crusader
overlords? If these ports are almost always authenticated I will allow
it in my exit policy without bothering with the IP list.

@_date: 2007-01-02 21:44:09
@_author: Mike Perry 
@_subject: dietzzoo blocking popups for us? :) 
It appears the tor node dietzzoo
($7E116EDADF03F4D82215C0DBBA2640E43A78716E) is inserting some
anti-popup javascript code into pages fetched through it.
Noticed this on a fetch of The diff is attached. According to google this is pretty standard
popup blocking code used by some hosting providers...

@_date: 2007-01-03 00:30:01
@_author: Mike Perry 
@_subject: SSH key spoofing 
Deliberately breaking threading so this doesn't fall through the
cracks. Thus spake Robert Hogan (robert at roberthogan.net):
Hrmm.. My scanner seems to be getting hung on some bug (possibly one
that I'm tickling in Tor or possibly my own), so I haven't seen this
during automatic scanning yet, but I can confirm manually that
tormentor IS in fact regularly changing ssh keys. It should be
delisted as an exit ASAP.
toxischnet is currently hibernating, so its hard to say on that one.

@_date: 2007-01-05 16:42:58
@_author: Mike Perry 
@_subject: A friendly reminder to stay on topic [Re: Good reasons to use Tor etc.] 
There are actually 13 banker bloodlines. I was just reading about this
via Tor last night. You probably forgot the Merovingian. They are the
most complicated to follow and easiest to overlook. Or, more likely, you
are the antichrist and wish to conceal your bloodline of origin.
Thus spake Nick Mathewson (nickm at freehaven.net):

@_date: 2007-03-07 14:14:33
@_author: Mike Perry 
@_subject: Building tracking system to nab Tor pedophiles 
Thus spake Freemor (freemor at yahoo.ca):
Excellent post, even if slight off-topic. As suggested on IRC, I think
the Tor documentation strategy needs to be rethought. Most people
barely read the download page, let alone the reems of FAQ questions.
We've had two "attacks" now on Tor that rely on unmasking users who
use Tor incorrectly. One of them actually published a paper and had
decent results at unmasking this way (mostly Asian users who probably
can't read our english mailinglist or english FAQ), and the media
still doesn't seem to understand that these attacks are well
The Tor download page should have a concice "Things to know before
downloading" section that lists a few key points about the most easy
ways your identity can be revealed through Tor. Something like
Things to know before you download Tor:
 - Browser plugins can be made to reveal your IP.  - This includes Flash, Java, ActiveX and others.    - It is recommended that you use FireFox and install the extensions      NoScript, QuickJava, and FlashBlock to control this behavior if
     you must have these plugins installed for non-Tor usage.
 - Make sure your browser settings have a proxy listed for ALL
   protocols (including Gopher and FTP).
 - For further details, please consult the Tor FAQ.
Maybe this will stop the same attack from hitting the blogosphere
every 2 months. Even better, maybe it will stop that attack from
actually working..

@_date: 2007-03-07 19:26:58
@_author: Mike Perry 
@_subject: Building tracking system to nab Tor pedophiles 
Thus spake Paul Syverson (syverson at itd.nrl.navy.mil):
Good. Solid post all around then.
Heheh, well speaking of dreaming big, while both what you and Jason
Edwards said are great goals to have, I think we shouldn't get
distracted from "stopping the bleeding" now with a few sentences right
up front while something more elaborate is devised (or a volunteer
steps up).
The problem is if it isn't right on the download page and translated
into most languages, people will just assume they are good to go
without bothering to read the FAQ until something breaks (as Jason
pointed out). I also fall into this category with most software (even
stuff I develop for ;).

@_date: 2007-03-08 13:00:57
@_author: Mike Perry 
@_subject: Warnings on the download page 
Thus spake sy16 (sy_c16 at yahoo.co.uk):
The problem with NoScript is that it is incredibly complex, and unless
you configure it properly (which is NOT the default), it is really no
protection against an attack like Moore's. The default whitelist is
enough for him to abuse. A bad tor node can fake any host it wants.
Even worse, it is possible to THINK you are configuring NoScript
properly and make yourself even more insecure. For example, the
addons.mozilla.org people got the brilliant idea to transmit
extensions over http (even though the site itself is https). They
verify MD5s using javascript that runs on the https connection.. If
you disable javascript for them, you are downloading extensions
without any verification :(.
Unfortunately, QuickJava by itself is not enough to disable java
launched from a moore-style attack.
 actually builds the
applet html in a hidden div using javascript. QuickJava lets it
through.. On the plus side, Sun Java 5.0r10 seems to obey SOCKS for
his datagramsocket test, which is a huge surprise... Who knows if the
same can be said for MS Java.
This last point puts us in a catch-22. Personally, I think even if we
could describe to people how to use NoScript, it is going to be waay
too much of a hassle and too error prone to work reliabily for the
average user, especially as more and more sites go AJAX with no other
option. On the plus side, the author of QuickJava has also authored an
anonymity extension for anonmouse. Perhaps he would be amenable to
fixing his extension against moore's on-the-fly HTML generation.
However his email address is not listed on the author page :(
Yea, these are good ideas for a second page. But on the front page we
just want a few paragraphs that covers all the bases.

@_date: 2007-03-08 14:27:45
@_author: Mike Perry 
@_subject: Warnings on the download page (Re: QuickJava update req) 
Thus spake light zoo (lightzook at yahoo.com):
Yeah, I left a feature request for him. On further investigation his plugin seems to rely on the Firefox
setting 'security.enable_java', so perhaps he would have direct
ability in fixing this bug.. But on the plus side, maybe the fact that
this setting is under 'security' and can still be bypassed will
warrant prompt response from the Firefox team.. I'm probably occupied
for today.. If anyone wants to test this option for firefox 1.5 and
2.0 latest with moore's page please do so and post here. Note it's
hard to tell if the applet is running. You probably have to use
wireshark and filter on udp while hitting the page with tor disabled.
The udp packet is to red.metasploit.com. It is easy to see with a
filter of 'udp'.

@_date: 2007-03-08 15:56:40
@_author: Mike Perry 
@_subject: Warnings on the download page (Re: QuickJava update req) 
Thus spake Mike Perry (mikepery at fscked.org):
Err. rather he probably has NO direct ability to fix it.
 is his url (mentioned in
a previous post). Hit that with JS enabled but java disabled to test.
The more platforms + JVM combos we have the better our odds are of
someone at firefox listening to us and fixing it promptly and
correctly. It's possible the behavior of this 'security.enable_java'
flag is OS+JVM dependent. I will do what I can, but I'm probably
going to be pretty occupied for the next few days with other things.
Also, as much as we have given him shit, HD Moore does deserve some
thanks about providing an open example of all this for us to test.
That is much better than the others who have studied this have done.
(Though I do suspect he may in fact simply hate Tor, at least his
security and research ethics are intact).

@_date: 2007-03-08 19:05:49
@_author: Mike Perry 
@_subject: Warnings on the download page 
Thus spake H D Moore (torspam at metasploit.com):
Actually, I'm also curious about your on-the-fly applet tag
generation. Were you aware that it would bypass that
security.enable_java setting or was it just a general evasive thing
you did for filtering? Do you have any information if this is specific
to certain versions/JVMs or if it is a universal hack?
Have you contacted the Firefox people?

@_date: 2007-03-08 19:17:09
@_author: Mike Perry 
@_subject: Warnings on the download page 
Thus spake Roger Dingledine (arma at mit.edu):
I have a couple more points - the second browser phrase should link to
 because
otherwise it's not really easy to have a second firefox installed.
I think we should also mention that we do scan the exits to try to
verify they are behaving well, but we may miss some. While developing the next generation of my scanner I still do scan for
matching MD5s inside/outside Tor from time to time, and the next
generation scanning script itself will examine script+embedded tags to
handle odd content/URLS in dynamic pages, but the main danger though
is in people targeting small segments of the population that I do not
speak the language of to issue queries for..  Tibetan sympathizers in
China come to mind..  Well, pretty much everyone in China comes to
mind, and I'm sure there are plenty of other marginal groups this
applies to as well (other than child porn "viewers").
Scanning doesn't help Moore's point 3, but hopefully some statement of
vigilance on our part will help Tor seem a little less like a
perpetual connection through the wireless net at Defcon.. Though
unfortunately that is the level of precaution Tor users should
probably be ready to take.

@_date: 2007-03-08 20:06:18
@_author: Mike Perry 
@_subject: Warnings on the download page 
Thus spake H D Moore (torspam at metasploit.com):
Firefox 1.5.0.10 Windows, jre5.0r10. Java is kinda of dagerous in
FF1.5 alltogether (as you're aware js can actually call java classes
in that version). So perhaps they cleaned up a bunch of java/js things
in 2.0, this included. I will test tonight and report again if the
applet runs still.

@_date: 2007-03-09 01:57:19
@_author: Mike Perry 
@_subject: Warnings on the download page 
Thus spake Mike Perry (mikepery at fscked.org):
Actually, negative on this. Cookies, extensions, and bookmarks are not
transfered over, but existing plugins from other firefox installs are
still detected. We just can't seem to catch a break here.. There
doesn't seem to be any way to disable plugins once you have installed
them... The 'about:plugins' chart does have an "Enabled" column..
maybe burried somewhere is a way to disable them with extensions..
Does anyone know anything about wrting firefox extensions? How do I go
about finding these plugin enabled properties, if they even exist
outside the compiled code?

@_date: 2007-03-09 03:17:35
@_author: Mike Perry 
@_subject: Warnings on the download page 
Thus spake Roger Dingledine (arma at mit.edu):
True, just going for what I assume is the majority of our
userbase first. Especially people who are going to have difficulty
with this stuff. Was also in a rush and didn't check out the plugin
thing right away, sorry.
Couple times a week for overnight runs. Pretty much whenever I add new
functionality to the stats gatherering system I do an SSL + http scan
with the old perl scanner controlling the new python core before
The problem is the http scanner itself is MD5 based, and it does
nothing to find nodes that deliberately target dynamic content.. So
maybe I'm doing nothing of substance at this point.
Heh. I haven't had much luck with 'foolproof' anything lately. It
definitely shouldn't be anything other than in-memory. It would be
nice is Vidalia had a list of recently used exits and a list if IPs
visited for each (with some expiration time of like 5 min?) Even with Vidalia it is hard to open the network window while the
stream is still attached to your circuit. Usually by the time you
notice its long closed.

@_date: 2007-03-09 03:21:05
@_author: Mike Perry 
@_subject: Warnings on the download page 
Thus spake H D Moore (torspam at metasploit.com):
Tested on FF2.0.0.2 for Windows.. Turns out I was mistaken about the
UDP packet. It was from your technique  doing the DNS request for
the image fetch. Guess I need some sleep..
The Java disable does seem to be working. Flashblock also works
against this (though on a friend's windows machine the Flash did hang
the browser, but this doesn't seem to be happening to me now). So we at least have that going for us, which is nice.  It's a shame
the rest of the plugins are such a mess. Just tested windows media player 10 plugin, which I believe is
installed by default on pretty much every windows box.. It ignores
proxy settings. Great.

@_date: 2007-03-20 03:26:14
@_author: Mike Perry 
@_subject: Work on Tor this summer, get paid by Google 
Thus spake Roger Dingledine (arma at mit.edu):
I just whipped up a TODO and a README file for the TorFlow library, so
if you scanned this list and either didn't see anything interesting,
or just went "TorFlow, buh?" at my item and moved on, maybe it's worth
seeing if any of the stuff in and  catches your eye. The stuff
marked "not GSoC" isn't forbidden, it's just less likely that it will
involve enough pure coding to make Google happy.
But if you did see an interesting item on the list, don't let me
distract you from it. Particularly any Windows coding. The Windows
select bug, Polipo port, and the USB drive are all very imporant and
less likely to get done by the main Tor devs who are mostly

@_date: 2007-03-28 18:08:28
@_author: Mike Perry 
@_subject: Please RTM!...Re: Please don't recommend Tor Button! 
Thus spake light zoo (lightzook at yahoo.com):
Ugh, I was really trying to avoid sliding into the position of
TorButton maintainer. Between my day job, TorFlow, and setting up a
fast tor node+webhosting service, I'm not sure I can add TorButton
maintainer to this list without suffering a nervous breakdown..
What I am doing is writing a prototype patch JUST for FF2.0 to support
clearing cookies, history, disabling plugins, and hooking javascript
Date() to make it be UTC-based. After which any other support (other
versions, tweaks, etc) will be have to be done by someone else. It
will be abandonware in approx 2 days, whether I finish or not.
Speaking of which, does anyone know anything about Javascript's
prototype features or XBL hooking? I can hook Date()'s
timezone-revealing functions in a script, but it has to be done inside
a script tag in the current document it seems, which means I have to
insert it into each document's DOM that loads, and I'm not sure even
then if those methods can't be unhooked/bypassed?
Can XBL hook javascript objects? Or is there another alternative?

@_date: 2007-03-31 17:04:33
@_author: Mike Perry 
@_subject: Securing teh Intarwebs (Ultimate Solution ;) 
So I've spent the last week burried in javascript, xml, xbl, and
something pronounced "Zool". I seem to have survived, but it is quite
possible I may turn into a fire breathing demondog at any moment. Hail
The result of this mad vision quest is a new and improved Torbutton.
Based off of TorButton 1.0.4, it has the following additional features:
1. It turns off browser plugins when you click a button in the statusbar,
   and also whenever Tor is on.
2. It clears your cookies whenever you toggle tor.
3. It hooks "dangerous" javascript functions, including:
   A. The Date() object, which can reveal your timezone
   B. document.getElement* which can be used to probe CSS attributes
      to see if you have visited certain sites or issued certain
      google queries:    C. navigator.oscpu and navigator.platform, two OS revealing strings
      not managed by UserAgentSwitcher.
4. It can optionally clear history whenever tor is toggled
   (unfortunately saving non-tor history is not possible yet. Firefox
    DOES have an API to do this, but it is "not implemented").
The goal of this extension is to make javascript as safe as it can be
to use over Tor, modulo browser vulerabilities (which the FF people
will actually fix.. They seem to enjoy arbitrary sites being able to
query their history and search keywords, however.. That is a "feature").
ALPHA WARNING:
This is ALPHA software. It desperately needs someone to review it and
to try to break it. Especially the Date hooks. Those are complicated,
and feeding Date various malformed strings to parse may cause it to
generate a time with an offset from the actual time that reveals your
timezone, among other issues. I tried my best to guard against these
types of issues, but it could really use another pair of eyes. Or
Additionally, it would be nice if someone could verify that popups,
iframes, frames, and other crazy gimpy windows properly hook Date()
and disable plugins. I tested iframes and frames briefly, but I did
not test popups.
ABANDONWARE WARNING:
I am not terribly interested in maintaining this extension. Especially
not for the next month or so. However, I will consider fixing serious
bugs involving my hooks of Date(), but likely not in any timely
fashion. If absolutely nothing happens with this after a month, I will
add it to my pile of responsibilities. But I should probably find the
time to pay my utilities first. I'm really hoping Scott will pick up my
changes and continue maintaining this extension.
KNOWN ISSUES (AKA HELP PLZ!):
This extension has been tested to work on FF2.0 and FF1.5. FF1.5
unfortunately lacks a sane TabOpen event, so plugins are not properly
disabled for new tabs when they open. FF2.0 seems ok.
I tried the code snippets for FF1.5 for this from
but I was unable to get it to deliver events just for a tab, and I
eventually gave up. I am not planning on suppoting FF1.5 ever. If you
like FF1.5, please submit a patch. It's possible I was just doing
something dumb. I did only learn javascript 5 days ago :)
It might also be nice if someone changed that "J" graphic to a "P" for
plugins, and also made a button for toggling the javascript.enabled
pref (and hooked it up so it actually worked).
BRIEF EXPLAINATION OF SOURCE:
XPIs are zips of jar files that contain javascript and xml. The jar
files themselves are also zips. The javascript hooking magic is done
in jshooks.js. The plugin toggling and events for javascript are in
Good luck!

@_date: 2007-03-05 13:40:19
@_author: Mike Perry 
@_subject: pop3 and smtp over ssl [was: ssh] 
Thus spake force44 at Safe-mail.net (force44 at Safe-mail.net):
This is interesting.. According to running
 there should be about
20 nodes that exit to port 465.. The problem might be that these nodes
are slower overall, and tend to drop more circuits. If either of you
try setting CircuitBuildTimeout to like 10 in your .torrc, does it
It would be nice if there was a way to specify an additional portlist
Tor uses to prebuild a couple extra circuits for. Circuit construction
can take a really long time and maybe this option would help people
who use apps on ports other than 80 and 443. Roger/Nick,
agree/disagree? Did I just volunteer? ;)

@_date: 2007-03-07 00:18:41
@_author: Mike Perry 
@_subject: Building tracking system to nab Tor pedophiles 
Thus spake Fergie (fergdawg at netzero.net):
Will they write a ZDnet article about me when my node scanner starts
to delist his compromised exit nodes? ;)
There's of course no way that these nodes can be allowed to continue
to be exits if discovered. Any of them can be retooled into targeting
a lot more than just pedophiles, for fun, profit, or via subpoena.
He's also putting himself in an interesting position here wrt federal
wiretap law as well (as mentioned on the Tor legal faq). Though of
course, he picked a good target to pick on. The anonymous typically
have little legal recourse. Especially when you claim they all just
want child porn.
Of course, anyone utilizing common Tor best practices will not be
affected by this. (Though the one gripe I have is that NoScript allows
Java if you allow scripts.. But there are also extensions that block
Java globally - like QuickJava).
At any rate, I welcome a good open source implementation of this. If
nothing else, it will be nice to pit it against my scanner on a test
network to make sure this sort of thing can be reliably detected.
As an aside, it's recently become clear that a lot of people are using
these Internets things to transmit child pornography. Perhaps we
should just shut 'er down? Sure would be easier than actually finding the PRODUCERS of such

@_date: 2007-03-07 00:28:55
@_author: Mike Perry 
@_subject: Building tracking system to nab Tor pedophiles 
Thus spake Mike Perry (mikepery at fscked.org):
Oh, and we can also use this as an opportunity to definitively settle
once and for all the age old question of which is the superior
language, python, or ruby? He does have to waste an awful lot of lines
on "end" statements... ;)
