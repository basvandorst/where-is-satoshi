
@_date: 2007-11-29 12:13:08
@_author: Gregory Fleischer (Lists 
@_subject: Insecurities in Privoxy Configurations  - Details 
Hash: SHA1
At the end of October, updated Vidalia bundles were released that
addressed some insecurities in the Privoxy configuration in versions
prior to 0.1.2.18.  A brief advisory was posted at the time [1].
Full details and sample exploit code are now available from [2].
For those impatient to get back to debating the finer points of the
law and legal responsibilities, here is the two minute version.
Privoxy has three configuration options of interest:
  - enable-remote-http-toggle
  - enable-remote-toggle
  - enable-edit-actions
1) If the 'enable-remote-http-toggle' option is set, any client side
    technology that can generate HTTP headers can bypass Privoxy
    content filtering by adding a header of: "X-Filter: No".
2) If the 'enable-remote-toggle' option is set, then any web browser
    vulnerabilities that can spoof HTTP Referer headers can be used to
    completely disable Privoxy filtering.
For Firefox 2.0.0.9 and prior, the following HTML snippet is typically
sufficient to disable Privoxy:
3) If the 'enable-edit-actions' option is set, then any web browser
    vulnerability that can spoof HTTP Referer headers and determine the
    modification time of the 'user.action' file can modify the Privoxy
    configuration.
Most recent Vidalia bundles for Windows install the 'user.action' file
with a consistent file time.  If a user has never edited any actions,
then the time is known (usually within plus or minus one hour).  One
of the sample Privoxy filter rules includes actions that can be used
to block all web requests simply by specifying a URL value of "./".
Using Referer spoofing and the known modification time of the
'user.action' file, a malicious script could generate requests that
would completely block all user web traffic through Privoxy.
[1] [2]

@_date: 2007-10-31 10:34:18
@_author: Gregory Fleischer (Lists 
@_subject: Insecure Privoxy Configuration in Vidalia Bundles Prior to 0.1.2.18 
Hash: SHA1
Versions of the Vidalia bundle prior to 0.1.2.18 install Privoxy with
an insecure configuration file.  Both Windows and Mac OS X versions
are affected.  The installed 'config.txt' file ('config' on Mac OS X)
had the following option values set to 1:
   - enable-remote-toggle
   - enable-edit-actions
Additionally, on Windows the following option was set to 1:
   - enable-remote-http-toggle
Malicious sites (or malicious exit nodes) could include active content
(e.g., JavaScript, Java, Flash) that caused the web browser to:
   - make requests through the proxy that causes Privoxy filtering to
     be bypassed or completely disabled
   - establish a direct connection from the web browser to the local
     proxy and modify the user defined configuration values
The Privoxy documentation recommends against enabling these options in
multi-user environments or when dealing with untrustworthy clients.
However, the documentation does not mention that client-side
web browser scripts or vulnerabilities could be exploited as well.
It should be noted that using Tor is not a prerequisite for some of
these attacks to be successful.  Users of Tor may be at greater risk,
because malicious exit nodes can inject content into otherwise trusted
In order to allow time for people to upgrade, additional attack
details and sample code will be withheld for a couple of days.

@_date: 2007-10-10 00:59:56
@_author: Gregory Fleischer (Lists 
@_subject: Attacking the Tor Control Port with Java 
Hash: SHA1
On 3 October 2007, Sun announced several critical security updates for
the Java Runtime Environment at [1].  In particular, [2] describes how
network access restrictions can be circumvented to connect to
arbitrary hosts by utilizing DNS rebinding.  The paper at [3]
summarizes some of the current research into the issues of DNS
Java exposes a programmatic sockets interface, and a malicious applet
can construct properly formed control port commands.  If the control
port is enabled with the NULL authentication and accessible to the web
browser, the malicious applet can authenticate and send arbitrary
To summarize, Tor users with the following conditions may be at risk:
   - vulnerable version of Java enabled in web browser
   - control port enabled with NULL authentication and accessible
Use of proxy switching browser add-ons (e.g., Torbutton, FoxyProxy)
may increase this risk if the Java Virtual Machine can perform
arbitrary DNS resolution through the native operating system resolver.
Possible workarounds:
   - disable Tor control port
   - if control port is required, use 'HashedControlPassword' option
   - disable Java in the web browser and/or uninstall from OS
   - if Java is required, consider a virtual machine solution such as
     JanusVM [4] or firewalled environment that only allows DNS
     requests through web browser
The latest Java downloads are available at [5] or from your operating
system vendor (or not, depending on how differently you think).
Additional details and demonstration code at [6].
[1] - [2] - [3] - [4] - [5] -  or [6] -
