
@_date: 2013-07-28 20:29:08
@_author: ef2k 
@_subject: [tor-talk] Tor disconnects and must be restarted while using OpenVPN 
I'm trying to connect to an OpenVPN server for my general internet traffic but keep Tor for DNS lookups and as a SOCKS5 proxy for a few I connect to my OpenVPN server and everything works as expected, but after 30-40 seconds (seems to depend on number of requests to Tor?), all Tor requests just time out (incl. Tor DNS requests) and it's unusable. If I restart Tor with "service tor restart" then it will work again for another 30-40 seconds before it disconnects again.
Nothing is shown in Tor's log located at /var/log/tor/log about this.
My iptables rules are:
iptables -A INPUT -i lo -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT
iptables -A OUTPUT -d 255.255.255.255 -j ACCEPT
iptables -A INPUT -s 255.255.255.255 -j ACCEPT
iptables -A FORWARD -i wlan+ -o tun+ -j ACCEPT
iptables -A FORWARD -i tun+ -o wlan+ -j ACCEPT
iptables -t nat -A POSTROUTING -o tun+ -j MASQUERADE
iptables -A OUTPUT -o wlan+ ! -d *VPNIP* -j DROP
Hope someone can help to resolve this, it's very frustrating. Thanks in

@_date: 2013-06-15 21:46:28
@_author: ef2k@tormail.org 
@_subject: [tor-talk] Tor transparent proxying over OpenVPN 
Is it possible to do Tor transparent proxying over OpenVPN i.e. My
connection -> OpenVPN -> Tor ?
The purpose of this would be to stop the ISP from seeing that Tor is being
At the moment I'm using the rules from
By modifying the rules slightly to allow non-Tor traffic to the VPN server
I am able to establish a connection with OpenVPN, however, I can't access
any content online after that.
I understand that a normal setup of OpenVPN and then setting Tor as the
SOCKS5 proxy in my web browser, IM client, etc would work, but it doesn't
provide what I want - for every connection to go through Tor without fail.

@_date: 2013-06-16 23:57:57
@_author: ef2k@tormail.org 
@_subject: [tor-talk] Tor transparent proxying over OpenVPN 
This wouldn't work for me, I only have access to an outdated netbook, it
can't run a single VM without bringing the computer almost to a halt,
definitely not two.
I am worried about this. It's why I don't want to rely on obfuscated
bridges to hide my Tor usage, as they're not private and one day I could
get flagged as using Tor if the ISP/military/police is monitoring
connections to the bridge that I'm using at the time.
VPN seems to be the best solution. Services like Airvpn offer additional
services - VPN over SSH and VPN over SSL. VPN over SSL would hide that I'm
using a VPN, unless they are monitoring connections to Airvpn servers, but
even then they could only see that I'm using a VPN - *not* a big deal
compared to Tor.

@_date: 2013-06-17 00:33:22
@_author: ef2k@tormail.org 
@_subject: [tor-talk] Tor transparent proxying over OpenVPN 
Has this been seen used by any ISPs or governments ?
It seems to me that it would be too difficult and use far too much
resources (computer and human time) to run such fingerprinting on the
millions of internet users, assuming they aren't previously flagged for
using Tor or suspected as being behind political comments or websites,

@_date: 2013-06-17 00:50:40
@_author: ef2k@tormail.org 
@_subject: [tor-talk] Tor transparent proxying over OpenVPN 
Could you take a look at my iptables rules ? I don't have much knowledge
of firewalls and I am not good at writing them myself, so I couldn't yet
get it working correctly.
iptables -F
iptables -t nat -F
iptables -A INPUT -p tcp ! --syn -m state --state NEW -j DROP
iptables -A INPUT -m state --state INVALID -j DROP
iptables -A INPUT -d 224.0.0.0 -j REJECT
iptables -A INPUT -p tcp -m tcp --tcp-flags FIN,SYN,RST,PSH,ACK,URG NONE
-j DROP
iptables -A INPUT -p tcp -m tcp --tcp-flags SYN,FIN SYN,FIN -j DROP
iptables -A INPUT -p tcp -m tcp --tcp-flags SYN,RST SYN,RST -j DROP
iptables -A INPUT -p tcp -m tcp --tcp-flags FIN,RST FIN,RST -j DROP
iptables -A INPUT -p tcp -m tcp --tcp-flags ACK,FIN FIN -j DROP
iptables -A INPUT -p tcp -m tcp --tcp-flags ACK,URG URG -j DROP
iptables -t nat -A OUTPUT -m owner --uid-owner 181 -j RETURN
iptables -t nat -A OUTPUT -p udp --dport 53 -j REDIRECT --to-ports 53
iptables -t nat -A OUTPUT ! -o lo -p tcp -m tcp -m owner ! --uid-owner 181
! -d VPN.IP.ADDR.HERE -j REDIRECT --to-ports 9040
iptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
iptables -A OUTPUT -m owner --uid-owner 181 -j ACCEPT
iptables -A OUTPUT -p icmp -j DROP
iptables -A INPUT -p icmp -j DROP
iptables -A OUTPUT ! -o lo -p udp -j DROP
iptables -A INPUT ! -i lo -p udp -j DROP
ip6tables -F
ip6tables -t nat -F
ip6tables -A INPUT -j DROP
ip6tables -A OUTPUT -j DROP
181 is the uid that tor runs under.
With these rules I can establish a connection to the OpenVPN server but I
can't do anything after that. DNS requests time out, unable to access
websites or use IM (not just DNS, when connecting directly).
The problem isn't with the VPN, if I close all of my programs, clear the
iptables rules and connect to the VPN, the internet is working without
How much file sharing traffic do you think would be required? I'm on a
1.5Mbps connection with a 10GB monthly limit, so anything serious would
make the internet unusable (and after a while, blocked for the month).
