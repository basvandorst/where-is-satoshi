
@_date: 2007-10-01 20:28:00
@_author: =?ISO-8859-1?Q?Linus_L=FCssing?= 
@_subject: Advanced traffic shaping with iptables? 
Ok, I think it works, the latency for internet connections goes down from horrible ~500ms to 40-80ms, when I start the script.
No, no, I ment something else ^^. I wanted to know if there is a programm, with which I could monitor the bandwidth usage of a single programm, maybe displayed as a graph (so I could have a look, if i.e. the minimum bandwidth for tor works propably).
(Yep, I could figure out the options for this script myself, the script is really good commented, nevertheless thanks again ;) )
And if I use the script, I don't need the bandwidth options in the torrc any more, do I? I've just commented them out.
Greetz Linus

@_date: 2007-09-25 02:32:44
@_author: =?ISO-8859-15?Q?Linus_L=FCssing?= 
@_subject: Advanced traffic shaping with iptables? 
Hi there!
My problem is, that I'm sharing the Bandwidth of my ADSL Internet connection (50KiB/s upload) with TOR and some other applications (i.e. online games, VPN-Server, small Teamspeak-Server, VoIP) as well. I've read, that with iptables I could priorise the packages. At the moment I'm just offering 25KiB/s, cause I need at least 25KiB/s for the other applications. But for the most time, I'm using none of the other ones, so I could theoretically offer 50KiB/s for TOR at these moments. It would be really, really helpfull, if I could set up a bandwidth rule for TOR with iptables, so I would get at least 10KiB/s but it could get all the bandwidth, that would be wasted (remember the Task-Manager for CPU-Usage-Priority, I need something like "low priority" for the bandwidth). Maybe someone has already built something like this as a shell script for example? Or maybe some links to good explained tutorials would be usefull as well. Any help to get this done is Greetings, Linus
PS: Or would this sort of dynamic bandwidth-offer harm the TOR-network in any way, could this make things sort of "unstable", especially for established and active routes?

@_date: 2007-09-25 23:30:57
@_author: =?ISO-8859-15?Q?Linus_L=FCssing?= 
@_subject: Advanced traffic shaping with iptables? 
Thanks man, this script looks pretty much the way, I've been looking for. Yep, the syntax of iptables+tc is really confusing, I tried to go through some tutorials before. But you seem to have posted a usefull link, I'll have a look at it later.
Can you also telle me, what the BOX_IP and TOR_IP-paramteters are good for? It has nothing to do with my own IP-address, has it? Cause I've got a dynamic one...
Hmm, for me, it doesn't seem to work. Talks with VoIP hangs badly, while TOR is running too. I've always got to stop the process first (what is really annoying, cause I've got to connect over SSH to my mini-linux-server in the cellar first).
Sounds good, but I don't want to move from Debian to Open/FreeBSD. I would have to set up all the apps again...
Thanks for the quick responses.
Greetz, Linus

@_date: 2007-09-30 23:50:00
@_author: =?ISO-8859-1?Q?Linus_L=FCssing?= 
@_subject: Advanced traffic shaping with iptables? 
Thanks a lot for spending some time to edit this script. It seems to work now, but at first I was bit confused. The script told me "Outbound shaping added to ppp0.  Rate for Tor upload at least: 12Kbyte/sec.", but with this option, the hole internet traffic broke down. The script it self measures in kbit, not kbyte, right? So I changed the minimum tor traffic from 12 to 96 and the maximum from 48 to 384. Can you tell me a programm with which I could monitor the bandwidth usage of tor only, so I could be sure, that it isn't a Placebo effect.
PS: My first test with sending a file over VPN to a friend, he could download the file with ~10kbyte/s without the script and with the script he downloaded with 24kbyte/s (only have of my Internet connection). But iptraf on the mini-router and tor-server told me, that I was sending ~32kbyte/s over the local connection. So I'm not sure, if it works or not. Maybe, the missing bandwidth is protocol-related. Maybe you can tell me a way to get some proof, if it works.
And finally the output of the status option:
(Does it matter, that it tells me 'Cannot find device "imq0"'?)
Greetings, Linus
