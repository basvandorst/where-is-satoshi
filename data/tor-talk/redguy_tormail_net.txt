
@_date: 2012-02-19 12:50:47
@_author: Fred Toben 
@_subject: [tor-talk] Hidden service security w. Apache/Win32 
Hello Everybody
I am in the process of setting up a hidden service with Apache 2.2 under
I run Apache (Win32) in a virtual machine and Tor in a separate virtual
machine under VMware Workstation.
VM 1 runs Apache and VM 2 runs Tor.
VM 1 is connected to VM 2 through an internal host only network and no
connection to Apache is possible except through the host only network.
Apache runs under a limited user account and I have locked down  all
potentially unsafe modules (PHP, autoindex etc) and I have tested that the
hidden service is connectable from the outside with its .onion address.
So far I haven't found any public info about the possible downsides of
running a hidden service under Windows.
Is running the instances of Tor and Apache in separate locked down virtual
environments more secure than having Apache and Tor listening within the
same machine?
Or is Windows an absolute no when considering running a secure hidden
Another question is whether my setup (VM1=application, VM2=Tor)
ameliorates the problems with proxified applications.
On the Torproject site I read that proxifying applications is often
dangerous because the applications might leak the machine's real IP
But if the proxified aplication runs within a virtual machine, and only
connects to an instance of Tor running within another VM, what info could
leak through the application other than the IP of the VM?

@_date: 2012-02-19 18:13:22
@_author: Fred Toben 
@_subject: [tor-talk] Hidden service security w. Apache/Win32 
There should be no Tor exit, if you mean exit node.
Is the time sync spoofing even applicable to hidden services?
What I am concerned about is the security of the OS under which Apache is
I have so far identified the following possibilities:
1. Exposing the date and time of the webserver.
I haven't managed to disable this info.
Telnet (VM1) on port internalport  and sending the command
OPTIONS / HTTP/1.0
returns the date, time and timezone  and the Apache server string.
But the Tor running on VM2 doesn't as far I know care about what date,
time or timezone the HTTP server running on VM 1 returns to the user
If I really wanted, I could script a reset of the date, time and timezone
on VM 1 to a random value at each startup.
2. Exposing the currently running username, computername or even product
ID of the Windows installation.
I can't see how it could happen.
I deliberately disable all Apache modules which could leak such info (no
PHPINFO) and even if Apache could somehow "break out" into the OS, access to sensitive folders (systemroot, userprofile) and the registry is locked
by a group policy.
The VM 1 and VM 2 is on a different subnet from my physical router and
VMware host.
3. Antivirus, Windows Update and browser fingerprints.
VM 1 serving the Apache installation doesn't even have internet access,
and no other services (IRC, web browser are allowed).
VM 2 has internet access, but the only non-system process allowed to
connect to the internet is tor.exe.
The limited user account is not permitted to download or run new programs
or to terminate existing processes.
4. A yet unpublicized exploit allowing an unknown intruder to break out of
the virtual environment.
Some years ago, it was discovered that the folder sharing option in VMware
Workstation (?) might enable a breakout of the guest OS.
But what about other virtualization products like Virtualbox?
I share your concerns, but if there is a security issue with running a
hidden service in Windows, one solution is replacing the VM running Tor
with a linux distro.
How can the MS time server tampering with the exit nodes be applicable to
hidden services?

@_date: 2012-02-20 19:23:56
@_author: Fred Toben 
@_subject: [tor-talk] Hidden service security w. Apache/Win32 
I think you misunderstand my setup.
VM 1 serves the Apache installation, and VM 2 runs the Tor hidden service.
Therefore as far I understand Only VM 2 must have its clock correctly set.
VM 1 on the other hand serves the Apache installation, and there is no
reason why the date, time and timezone of respectively VM 1 and VM 2 has
to correspond.
The connection between VM 1 (Apache) and VM 2 (Tor listening on the
internal hidden service port)is socks 5, and there is no outbound internet
connection permitting any timesync or Microsoft service to break out of VM
An attacker attempting to correlate the time of my server (through a HTTP
request) with my Tor machine will only retrieve the date, time, and
timezone of the (virtualized and locked down) Apache  installation.
