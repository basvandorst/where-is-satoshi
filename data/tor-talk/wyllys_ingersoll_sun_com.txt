
@_date: 2009-10-12 16:58:37
@_author: Wyllys Ingersoll 
@_subject: hardware acceleration available for Tor ?  On FreeBSD ? 
I did testing with the Niagara 2 chips on some Sun systems running Solaris and got good results.
The critical operation is not necessarily the SSL, but rather the AES CTR mode algorithms.
I did not test this on a gigabit test network though.
The problem I discovered was that just getting accelerated AES from hardware
was not giving much improvement if the CTR mode operations had to be done
in software.  The N2 supports AES CTR in hardware so you can pass
the entire buffer to be encrypted at once instead of doing 16 bytes at a time
and updating the counters in software.  As far as I could tell, OpenSSL had no support for getting AES CTR from
hardware (0.9.8k), at least not without some heavy mods to the engine.
I blogged about it here:
Also posted a short paper describing the analysis (using DTrace) here:
-Wyllys Ingersoll
To unsubscribe, send an e-mail to majordomo at torproject.org with
unsubscribe or-talk    in the body.

@_date: 2009-10-13 00:13:53
@_author: Wyllys Ingersoll 
@_subject: hardware acceleration available for Tor ?  On FreeBSD ? 
I think that is correct.
Correct.  The counters are updated in software so the benefit is minimal.
There may be hardware accelerators with drivers for Linux and FreeBSD
that offer AES CTR, but I'm not familiar with the offerings
on those platforms.
I don't think the SCA6000 offers AES CTR support.  The N2 (T2) crypto
chips are newer and offer more algorithm support and faster performance.
You are correct, though, we (Solaris security) do strive to offer crypto
framework support for the underlying hardware devices.
Yes, in theory that would be the ideal solution. I think there are some patches
floating around that do add AES CTR to OpenSSL, but  I don't think
any have been yet accepted into the main openssl codebase.  Even so,
it would also require a hardware engine that could support AES CTR
in order to get the full benefit.
Yes, I think that sums it up nicely.
No problem, I hope it was helpful.
To unsubscribe, send an e-mail to majordomo at torproject.org with
unsubscribe or-talk    in the body.

@_date: 2009-10-13 10:27:19
@_author: Wyllys Ingersoll 
@_subject: Slightly OT: where to get Crypto HW stuff for Sparc/Solaris? 
The SCA6000 card supports AES CTR mode, I may have said in a previous email
that it does not, but I checked and it *does*.    It is supported on the
V480, but I don't see the E450 listed on the supported platform list.
Here is the link on the Sun product site with the spec sheet.
I don't know if you can find these on Ebay or not.  (I'm not trying to push the product here)
To unsubscribe, send an e-mail to majordomo at torproject.org with
unsubscribe or-talk    in the body.

@_date: 2009-10-13 13:57:20
@_author: Wyllys Ingersoll 
@_subject: Slightly OT: where to get Crypto HW (long, detailed, 
Yes, the BCM5825 is supported by the crypto framework and would meet the requirement for AES-CTR.
I don't know if it is the same part or not,  probably not if the price
diff is that great.
The dual-processor support would be provided by the kernel itself, not
anything in userland or the crypto framework.  If there were multiple accelerators, each would be registered in the framework as a unique instance and each would then be treated as a single accelerator by
the crypto framework.  This means that there is no multi-tasking/threading amongst crypto processors for a given session.
You may get better answers to these questions from the crypto-discuss at opensolaris.org
mailing list:
The benefit I see is that individual packets are processed much faster. Which translates to the node being able to handle many more transactions
for a given period of time.  I think this should lead to greater
bandwidth utilization, but I don't know if it would approach 100mbps or
not, there may be other limiting factors that get in the way.
To unsubscribe, send an e-mail to majordomo at torproject.org with
unsubscribe or-talk    in the body.

@_date: 2009-10-13 16:13:19
@_author: Wyllys Ingersoll 
@_subject: Less OT: Here's a Solaris crypto acceleration branch to try. 
The patches currently being applied to the Tor in Solaris (2.0.34)
can be seen here:
I have a newer release of Tor (2.1.19) ready to go, I just haven't had time to
complete the steps needed to do the putback into Solaris lately.
To unsubscribe, send an e-mail to majordomo at torproject.org with
unsubscribe or-talk    in the body.

@_date: 2009-09-26 18:16:59
@_author: Wyllys Ingersoll 
@_subject: onion_skin_client_handshake failed. 
Im trying to run a tor relay (v2.1.19) and am seeing the following errors repeatedly:
Sep 26 18:16:03 spyglass Tor[851]: [ID 702911 daemon.warning] onion_skin_client_handshake failed.
Sep 26 18:16:03 spyglass Tor[851]: [ID 702911 daemon.warning] circuit_finish_handshake failed.
Sep 26 18:16:03 spyglass Tor[851]: [ID 702911 daemon.warning] Digest DOES NOT MATCH on onion handshake. Bug or attack.
I'm not sure how to fix this - any suggestions?
-Wyllys Ingersoll
To unsubscribe, send an e-mail to majordomo at torproject.org with
unsubscribe or-talk    in the body.

@_date: 2009-09-27 15:36:05
@_author: Wyllys Ingersoll 
@_subject: onion_skin_client_handshake failed. 
Oddly enough, on the one system that I use that DOES have HW support, I don't have the problem. I am seeing it on several systems that do not
have any HW support.
To unsubscribe, send an e-mail to majordomo at torproject.org with
unsubscribe or-talk    in the body.
