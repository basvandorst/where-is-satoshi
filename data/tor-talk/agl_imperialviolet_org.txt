
@_date: 2005-08-26 10:58:14
@_author: Adam Langley 
@_subject: Getting logged out from forums 
Check your privoxy configuration. If it's filtering the cookies then
it doesn't matter if cookies are enabled in the browser.

@_date: 2005-08-30 20:54:36
@_author: Adam Langley 
@_subject: privoxy/firefox 
At the bottom of:
But it doesn't do anything pre Deer Park.

@_date: 2005-08-31 14:15:25
@_author: Adam Langley 
@_subject: Script for starting private Tor networks 
It follows the steps at
but it's a lot quicker than doing it by hand for many nodes.
usage: make-private-tor-network.py [options]
  -h, --help            show this help message and exit
  -b BINARY, --tor-binary=BINARY
                        location of the tor binary
  -n BASENAME, --base-name=BASENAME
                        base name of the directories and nicknames of the
                        nodes
  --base-port=BASEPORT  lower most port number to start assigning from
  -d NUM_DIRSERVERS, --num-dirservers=NUM_DIRSERVERS
                        number of dirservers
  -o NUM_NODES, --num-nodes=NUM_NODES
                        number of non-dirserver nodes
  -e EXTRACONFIG, --extra-config=EXTRACONFIG
                        location of a file which is appended onto the
                        generated configs
  -p BASEPATH, --path=BASEPATH
                        the path in which to create the directories
The output is a script to start the network which can either be put in
a file or pasted into the console:
% python make-private-tor-network.py -b ./tor -e extra-config -o 10 -d 2
./tor -f ./nodeD0/torrc &  # or: 3000, dir: 3001, socks: 3002
./tor -f ./nodeD1/torrc &  # or: 3003, dir: 3004, socks: 3005
./tor -f ./nodeN2/torrc &  # or: 3006, dir: 3007, socks: 3008
./tor -f ./nodeN3/torrc &  # or: 3009, dir: 3010, socks: 3011
./tor -f ./nodeN4/torrc &  # or: 3012, dir: 3013, socks: 3014
./tor -f ./nodeN5/torrc &  # or: 3015, dir: 3016, socks: 3017
./tor -f ./nodeN6/torrc &  # or: 3018, dir: 3019, socks: 3020
./tor -f ./nodeN7/torrc &  # or: 3021, dir: 3022, socks: 3023
./tor -f ./nodeN8/torrc &  # or: 3024, dir: 3025, socks: 3026
./tor -f ./nodeN9/torrc &  # or: 3027, dir: 3028, socks: 3029
./tor -f ./nodeN10/torrc &  # or: 3030, dir: 3031, socks: 3032
./tor -f ./nodeN11/torrc &  # or: 3033, dir: 3034, socks: 3035

@_date: 2005-10-02 03:21:41
@_author: Adam Langley 
@_subject: nym-0.2 released (fwd) 
Dude, we're not launching missiles here, it's just Wikipedia.
First, how do you add client certificates in modern browsers? Oh,
actually I've just found it in Firefox, but what about
IE/Opera/whatever else? Can you do it easily?
The blinded signature is just a long bit string and it might well be
better from a user's point of view for them to 'login' by pasting the
base64 encoded blob into a box.
Just a thought (motivated in no small part by my dislike for all things x509ish)
The lack of forward secrecy is pretty fundamental in a reputation
based system. The more you turn up the forward secrecy, the less
effective any reputation system is going to be.
And I'm also going to say well done to Jason for actually coding
something. There do seem to be a lot couch-geeks on or-talk - just
look at the S/N ratio on the recent wikipedia threads. It might not
work, but it's *something*. No amount of talk is going to suddenly
become a solution.
Adam Langley                                      agl at imperialviolet.org
                       (+44) (0)7906 332512
PGP: 9113   256A   CC0F   71A6   4C84   5087   CDA5   52DF   2CB6   3D60

@_date: 2005-10-05 15:19:48
@_author: Adam Langley 
@_subject: Wanted: Brave, hacker, exit node operator 
Thanks for the testing. That patch is on hold for the moment because
I've just moved country and started work and I've started right in the
middle of a crunch time. Hopefully I'll get back to it soon, but it
could well be three weeks before I even have computer to hack on.
Adam Langley                                      agl at imperialviolet.org
                       (+44) (0)7906 332512
PGP: 9113   256A   CC0F   71A6   4C84   5087   CDA5   52DF   2CB6   3D60

@_date: 2005-09-01 19:20:20
@_author: Adam Langley 
@_subject: Wanted: Brave, hacker, exit node operator 
Tor has DNS caching built in, which is currently bad because it's over
caching. It's not encrypted either.
1) Encrypting the DNS cache is probably overkill. The only case where
it's of benefit is where you extract cache pages from the swap and
keep the key in non-paged memory. If you can root a running box you
can take the key from memory as easily as getting the DNS cache.
So the solution is to encrypt your swap with a boot-time nonce.
Sniffing at the ISP is an easier way to find out what is exiting at
any given node anyway, will get you more information and Tor shouldn't
depend on knowledge of exit traffic being secret. (although every
little bit of information helps the attacker)
2) The DNS system was designed with full DNS servers sitting very
close to the resolver. That's why the resolvers don't do caching.
Unfortunately there's a habit of configuring DNS servers which are
tens of milliseconds away (e.g. at the ISP) these days. Windows boxes
don't have a local DNS server, which is a bad move by MS, but UNIX
boxes have no excuse[1].
So, in the case of UNIX systems Tor maybe shouldn't be doing caching
at all. In the cases where it does make sense, the resolver doesn't
pass on the time to live of the information so Tor cannot know how
long to cache for. At the moment it's up to 150 minutes[2], which can
be very bad for highly dynamic routing setups like google.com (which
has a TTL of 5 minutes)
Eventdns (my patch) does pass on the TTL of the replies so Tor can do
sensible caching. Unfortunately, the way the data structures are laid
out means that it's difficult to do and I didn't want to drop a whole
new heap implementation into the Tor code on the first patch.
[1] [2] src/or/or.h:181

@_date: 2005-09-01 19:22:55
@_author: Adam Langley 
@_subject: Wanted: Brave, hacker, exit node operator 
Thanks for that!
Probably not needed because I've not added any extra logging calls.
Mostly I'm expecting that it'll segfault and then I'll be interested
in the full back trace.

@_date: 2005-09-01 15:48:39
@_author: Adam Langley 
@_subject: Wanted: Brave, hacker, exit node operator 
It would be cool if someone could test some patches I have for doing
DNS lookups without fork() workers and using glibc. I'd need:
  * An exit node operator (because otherwise they don't do DNS lookups)
  * running Linux
  * who knows their way around patching CVS trees etc
The patch is at and you need to drop the following two files into src/or/:
The patch applies against the CVS tree at the moment. You need to
rerun autogen.sh afterwards and run ./configure --enable-eventdns.
Run with core limits off and when it crashes email me the bt full
output from gdb, then switch back to the unpatch binary which you'll
keep around until I figure out what when wrong ;)
(actually, from using tor-resolve lots it appears to work fine, but
I'm sure that it still has bugs in).
Also, do email the list if you're testing this patch so there aren't
too many (if any at all).

@_date: 2005-09-27 02:52:07
@_author: Adam Langley 
@_subject: Deer Park Alpha 2 remote DNS resolution 
Adam Langley                                      agl at imperialviolet.org
                       (+44) (0)7906 332512
PGP: 9113   256A   CC0F   71A6   4C84   5087   CDA5   52DF   2CB6   3D60

@_date: 2005-09-02 18:10:07
@_author: Adam Langley 
@_subject: Script for starting private Tor networks 
Looks like a bug in the subprocess module shipped with Python 2.4. The
faulting line of code is in a big "if mswindows:" block, and is
passing the wrong type of argument to a win32 call.

@_date: 2005-09-28 14:25:15
@_author: Adam Langley 
@_subject: Hello directly from Jimbo at Wikipedia 
A similar scheme  would be to make people perform many CAPTCHAs[1] in
order to generate a login id. That way the resource is human time and
it's difficult to generate lots of them [1]. Abuse from these accounts
results in the account being deleted, which makes it costly.
(More detail here: The design of the CAPTCHA is actually far more difficult than I
imagined because it turns out that the range of ability of people for
solving them is very large - but there are several widly used CAPTCHAs
which seems to be good for many of people. (Very unscientifically, it
seems that computer minded people can solve them but other's have
great problems. My mother can't even do the Google CAPTCHA).
Although this seems possible it's tough to believe that it's worth
doing for Wikipedia because I've already written a small (1500 line)
patch for MediaWiki; the design of which was okayed in general by one
of the developers. It was intended to make it easier to block and
unblock IP ranges (like all Tor nodes) . The patch certainly wasn't
perfect but, despite the efforts of several people, I never got any
responce from anyone in MediaWiki about it.
I don't mind - I've the attention span of a flea anyway. But it's not
good for people who might be willing to do this work.
[1] [2] You could setup a sweatshop to do it, or you could distribute it and make setup a porn website which requires you to solve them to gain
entry. Either way - it's quite a lot of effort. See
Adam Langley                                      agl at imperialviolet.org
                       (+44) (0)7906 332512
PGP: 9113   256A   CC0F   71A6   4C84   5087   CDA5   52DF   2CB6   3D60

@_date: 2005-09-28 14:35:55
@_author: Adam Langley 
@_subject: Wikipedia & Tor 
(Just a forward for people trying to follow the various thread on this)
See my post as of a few minutes ago, in short: I've already done this.
The patch was far from perfect but (despite several people pushing it)
there has been no reply from any of the MediaWiki people about it.
This doesn't bother me, but it certainly doesn't motivate anyone who
might be considering coding solutions up for MediaWiki.
Adam Langley                                      agl at imperialviolet.org
                       (+44) (0)7906 332512
PGP: 9113   256A   CC0F   71A6   4C84   5087   CDA5   52DF   2CB6   3D60

@_date: 2005-09-01 16:25:15
@_author: Adam Langley 
@_subject: Mozilla Thunderbird leaking ? 
Note that support for sending DNS lookups over SOCKS5 was only added
in Firefox Deer Park alpha 1. I've no idea which versions of
Thunderbird include it - you may need to get the latest alpha/beta
and/or poke about:config in the same way as Firefox.
For firefox instructions (which might carry over in recent versions of
Thunderbird) see

@_date: 2005-09-05 17:59:01
@_author: Adam Langley 
@_subject: Tor overwhelms my router 
Linksys aren't known for their shoddy routers, so you might try
upgrading the firmware:
But I don't know if the WCG series deserves the reputation of the WRT54G ones.

@_date: 2005-09-01 16:28:05
@_author: Adam Langley 
@_subject: Script for starting private Tor networks 
Portability is a fluke - I've not coded on Windows since I was about 12.
It will stomp some files, but only ones which it thinks that it would
have created last time. Thus, if you have lots of directories called
nodeD0 and so forth it will think that it owns them.
Generally, run it in a new directory and all the files it creates
should be within that directory.
(barring command line args to tell it otherwise and/or really freaky
Windows behavior - but I don't think so)

@_date: 2005-09-09 09:10:13
@_author: Adam Langley 
@_subject: AllowedUnverifiedNodes 
Anything can be compressed, it's only a question of ratios. However,
anything encrypted should give a ratio > 1, so there's very little
point. So compression would have to happen before encryption (which is
what SSH does) and there would be some benefit in some cases. However,
it would also add increased load onto exit nodes, and they are already
pretty busy.

@_date: 2008-12-28 12:53:44
@_author: Adam Langley 
@_subject: Tor on Android 
Just for lark, more than anything else, I built Tor on Android and
have it running on a (release) HTC Dream:
$ ./tor -f torrc
Dec 28 12:40:33.468 [notice] Tor v0.2.0.32 (r17346). This is
experimental software. Do not rely on it for strong anonymity.
(Running on Linux armv6l)
Dec 28 12:40:33.478 [notice] Initialized libevent version 1.4.9-stable
using method epoll. Good.
Dec 28 12:40:33.480 [notice] Opening Socks listener on 127.0.0.1:9050
The native web browser doesn't have support for SOCKS proxies, only
HTTP proxies, so one would have to add a HTTP->SOCKS proxy in the mix
to get it working. However, I did test it with Firefox routing SOCKS
requests over a USB link to Tor running on the phone. The 3G latencies
and limited CPU power make for a pretty slow result, but it does work.
It's back to work tomorrow, so this is probably as far as I'll take
it. If anyone wants the binaries or build instructions (I didn't do
anything shockingly odd), let me know.

@_date: 2008-12-28 15:21:23
@_author: Adam Langley 
@_subject: Tor on Android 
If you have a dev phone, that might be possible. However, the release
phones don't provide you with root (or any other way to setup

@_date: 2008-12-28 15:55:21
@_author: Adam Langley 
@_subject: Tor on Android 
Looks like I should do a quick write up:
One caveat, I'm running Android 1.1 PLAT-RC16, which is an unreleased
testing version. However, I don't believe that anything pertinent has
1) Setup your phone for debugging.
Home -> Settings -> Applications -> Development. Check both "USB
debugging" and "Stay Awake".
2) Setup udev
See  and
search the page for "udev". This is to make sure that the USB device
inodes get the correct permissions.
3) Download the SDK
Put the tools/ directory from the SDK in your $PATH. You'll need the
adb utility from there.
4) Plug your phone into a USB port on your computer
`adb devices` should list a single device.
5) Grab a full source release and build it
Follow  It's a lot of downloading,
disk space and build time. If you aren't running an Intel x86 or
x86-64 build platform you might have some issues. If you are running
x86-64 you'll still have some issues. Many of them are covered on the
above page but one which I had was that my distro (Ubuntu 8.10)
doesn't seem to have 32-bit libreadline libraries.
I built a 32-bit libreadline from source (this is from memory only):
% export CC="gcc -m32"
% ./configure
% make
% sudo cp libreadline.so.5.2 libhistory.so.5.2 /usr/lib32
% sudo chmod a+rx /usr/lib32/libreadline.so.5.2 /usr/lib32/libhistory.so.5.2
% ldconfig (might setup the symlinks /usr/lib/libreadline.so for you,
otherwise, do it manually)
Hopefully you can do a successful `make` run with the android source.
6) Setup agcc
Once you have a source build, you should have an ARM cross-compiler in
mydroid/prebuilt/linux-x86/toolchain/arm-eabi-4.3.1/bin. The agcc[1]
script will give all the correct arguments to it to build binaries
with bionic etc. Put both agcc and ..../arm-eabi-4.3.1 in your $PATH.
[1] 7) Build a test binary
% cat > test.c <
main() {
  printf("hello android\n");
  return 0;
% agcc test.c
% file ./a.out
That should get you an ARM binary
8) Try running it
% adb push a.out /sqlite_stmt_journals
% adb shell
$ cd /sqlite_stmt_journals
$ ./a.out
9) Build libevent
Download libevent
% export CC="agcc"
% ./configure --host=arm-eabi
I had to manually disable select support in config.h and remove
select.c (and everything else to do with select) from the Makefile
because bionic seems to be missing fd_mask structures. I also didn't
bother building anything in /test.
Hopefully you end up with libevent.a (probably in .libs). Copy it to
10) Setup include paths
I added these lines to the list of include paths in agcc:
    "-I$DROID/external/libevent-1.4.9-stable",
    "-I$DROID/external/openssl/include",
    "-I$DROID/external/zlib",
The first is where I happened to build libevent. Your location may
vary. The other two are path of the standard source distribution.
11) Build tor
I used 0.2.0.32
Firstly, Android doesn't include deprecated OpenSSL functions, so add
a wrapper to src/common/crypto.c:
+++ tor-0.2.0.32-agl/src/common/crypto.c  2008-12-28 12:24:25.000000000 -0800
 -387,6 +387,37    tor_free(env);
 }
+RSA *RSA_generate_key(int bits, unsigned long e_value,
+             void (*callback)(int,int,void *), void *cb_arg)
+        {
+        BN_GENCB cb;
+        int i;
+        RSA *rsa = RSA_new();
+        BIGNUM *e = BN_new();
+        if(!rsa || !e) goto err;
+        /* The problem is when building with 8, 16, or 32 BN_ULONG,
+         * unsigned long can be larger */
+        for (i=0; i<(int)sizeof(unsigned long)*8; i++)
+                {
+                if (e_value & (1UL<<i))
+                        if (BN_set_bit(e,i) == 0)
+                                goto err;
+                }
+        BN_GENCB_set_old(&cb, callback, cb_arg);
+        if(RSA_generate_key_ex(rsa, bits, e, &cb)) {
+                BN_free(e);
+                return rsa;
+        }
+        if(e) BN_free(e);
+        if(rsa) RSA_free(rsa);
+        return 0;
Then, the only other issues I had were with some odd namespace
collision with log.h. I'll include the diffs, although I didn't bother
pinning down the problem, I just worked around where it popped up:
--- tor-0.2.0.32/src/common/log.h   2008-02-26 11:56:29.000000000 -0800
+++ tor-0.2.0.32-agl/src/common/log.h  2008-12-28 12:02:17.000000000 -0800
 -11,7 +11,7   * \brief Headers for log.c
  **/
- __LOG_H
+ __TOR_LOG_H
  LOG_H_ID "$Id: log.h 13412 2008-02-07 05:31:47Z nickm $"
  "compat.h"
 -180,6 +180,6   /* !GNUC */
-# define __LOG_H
+# define __TOR_LOG_H
 --- tor-0.2.0.32/src/or/buffers.c   2008-11-20 14:14:26.000000000 -0800
+++ tor-0.2.0.32-agl/src/or/buffers.c  2008-12-28 12:03:08.000000000 -0800
 -14,6 +14,7   * memory, file descriptors, or TLS connections.
  **/
  BUFFERS_PRIVATE
+ "src/common/log.h"
  "or.h"
 // PARANOIA
diff -ur tor-0.2.0.32/src/or/circuitbuild.c
--- tor-0.2.0.32/src/or/circuitbuild.c 2008-09-23 14:00:43.000000000 -0700
+++ tor-0.2.0.32-agl/src/or/circuitbuild.c   2008-12-28 12:03:30.000000000 -0800
 -12,6 +12,7   * \brief The actual details of building circuits.
  **/
+ "src/common/log.h"
  "or.h"
 /********* START VARIABLES **********/
Only in tor-0.2.0.32-agl/src/or: .deps
diff -ur tor-0.2.0.32/src/or/eventdns.c tor-0.2.0.32-agl/src/or/eventdns.c
--- tor-0.2.0.32/src/or/eventdns.c  2008-02-26 11:56:28.000000000 -0800
+++ tor-0.2.0.32-agl/src/or/eventdns.c 2008-12-28 12:18:22.000000000 -0800
 -121,6 +121,7   /* for debugging possible memory leaks. */
+ "src/common/util.h"
  malloc(x) tor_malloc(x)
  realloc(x,y) tor_realloc((x),(y))
  free(x) tor_free(x)
Only in tor-0.2.0.32-agl/src/or: Makefile
diff -ur tor-0.2.0.32/src/or/or.h tor-0.2.0.32-agl/src/or/or.h
--- tor-0.2.0.32/src/or/or.h  2008-11-20 14:14:26.000000000 -0800
+++ tor-0.2.0.32-agl/src/or/or.h 2008-12-28 12:03:48.000000000 -0800
 -75,7 +75,7   "crypto.h"
  "tortls.h"
- "log.h"
+ "src/common/log.h"
  "compat.h"
  "container.h"
  "util.h"
12) Finish up
I didn't bother building any of the Tor utilities once I had the Tor
binary. You can copy it to the phone with adb push again and run it
via the shell.
First you should `export HOME=/sdcard` because the tmpfs is very small.
That gets Tor running, however it's hardly very neat.
The rest of Android is designed around Activies, as documented in the
SDK documentation. I suspect that the way to go would be to build Tor
as a .so, renaming the main function. You can use JNI[1] from a Java
thread to start running Tor by calling the new alternative main. If
you do this, you'll want to read [2] otherwise the system will
randomly kill the process.
I believe that there's a way to get Android to use an HTTP proxy.
Certainly there's an http_proxy field in
frameworks/base/core/java/android/provider/Settings.java. You might
find details online about poking a value in a SQLite table. The
sqlite3 binary that they reference isn't shipped on the phones, but
you find it in mydroid/out/target/product/generic/system/xbin.
However, I don't believe that the sqlite file lives in the same place
anymore and I don't know where it moved to.
[1] [2]

@_date: 2008-12-28 19:24:17
@_author: Adam Langley 
@_subject: Tor on Android 
It's not defined. This is probably a mistake on bionic's part since,
from reading around, fd_mask is POSIX. Rather than change libevent,
probably bionic should be changed. I'll look at doing that tomorrow.
Also, android has a config include file which is included in all
compiles. This might well be a mistake as it defines HAVE_SYS_SOCKET_H
and that's pretty rude.
Sorry! That is, indeed, OpenSSL code.
With custom libc etc, this C compiler is certainly acting a little weird!
With a little investigate, the issue is in the agcc script. I had it
add the libevent directory as an include path, but it put's -I options
last on the resulting command line. Thus libevent's log.h was getting
picked up. I've attached a version which collects -I arguments and
puts them first on the gcc command line and this allows tip-of-SVN to
build with these modifications:
--- or.h        (revision 17805)
+++ or.h        (working copy)
 -2872,7 +2872,7  int config_get_lines(const char *string, config_line_t **result);
 void config_free_lines(config_line_t *front);
-int options_trial_assign(config_line_t *list, int use_defaults,
+setopt_err_t options_trial_assign(config_line_t *list, int use_defaults,
                          int clear_first, char **msg);
 int resolve_my_address(int warn_severity, or_options_t *options,
                        uint32_t *addr, char **hostname_out);
This looks like the compiler is just being more picky (maybe because
it's GCC 4.3?) Enums aren't technically ints.
Index: eventdns.c
--- eventdns.c  (revision 17805)
+++ eventdns.c  (working copy)
 -102,7 +102,7    HAVE_NETINET_IN6_H
- +    WIN32
The configure script checks for netinet/in6.h, but eventdns.c uses
netinet6/in6.h. The former exists in bionic, but not the latter.

@_date: 2008-07-23 10:44:05
@_author: Adam Langley 
@_subject: Obfuscated TCP: looking for testers 
Obfuscated TCP is a backwards-compatible modification to the TCP
protocol which adds opportunistic encryption. It's designed to hamper
and detect large-scale wiretapping and corruption of TCP traffic on
the Internet [1]
TLS is the solution to protecting sensitive information. However,
there's room for a low setup cost protocol to protect the bulk of
traffic which isn't currently encrypted. It can't stop a focused
attack, but it can assuage untargeted, dragnet sniffing of backbones
and spoofing of RST packets.
I figure that Tor users might be the kind of technically inclined
folks who might want to help out by testing this even though I've not
written any Tor code in quite a while. Note that, since obstcp has a
kernel component, you'd need to be able to patch and rebuild a kernel.
All the information is at: Also, I'll be on  on OFTC today
[1]

@_date: 2011-06-13 16:27:13
@_author: Adam Langley 
@_subject: [tor-talk] ServerDNSRandomizeCase and GoDaddy 
That's a problem. Are *.domaincontrol.com GoDaddy's DNS servers? Can
you give an example of a less phishy looking domain?
If I can get a good example then I may be able to get this fixed.

@_date: 2011-06-15 16:23:19
@_author: Adam Langley 
@_subject: [tor-talk] ServerDNSRandomizeCase and GoDaddy 
GoDaddy are working on a fix and hope to have it done by early August.

@_date: 2011-11-29 09:35:04
@_author: Adam Langley 
@_subject: [tor-talk] Tor resolver DNSSEC RRs 
(It's important to note that OpenSSH trusts the AD bit in the DNS
reply. So, using it with Tor's DNS resolver assumes that Tor acts as a
full, validating, DNSSEC resolver. It would likely be more expeditious
to figure out a way have Unbound forward over Tor.)
