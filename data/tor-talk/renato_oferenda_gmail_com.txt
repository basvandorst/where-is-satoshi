
@_date: 2009-08-03 14:08:01
@_author: Renato Borges 
@_subject: Tor check and DNS exitlist down? 
I can confirm neither page is accessible from regular connection (I'm
located in Brazil). Pinging check.torproject.org at least returns an
IP (from openDNS), but exitlist.torproject.org doesn't.
I'll try to traceroute them shortly.

@_date: 2009-08-03 14:10:46
@_author: Renato Borges 
@_subject: Tor check and DNS exitlist down? 
Actually, I can't traceroute, it seems I'm behind a firewall that
strips all icmp. Sorry.

@_date: 2009-08-21 21:31:14
@_author: Renato Callado Borges 
@_subject: Tor/Iptables Question 
I know this thread has being going on for some time, but I haven't read it before, too busy. If I'm repeating something already said, or ignoring some constraint not present in this latest message, I apologise.
AFAIK, you need to be able to create connections from your machine to itself. You can check this need by running "netstat -tc" on a working torrified browsing session. You should see some "localhost" to "localhost" connections.
Proto Recv-Q Send-Q Local Address           Foreign Address         State      tcp        0      0 localhost:33435         localhost:8118          ESTABLISHED
These connections, to my knowledge, are done via the loopback interface. So you need this rule:
This rule will go right at the top of the iptables rules (-I = Insert), and it ACCEPTS every packet that enter through your "lo" (loopback) network interface, which is used for internal communications.
Hope it helps.

@_date: 2009-08-22 09:29:59
@_author: Renato Callado Borges 
@_subject: Tor/Iptables Question 
Ok, I see. But I believe the problem remains that you need listen on lo on some ports, right?
I suppose you'd prefer a "block everything but allow only these packets" approach. Then what about:
-I INPUT 1 -i lo -p tcp --dport 8118 -j ACCEPT
-I INPUT 2 -i lo -p tcp --dport 9050 -j ACCEPT
This will allow any user to get in through lo on ports 8118 and 9050, which, together with the rules you already have, would allow any user to get a full connection on these ports through lo.
According to iptables man page,
       This module attempts to match various characteristics of the packet creator, for locally-generated packets.  It is only valid in the OUT-
       PUT chain, and even this some packets (such as ICMP ping responses) may have no owner, and hence never match."
So you can't assure that other users won't get through lo, on these ports, using the owner module. Also, I have no idea if tor uses ICMP or other packets that wouldn't match the rules. There might be a caveat here.
Also, since you want only owner torify to be allowed out thorugh lo on these ports, you should change your rules, because as-is you're allowing all users through lo on ports 9050, 8118 and 8888. I'm assuming you don't need these ports (and 8888) for other users, from the description of your problem. But your rules actually allow pacjets through.
Change from:
-A OUTPUT -o lo -p tcp --dport 8118 -m owner --uid-owner torify -j ACCEPT
-A OUTPUT -o lo -p tcp --dport 9050 -m owner --uid-owner torify -j ACCEPT
-A OUTPUT -o lo -p tcp -m owner --uid-owner torify -j REJECT --reject-with icmp-port-unreachable
Is this getting closer?
