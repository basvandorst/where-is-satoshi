
@_date: 2008-08-16 11:32:08
@_author: John Brooks 
@_subject: e-mail and anonymity 
Enabling javascript and cookies for everything is dangerous to anonymity,
but doing that selectively is much less so. Cookies are recommended against
because they, by definition, store something along with the user - meaning
that even if the tor IP changes, the cookie can be used to connect it to the
old one. This isn't an issue for a webmail system anyway, where you have a
username that does a perfectly good job of connecting you to your old
traffic already (and if you were trying to avoid that, you'd be using a new
account, and thus a different cookie). Google, for example, uses cookies to
help track users through IP changes, which can easily become dangerous if
you use both Tor and non-Tor google in the same browser.
Javascript's only real danger to anonymity is exploits (i.e. if some
javascript traffic went outside the proxy, or if it helped compromise the
browser), but it is worth noting that javascript can also change the content
of the page you're viewing. If you have a bad exit node that inserts fake
javascript into pages (it's happened), you won't have a real way to know the
In theory, javascript could also be of use in certain timing or latency
attacks to discover a client's circuit (by generating large amounts of
constant traffic), but that's not hard to do without javascript.
You should be fine enabling javascript and cookies for specific sites that
require it - although you should try to use SSL there if at all possible.
- John Brooks

@_date: 2008-08-17 22:45:22
@_author: John Brooks 
@_subject: DEFCON Presentations 
That is fairly true, within a margin of error. Symmetric encryption has one
bit of output for every bit of input (with padding), so the size will be
reasonably close. If you know all of the pages on a specific host (and they
are either static or don't change much dynamically), you could guess at them
assuming they differ significantly. Problems would include keepalive
connections (you can't tell where one page ends and the next begins if
pipelining is used), accounting for response headers, etc. Also, depending
on the SSL implementation and TCP state, padding may be significant or
insignificant - so you can't really account for that either.
It'd be of very limited use unless static files of very differing sizes were
being served and the indirect knowledge of what file a given user was
requesting was useful to you. It would not hurt the anonymity of tor, of
course, because any node that knows you will not know where you are going.
That's all original opinions - I don't recall seeing anything detailing this
specifically. You might be able to find a more in-depth paper on the
concept, but it is of fairly limited use.
- John Brooks

@_date: 2008-08-07 23:25:23
@_author: John Brooks 
@_subject: running a new node 
There isn't really a trust issue involved. It does take some time to get
most clients to know you (generally not more than a day, I believe) and the
stable flag will help quite a bit. You should probably check your ports etc,
and look at your node on one of the tor monitoring sites (
 to make sure that everything there is okay.
Mine tends to use it's full allotted bandwidth (250 KB/s) constantly (in the
realm of 20-40gb per day), but it's got a good stable history, handles exit
traffic, and is marked as guard (which is an automated process).
Check to make sure that incoming connections are working and so forth -
that'd be my first guess.
- John

@_date: 2008-08-28 23:46:30
@_author: John Brooks 
@_subject: (Theory) The BGP exploit: Effects on Tor routing and overall anonymity? 
The short answer is no, not much. The long answer is a lot longer than that,
so get ready :P
This would serve the person intercepting the traffic in near exactly the
same way it does the operator of the node - entry nodes know the client,
middle nodes know the entry and exit nodes, exit nodes know the destination
(and the traffic to that destination). You would still need to intercept a
significant amount of nodes before being able to break anonymity and tell
which users are responsible for what traffic - which is a problem because
the entire reason this attack works is that it targets more specific IP
blocks. That many announcements (for various nodes) would be pretty easy to
see. If an attacker were able to intercept traffic on the entry and exit
nodes, or the client and destination, they could use timing and bandwidth
correlations to tell (with high probability) that this client is accessing
this destination. But this is no different from an attacker with control of
the entry node or exit/destination.
The only way to make use of it that doesn't involve guessing at what nodes
are in use would be to start at one end and work backwards or forwards in
realtime. Essentially, you start by intercepting traffic to a target
destination, then intercept traffic to the exit node contacting that
destination, then intercept traffic to the middle node contacting that exit,
then the entry node contacting that middle node, and finally to the client.
The problem here is that you'd need a consistant (and obvious) traffic
pattern sustained throughout that time (which would be long, due to the
large amount of traffic most nodes handle and that BGP is not
instantaneous), which is not generally true of HTTP requests. The complexity
of such an attack would be problematic, and it still involves quite a lot of
So no, this isn't a significant risk to tor anonymity, it's at best a
quicker way to intercept traffic and follow a node path to its source, and I
would be amazed if that were pulled off successfully. Remember that this
exploit only allows you to intercept traffic *to* a specific destination,
and in that situation you have no more information than the real destination
does (less, in fact, because you don't see the traffic going the other
direction unless you intercept that too).
- John Brooks

@_date: 2008-07-24 11:07:06
@_author: John Brooks 
@_subject: Is tor being slowed up to ~20ms per hop by TCP delayed ACK? 
This pretty much mirrors my experiences. I have a tor node running on a dedi
used for other purposes as well. It's capped to 300 KB/s currently, and
marked as fast, guard, and stable by all directories, so it handles that
much traffic 24/7. Tor generally has pretty high memory usage (over 200mb
before on 0.1.x, about 100mb on 0.2.1.x), but very low CPU usage (<3% on
average). This is not on a powerful CPU by any means.
It seems pretty obvious to me that the bottleneck in tor lies mostly with
insufficient bandwidth, not overhead from encryption (minimal) or tcp
(seriously?). Improvements in those two areas could help, but probably only
in regards to reducing the load of bandwidth on nodes. What the network
really seems to need is more high-speed nodes, so more connections can be
handled without bottlenecking at some slower or too busy node. There is
probably room for improvement in the node selection algorithm, too.
I think energy would be better spent trying to recruit more node providers,
finding a way to give back to node providers, and ensuring their legal
status. Technical improvements only go so far when, by design,  tor will add
3 very busy bottleneck points to the route.
As of writing, 260 KB/s steadily coming from tor.
- John Brooks

@_date: 2008-11-13 18:09:52
@_author: John Brooks 
@_subject: Tor and DNS attacks 
Yes, tor ships with the keys for the main authorities - so long as
your tor distribution is verified, those keys are correct and you will
verify the authorities (which are the most important part). Beyond
that, the consensus system works to verify every other key by checking
that a majority of sources will return the same answer (i.e. the same
descriptor for a node).
That said, cache poisoning is still an issue for relayed
communications and all sorts of other things on the machine (including
getting the tor binaries themselves.. this is what gpg is for :P), so
I agree that it is very important for operators to ensure that they
are protected against these attacks.
  - John Brooks

@_date: 2008-11-15 19:27:31
@_author: John Brooks 
@_subject: Torsocks on FreeBSD 
This sounds like a bug in the torsocks configure script to me - libdl
on linux is required to use dlopen and similar functions, but on BSD
is part of the normal libc. So, on linux, -ldl is required, and on
freebsd, it is an error (libdl does not exist). I imagine if the
script simply didn't check for or try to use libdl on BSD, you'd be
But, this probably isn't the best place to report issues with torsocks
- i'd recommend posting an issue to the bugtracker on
 and see where that will get you.
  - John Brooks

@_date: 2008-11-02 19:59:27
@_author: John Brooks 
@_subject: unknown_subject 
The route selection algorithm takes this into account - nodes with
exit traffic enabled are dramatically less likely to be used for
non-exit traffic. Eliminating it entirely could theoretically harm
anonymity by limiting the selection of middle nodes further and, more
importantly, by telling 3rd parties that every node contacting that
exit is going to be a middleman in someone's route. If the exit can be
used at any point in the chain, even if it is most likely as the
endpoint, that field can be widened dramatically.
Anyway, the point is, exit nodes will receive almost entirely exit
traffic by client selection anyway.
  - John Brooks

@_date: 2008-10-08 20:27:16
@_author: John Brooks 
@_subject: same first hops 
As has been mentioned recently (this seems to be a common problem),
every mail includes a header that says:
X-To-Get-Off-This-List: mail majordomo at seul.org, body unsubscribe or-talk
That should work for you.
- John Brooks

@_date: 2008-09-12 09:50:59
@_author: John Brooks 
@_subject: invitation to directory server operators 
I don't believe the common carrier concept applies to hidden services
at all, or at least less than traditional tor does. Consider - all
hidden service traffic is encrypted for its entire path through the
network. The *only* people capable of decrypting this traffic are the
client and the service, which means anyone in between (such as your
server) is entirely in the dark. Serving the directory is similar -
you are mirroring the published services, not endorsing them, hosting
them, or looking into their content in any way. There is nothing in
place that would allow you to moderate the content of hidden services
via the directory, so it would be unreasonable for that to be
expected. Given that it is an entirely automated process mirroring
descriptors published by other parts of the network (which you have no
direct relationship with), and that you have no feasible way of
moderating the content, I think even a country without common carrier
laws would find this to be not problematic.
Also, if this is enabled by default, it will still only be respected
if you are already serving the normal tor directory - in countries
with laws restrictive enough to prevent mirroring the hidden service
directory, it seems that you'd have issues with the standard directory
as well, not to mention actual tor traffic. I think the legal risks of
the hidden service directory are minimal beside the risks of normal
tor traffic, so I doubt it'd be a problem for many node operators (and
if it were, they could disable this option again).
But, i'm not a lawyer, and certainly not a lawyer in any foreign
countries, so this is all just my assumptions.
- John Brooks

@_date: 2008-09-02 09:44:14
@_author: John Brooks 
@_subject: another DirPort DoS attacker 
That is odd; I don't see what purpose a DoS against a specific
directory/node would serve (unless you were specifically attacking a
connection routed through that node, or trying to use latency attacks). Is
it an exit node? Could be retaliation from something a user did through your
node by someone who doesn't understand tor, although choosing the directory
port is a bit strange.
Another option would be that it's completely unrelated to tor. What port is
your directory on? If it's a common service/proxy port, it could be some
exploit attempt or similar getting confused. It's a bit worrying if someone
cares about attacking tor itself that much, in an abstract way.
Chances are it's nothing too worrisome, though.
- John Brooks

@_date: 2008-09-03 04:58:37
@_author: John Brooks 
@_subject: another DirPort DoS attacker 
I would be very interested to see what is being sent over these connections.
Since the directory is on port 443, it's possible that this is some
proxy/vulnerability scanner getting confused and hammering your server
thinking it's a webserver of interest. However, it should *not* be possible
for one IP to create that many directory connections to your tor server, and
use that much bandwidth with them. This definitely needs some limits added
(why would one IP ever need more than a couple directory connections to one
location?) to help make this sort of thing more difficult. A bit more
complicated, but it also might be a good idea to allow setting bandwidth
limits on directory connections seperately so you can ensure that they won't
interrupt relay traffic.
If it is something sending invalid, non-tor requests, perhaps it'd be a good
idea to stop accepting directory connections from IPs that are hammering you
with lots of requests resulting in file not found, method not supported,
etc. Especially with all of the newer research into latency-related attacks,
properly managing the resources of the server is very important.
If no one familiar with the code wants to (please do..), I could probably
hack up a patch to limit the number of directory connections from a single
IP. I haven't gotten around to reading much of the code, though, so it'd be
far easier for someone more familiar to it. As a quick alternative to that,
you could use iptables to set limits on the number of connections and amount
of bandwidth on the directory port.
I'm inclined to think this is an innocent case (rather than one targeted to
tor), mostly because it's on port 443 and there is no clear benefit to
attacking your node. M's message supports this. But these problems need to
be solved properly, or someday it will not be innocent at all :P
- John Brooks

@_date: 2008-09-25 20:02:24
@_author: John Brooks 
@_subject: How to strictly exclude exit nodes? 
I'm not certain, but I believe this message is indicating that the
exit node is *explicitly* requested for this route, and being used
despite that it would never be chosen for a normal route. That is, I
would guess this is using a .exit address (
to force the exit path, and it allows that despite blabla being in
ExcludeExitNodes. The specific behavior of Exclude(Exit)Nodes is to
not use the specified nodes when creating any routes - it won't use
them by itself, but will if you force it to.
You should be safe from using blabla for an exit for normal traffic.
- John Brooks

@_date: 2008-09-27 17:13:02
@_author: John Brooks 
@_subject: How to strictly exclude exit nodes? 
4 and 5 hop circuits can be created when contacting or publishing
hidden services and, I believe, sometimes when retrieving directory
information. Many nodes run directories on port 443, so that's not
particularly unusual.
For the thread as a whole, I still think the problem is that this exit
node is being *explicitly* requested ( and
that it would never be chosen automatically by tor itself, as I stated
in my first message. StrictExitNodes is an irrelevant setting.
- John Brooks
On Sat, Sep 27, 2008 at 7:55 AM, Anon Mus

@_date: 2008-09-29 20:38:19
@_author: John Brooks 
@_subject: Force exitnode oddness 
Tor cares about the hostname it is told to connect to having the
'.exit' suffix - privoxy won't modify that (afaik). What you want to
modify with privoxy is the Host header, so the server you're
connecting to can properly handle virtual hosting. So, you want a
filter rule to modify the Host header and remove '.something.exit'
from the end if present. I'm not a privoxy user myself, so I don't
have any insight on how to actually do that, but I hope that helps.
- John Brooks

@_date: 2008-09-04 00:51:14
@_author: John Brooks 
@_subject: Ports 465/587 in exit policy (was Re: Update to default exit policy) 
But it is worth noting that ISPs often are very unfriendly to spam. I've
received several abuse notifications from my dedi's ISP due to tor exit
traffic, all of it because of outgoing spam using insecure webmail services
(where my node's IP shows up in the headers as originating IP). I imagine
they'd take direct spam (from you to a mailserver) much more seriously, so
it could create more problems for node operators if their nodes are involved
in that so directly. I would say that is reason enough to not open port 25
by default, and likewise with 465/587 *IF* they are commonly unsecured.
Running an exit node is difficult enough already without having the ISP all
over you for being a spammer :P
It's an interesting balancing act, but might be worth trying for the uses it
does have. The other option would be for operators to explicitly allow these
ports to gmail IPs, but there might be quite a few of those, and it wouldn't
take care of other providers.
- John Brooks

@_date: 2008-09-07 20:04:43
@_author: John Brooks 
@_subject: Ports 465/587 in exit policy (was Re: Update to default exit policy) 
As someone involved heavily in IRC and the running of several IRC networks,
I think the primary reason most networks use random blacklists for tor
(there are several, some better than others in terms of operating properly)
is the unusual format of the official dnsel (
 Notably, with the software most
people use for proxy scanning, getting the exact port used to connect is
difficult or impossible, and sometimes the server IP is as well.
It might be beneficial to provide the DNSEL in a standard format (without
the destination ip/port) as well, for situations where that distinction
isn't feasible. This would at least be better than leaving that blacklisting
to third parties who often don't understand quite what they're doing :P
- John Brooks

@_date: 2008-09-11 10:50:47
@_author: John Brooks 
@_subject: invitation to directory server operators 
Added this to my high bandwidth node - I would've done so far sooner if I
had known it wasn't default behavior. I'd say this should be enabled by
default or at least get a line in the example torrc so people know it
- John Brooks
