
@_date: 2006-07-16 21:56:30
@_author: Jan Danielsson 
@_subject: Problems running TOR for an extended period 
Hello all,
   [note: I'm posting this to NetBSD's pkgsrc-user mailing list, as well
as the TOR talk mailing list]
   I'm trying to run tor v0.1.1.22 on NetBSD/amd64 3.0. I'm running it
as an exit node. It does seem to run pretty fine, but only for a while.
I noticed that it does consume *vast* amounts of RAM, and after a while
it has consumed so much that it starts eating off the swap, and finally
I get messages which state that TOR processes are being killed off for
eating up the remaining swap.
   This is an except from "top" (yes, I am aware of that "top" isn't
optimal for memory related detective work).
  PID USERNAME PRI NICE   SIZE   RES STATE      TIME   WCPU    CPU COMMAND
 1535 tor        2    0    38M   23M netio      0:00  0.00%  0.00% tor
 1202 tor        2    0    38M   23M netio      0:00  0.00%  0.00% tor
  709 tor        2    0    38M   23M netio      0:00  0.00%  0.00% tor
 1823 tor        2    0    38M   23M netio      0:00  0.00%  0.00% tor
 1126 tor        2    0    38M   22M netio      0:00  0.00%  0.00% tor
 1069 tor        2    0    38M   22M netio      0:00  0.00%  0.00% tor
 1716 tor        2    0    38M   22M netio      0:00  0.00%  0.00% tor
 1688 tor        2    0    38M   22M netio      0:00  0.00%  0.00% tor
 1198 tor        2    0    38M   22M netio      0:00  0.00%  0.00% tor
 1150 tor        2    0    38M   22M netio      0:00  0.00%  0.00% tor
   I'm not really sure how an application which relays TCP traffic
(albeit encrypting/decrypting it) can consume this amount of RAM. Is it
really normal?
   What's worse... A few times NetBSD has hung, *completely* (requiring
hard reset), when TOR has consumed all memory. I have never has NetBSD
crash hard on me before as far as I can remember. Since I started
running TOR a few days ago, I have had several total crashes.
   Is anyone else having problems with tor and memory consumption? On

@_date: 2006-07-17 02:41:15
@_author: Jan Danielsson 
@_subject: Problems running TOR for an extended period 
That is what I was thinking, but I decided against it since I
wouldn't want to connect through such a system myself (since I would
need to restart it hourly in order to get some kind of stability from
it). My TOR exit node does get a lot of traffic, and in case someone is
downloading something rather large, I don't want to interrupt it
periodically. Sometimes my node can run for a whole day, other times
just half an hour, before crashing. Restarting it each hour feels evil.
   I'd rather like to find a real solution to the problem. Mainly,
getting a working gethostbyname_r(). Btw.. What is the origin of
gethostbyname_r()? Does it exist in all common/mainstream unicies?
   As a side note, I don't understand why the calls to gethostbyname()
can't be mutex'd on BSD systems, rather than just switching over to an
all fork'd design. Are there other calls which are affected as well?
   OS/2 was designed for multi threading from the ground up, but at some
odd times I did actually encounter API:s which weren't thread safe.
Instead of kicking off a bunch of separate processes, I simply protected
those API:s with a mutex semaphore. An ugly workaround, but not as ugly
as launching an army of processes, imho. But then again, I'm unaware if
there are other issues adding to the problem.

@_date: 2006-07-17 14:46:07
@_author: Jan Danielsson 
@_subject: Problems running TOR for an extended period 
No offense taken. However, the wiki I was pointer to earlier in this
thread is a bit to flammable for my tastes. From
   "[---] If you want to run a Tor server, we recommend you upgrade to a
better OS."
   Although this wiki is linked to from the TOR site, I am unsure if it
is an official TOR wiki, so this may be off-topic. I am also not sure if
the quote above is meant to say "[...] a better OS [for running a TOR
server]" or "[...] a better OS [period!]". If the latter is intended, I
suggest someone change it, because I don't feel that a TOR wiki is the
place for OS advocacy.
   Also, the statement is pointless in the sense that I highly doubt
that many users are about to switch operating system just to run TOR. I
may be wrong, but I know I certainly wouldn't -- even though I very much
am a supporter of what TOR is trying to accomplish.
   Anyway, even if OS advocacy wasn't intended, it's still pretty
flammable, imho. It would be better to mention that in NetBSD-current,
the gethostbyname_r() problems should be fixed. Or mention other
possible future directions which may work around such problems, and ask
for help from the BSD community.
   I know.. I have used API:s which I though were reentrant and mt-safe
but turned out not to be. It was an "interesting" exercise, as in "what
an interesting brain tumor you have". But in my case it wasn't
mislabeled; it was my own fault for not reading the document
introduction properly.
   Ah, obviously. I never even thought of DNS lookups as being slow. :-/
   Oh, so the actual code (+ bug) is already there? Neat. I'll take a
look. Is a new release, with built in DNS resolver, planned for the near

@_date: 2007-11-10 12:59:16
@_author: Jan Danielsson 
@_subject: 20090101 
Hash: SHA512
   I assume that they made sure to put one, or more, "make available to
the state" cause in there?
   If not, I'm just wondering how they'd react if I do log (as
required), and if they want the logs, I send them a
