
@_date: 2015-02-04 15:19:45
@_author: contact_tor@nirgal.com 
@_subject: [tor-talk] How to protect apache local-restricted from secret 
When you have a website that is available from a tor secret service, how
do you forbid access to url restricted to ip=localhost?
I'm thinking of apache default  for example.
Using "a2dismod status" is the obvious solution for that one, but does
anyone had a more generic solution?
Maybe a full VM with a vif interface? That's an heavy solution...
Anything more simple?
The web site I'm thinking about has a public address, nothing to hide,
and the .onion address is only there to protect the users. But I'd
rather not introduce too many security issues...
(BTW, a warning about these issues on
 would be nice)

@_date: 2015-02-06 15:49:45
@_author: contact_tor@nirgal.com 
@_subject: [tor-talk] How to protect apache local-restricted from secret 
I don't think you can a firewall, no:
"apachectl status" is querying from localhost to
Connection from tor hidden service also comes from localhost and
iptables won't help there.
I tried 10 random http hidden services with that trick, and could find 2
servers with information that shouldn't be available, like which service
are sharing on the same server, the security patch level, list of URL
being served, and so on. I also could read one public IP on another one. :(
If you run apache, you should probably disable mod_status. Now.
# grep -iEr 'require +local' /etc/apache2/
lists possible problems for apache2.4, for example.
Each webapp should also be checked for special permissions granted when
remote IP is actually localhost.
Documentation really should warn about this, IMHO:
and possibly a one line warning in the example torrc since
"HiddenServicePort 80 127.0.0.1:80" typically is a problem.
I might move httpd and tor to 2 different VM. Any nicer idea?

@_date: 2015-02-27 14:37:40
@_author: contact_tor@nirgal.com 
@_subject: [tor-talk] How to protect apache local-restricted from secret 
How can I make that happen?
Here's a draft for the last bullet points (English is not my native
* Make sure you don't grant access to special URLs based on source IP
address, since all connection will come from localhost or wherever you
install tor on your LAN. For example, on apache, you should disable
mod_status and all modules/sites/conf with "Require local" directive.
In example torrc, we could add:
 Be aware source IP filtering will not be available:
 see  /var/lib/tor/hidden_service/
 80 127.0.0.1:80

@_date: 2015-01-19 09:46:39
@_author: contact_tor@nirgal.com 
@_subject: [tor-talk] force apt-get & yum updates through tor? 
I never could make apt works directly with socks proxies. But html
proxies are fine. If you set up polipo or similar and use:
  Acquire::http::Proxy "
or for a specific PPA:
  Acquire::http::Proxy::abcdefghijklmnop.onion "
In recent versions, one can add a file with this in /etc/apt/apt.conf.d/
This works for me.

@_date: 2016-06-11 08:55:18
@_author: contact_tor@nirgal.com 
@_subject: [tor-talk] Please suggest domain registrats that are Tor (and 
I strongly advise against using orangewebsite: They rent "freshly
installed servers" with /root/.ssh/authorized_keys that is pre-seed!
Maybe their dns service is ok however...
(It's a real pity because they use 100% renewable energy, and that was

@_date: 2018-07-03 11:45:17
@_author: Nirgal 
@_subject: [tor-talk] .onion eat http 413 errors 
I am working on a web site that allow users to post big files.
Because some people don't use javascript, and because I don't want to use the PHP limit where an error message such as "Sorry uploads are limited to 1MB" appears *after* the user spent many hours uploading a 1GB file, I am trying to use the good old 413 errors generated by apache LimitRequestBody directive, or simmilar stuff from nginx.
It works ok when I use TorBundle to post on my regular  site. I get my nice HTTP 413 error page with custom explanations.
But when I use the .onion address to do a big post, I always get a generic "The connection was reset" message, and no http error code, nor customized error message.
It's a bit like if the browser doesn't even try to read the answer before the connection with the POST is hang by the server, when the .onion is used.
Did any one already experience that behaviour?
Any known work around?

@_date: 2019-10-23 11:49:22
@_author: Nirgal 
@_subject: [tor-talk] TorBrowser is only showing a black windows after today's 
I'm using Tor Browser Bundle on Debian stable, with xfce.
After last update, tor is only showing a black windows.
I get the first small window "Establishing a connexion..." then the regular
big window "Tor Browser", so I guess some stuff is working. But it's unusable
because both windows are totally black.
Any one else have that issue?
Any work around?
When running with --verbose, I get this kind of errors:
[21969, Main Thread] WARNING: failed to open shm: Permission denied: file /var/tmp/build/firefox-d051ff6e2f60/ipc/chromium/src/base/shared_memory_posix.cc, line 142
Crash Annotation GraphicsCriticalError: |[0][GFX1-]: Failed to lock new back buffer. (t=0.466201) [GFX1-]: Failed to lock new back buffer.
[21969, Main Thread] WARNING: failed to open shm: Permission denied: file /var/tmp/build/firefox-d051ff6e2f60/ipc/chromium/src/base/shared_memory_posix.cc, line 142
Crash Annotation GraphicsCriticalError: |[0][GFX1-]: Failed to lock new back buffer. (t=0.466201) |[1][GFX1-]: Failed to lock new back buffer. (t=0.471717) [GFX1-]: Failed to lock new back buffer.
[21969, Main Thread] WARNING: failed to open shm: Permission denied: file /var/tmp/build/firefox-d051ff6e2f60/ipc/chromium/src/base/shared_memory_posix.cc, line 142
Crash Annotation GraphicsCriticalError: |[0][GFX1-]: Failed to lock new back buffer. (t=0.466201) |[1][GFX1-]: Failed to lock new back buffer. (t=0.471717) |[2][GFX1-]: Failed to lock new back buffer. (t=0.494473) [GFX1-]: Failed to lock new back buffer.
[21969, Main Thread] WARNING: failed to open shm: Permission denied: file /var/tmp/build/firefox-d051ff6e2f60/ipc/chromium/src/base/shared_memory_posix.cc, line 142
Crash Annotation GraphicsCriticalError: |[0][GFX1-]: Failed to lock new back buffer. (t=0.466201) |[1][GFX1-]: Failed to lock new back buffer. (t=0.471717) |[2][GFX1-]: Failed to lock new back buffer. (t=0.494473) |[3][GFX1-]: Failed to lock new back buffer. (t=0.505148) [GFX1-]: Failed to lock new back buffer.
[21969, Main Thread] WARNING: failed to open shm: Permission denied: file /var/tmp/build/firefox-d051ff6e2f60/ipc/chromium/src/base/shared_memory_posix.cc, line 142
Crash Annotation GraphicsCriticalError: |[0][GFX1-]: Failed to lock new back buffer. (t=0.466201) |[1][GFX1-]: Failed to lock new back buffer. (t=0.471717) |[2][GFX1-]: Failed to lock new back buffer. (t=0.494473) |[3][GFX1-]: Failed to lock new back buffer. (t=0.505148) |[4][GFX1-]: Failed to lock new back buffer. (t=0.554666) [GFX1-]: Failed to lock new back buffer.
[21969, Main Thread] WARNING: failed to open shm: Permission denied: file /var/tmp/build/firefox-d051ff6e2f60/ipc/chromium/src/base/shared_memory_posix.cc, line 142
Crash Annotation GraphicsCriticalError: |[0][GFX1-]: Failed to lock new back buffer. (t=0.466201) |[1][GFX1-]: Failed to lock new back buffer. (t=0.471717) |[2][GFX1-]: Failed to lock new back buffer. (t=0.494473) |[3][GFX1-]: Failed to lock new back buffer. (t=0.505148) |[4][GFX1-]: Failed to lock new back buffer. (t=0.554666) |[5][GFX1-]: Failed to lock new back buffer. (t=0.704898) [GFX1-]: Failed to lock new back buffer.
