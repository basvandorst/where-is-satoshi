
@_date: 2005-04-16 02:05:29
@_author: alexyz@uol.com.br 
@_subject: Event Log errors in Windows 
I?m not sure this is a bug but I will report it anyhow. Since running Tor
as server I had been getting lots of "Event 4226" entries in the Event Log
Viewer of Windows XP SP2. Five per day to be exact over 2 straight days.
After some research, it comes out that event 4226 signals a TCP/IP stack
limit to the rate of opening half-opened connections. The following quotes
should be more meaningful to you network specialists.
"SP2 has limited the number of possible TCP connection attempts per second
to 10"
[the limit] "...only applies to incomplete outbound connections, where the
client has sent a SYN packet but hasn't yet received a SYN-ACK packet from
the server. This is the first thing the server's TCP stack does, before it
even informs the server application that a connection is being made (i.e.
accept() doesn't return yet). The reason for the limit is simple: to
prevent simple SYN-flooding attacks."
There was no limit in WinXP SP1 but Microsoft changed this in SP2
apparently to prevent worms from spreading more quickly. Here is another
quote I found.
"The idea of MS is not bad to reduce the spreading of worms and other
harmful programs. But 10 half-open connections [per sec] is a little bit
too less. With a higher (e.G. 25-100) number of waiting for connection
connections the benefit would be almost the same, but less normal users
would feel disturbed by this."
The noticeable effect of this problem is that browsing becomes (very)
sluggish and I believe Tor connections in the background are also
suffering as connection attempts have to be queued to conform to the
limit. So I decided to do something about it and researched some more. In
SP1 the limit was changeable in the registry. In SP2 it can not be
changed. I found that there are some unofficial patches going around the
net that simply increases this number to 50. The patch is done to the
TCPIP.SYS file. (It can be obtained here=>
After installing the patch, my browsing is restored to normal and there
are no more event 4226 entries. BUT, I now get event 7023 in the log (4
per day):
The service Tor Win32 Service terminated with an error: I couldn?t find info on event 7023, and I doubt I?m going to find event
7023 with an error message that specifically mentions Tor.
One last thing, I started running version 0.0.9.8 and then switched to
0.1.0.3-rc. The event 4226 entries occurred with both versions.

@_date: 2005-04-16 10:29:17
@_author: alexyz@uol.com.br 
@_subject: Event Log errors in Windows 
Ok, the 4226 has not disappeared as I thought. Aproximately 54 hours after I patched tcpip.sys I have 2 new 4226 entries closely together (2hr interval). With TCPview I can see that Tor has right now a little over 200 established connections. There were certainly not that many 54 hours back, maybe the errors now have something to do with the build up of these connections.

@_date: 2005-04-17 21:28:14
@_author: alexyz@uol.com.br 
@_subject: Publishing node IPs 
I understand the need to keep a list in a central server for initial connections. But why make this list public by publishing the IPs in a webpage?  Isn?t it ambiguous that an anonymous network is identifying itself? By making the node IPs public, there is an implicit message saying "hey everyone afraid of me, here is how to block me".  Granted there are other ways to obtain that information. But considering that the likely attackers of this network include governments, I wouldn?t make it easier for them.

@_date: 2005-04-25 12:44:44
@_author: alexyz@uol.com.br 
@_subject: both my servers crashed 
I did have a problem regarding the TCP/IP stack limit that WinXP SP2 imposes. When the limit was reached, new connections were slow and it became dificult browsing. I solved it by gradually increasing the limit until at 200 there was no more problems (the default is 10). It?s worth investigating if this is at least part of your problem. It?s very easy to do that, just go to E
Event Viewer and see if you are getting 4226 event warnings.

@_date: 2005-04-25 18:17:08
@_author: alexyz@uol.com.br 
@_subject: both my servers crashed 
If you are using SP1 it is configurable in the registry (don?t know where). If you use SP2 you can only change it with a patch to the tcpip.sys file. Get it here:
This patch will show you the current limit and allow you to change it to whatever you want. It even creates a backup of the tcpip.sys file if you want to switch back (just run it again). You should know this patch is unofficial but I had no problems or side effects (10 days in the running now). I also have other servers running besides Tor and all is happily chugging along. I started getting 7023 errors but those were related to shuting down (which I had to do frequently to fine tune the limit) and eventually did not appear again.

@_date: 2005-04-26 03:10:47
@_author: alexyz@uol.com.br 
@_subject: Tor on LAN 
I can?t get Tor server to work properly from behind a LAN. This should be straightforward but I can?t figure it out.
If I don't use the "Address" setting in torrc, Tor will not guess my IP correctly (it reports the internal private IP). I?ve set it manually to reflect the WAN.
The client functions Ok and the DirPort is reachable from the outside. But the ORPort is not. Both are deafult and are properly forwarded in the router.
Any troubleshooting tips?

@_date: 2005-04-28 15:32:49
@_author: alexyz@uol.com.br 
@_subject: Tor 0.4 and 0.5 throughput 
I can?t see any throughput when using the 0.1.0.4 or 0.1.0.5 versions. It?s just a very small trickle. If Iswitch to 0.1.0.3 transfers are restablished to normal levels. In all cases I am using bandwidth limiting. Just thought you?d like to know. cheers

@_date: 2005-04-13 10:57:18
@_author: alexyz@uol.com.br 
@_subject: begginer at Tor 
I?ve been using Tor as a client for some time and decided to run a server as well. I have read the FAQ and documentation for servers but still have doubts. I hope this is the place to discuss them.
I am playing around with the configuration of exit policies. If I change them, how do I get Tor to recognize the changes (or any other change in the torrc file)? Do I have to quit and restart (and thus break existing connections)?
If I need to restart my computer or shut it down for any reason. Is there a way to "soft" close Tor and not disrupt existing I?ve seen something on the manual relative to SIGNALS. What are these for and how do I use them?
Logging. Since this project is still in the alpha phase I believe you would appreciate reports of weird behaviour. How do I recognize these, what are you guys interested in? What level of logging should I start with?
Security. Since running Tor server, the number of portscans I get has increased dramatically. I use Norton Firewall (and also Anti-
Virus) so they don?t go any further. But I just started wondering if I should take extra precautions because now I run a server. What do you think about extra precautions and what might those be?
I have some philosophical questions in nature but I?ll start a different thread for those.

@_date: 2005-04-13 11:12:10
@_author: alexyz@uol.com.br 
@_subject: hack attempts of Tor? 
I?ve been getting the following warning messages a lot:
Apr 13 10:11:39.984 [warn] connection_tls_finish_handshake(): Identity key not as expected for router claiming to be 'JAP' There IS a ?jap? nick in the list of tor nodes but the IP is 141.76.46.90 (currently, at least). This obviously doesn?t look good.
I also got earlier a suspicious warning message. Something about Cookie not as expected (logging is currently off, I?m not sure how to properly turn it on...). In the manual there is something about controling Tor (and it involves CookieAuthentication) but I think it will only accept local connections. Anyway, if I had the mindset of a hacker, I would certainly explore the possibilities of taking control over Tor servers using this feature.
I hope you developers and network experts have your eye on this (if indeed this a cause for concern). I can see that Tor usage is gaining momentum and the volume of hack attempts is surely to go up as Tor?s popularity increases.

@_date: 2005-04-13 11:46:05
@_author: alexyz@uol.com.br 
@_subject: philosophical issues 
Hi again!
I?ve read the legal FAQ and all I can say is that it takes bravery to setup a Tor server. It also takes bravery to standup against oppessors and fight for freedom.
Generally speeking, the strongest defense with Tor ops is that servers only act as a conduit for other people?s doings. Thus you are not the perpetrator of those doings and are not liable for them. But people are also creative... What happens if an attacker decides to run a server to disguise his own wrong-doing? When questioned, he could just point to the server and say it came from Tor network. As it is anonymous, he can?t detect the source, blah blah blah, he walks. Or, he is demanded to prove his innocense. In either case, the outcome is unacceptable, they are both wrong! The thought of this situation really scares me, what do you Another issue has to do with abuse. Yes, I know it has been battered before, and everyone at Tor is commited to fighting this. But what exactly is being done? My concern is that the law (and I refer to it here only generically since it varies considerably from country to country), suggests that service providers should have means to fight abuse (at a reasonable level) and terminate service to repeat offenders. A Tor server is a service provider, are we not? So it seams to me that we would be REQUIRED (I know it is desirable to developers but is that enough?) to have reasonable means to fight abuse. Do you agree with my assessment? IS there anything? SHOULD there be something? Do we HAVE to have something?

@_date: 2005-04-13 11:59:30
@_author: alexyz@uol.com.br 
@_subject: country banning 
Hi! Again!
I?m not sure how this impacts or fits in the Tor network. Before running Tor as a server, I had made the decision to block any connection (to and from) Korean and Chinese IPs. I know this is rash and I hate the notion that I?m in a way censoring these countries. But I get so much crap from IPs originating there that I declared it unsafe to connect to.
My preocupation now is that being part of the Tor network, I am breaking connections to and from those countries. Will the Tor nodes "sense" that this is happening and avoid my node for those connections? Considering my policy, am I fit to be a part of this All your comments are appreciated. thanks

@_date: 2005-04-13 16:31:34
@_author: alexyz@uol.com.br 
@_subject: hack attempts of Tor? 
I?ve taken a look at the release notes for 0.1.0.3-rc and found:
Bugfixes on 0.0.9.x:
When we're connecting to an OR and he's got a different nickname/key than we were expecting, only complain loudly if we're an OP or a dirserver. Complaining loudly to the OR  admins just confuses them.
I guess that means that I?m confused :-)

@_date: 2005-04-13 16:34:28
@_author: alexyz@uol.com.br 
@_subject: hack attempts of Tor? 
I?ve taken a look at the release notes for 0.1.0.3-rc and found:
Bugfixes on 0.0.9.x:
When we're connecting to an OR and he's got a different nickname/key than we were expecting, only complain loudly if we're an OP or a dirserver. Complaining loudly to the OR  admins just confuses them.
I guess that means that I?m confused :-)
I?ve upgraded to the new beta version and will keep an eye out.

@_date: 2005-06-01 20:11:57
@_author: alexyz@uol.com.br 
@_subject: evil nodes 
Is it possible for an exit node to inject malicious javascript code on http requests?

@_date: 2005-06-02 17:42:34
@_author: alexyz@uol.com.br 
@_subject: evil nodes 
Trustworthiness is dificult to measure but there is less and there is more. While I wouldn?t put my life on the line for my ISP, it is bound by a contract with me and is accountable by law for certain behaviours. That relation enforces some trust that I will never have with any Tor node. And obviously not all of them are alike. Based on your information I may decide to enforce my communications through specific exit nodes that I deem more trustworthy. But that will not be effective if middle and entry nodes can attack the same way. Will the encryption between the nodes somehow deter this?
Threre is risk in everything we do, I just wish to understand those risks so I can manage them. SSL is a great tool to deal with this situation but it is not always available. What do you think is more likely, that an attacker uses statistical analysis on big portions of the internet or inject code in the streams to allow him later to have a trojan phone home and identify the computer?

@_date: 2005-06-09 16:35:47
@_author: alexyz@uol.com.br 
@_subject: evil nodes 
It just occurred to me that Privoxy does some Javascript filtering. I had a bad time searching their documentation, only found a reference to "taming" the code, whatever that +filter{js-annoyances}       # Get rid of particularly annoying JavaScript abuse
Does anybody know what the filter above does? Could privoxy be used to provide some level of protection for evil Javascript code? Maybe it?s too much to ask from Privoxy but disabling Javascript altogether really breaks some sites.

@_date: 2005-05-25 12:08:25
@_author: alexyz@uol.com.br 
@_subject: raise ulimit? 
This is an interesting warning message:
[warn] connection_add(): Failing because we have 991 connections already. Please raise your ulimit -n.
Got several of them and don?t know what to do. I am not using bandwidth limiting, if that?s what it is refering to.

@_date: 2005-05-13 17:53:38
@_author: alexyz@uol.com.br 
@_subject: Tor crashes 
I had been running Tor server quite succesfully until I had to fully reformat my HD due to a hack breach. After reinstalling OS and apps I can?t get Tor to run for more than an hour before it crashes. Tried versions 0105, 0103 and 0099. Below are the most significant messages: (libevent poll with win32 failed and poll failed)
I suspect misconfiguration on my system but I don?t know where to start looking.Pointers? May 13 12:34:22.921 [notice] circuit_send_next_onion_skin(): Tor has successfully opened a circuit. Looks like it's working.
May 13 12:35:31.687 [notice] router_dirport_found_reachable(): Your DirPort is reachable from the outside. Excellent.
May 13 12:54:20.406 [err] do_main_loop(): libevent poll with win32 failed: No such file or directory [2]
May 13 15:28:50.546 [notice] tor_init(): Tor v0.1.0.3-rc. This is experimental software. Do not rely on it for strong anonymity.
May 13 15:28:50.562 [notice] options_act(): Initialized libevent version 1.0b using method May 13 15:29:27.625 [notice] circuit_send_next_onion_skin(): Tor has successfully opened a circuit. Looks like it's working.
May 13 15:29:27.625 [notice] circuit_send_next_onion_skin(): Now checking whether ORPort and DirPort are reachable... (this may take several minutes)
May 13 15:32:13.453 [notice] router_orport_found_reachable(): Your ORPort is reachable from the outside. Excellent. Publishing server descriptor.
May 13 15:43:14.593 [notice] router_dirport_found_reachable(): Your DirPort is reachable from the outside. Excellent.
May 13 16:01:02.718 [notice] cull_wedged_cpuworkers(): Bug: closing wedged cpuworker. Can somebody find the bug?
May 13 16:32:14.031 [err] do_main_loop(): libevent poll with win32 failed: No such file or directory [2]
May 13 16:51:43.171 [notice] tor_init(): Tor v0.0.9.9. This is experimental software. Do not rely on it for strong anonymity.
May 13 16:52:08.875 [notice] circuit_send_next_onion_skin(): Tor has successfully opened a circuit. Looks like it's working.
May 13 16:58:41.750 [warn] connection_about_to_close_connection(): Harmless bug: Edge connection (marked at main.c:278)hasn't sent end yet?
May 13 17:07:58.343 [err] do_main_loop(): poll failed: No buffer space available [WSAENOBUFS ] [10055]

@_date: 2005-05-17 09:51:00
@_author: alexyz@uol.com.br 
@_subject: Filtering out attacks? 
Date sent:      	Mon, 16 May 2005 15:20:54 -0400
If I can make an additional suggestion, why not have Tor implement some kind packet inspection? I believe routers around the world implement this to different degrees so I wouldn?t consider it invasive or judgemental. It is only to guarantee communications in line with RFC standards. This would certainly deter some abusive attacks.
I think Tor developers should not make judgements like you pointed out. But as a server op I do reserve the right to make those decisions. I do so already by defining exit policys, for example. In line with this thought, I would incorporate these tools as optional/configurable. This will allow server volunteers set how much service they want to provide to the Tor network. By incorporating them as optional you also broaden the audience of likely server operators. In the future, how many people would volunteer knowing that they could face abusive charges from organizations or ISPs? SPI and DoS tools are a means of reducing these risks to the server ops.

@_date: 2005-05-17 18:06:57
@_author: alexyz@uol.com.br 
@_subject: Filtering out attacks? 
I wasn?t really thinking of high level filtering such as IP filtering or content filtering but more on (invalid) packet header filtering. For example, deliberate use of bad checksums, unusual TCP flags or IP options, invalid sequence numbers, spoofed addresses, duplicate TCP packets with differing payloads, packets with short TTLs that expire between targets, and so on. Yes, this would break the connection after the node had negotiated with the client but you can argue that the packets were invalid in the first place and should not be sent at all.
I guess what I was suggesting was an Intrusion Detection System filtering Tor?s output. IDS systems can be very complex and I don?t think this should be Tor?s priority. I can always resort to third-party applications if I wish to do so.
