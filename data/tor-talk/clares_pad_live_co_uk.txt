
@_date: 2014-07-13 17:56:24
@_author: =?ks_c_5601-1987?B?Q2xhcmUgot0=?= 
@_subject: [tor-talk] Why isn't my proxy working? 
I'm using an isolating proxy that I've set up on a separate machine running Tor on OpenWRT. I can connect to it, and ping my computer from the Tor machine, but when I try to browse the internet, I'm told that my proxy is refusing connections. I'm thinking that there must be a problem with my firewall rules. Here's a link to a question I posted that includes the rules (I won't post them here directly, as I've had issues with formatting in the past): Any help is appreciated!

@_date: 2014-07-14 19:05:25
@_author: =?ks_c_5601-1987?B?Q2xhcmUgot0=?= 
@_subject: [tor-talk] Tor-based firewall issues. 
Can anyone help with the issues that I describe here? Any help would be greatly appreciated!

@_date: 2014-05-17 14:59:23
@_author: =?ks_c_5601-1987?B?Q2xhcmUgot0=?= 
@_subject: [tor-talk] Isolating Proxy and iptables. 
I'm setting up a Tor-based isolating proxy using the 'Anonymizing Middlebox' iptables rules specified here: iptables -t nat -A PREROUTING -i $INT_IF -p udp --dport 53 -j REDIRECT --to-ports 53iptables -t nat -A PREROUTING -i $INT_IF -p tcp --syn -j REDIRECT --to-ports 9040
...and the INPUT, OUTPUT and FORWARD chains are left at the default. Would there be any merit to also including the following rules?
iptables -P INPUT DROPiptables -P FORWARD DROPiptables -P OUTPUT DROP
iptables -A INPUT -i lo -j ACCEPTiptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPTiptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
Or are they rendered unnecessary by my current setup?
Are there any other firewall rules that I should consider in order to improve security and ensure that all traffic is torified?
Many thanks.

@_date: 2014-05-17 15:48:56
@_author: =?ks_c_5601-1987?B?Q2xhcmUgot0=?= 
@_subject: [tor-talk] Isolating Proxy and iptables. 
I've just noticed that this is terribly formatted. Let me try to re-format my rules for easier reading (if this fails again, please do excuse me!). iptables -t nat -a PREROUTING -i $INT_IF -p udp --dport 53 -j REDIRECT --to-ports 53iptables -t nat -A PREROUTING -i $INT_IF -p tcp --syn -j REDIRECT --to-ports 9040
And the rules that I'm considering... iptables -P INPUT DROPiptables -P FORWARD DROPiptables -P OUTPUT DROP
iptables -A INPUT -i lo -j ACCEPTiptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPTiptables -A OUTPUT -o lo -j ACCEPTiptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
Any help would be greatly appreciated.

@_date: 2014-05-17 15:51:52
@_author: =?ks_c_5601-1987?B?Q2xhcmUgot0=?= 
@_subject: [tor-talk] Isolating Proxy and iptables. 
One more attempt... iptables -t nat -a PREROUTING -i $INT_IF -p udp --dport 53 -j REDIRECT --to-ports 53iptables -t nat -A PREROUTING -i $INT_IF -p tcp --syn -j REDIRECT --to-ports 9040
And the rules that I'm considering... iptables -P INPUT DROPiptables -P FORWARD DROPiptables -P OUTPUT DROP
iptables -A INPUT -i lo -j ACCEPTiptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPTiptables -A OUTPUT -o lo -j ACCEPTiptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
Apologies for the spam!

@_date: 2014-05-17 18:05:38
@_author: =?ks_c_5601-1987?B?Q2xhcmUgot0=?= 
@_subject: [tor-talk] Isolating Proxy and iptables. 
Thanks! It's incredibly helpful to see how more experienced users have Tor set up. Sorry again for the poor formatting in my post, no idea what's up with that. might help you.
It has been suggest recently, to additionally block rules:
iptables -A OUTPUT -m conntrack --ctstate INVALID -j DROP
iptables -A OUTPUT -m state --state INVALID -j DROP

@_date: 2014-05-17 18:07:24
@_author: =?utf-8?B?Q2xhcmUg4pms?= 
@_subject: [tor-talk] Isolating Proxy and iptables. 
Haha, yeah, I also posted my question there. Thanks for noticing that and posting the link, I probably should have just done that in the first place. * Clare ?? schrieb am 2014-05-17 um 17:48 Uhr:
A version with better formatting is here:
