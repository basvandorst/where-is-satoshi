
@_date: 2009-08-21 15:52:56
@_author: Bob Williams 
@_subject: Annoying loop situation 
My system is openSUSE 11.1 and I'm using Firefox 3.0.13
I have both privoxy and torbutton installed. When I setup Firefox's proxy settings to use http and ssl through 127.0.0.1 port 8118 and SOCKS host 127.0.0.1 port 9050, torbutton enables itself. If I then disable torbutton (I'm only really interested in running a tor relay) the Firefox settings revert to 'No proxy'.
I'd like to run privoxy for all my browsing, whether I'm using tor client mode or not, and also run a tor relay. I'm sure this was working before a recent kernel upgrade and reboot.
Any suggestions, please? Do you need to see any part of my config files?

@_date: 2009-08-21 22:33:07
@_author: Bob Williams 
@_subject: Annoying loop situation 
Well, that's the odd thing. I start with torbutton disabled (red message on the Firefox status bar). I then go to Firefox > Edit > Preferences > Network > Settings and select Manual Proxy Configuration. (I notice that it tells me to Disable Torbutton to change these settings, but it's already disabled). I select 127.0.0.1 port 8118 for http and ssl, and port 9050 for socks. When I click OK, Torbutton becomes enabled :(
At this point,  shows me I'm that privoxy is enabled, but if I then disable torbutton, I also lose my privoxy settings, and it reverts to 'No proxy.'

@_date: 2009-08-22 08:46:57
@_author: Bob Williams 
@_subject: Annoying loop situation 
In what way? The uncommented lines in my privoxy config file are:
user-manual  /usr/share/doc/packages/privoxy-doc/source/user-manual
trust-info-url  trust-info-url  proxy-info-url confdir /etc/privoxy
logdir /var/log/privoxy
actionsfile standard.action  # Internal purpose, recommended
actionsfile default.action   # Main actions file
actionsfile user.action      # User customizations
filterfile default.filter
filterfile user.filter      # User customizations
logfile logfile
debug   4096 # Startup banner and warnings
debug   8192 # Non-fatal errors
listen-address  127.0.0.1:8118
toggle  1
enable-edit-actions 1
enforce-blocks 0
buffer-limit 4096
forward         192.168.*.*/     .  forward-socks4a	/	127.0.0.1:9050	.
forward-socks5	/	127.0.0.1:9050	.
allow-cgi-request-crunching 0

@_date: 2009-08-22 09:19:02
@_author: Bob Williams 
@_subject: Annoying loop situation 
This looks interesting. I shall give it a try.  So, I uninstall torbutton, clear my proxy settings, re-install torbutton, select Preferences on the torbutton right click menu and choose 'Use recommended settings for my version of Firefox [Use Privoxy]?
And this will leave privoxy active whether or not I'm enabling torbutton?

@_date: 2009-08-22 12:27:22
@_author: Bob Williams 
@_subject: Annoying loop situation 
That makes sense. It may be that I'll have to settle for not using privoxy for my normal browsing. My main 'tor' aim is to provide a relay. If I browse with torbutton enabled, I get funny results for Google searches, in languages that depend on the location of the exit node ;)

@_date: 2009-08-22 17:52:55
@_author: Bob Williams 
@_subject: Annoying loop situation 
The effect of this would be the same as NOT having the forward-socks* lines, wouldn't it? i.e. leaving forwarding unset?

@_date: 2009-07-23 23:36:02
@_author: Bob Williams 
@_subject: Newbie needs help 
My system is openSUSE 11.1 x86_64 with KDE4.2.4 desktop, using linux kernel 2.6.27.25-0.1-default, and Firefox 3.0.11.
I've installed Privoxy and Tor, but I'm having difficulty with the setup. I can launch both programs:
18:58 user:~> privoxy /etc/privoxy/config
Jul 23 20:29:33.391 Privoxy(7fb481fa96f0) Info: Privoxy version 3.0.10
Jul 23 20:29:33.391 Privoxy(7fb481fa96f0) Info: Program name: privoxy
Jul 23 20:29:33.410 Privoxy(7fb481fa96f0) Info: (Re-)Opening logfile 20:29 user:~> tor -f /etc/tor/torrc
Jul 23 20:29:44.752 [notice] Tor v0.2.0.35. This is experimental software. Do not rely on it for strong anonymity. (Running on Linux x86_64)
Jul 23 20:29:44.752 [notice] Initialized libevent version 1.4.5-stable using method epoll. Good.
Jul 23 20:29:44.752 [notice] Opening Socks listener on 127.0.0.1:9050
but when I select torbutton preferences (having selected 'Use the recommended proxy settings for my version of Firefox', and 'Use Privoxy'), and click the 'Test settings' button, I get...
Tor proxy test FAILED! Check your proxy and Privoxy settings.
I have a hunch it must be to do with permission settings, somewhere, but ???
I've opened all the relevant ports in my NAT router
Any suggestions?

@_date: 2009-07-23 23:45:07
@_author: Bob Williams 
@_subject: Newbie needs help 
My system is openSUSE 11.1 x86_64 with KDE4.2.4 desktop, using linux kernel 2.6.27.25-0.1-default, and Firefox 3.0.11.
I've installed Privoxy and Tor, but I'm having difficulty with the setup. I can launch both programs:
18:58 user:~> privoxy /etc/privoxy/config
Jul 23 20:29:33.391 Privoxy(7fb481fa96f0) Info: Privoxy version 3.0.10
Jul 23 20:29:33.391 Privoxy(7fb481fa96f0) Info: Program name: privoxy
Jul 23 20:29:33.410 Privoxy(7fb481fa96f0) Info: (Re-)Opening logfile 20:29 user:~> tor -f /etc/tor/torrc
Jul 23 20:29:44.752 [notice] Tor v0.2.0.35. This is experimental software. Do not rely on it for strong anonymity. (Running on Linux x86_64)
Jul 23 20:29:44.752 [notice] Initialized libevent version 1.4.5-stable using method epoll. Good.
Jul 23 20:29:44.752 [notice] Opening Socks listener on 127.0.0.1:9050
but when I select torbutton preferences (having selected 'Use the recommended proxy settings for my version of Firefox', and 'Use Privoxy'), and click the 'Test settings' button, I get...
Tor proxy test FAILED! Check your proxy and Privoxy settings.
I have a hunch it must be to do with permission settings, somewhere, but ???
I've opened all the relevant ports in my NAT router
Any suggestions?

@_date: 2009-07-24 08:26:24
@_author: Bob Williams 
@_subject: Newbie needs help 
Thank you. I've made the changes to my privoxy config file as suggested there (in particular, I'd previously missed the forward-socks4a line), and restarted privoxy, but the tor error remains.

@_date: 2009-07-24 09:17:13
@_author: Bob Williams 
@_subject: Newbie needs help 
I have now (see Andrew Lewman's post and my reply).
I have added the following two lines to my privoxy config
forward-socks4a	/	127.0.0.1:9050	.
forward-socks5	/	127.0.0.1:9050	.
Now, when I click on the 'Test Settings' button in the Preferences dialog, Tor switches to 'enabled', but  tells me I'm not using Tor.

@_date: 2009-07-24 12:09:48
@_author: Bob Williams 
@_subject: Newbie needs help 
That shows my correct WAN IP address, as allocated by my ISP. I presume that shows that tor is not working.

@_date: 2009-07-24 12:18:52
@_author: Bob Williams 
@_subject: Newbie needs help 
BTW, when I open the ports in my router do I have to specify the UDP protocol as well as TCP?

@_date: 2009-07-24 12:35:20
@_author: Bob Williams 
@_subject: Newbie needs help 
I have the following line uncommented in torrc
Log notice file /var/log/tor/notices.log
and that file contains the following
Jul 23 09:15:19.124 [notice] Tor 0.2.0.35 opening new log file.
Jul 23 09:15:19.295 [warn] Couldn't load consensus networkstatus from Jul 23 09:15:19.601 [notice] I learned some more directory information, but not enough to build a circuit: We have no network-status consensus.
Jul 23 09:15:21.794 [notice] I learned some more directory information, but not enough to build a circuit: We have only 0/1663 usable descriptors.
Jul 23 09:15:23.563 [notice] I learned some more directory information, but not enough to build a circuit: We have only 96/1663 usable descriptors.
Jul 23 09:15:24.436 [notice] I learned some more directory information, but not enough to build a circuit: We have only 192/1663 usable descriptors.
Jul 23 09:15:24.460 [notice] I learned some more directory information, but not enough to build a circuit: We have only 288/1663 usable descriptors.
Jul 23 09:15:25.236 [notice] I learned some more directory information, but not enough to build a circuit: We have only 318/1663 usable descriptors.
Jul 23 09:15:25.666 [notice] I learned some more directory information, but not enough to build a circuit: We have only 413/1663 usable descriptors.
Jul 23 09:15:26.076 [notice] We now have enough directory information to build Jul 23 09:15:33.062 [notice] Tor has successfully opened a circuit. Looks like client functionality is working.
Jul 23 18:49:38.498 [notice] Received reload signal (hup). Reloading config.
Jul 23 18:49:38.499 [notice] Tor 0.2.0.35 opening log file.
Jul 23 18:49:38.500 [notice] Received reload signal (hup). Reloading config.
Jul 23 18:49:38.500 [notice] Tor 0.2.0.35 opening log file.
Jul 23 18:50:04.641 [notice] Catching signal TERM, exiting cleanly.
Jul 23 20:29:44.757 [notice] Tor 0.2.0.35 opening log file.
Jul 23 20:29:45.237 [notice] We now have enough directory information to build Jul 23 20:29:51.412 [notice] Tor has successfully opened a circuit. Looks like client functionality is working.
I notice there is nothing recorded for today!
Thanks for your help

@_date: 2009-07-24 12:40:39
@_author: Bob Williams 
@_subject: Newbie needs help 
Yes, I can turn it green (enabled), but when I do, it warns me
"The most recent Tor proxy test failed to use Tor.
Are you sure you want to enable anyway?"
Thanks, that's good to know. My intention in installing Tor/Privoxy is ultimately to provide a relay, rather than anonymising my own activity, though that might be interesting.  ATM I am trying to get it working properly as a client, before exploring the wonders of relays ;)

@_date: 2009-07-24 12:44:02
@_author: Bob Williams 
@_subject: Newbie needs help 
Thanks. How do I restart Tor? I originally started it with
~> tor -f /etc/tor/torrc
but when I rerun that command, I get
~> tor -f /etc/tor/torrc
Jul 24 12:41:40.393 [notice] Tor v0.2.0.35. This is experimental software. Do not rely on it for strong anonymity. (Running on Linux x86_64)
Jul 24 12:41:40.393 [notice] Initialized libevent version 1.4.5-stable using method epoll. Good.
Jul 24 12:41:40.393 [notice] Opening Socks listener on 127.0.0.1:9050
Jul 24 12:41:40.393 [warn] Could not bind to 127.0.0.1:9050: Address already in use. Is Tor already running?
Jul 24 12:41:40.393 [warn] Failed to parse/validate config: Failed to bind one of the listener ports.
Jul 24 12:41:40.393 [err] Reading config failed--see warnings above.
How do stop and restart tor?

@_date: 2009-07-24 12:58:16
@_author: Bob Williams 
@_subject: Newbie needs help 
Of course! Thank you. Unfortunately, I get the same result
12:53 barrowhillfarm:~> killall tor
12:53 barrowhillfarm:~> tor -f /etc/tor/torrc
Jul 24 12:54:15.469 [notice] Tor v0.2.0.35. This is experimental software. Do not rely on it for strong anonymity. (Running on Linux x86_64)
Jul 24 12:54:15.470 [notice] Initialized libevent version 1.4.5-stable using method epoll. Good.
Jul 24 12:54:15.470 [notice] Opening Socks listener on 127.0.0.1:9050
Jul 24 12:54:15.470 [warn] Could not bind to 127.0.0.1:9050: Address already in use. Is Tor already running?
Jul 24 12:54:15.470 [warn] Failed to parse/validate config: Failed to bind one of the listener ports.
Jul 24 12:54:15.470 [err] Reading config failed--see warnings above.
12:54 barrowhillfarm:~>
I know there is nothing else trying to use port 9050 as /etc/services says so:
#               9027-9079   Unassigned
What next?

@_date: 2009-07-24 13:10:25
@_author: Bob Williams 
@_subject: Newbie needs help 
This is what I have, unaltered from the original sample file:
 Replace this with "SocksPort 0" if you plan to run Tor only as a
 server, and not make any local application connections yourself.
SocksPort 9050 # what port to open for local application connections
SocksListenAddress 127.0.0.1 # accept connections only from localhost
 192.168.0.1:9100 # listen on this IP:port also

@_date: 2009-07-24 13:18:59
@_author: Bob Williams 
@_subject: Newbie needs help 
Actually, it looks as if the tor process is indestructible :( Neither root nor user bob (that's who started it) can kill it.

@_date: 2009-07-24 13:21:22
@_author: Bob Williams 
@_subject: Newbie needs help 
Thanks, Scott. I've done all that as instructed (FF3 is the same as FF2) but nothing seems to have changed.

@_date: 2009-07-24 13:42:36
@_author: Bob Williams 
@_subject: Newbie needs help 
Good. That worked. Now when I try to restart it, it says I should start it as Jul 24 13:37:23.052 [warn] Error setting groups to gid 112: "Operation not permitted". If you set the "User" option, you must start Tor as root.
Jul 24 13:37:23.052 [warn] Failed to parse/validate config: Problem with User value. See logs for details.
Jul 24 13:37:23.052 [err] Reading config failed--see warnings above.
startproc:  exit status of parent of /usr/bin/torctl: 3
I don't remember setting a "User" option, but tor was installed from a package obtained from my distro's repositories, so it may have occurred automatically.
Is it OK to run it as root?

@_date: 2009-07-24 13:44:20
@_author: Bob Williams 
@_subject: Newbie needs help 
Ah ha! A quick look around this openSUSE linux system reveals /etc/rc.d/tor and that accepts the 'stop' option. It tells me that 'tor apparently not running (no pid file)'.
However, ps ax | grep tor | grep -v grep says
8829	pts/0	T	0:03 tor -f /etc/tor/torrc
and /etc/rc.d/tor start fails with
13:27 barrowhillfarm:~> /etc/rc.d/tor start
Starting tor daemon
Jul 24 13:27:54.225 [notice] Tor v0.2.0.35. This is experimental software. Do not rely on it for strong anonymity. (Running on Linux x86_64)
Jul 24 13:27:54.226 [notice] Initialized libevent version 1.4.5-stable using method epoll. Good.
Jul 24 13:27:54.226 [notice] Opening Socks listener on 127.0.0.1:9050
Jul 24 13:27:54.226 [warn] Could not bind to 127.0.0.1:9050: Address already in use. Is Tor already running?
Jul 24 13:27:54.226 [warn] Failed to parse/validate config: Failed to bind one of the listener ports.
Jul 24 13:27:54.226 [err] Reading config failed--see warnings above.
startproc:  exit status of parent of /usr/bin/torctl: 3
It looks as if I've messed up my torrc but I've hardly changed anything from the defaults, apart from uncommenting a couple of lines. It might help if I could see a working torrc file

@_date: 2009-07-24 13:57:40
@_author: Bob Williams 
@_subject: Newbie needs help 
Thanks, Andrew. That sounds like good advice. I'll report back later if I have any further problems/questions, but hopefully not.

@_date: 2009-07-24 15:45:27
@_author: Bob Williams 
@_subject: Newbie needs help [SOLVED] 
Tor now re-installed and all working well. Now to investigate becoming a relay. Thanks for everyone's help.
