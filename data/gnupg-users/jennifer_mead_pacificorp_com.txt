
@_date: 2018-09-27 18:07:59
@_author: Mead, Jennifer 
@_subject: converting gpg files into PEM and certification change confusion 
Hi folks, new to gpg and thid forum,
I have used keys for many years, but not in a mangement role.  Now I am installing Yubikey KSM and Validation server.  I thought I understood it well enough but apparently that is not true.  While working on the validation piece I was requested to convert my certificate chain into a pem file and place it where all the parts and pieces of yubikey can get to it via the web.  My first what??? moment.  Like what is the certificate chain?  I did some research and even though it is mentioned quite often by others I have not been able to assert which file that actuall is.  Here is what is in my .gnupg directory:
.   gpg.conf                                   .  .note.swp          pubring.gpg   random_seed  S.gpg-agent
..  .  note                                       private-keys-v1.d  pubring.gpg~  secring.gpg  trustdb.gpg
key was created as such:
gpg --gen-key
chose: (2) DSA and Elgamal
Key is valid for? (0) 0
input name,email,user-id and passphrase
gpg: key 1234WXYZ marked as ultimately trusted
public and secret key created and signed.
then it spit out that it was checked the trustdb returned these types:
I then took those keys and turned them into yubikey format and loaded them into a db.  I thought all was said and done (LOL).
So I think one of those files is my supposed "certificate chain"... not sure.  Maybe I have not created the chain?
When I try to convert a file (pubring, secring, trustdb) they all end with:
[root at cswks99 .gnupg]# openssl dsa -in ~/.gnupg/trustdb.gpg -outform pem
read DSA key
unable to load Private Key
140528619882384:error:0906D06C:PEM routines:PEM_read_bio:no start line:pem_lib.c:707:Expecting: ANY PRIVATE KEY
unable to load Key
[root at cswks99 .gnupg]# openssl dsa -in ~/.gnupg/secring.gpg -outform pem
read DSA key
unable to load Private Key
140648490235792:error:0906D06C:PEM routines:PEM_read_bio:no start line:pem_lib.c:707:Expecting: ANY PRIVATE KEY
unable to load Key
1) I am not sure that (2) DSA and Elgamal will work with the above command, it seems like two alogrythms and not one (Elgamal is there too).  Is that the problem?  Or do I need an intermediary format to accomplish this?  What the heck am I doing wrong.  I do have two certs on my server as follows:
perhaps they are related?  I don't remember what step created them.  This is all very confusing to me and I need some gental nudges in the right direction.  Sorry for being such a newbie and not really getting any of this.  Any help is greatly appreciated.

@_date: 2019-04-04 14:16:58
@_author: Mead, Jennifer 
@_subject: FW: yubikey public key 
Second try.
Sent: Monday, April 1, 2019 2:24 PM
Hi Everyone,
I got a yubikey 5 working with Gnupg agent by writing the key direct to the card on CentOS 7.  Then I was tasked with writing documentation for others to do the same.   I have to admit that I had been at it quite a while (trying different ways of accomplishing it) and wasn't able to instant recall all my steps.
What other folks are struggling with (just guessing this is the issue) is that when they dump the public key (to move to another server and add to the authorized_keys file) they get a different style output than I do.  I get a string that ends with cardno:NNNNNNNNNNNN and they get a regular key (bigger and without card reference).
I am hoping that someone on this forum/list will have an easy answer to that problem.  I don't remember running a converter to change the public key format.  I don't remember doing anything special.  I did generate my key on the card, but I am having them do the same thing.  Generating direct to card is a security requirement here.
I tried to run gpg with the flag -export-ssh-key and that is not available on gpg2 on CentOS 7 (I get invalid option).  Not that I think that will fix my issue, I am just desperate to find what I did different to get the cardno:NNNNNNNNNNNN public key exported.  Any help is appreciated.
Jennifer (Jen) Mead
Security Engineer
Jennifer.Mead at pacificorp.com

@_date: 2019-06-21 18:42:28
@_author: Mead, Jennifer 
@_subject: GPG/YubiKey/CentOS7 
Hi All,
Even though I have had GPG and YubiKey running a few times on CentOS7 I lost all my notes and install guides.  I am hung up on getting the public key from the YubiKey.
I wrote the gpg keys right on the yubikey, I can query and see that gnupg knows all about it and sees it as a card.
sec>  2048R/C5778901 2019-06-20
      Card serial no. = 0006 09042340
uid                  Jen Mead (yubikey) ssb>  2048R/8293401A 2019-06-20
ssb>  2048R/A558FD7E 2019-06-20
[p42547 at cswks20~] > ssh-add
[p42547 at cswks20~] > ssh-add -l
error fetching identities for protocol 1: agent refused operation
2048 SHA256:dj02A/DHL0RKuJuMLBX14CaQ6RriT0uqY0sXqTNPoW4 cardno:000609042340 (RSA)
[p42547 at cswks20~] > gpg --export-secret-keys $KEYID | openpgp2ssh $KEYID
We cannot handle encrypted secret keys.  Skipping!
I never encrypted this key.  So why is it coming out encrypted?
gpg --export-secret-keys C5778901 gives me an asci file that then complains about not being openpgp it also is missing the cardno in the public file which tells the server to look at the yubikey for the matching key.  I am more than confused.  Can anyone tell me how to properly get the public key off of the yubikey to present to other servers?
Jennifer (Jen) Mead
Security Engineer
Jennifer.Mead at pacificorp.com
