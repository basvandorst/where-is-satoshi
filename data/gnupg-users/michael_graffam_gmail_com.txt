
@_date: 2008-06-11 10:43:02
@_author: michael graffam 
@_subject: LD_PRELOAD attack 
Has anyone read the article in the most recent 2600 regarding using
LD_PRELOAD to eavesdrop on gnupg?
I realize that the actual recovery of a passphrase by this means is no
better than keylogger --
But what concerns me more (and isn't explicitely covered in the
article) is the ability to inject false randomness into GPG key
generation, or even change the plaintext going in.
I think the advice to statically link a strcmp and getenv into GPG for
purposes of checking/scrubbing the environment is a good one.
Sure - you have to trust the machine you're running on - but it seems
to me that a basic sanity check would be in order.

@_date: 2008-06-11 12:58:48
@_author: michael graffam 
@_subject: LD_PRELOAD attack 
Not a real solution, because if LD_PRELOAD is already set, then the
shell you type unset into might be overloaded as we'll, already.
You can't trust strcmp() or getenv() either, since the preloaded lib
could be hooking them on you.
I've was able to write a stealthed lib which successfully hides itself
from calls to getenv, and ignore attempts to unset env vars.
Manually walking the environment pointer reveals it, of course.

@_date: 2008-06-11 14:03:47
@_author: michael graffam 
@_subject: LD_PRELOAD attack 
How does "physical security" have anything to do with env vars?
I'm not asking for gnupg programmers to try and thwart hardware keyloggers.
But just like we ask our software to do the Right Thing with respect
to say, defeating buffer overflows, it would be nice to do the Right
Thing and check environment sanity.

@_date: 2008-06-11 16:31:45
@_author: michael graffam 
@_subject: LD_PRELOAD attack 
Replacing the GPG bin requires root. An LD_PRELOAD'ed lib doesn't.
 Or add a shell script named 'gpg' and put it in your
Again,  root.
Doesn't save GPG passphrases.
Root, root, root.
Get it yet? LD_PRELOAD enables attacks against GPG w/o requiring full access
to the box. The attacker just need access to the user's account.
If you don't have control of your computer, you don't have control of
By that logic, anti-lock brakes are useless because, well.. clearly.. if you
don't have control over your car, then you don't have control over your car.
In point of fact, it is precisely when you have lost control of your car,
that you need anti-lock brakes. I think the same applies here.
So, you write static-strcmp(), throw it into the code, and in main() you use
static-strcmp() to walk the environment pointer. If you find an LD_PRELOAD,
you bail. I am not aware of any way to fake these checks w/o modifying the
bin (root!).
If I may torture an analogy here, being worried about someone who has
I don't think this situation is analogous at all, in fact.
I think it is more like saying: why be worried about someone having a key to
your front door when they can just blow the door apart with a shotgun.
Sure, its true.. and if your threat model includes shotgun-carrying
assailants or hostile root users, its entirely valid.
But what about just some basic hygiene to keep honest people honest? Hell,
thats what most REAL locks are for, anyhow.
