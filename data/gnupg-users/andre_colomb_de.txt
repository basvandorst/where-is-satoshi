
@_date: 2016-09-12 11:04:24
@_author: =?UTF-8?Q?Andr=c3=a9_Colomb?= 
@_subject: Local-signing without (offline) private master key 
Hi all,
this is my first post to GnuPG-users, please be gentle :-)
My OpenPGP setup currently includes an offline master key (see attached
public key) with three subkeys on a Yubikey USB "smartcard". Amongst
them is a signing subkey with "usage: S" flag, but only the master key
has the Certify capability (usage: SC).
Now I want to import someone else's key to verify a signature. In order
to verify that signature, I need to at least locally sign the owner's
key, AFAIK. However, I would need my offline master key (read: really
inconvenient) to issue a signature.
What is the recommended practice if I only want to verify message
integrity, but don't have the master key with Certify ability available?
One solution that comes to mind would be to add a new certification
subkey that I keep on my machine instead of the smartcard, and only use
it for local signatures. Would that make sense or what complications
should I expect?
Building a Web of Trust with an offline master key seems rather
difficult, even just to verify incoming emails. Maybe the upcoming TOFU
trust model would help my usage pattern?
Thanks for any pointers or explanation.
Kind regards,

@_date: 2016-09-15 09:17:22
@_author: =?UTF-8?Q?Andr=c3=a9_Colomb?= 
@_subject: Local-signing without (offline) private master key 
Damien Goutte-Gattat  wrote on 2016-09-12
14:16 (UTC+0200)
This sounds reasonable. I'm on Ubuntu 16.04, GnuPG 2.1.11, so the TOFU
stuff seems to work fine.
It seems hard to discover the current TOFU ratings for individual keys.
The man page only says "see: [trust-model-tofu]" in some places, and
there is no option to show the trust status except for the classic WoT
checking. Looking at the SQLite database at least gives some indication,
but is not easy data to interpret.
Did I miss some option here, or are any such additions planned?

@_date: 2018-01-22 09:36:34
@_author: =?UTF-8?Q?Andr=c3=a9_Colomb?= 
@_subject: Why exactly does pinentry fails with gpg-agent and ssh support? 
I can confirm that it actually IS necessary to send "updatestartuptty"
for ssh-agent functionality to work in this scenario.  The gpg-agent
process started by systemd's user session has no $DISPLAY and no
$GPG_TTY set (looking at /proc/  Its cmdline does not
contain --supervised either.
I always wondered why I got the message "agent refused operation" when
using an SSH key from gpg-agent.  Restarting gpg-agent manually after
logging in was my workaround thus far, but today I found out that
updatestartuptty suffices.
Strange thing is, I could use the GPG part of gpg-agent already before
issuing that command.  Why does that behave differently?
Can something be done to the systemd user unit file so the process gets
told the correct $DISPLAY at least?
Kind regards

@_date: 2018-01-22 18:06:48
@_author: =?UTF-8?Q?Andr=c3=a9_Colomb?= 
@_subject: Why exactly does pinentry fails with gpg-agent and ssh support? 
Hello Daniel,
I'm on Ubuntu 17.10 with GnuPG 2.1.15, by the way.
Daniel Kahn Gillmor  wrote on 2018-01-22 12:53
The session is started by GDM3, using the vanilla gnome-session scripts
(not the adapted ubuntu-session, also based on GNOME 3).  The systemd
user unit file is copied from /usr/lib/systemd/user/gpg-agent.service
and the Upstart-specific "initctl" command line commented out.
The main difference I see here is that I have enabled the user unit by
symlinking from ~/.config/systemd/user/default.target.wants/, whereas
the Ubuntu package includes the symlink in
acolomb at barnov:~$ systemctl --user status gpg-agent.service
   Loaded: loaded (/home/acolomb/.config/systemd/user/gpg-agent.service;
enabled; vendor preset: enabled)
(from your other message:)
I can't see how it does that in my packaged Ubuntu version (2.1.15),
there is no gpg-agent.socket unit file anywhere?
Any other ideas on how to debug this?  What logging should I enable for
gpg-agent and how?
Btw. it affects both my Yubikey as well as file-based authentication
subkeys, so not specific to scdaemon apparently.

@_date: 2018-01-24 20:34:45
@_author: =?UTF-8?Q?Andr=c3=a9_Colomb?= 
@_subject: Why exactly does pinentry fails with gpg-agent and ssh support? 
Seems like the relevant systemd unit file examples were added in commit
57e95f5413e21cfcb957af2346b292686a5647b7, shortly after 2.1.15 (included
in Debian / Ubuntu) was released.
As far as I can see, the new socket-activated user units should be
installed with current packages in Debian testing and Ubuntu bionic.  I
might try manually upgrading to 2.2.4-1ubuntu1 and report any findings.
