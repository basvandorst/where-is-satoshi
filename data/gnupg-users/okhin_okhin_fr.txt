
@_date: 2016-01-20 16:05:40
@_author: Okhin 
@_subject: libgcrypt  and decrypting Session Key of Symmetrically Encrypted 
Hello list,
I'm currently working on a library to be able to encrypt/decrypt data
server side in python. I've already binded (using python cffi) the
libgcrypt code (code is available on?
I can decrypt messages Symmetrically Encrypted (tag 9 or 18 according
to RFC4880), I can also symmetrically encrypt and decrypt random bytes
of text using the libgcrypt function :
gcry_error_t gcry_pk_decrypt (gcry_sexp_t *r_plain, gcry_sexp_t data,
gcry_sexp_t skey)
(from the online documentation:?
I'm using GnuPG 2.1.0 and libgcrypt 1.6.4.
My issue is that, when I try to decrypt the public key encrypted essage
(message_ok.asc attached, private_key_ok.asc attached, protected with
passphrase 'passphrase') I cannot manage to extract the session key
from the packet tagged 1.
I can extract the session key from teh command line
$ gpg --show-session-key testdata/message_ok.asc?
gpg: encrypted with 2048-bit RSA key, ID 0x0162F5906FA9F361, created
??????"test at example.com"
gpg: session key:
But I cannot extract it from the code. If I'm reading the RFC4880
correctly, the session key is EME PKC1 v1.5 encoded. So it should start
with a 0x00 and followed by a 0x02 which is not. The decryption gave me
the following S-Expression, and I do not understand how to convert it
into a session-key.
The gcry_pk_encrypt is called with those two S-Expression:
data = (enc-val?
? (a
? )
skey = ?(private-key?
? (q
? (n
? (d
? (p
? (u
? (e ? )
I'm attaching the armored message and private_key (passphrase
protected, passphrase is: 'passphrase' wthout quotes).
I suspect there's an issue with my data S-expression, I'm perhap's
missing some parameters here ?
Thanks for your patience and help,
