
@_date: 2013-01-02 11:05:47
@_author: Fabio Coatti 
@_subject: smartcard key change 
Hi All,
I'm playing a bit with a fsfe fellowship card, and I've noticed an
issue but I can't say if in gpg or in me :)
basically, the card works as expected (signing, encryption, etc..)
with a subkey only setup; I've then changed the sign subkey  with a
new one, but I noticed that I mistakenly loaded a 4096bit  subkey (out
of spec, IIRC, it works but it is failry slow :) ). I then tried to
place the previous sign key... and gnupg fails with this error:
Please select where to store the key:
   (1) Signature key
   (3) Authentication key
Cosa scegli? 1
gpg: WARNING: such a key has already been stored on the card!
Replace existing key? (y/N) y
gpg: secret key already stored on a card
but the card as the 4096 key on it; so it seems that gnupg flags every
key that has loaded on card as "on card", but it is impossible to tell
gnupg that a key has been removed from card.
Interesting enough, gpg --card-status (or gpg --edit key /toggle/list)
shows that 4 keys are on card :)
i.e. the secret key description reports "card-no: 0000 00000XXX" below
4 keys and not only three.
My guess is that gpg flags every subkey sent to card with the card
number and checks the number when requested to install it again... but
is there any way to tell gpg to clear that card number field?

@_date: 2013-01-02 14:09:39
@_author: Fabio Coatti 
@_subject: smartcard key change 
In data mercoled? 2 gennaio 2013 12:31:10, Peter Lebbing ha scritto:
No big deal, I have the needed backups; now I figured out what's going on, thanks. Maybe the message "gpg: secret key already stored on a card" is a bit misleading here :)
Many thanks!

@_date: 2013-01-04 16:11:06
@_author: Fabio Coatti 
@_subject: poldi 
Hi, I'm playing a bit with a fsfe card and trying to find a way to use smartcard for xscreensaver I've stumbled on poldi references, but the sources seems untouched since long time.
before starting to work on a updated ebuild (I'm on gentoo installation), is poldi still alive or do we have better way to reach the same goal (basically, having xscreensaver and other pam enabled things using the card)?
sorry if the question is silly, but I found no helpful references so far...

@_date: 2013-10-02 15:18:44
@_author: Fabio Coatti 
@_subject: Issues when switching between smartcards 
Hi all,
I'm recently facing an issue: simply put, I'm unable to switch smarcards.
The scenario is the followig: I have two different cards with two different set of keys. (E,S,A)
I have card A inserted in smartcard reader (HP Folio 9470m build in reader)
[mer ott  2 14:41:28 2013] usb 2-1.8: New USB device found, idVendor=058f, [mer ott  2 14:41:28 2013] usb 2-1.8: New USB device strings: Mfr=1, Product=2, SerialNumber=0
[mer ott  2 14:41:28 2013] usb 2-1.8: Product: EMV Smartcard Reader
The card is working fine.
Now I get an email signed with a different card (B) and a popup tells me to switch cards.
I do that, a popup appears requesting the PIN, but once entered kmail complains that it is unable to decrypt the message.
after that, gpg --card-status reports "card not present" but the card is inserted. (card B)
pcscd is crashed, looking at dmesg I see this:
 pcscd[10595]: segfault at 7f00beef8026 ip 00007f00beef8026 sp 00007f00beee7f30 error 14 in libc-2.17.so[7f00bf319000+1a0000]
So I restart pcscd, then I have to kill scdaemon ... but it requires a kill -9, it seems scdaemon gets stuck.
After that, a gpg --card-status works again, but if I try to decrypt again the message the decryption fails in the same way, scdaemon stuck and so on.
The only effective way to get the system working again is to reboot the laptop... quite a invasive one.
admittedly, it could be a hardware glitch, but this does not accounts for scdaemon lock and pcscd segfault.
Tech infos:
distro: gentoo
Linux 3.11.3
glibc 2.17
pcscd from sys-apps/pcsc-lite-1.8.8-r1 (pcsc-lite version 1.8.8)
(gpg (GnuPG) 2.0.21 libgcrypt 1.5.3 )
Any help will be appreciated; for more information or debug just ask (with some suggestion, I'm a bit stuck here :) )
Many thanks for any answer.

@_date: 2013-10-16 11:59:37
@_author: Fabio Coatti 
@_subject: Issues when switching between smartcards 
In data marted? 15 ottobre 2013 16:16:48, Kevin ha scritto:
After some mail exchange with Ludovic Rousseau (many thanks for his help and patience) , I solved the issues upgrading ccid to 1.4.13, but mainly looking at the bios setup where I found that the laptop was configured to power on and off the reader according to the fact that the card was inserted or not. It seems that this confuses smart card driver (basically, when powered off the reader is not even visible in lsusb).
I don't konw if this is an issue that can be dealt with changin something in driver code (probably it should handle this behaviour more nicely), but telling bios to always keep reader powered solved my issue (basically now I'm relying on linux usb power management to avoid waste when card is not

@_date: 2013-10-29 14:18:06
@_author: Fabio Coatti 
@_subject: Public algos list 
Hi all,
I just spotted this asking for gnupg version:
gpg (GnuPG) 2.0.22
libgcrypt 1.5.3
Copyright (C) 2013 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Home: ~/.gnupg
Supported algorithms:
Pubkey: RSA, ELG, DSA, ?, ?
Cipher: IDEA, 3DES, CAST5, BLOWFISH, AES, AES192, AES256, TWOFISH,
        CAMELLIA128, CAMELLIA192, CAMELLIA256
Hash: MD5, SHA1, RIPEMD160, SHA256, SHA384, SHA512, SHA224
Compression: Uncompressed, ZIP, ZLIB, BZIP2
The part that I don't understand is the two question marks in pubkey
algos. Pubkey: RSA, ELG, DSA, ?, ?
Can someone point me to some documentation about this or give me an hint?
I'm sure I missed something, but I read documentation and googled
without success... and I'd like to know what thos question marks
stands for .
Sorry for the very likely stupid question and thanks for any hint :)

@_date: 2014-01-11 14:30:20
@_author: Fabio Coatti 
@_subject: dirmngr segfaults 
Hi all,
I'm seeing several segfaults from dirmngr, tried googling around but with
no success this time :)
[sab gen 11 13:22:51 2014] dirmngr[11220]: segfault at 580 ip
00007fdbfe5abbe1 sp 00007fff12335980 error 4 in
cova at calvin ~ $ gdb /usr/bin/dirmngr core.4414
GNU gdb (Gentoo 7.6.2 p1) 7.6.2
Copyright (C) 2013 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-pc-linux-gnu".
For bug reporting instructions, please see:
Reading symbols from /usr/bin/dirmngr...done.
[New LWP 4414]
warning: Could not load shared library symbols for linux-vdso.so.1.
Do you need "set solib-search-path" or "set sysroot"?
Core was generated by `dirmngr --gpgconf-test'.
Program terminated with signal 11, Segmentation fault.
  0x00007fb080c64be1 in pth_key_setdata (key=0, value=value at entry=0x0) at
67      pth_data.c: File o directory non esistente.
(gdb) bt
  0x00007fb080c64be1 in pth_key_setdata (key=0, value=value at entry=0x0) at
  0x000000000040715d in main (argc=2, argv=0x7fff0baa1268) at
dirmngr: 1.1.1
dev-libs/pth: 2.0.7-r3
distro: gentoo
any help will be deeply appreciated; of course I can provide more data if
