
@_date: 2005-08-24 15:20:46
@_author: Felix E. Klee 
@_subject: Pinpad on SPR532 isn't used 
After installing GNUPG 1.4.2, I can now access my OpenPGP smartcards
(bought at Kernelconepts) using my SPR532 reader.  However, the pinpad
of the reader is not used.  An example:
  ~> gpg --card-edit
  gpg: WARNING: using insecure memory!
  gpg: please see  for more information
  Application ID ...: D2760001240101010001000005B60000
  Version ..........: 1.1
  Manufacturer .....: PPC Card Systems
  Serial number ....: 000005B6
  Name of cardholder: [not set]
  Language prefs ...: de
  Sex ..............: unspecified
  URL of public key : [not set]
  Login data .......: [not set]
  Private DO 1 .....: [not set]
  Private DO 2 .....: [not set]
  Signature PIN ....: forced
  Max. PIN lengths .: 254 254 254
  PIN retry counter : 3 3 3
  Signature counter : 0
  Signature key ....: [none]
  Encryption key....: [none]
  Authentication key: [none]
  General key info..: [none]
  Command> passwd
  gpg: OpenPGP card no. D2760001240101010001000005B60000 detected
  PIN
  Enter PIN: [Here I have to enter my PIN via my computer's keyboard]
The version of the reader's firmware is 5.05 IIRC.  What may be the reason for the problem?

@_date: 2005-08-25 22:57:17
@_author: Felix E. Klee 
@_subject: Pinpad on SPR532 isn't used 
At Thu, 25 Aug 2005 15:24:03 +0200,
Well, then the document "How to use the Fellowship Smartcard - The GnuPG
Smartcard HOWTO" from March 5th, 2005 needs to be corrected.  Quote:
  SCM Microsystems SPR532
  This is a USB (CCID)/serial reader with a numerical keypad and three
  extra buttons. The pinpad may be used to securely enter the PIN
  without using the attached computer. Only USB has been tested.
Anyway, does this lack of pinpad support apply to *any* driver or only
to the internal CCID one?

@_date: 2005-07-21 12:39:35
@_author: Felix E. Klee 
@_subject: PGP and Smartcards? 
I'd like to do PGP with a Smartcard that contains my main private key (I
want to go for 2048 RSA, it should last for about five years) and
subkeys (they should each last for about six months).  I didn't buy a
smart card for this purpose yet, and before I go ahead, I'd like to get
some questions answered:
* Can I use GnuPG for signing and decryption with a smart card and 2048
  bit RSA keys?  What limitations do I have to expect, if any?
* Personally, I currently favor the Axalto Cryptoflex 32k.  But is there
  any card that you recommend? (I know that there's the OpenPGP card but
  it only supports keys up to 1024 bits - not an option.)
* Why was OpenSC removed with development version 1.9.17 of GnuPG?  From
  a software developer's point of view it just doesn't make sense to
  ditch an existing and supposedly well working library that provides a
  standardized interface (PKCS and whose license (LGPL) is compliant
  with the license of the GnuPG.
* If not GnuPG, what free software alternatives are there for doing PGP
  signing and decryption with a smart card?

@_date: 2005-07-21 12:49:53
@_author: Felix E. Klee 
@_subject: PGP and Smartcards? 
I'd like to do PGP with a Smartcard that contains my main private key (I
want to go for 2048 RSA, it should last for about five years) and
subkeys (they should each last for about six months).  I didn't buy a
smart card for this purpose yet, and before I go ahead, I'd like to get
some questions answered:
* Can I use GnuPG for signing and decryption with a smart card and 2048
  bit RSA keys?  What limitations do I have to expect, if any?
* Personally, I currently favor the Axalto Cryptoflex 32k.  But is there
  any card that you recommend? (I know that there's the OpenPGP card but
  it only supports keys up to 1024 bits - not an option.)
* Why was OpenSC removed with development version 1.9.17 of GnuPG?  From
  a software developer's point of view it just doesn't make sense to
  ditch an existing and supposedly well working library that provides a
  standardized interface (PKCS and whose license (LGPL) is compliant
  with the license of the GnuPG.
* If not GnuPG, what free software alternatives are there for doing PGP
  signing and decryption with a smart card?

@_date: 2005-07-21 13:09:05
@_author: Felix E. Klee 
@_subject: PGP and Smartcards? 
I'd like to do PGP with a Smartcard that contains my main private key (I
want to go for 2048 RSA, it should last for about five years) and
subkeys (they should each last for about six months).  I didn't buy a
smart card for this purpose yet, and before I go ahead, I'd like to get
some questions answered:
* Can I use GnuPG for signing and decryption with a smart card and 2048
  bit RSA keys?  What limitations do I have to expect, if any?
* Personally, I currently favor the Axalto Cryptoflex 32k.  But is there
  any card that you recommend? (I know that there's the OpenPGP card but
  it only supports keys up to 1024 bits - not an option.)
* Why was OpenSC removed with development version 1.9.17 of GnuPG?  From
  a software developer's point of view it just doesn't make sense to
  ditch an existing and supposedly well working library that provides a
  standardized interface (PKCS and whose license (LGPL) is compliant
  with the license of the GnuPG.
* If not GnuPG, what free software alternatives are there for doing PGP
  signing and decryption with a smart card?

@_date: 2005-07-22 18:59:26
@_author: Felix E. Klee 
@_subject: PGP and Smartcards? 
At Fri, 22 Jul 2005 10:12:37 +0200,
OpenPGP cards with 2048 bit keys don't seem to be available at all.
However, ordinary ISO 7816-4 compliant smart cards are available through
online outlets.  For example CryptoFlex and CyberFlex cards can be
bought at Axalto's web shop [1] (only in packages of five, though) or at
IT-Secure's webshop [2] based in Switzerland.  Aladdin eToken PRO smart
cards should also be available at web shops.  Price for these and
similar cards is somewhere between 20 EUR and 30 EUR per piece.
Uh, I guess this would cost me too much time.  One solution, though,
would be to buy a JavaCard and try to run and enhance the OpenPGP Java
implementation that was started by Zeljko Vrba [3].
A simpler solution, though, would probably be porting code for accessing
an Axalto CryptoFlex 32k to GnuPG, or helping fork a "clean" PKCS
library from OpenSC and interfacing it to GnuPG.  But before thinking
about doing anything like that, I'd like to clarify:
Can the crypto capabilities on an ISO 7816-4 compliant card actually be
used for doing PGP?
The thing is: All that I need is a card that can securely store a
(private) RSA key and that can encrypt and decrypt data with this key.
All other things - e.g. encrypting with public keys, decrypting messages
with unencrypted session keys, hashing of messages to be singed - don't
need to be done on the card.  They could safely be done on the host
[1] [2] [3]

@_date: 2005-07-22 23:40:04
@_author: Felix E. Klee 
@_subject: PGP and Smartcards? 
At Fri, 22 Jul 2005 22:19:22 +0200,
Your wording implies that the cards I mentioned aren't both secure and
fast.  Any pointers?
I know that the PKCS are more or less standard suggestions.  IMHO this
isn't that interesting, though.  The point is that AFAICS PKCS
clearly defines an API, and perhaps it may become an ISO standard in the
future (as other PKCS have done).  If GnuPG would provide an interface
to PKCS then the user would have the choice among all crypto devices
for which free software PKCS implementations are available.  Aside
from OpenCS there are other PKCS libraries such as the MUSCLE
Framework or openCryptoki (unfortunately those two feature GPL
incompatible licenses but who says that this won't change?).
Well I guess one doesn't have to use those unless one interfaces with
proprietary libs (which is not an option due to licensing issues).
Perhaps I'll indeed buy two of those because everything else seems to be
like too much hassle.  I may limit my new master key's life time to two
years, and then see if other devices are around.
About the weakest link: For a master key the length of the key may well
be the weakest link if the master key is stored away in a safe place and
if it is only used once in a while on reasonably tamper proof systems
not connected to a network.
[1]

@_date: 2005-07-22 23:54:32
@_author: Felix E. Klee 
@_subject: PGP and Smartcards? 
At Fri, 22 Jul 2005 22:42:20 +0200,
Right at the moment, I also have time problems ;-).  But I may be
interested to do that in the near future.

@_date: 2005-07-24 18:02:56
@_author: Felix E. Klee 
@_subject: PGP and Smartcards? 
At Thu, 21 Jul 2005 13:09:40 +0200,
This does indeed look very interesting.  However, at the moment I don't
have a CryptoFlex 32k at hand and time doesn't permit me to play too
much with this smart card stuff.  For the time being, I may simply buy
an OpenPGP card with support for 1024 bit keys and use that for my day
to day use.  After all, 1024bit keys still seem to be quite secure.
There have been some rumors that say otherwise, but they seem to be
based on misunderstandings (at least that's what RSA says in a 2002
technical note [1]).
Huh? AFAICS, in general it is more important to have the subkeys on a
smart card than the master key.  After all the master key can be stored
in a safe place at home (e.g. on a CD, though a smart card would be more
secure).  The subkeys are usually carried around and are, thus, easy
subject for thieves.  Also for a cracker it should usually be much
easier to gain access to an everyday-machine with Internet access than
it is to get access to a system primarily used for maintaining PGP keys
(such a system should not have network access and, for additional
security, it should be booted from a reasonably tamper proof device,
e.g. from a Knoppix CD off a recently bought computer journal).
I read about the licensing issue that you complain about in your blog.
Although, I say that combining incompatible licenses is a no-no, I would
appreciate it if GPG would incorporate an interface to PKCS since
both issues are essentially unrelated.
[1]

@_date: 2005-07-25 11:41:19
@_author: Felix E. Klee 
@_subject: Changing the email address on an existing key...how? Should I? 
At Fri, 22 Jul 2005 16:32:25 -0700,
You could create a new identity and, optionally, revoke the old one.
Read more about it in the GNU Privacy Handbook.  Also, keep in mind
that, if your key is very old already, chances are that it's private
part may have been stolen at some point during its life time, unless you
have handled it very carefully.  If you're worried about this, you may
want to create a new key.

@_date: 2006-04-05 18:21:52
@_author: Felix E. Klee 
@_subject: OpenPGP card: What RSA problems? Why not for key signing? 
I consider creating a new master key: My old one wasn't stored securely
in the past and it has been rarely used.  This new key I want to
generate on a system with a temporary fresh LINUX install and upload it
to two Smartcards (one is for backup).  Now, the only thing that's
preventing me from doing this are the following paragraphs that I found
in The GnuPG Smartcard HOWTO ("How to use the Fellowship Smartcard"):
  The card does not support DSA keys. Even if you are using a RSA key
  you might encounter problems. The cards available at the moment only
  support 1024 bit keys.
  The suggestion is to use the key on the card only for signing and
  decrypting but NOT for key signing.
This calls for some questions:
* What are those problems that one may encounter with RSA?
* Why should the key on the card not be used for key signing?
* Is there any advantage in using a DSA master key (not supported by the
  OpenPGP card, I know) instead of an RSA master key?
* What's the best tool for generating the 1024 bit RSA key?  Should I
  simply use plain "gpg --gen-key --no-random-seed-file" or should the
  key be generated on card, or does it not really matter?
PS: Of course, I will use a subkey with limited lifetime for everyday
use, and I'll store this key on a third card.

@_date: 2006-04-06 14:28:24
@_author: Felix E. Klee 
@_subject: OpenPGP card: What RSA problems? Why not for key signing? 
At Thu, 06 Apr 2006 11:24:25 +0200,
Yes, one reads this and that: Some say 1024 may become easily crackable
[1] in the upcoming years, some say that it won't.  OK, my data may not
be that interesting [2] but, still, I want to do it right, or more or
less so.  So, I'll probably simply create a 4096 bit RSA key with 10
years life time and store it on devices not accessible from the systems
I normally use.
So, I've one more question: How long should the passphrase reasonably
be, in case ...
... it is a phrase containing words from a dictionary (e.g. taken from a
... it is a phrase made up of easily memorizable/pronounceable but
non-real words, formatted like an ordinary phrase (i.e. one word, one
blank, etc.)?
... it is just a random string?
The goal is to make decrypting the pass phrase protected secret key
about as hard as factoring the public key.  Is this even remotely
Well, I planned to have the key stored on two smartcards (one for
backup), anyway.
If not used for storage of the master key, the smartcards, of course,
are still nice for storing sub keys, and have them available all the
[1] I.e. with not too expensive equipment and in a rather short time,
  say a couple of days.
[2] I plan to use the key in the context of financial transactions,
  though.

@_date: 2006-02-12 22:48:04
@_author: Felix E. Klee 
@_subject: gpg: OpenPGP card not available: Assuan server fault 
Today, I tried out GnuPG 1.9.21 (from CVS) and GnuPG 1.9.20, in order to
access OpenPGP cards with my SPR532 card reader, but without success -
see below.  Any idea what I may be doing wrong?  I tried it out with two
different cards, at least one of which is yet unused.
As I'm at it, a minor complaint: In order to get the gpg2 binary, I had
to do:
  gnupg-1.9.20/g10# make
  gnupg-1.9.20/g10# make install
It was not sufficient to do:
  gnupg-1.9.20# make
  gnupg-1.9.20# make install
AFAICS, the above additional step is not documented anywhere.
* Messages with 1.9.20:
  # gpgsm --learn-card
  gpgsm: NOTE: THIS IS A DEVELOPMENT VERSION!
  gpgsm: It is only intended for test purposes and should NOT be
  gpgsm: used in a production environment or with production keys!
  gpgsm: can't connect to `/root/.gnupg/S.gpg-agent': No such file or directory
  scdaemon[13949]: NOTE: this is a development version!
  scdaemon[13949]: reading public key failed: Missing item in object
  scdaemon[13949]: reading public key failed: Missing item in object
  scdaemon[13949]: reading public key failed: Missing item in object
  gpg-agent[13948]: card has S/N: D2760001240101010001000005B60000
  # scdaemon[13949]: scdaemon (GnuPG) 1.9.20 stopped
  # gpg2 --card-edit
  gpg: NOTE: THIS IS A DEVELOPMENT VERSION!
  gpg: It is only intended for test purposes and should NOT be
  gpg: used in a production environment or with production keys!
  gpg: WARNING: This version of gpg is not very matured and
  gpg: WARNING: only intended for testing.  Please keep using
  gpg: WARNING: gpg 1.2.x, 1.3.x or 1.4.x for OpenPGP
  gpg: DBG: connection to agent established
  scdaemon[13961]: NOTE: this is a development version!
  scdaemon[13961]: reading public key failed: Missing item in object
  scdaemon[13961]: reading public key failed: Missing item in object
  scdaemon[13961]: reading public key failed: Missing item in object
  gpg-agent[13960]: card has S/N: D2760001240101010001000005B60000
  Application ID ...: D2760001240101010001000005B60000
  Version ..........: 1.1
  Manufacturer .....: PPC Card Systems
  Serial number ....: 000005B6
  Name of cardholder: [not set]
  Language prefs ...: de
  Sex ..............: unspecified
  URL of public key : [not set]
  Login data .......: [not set]
  Signature PIN ....: forced
  Max. PIN lengths .: 254 254 254
  PIN retry counter : 3 3 3
  Signature counter : 0
  Signature key ....: [none]
  Encryption key....: [none]
  Authentication key: [none]
  General key info..: [none]
  Command> scdaemon[13961]: updating status of slot 0 to 0x0007
  scdaemon[13961]: client pid is 13960, sending signal 12
  scdaemon[13961]: scdaemon (GnuPG) 1.9.20 stopped
  gpg: OpenPGP card not available: Assuan server fault
* Messages with 1.9.21 from CVS:
  # gpgsm --learn-card
  gpgsm: NOTE: THIS IS A DEVELOPMENT VERSION!
  gpgsm: It is only intended for test purposes and should NOT be
  gpgsm: used in a production environment or with production keys!
  gpgsm: can't connect to `/root/.gnupg/S.gpg-agent': No such file or directory
  scdaemon[15326]: NOTE: this is a development version!
  scdaemon[15326]: reading public key failed: Missing item in object
  scdaemon[15326]: reading public key failed: Missing item in object
  scdaemon[15326]: reading public key failed: Missing item in object
  gpg-agent[15325]: card has S/N: D2760001240101010001000005B60000
  # scdaemon[15326]: scdaemon (GnuPG) 1.9.21-cvs3973 stopped
  # gpg2 --card-edit
  gpg: NOTE: THIS IS A DEVELOPMENT VERSION!
  gpg: It is only intended for test purposes and should NOT be
  gpg: used in a production environment or with production keys!
  gpg: WARNING: This version of gpg is not very matured and
  gpg: WARNING: only intended for testing.  Please keep using
  gpg: WARNING: gpg 1.2.x, 1.3.x or 1.4.x for OpenPGP
  gpg: DBG: connection to agent established
  scdaemon[15355]: NOTE: this is a development version!
  scdaemon[15355]: reading public key failed: Missing item in object
  scdaemon[15355]: reading public key failed: Missing item in object
  scdaemon[15355]: reading public key failed: Missing item in object
  gpg-agent[15354]: card has S/N: D2760001240101010001000005B60000
  Application ID ...: D2760001240101010001000005B60000
  Version ..........: 1.1
  Manufacturer .....: PPC Card Systems
  Serial number ....: 000005B6
  Name of cardholder: [not set]
  Language prefs ...: de
  Sex ..............: unspecified
  URL of public key : [not set]
  Login data .......: [not set]
  Signature PIN ....: forced
  Max. PIN lengths .: 254 254 254
  PIN retry counter : 3 3 3
  Signature counter : 0
  Signature key ....: [none]
  Encryption key....: [none]
  Authentication key: [none]
  General key info..: [none]
  Command> scdaemon[15355]: updating status of slot 0 to 0x0007
  scdaemon[15355]: client pid is 15354, sending signal 12
  scdaemon[15355]: scdaemon (GnuPG) 1.9.21-cvs3973 stopped
  gpg: OpenPGP card not available: Assuan server fault
* Auxiliary packages:
  libgpg-error 1.1
  libgcrypt 1.2.2
  libassuan 0.6.10
  libksba 0.9.13
  pth 2.0.6

@_date: 2006-06-03 19:08:42
@_author: Felix E. Klee 
@_subject: Info on sub keys? 
I've a couple of newbee questions concerning sub keys:
* Aside from convenience, is there any difference between a sub key and
  an ordinary key signed with the master key?
* Can such an ordinary key be transformed into a sub key?
* Since when (date and version) does PGP and since when does GnuPG
  support signing sub keys?  I ask because I read that old versions, at
  least of PGP, support only encryption sub keys, not signing sub keys.
* Are signing sub keys part of the OpenPGP standard?
* One can include any number of sub keys into a key, right?  I ask
  because I recall reading that there was/is some problem with key
  servers and sub keys.
If there is any good documentation on sub keys, aside from technical
specifications (such as RFC 2440), then please let me know.

@_date: 2006-06-03 23:43:45
@_author: Felix E. Klee 
@_subject: Info on sub keys? 
At Sun, 04 Jun 2006 03:02:19 +0930,
Right, I read about that before.
According to Tom McCune's FAQ [1] version 8.1 was the first version that
supported signing subkeys for checking signatures:
  "GPG (but not PGP) can now generate subkeys for signing.  Until PGP
  8.1, PGP had no support for this, and could not verify signatures made
  with such a signing subkey."
So, I assume that there was a version 8.0 which doesn't support them.  I
wonder when version 8.1 was released.
Hm, as far as I understand it, public key servers exchange updates among
each other, in oder to stay synchronized.  Consider the following
  I upload a key to server A, from there it goes to server B and
  finally it arrives at server C: A->B->C.
Now what would happen if that key contains a signature sub key and
server B runs a pre 0.9.6 PKS version?  Would the key end up in a
mangled state on B and C?  Could the mangled key propagate back to A?
I recall finding it on the web some time ago, but I didn't read it.  I
better do that now.
BTW, there's another little question I forgot to raise in my first
  In his FAQ, Tom McCune uses the expression "4096/2048 RSA" to refer to
  a 2048 bit master key with a 4096 bit encryption sub key.  Is this a
  general convention?  I.e. does "foo Y/X", in general, refer to an "X"
  bit master key of type "foo" with an "Y" bit sub key for encryption?
[1]

@_date: 2006-03-07 22:07:19
@_author: Felix E. Klee 
@_subject: gpg: OpenPGP card not available: Assuan server fault 
At Mon, 13 Feb 2006 14:47:51 +0100,
But I don't want to do OpenPGP: I want to do SSH with the OpenPGP card.
I roughly followed the howto behind the following URL:
  This howto mentions the use of "gpg2".

@_date: 2015-01-22 17:00:44
@_author: Felix E. Klee 
@_subject: Crypto device where I need to confirm every operation? 
I currently use GnuPG with an OpenPGP Card V2.0 in a smart card reader
with PIN pad. Surely, that adds a certain layer of security, as all
encryption and signing operations happen on the card. However, there
is one attack which I think could be easily prevented: With the card
in the reader, the PIN entered, and Eve having remote access to my
machine, she could sign and decrypt documents.
To prevent such an attack, I imagine a device where I have to confirm
every transaction with a simple push on a hardware button.
Does that exist?

@_date: 2015-01-23 11:19:38
@_author: Felix E. Klee 
@_subject: Talking about Cryptodevices... which one? 
I bought an OpenPGP smart card at [cryptoshop][1]. Whether they ship to
Chile, I don?t know. The cards are actually distributed by [kernel
concepts][2]. I called them, and they told me:
  * Currently they don?t have cards in stock.
  * The shop will be back IIRC next month, or in March.
  * There will be a new batch of cards, with the same functionality but
    updated print: On the back of the current cards, it says ?RSA with
    up to 3072 bit? when in fact the cards support up to 4096 bit.
Also: You can get that card, if you become an [FSFE fellow][3].
As for the reader, I got a Reiner SCT cyberJack RFID standard. The RFID
functionality allows me to use it with the German ID card as well. If
you don?t need that, there is a smaller device, the cyberJack go plus.
I?m running the setup with Win7 X64, with Gpg4win, which works fine:
  * PIN entry is via the pinpad on the reader.
  * 4096 bit RSA
  * Decryption of a 30 kB file takes one or two seconds.
[1]: [2]: [3]:

@_date: 2015-01-23 11:28:28
@_author: Felix E. Klee 
@_subject: Crypto device where I need to confirm every operation? 
Right, for signing I am always asked for the PIN. I didn't check that
before posting.

@_date: 2015-01-27 16:24:32
@_author: Felix E. Klee 
@_subject: Talking about Cryptodevices... which one? 
How does that store the private key? Password encrypted?
A smart card stores the key unencrypted, right?

@_date: 2015-01-27 17:34:56
@_author: Felix E. Klee 
@_subject: Talking about Cryptodevices... which one? 
Good! What PIN length do you recommend? (for the case that there is a
backdoor to get the *encrypted* key off the card)

@_date: 2015-01-27 18:35:37
@_author: Felix E. Klee 
@_subject: Talking about Cryptodevices... which one? 
So the private key is encrypted with an AES key that is also stored on
the card? Then why encrypt the private key at all? Against what attack
does encryption of the private key on the card protect?

@_date: 2015-01-28 09:14:48
@_author: Felix E. Klee 
@_subject: Talking about Cryptodevices... which one? 
Thanks a lot for this explanation!
I still would feel more comfortable with a pinpad, or some hardware
button (see thread ?crypto device where I need to confirm every

@_date: 2015-03-06 12:50:22
@_author: Felix E. Klee 
@_subject: Trezor - Could this be the model for a PGP crypto device? 
Yesterday in Las Palmas de Gran Canaria, I attended a [talk][1] by Marek
Palatinus, one of the relatively early Bitcoin miners and cofounder of
[SatoshiLabs][2]. He gave an introduction to his path into Bitcoin, and
things that went wrong, and then he presented the [Trezor][3] crypto
The Trezor has a little display and two buttons. It generates and stores
your private key which is used for identifying your address in the
Bitcoin network. The Bitcoins that you own are associated with your
address. Connected via USB to a computer, the Trezor signs Bitcoin
Marek later explained to me that the Bitcoin crypto standard is
different from those used with PGP.
After the talk, I hammered him with questions:
  * What if I lose the device or if it breaks? For backup, the device
    presents a list of 24 English words, that the user should write down
    and keep on paper in a safe place. Using this list, the private key
    can be recreated.
  * What if Eve wants to access the device without my authorization?
    There is a PIN.
  * How is the key generated? With an RNG on the device, using entropy
    gathered from the connected computer.
  * There?s no PIN pad on the device; Couldn?t malware sniff the PIN?
    The device has a little screen that displays a matrix of nine
    numbers. On the computer?s screen appears the same matrix without
    numbers, and one clicks on these with the mouse.
  * Do I have to enter the PIN for every transaction? Only once, then
    the device remains activated.
  * Once the device is activated, couldn?t malware do arbitrary
    transactions? For every transaction there is information displayed
    on the device?s display, and it has to be confirmed with the press
    of a button on the device.
  * Can I trust the firmware? [Source code][4] is available. Users can
    check the code, compile it, and flash their own version.
  * What if Eve modifies the firmware in a malignant way and flashs it
    to the device? Flashing unsigned firmware causes the private key to
    be erased by the bootloader.
  * Can I trust the bootloader? Source code is available as well.
Of course there could still be backdoors. However, at the moment I
cannot see what can be done better, other than building your own
hardware, ideally down to chip manufacturing level.
[1]: [2]: [3]: [4]:

@_date: 2015-03-07 15:09:43
@_author: Felix E. Klee 
@_subject: Trezor - Could this be the model for a PGP crypto device? 
It?s not about the UI being pretty. What I like about Trezor is that
it?s small yet has basically an external PIN pad, and every transaction
has to be confirmed by the push of a button. So, unless there are
backdoors (which also could be at chip level) or bugs, malware cannot
sniff the PIN nor can it do unattended transactions.

@_date: 2015-11-02 10:40:39
@_author: Felix E. Klee 
@_subject: =?UTF-8?Q?Re=3A_Generating_4096_bit_key_fails_=E2=80=93_why=3F?= 
Unfortunately that doesn?t seem to be the explanation. After starting
`gpg --card-edit`, I checked which version is running, and it?s 2.1.9:
    $ ps aux | grep scdaemon
    root       506  [?] scdaemon --multi-server
    felix      562  [?] grep scdaemon
    $ sudo ls -l /proc/506/exe
    [?] /proc/506/exe -> /usr/lib/gnupg/scdaemon
    $ /usr/lib/gnupg/scdaemon --version
    scdaemon (GnuPG) 2.1.9
    libgcrypt 1.6.4
    libksba 1.3.3
    Copyright (C) 2015 Free Software Foundation, Inc.
    License GPLv3+: GNU GPL version 3 or later
    This is free software: you are free to change and redistribute it.
    There is NO WARRANTY, to the extent permitted by law.
What else can I try?

@_date: 2015-11-17 10:12:53
@_author: Felix E. Klee 
@_subject: =?UTF-8?Q?Re=3A_Generating_4096_bit_key_fails_=E2=80=93_why=3F?= 
Any idea when the next release is scheduled to be available?
I tried installing the Git version into `/usr/local`, but that couldn?t
interface with my reader?s PIN pad.

@_date: 2015-11-29 14:36:11
@_author: Felix E. Klee 
@_subject: =?UTF-8?Q?Re=3A_Generating_4096_bit_key_fails_=E2=80=93_why=3F?= 
Seems like that didn't happen. I'm without a working crypto card since
August. :-(

@_date: 2015-10-27 11:11:04
@_author: Felix E. Klee 
@_subject: =?UTF-8?Q?Generating_4096_bit_key_fails_=E2=80=93_why=3F?= 
As already mentioned in the October 2015 thread ?Bad secret key? on
, I cannot generate a 4096 bit on
my [OpenPGP card][1]. What could be the issue?
    $ uname -a
    Linux felix-arch 4.2.3-1-ARCH  SMP PREEMPT Sat Oct 3 18:52:50 CEST
    2015 x86_64 GNU/Linux
    $ gpg --version
    gpg (GnuPG) 2.1.9
    libgcrypt 1.6.4
    [?]
    $ gpg --card-edit
    Application ID ...: D2760001240102010005000040D80000
    Version ..........: 2.1
    Manufacturer .....: ZeitControl
    Serial number ....: 000040D8
    Name of cardholder: Felix Klee
    Language prefs ...: de
    Sex ..............: unspecified
    URL of public key : [not set]
    Login data .......: [not set]
    Signature PIN ....: not forced
    Key attributes ...: rsa2048 rsa2048 rsa2048
    Max. PIN lengths .: 32 32 32
    PIN retry counter : 3 0 3
    Signature counter : 0
    Signature key ....: [none]
    Encryption key....: [none]
    Authentication key: [none]
    General key info..: [none]
    gpg/card> admin
    Admin commands are allowed
    gpg/card> generate
    Make off-card backup of encryption key? (Y/n) n
    What keysize do you want for the Signature key? (2048) 4096
    The card will now be re-configured to generate a key of 4096 bits
    Note: There is no guarantee that the card supports the requested
          size. If the key generation does not succeed, please check the
          documentation of your card to see what sizes are allowed.
    gpg: error changing size of key 1 to 4096 bits: Invalid data
[1]:

@_date: 2015-10-31 06:18:39
@_author: Felix E. Klee 
@_subject: =?UTF-8?Q?Re=3A_Generating_4096_bit_key_fails_=E2=80=93_why=3F?= 
See attachment.
And, yes, the OpenPGP card V2.1 does 4096 bit keys, just as V2.0, which
I successfully used with such keys. In fact on V2.1, it is printed: ?RSA
with up to 4096 bit?

@_date: 2016-01-12 11:03:37
@_author: Felix E. Klee 
@_subject: =?UTF-8?Q?Re=3A_Generating_4096_bit_key_fails_=E2=80=93_why=3F?= 
After the second attempt with GnuPG 2.1.10, I got all three 4096 bit
keys generated on card, which took a while:
    > admin
    [?]
    > generate
    [?]
    gpg: key 28C1B3D1 marked as ultimately trusted
    public and secret key created and signed.
    gpg: checking the trustdb
    gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model
    gpg: depth: 0  valid:   2  signed:   0  trust: 0-, 0q, 0n, 0m, 0f,
    2u
    gpg: next trustdb check due at 2017-10-30
Following initialization, I could finally import the backup of my 4096
bit keys. :-D

@_date: 2016-01-20 17:48:21
@_author: Felix E. Klee 
@_subject: How to export ASCII armored secret key without passphrase? 
There?s a known issue: Is there any workaround? For example, could I export an ASCII armored
key with a passphrase, then decrypt the exported key?
Command that failed without passphrase (the key doesn't have one):
    $ gpg --armor --export-secret-keys >key.txt
Affected version of GnuPG is 2.1.10.
With 2.0.19 I did not run into this issue.

@_date: 2016-01-21 12:45:43
@_author: Felix E. Klee 
@_subject: How to export ASCII armored secret key without passphrase? 
Thanks! On my system, Arch, that?s:
    $ gpg --export-secret-keys | gpg1 --import

@_date: 2016-07-26 12:05:28
@_author: Felix E. Klee 
@_subject: gpg: KEYTOCARD failed: Unusable secret key 
Successfully moved a key to an [OpenPGP-Card][1]. Now, as backup, I
want to install the key to a second card, but that failed:
    # gpg --edit-key $KEY
    [...]
    gpg> toggle
    [...]
    ggp> keytocard
    Really move the primary key? (y/N) y
    [...]
    Please select where to store the key:
       (1) Signature key
       (3) Authentication key
    Your selection? 1
    gpg: WARNING: such a key has already been stored on the card!
    Replace existing key? (y/N) y
    gpg: KEYTOCARD failed: Unusable secret key
Why did it work for the first card but not for the second one?
I assume, although `keytocard` is documented as *moving* the key to the
card, it actually copies it.
[1]:

@_date: 2016-07-26 14:11:06
@_author: Felix E. Klee 
@_subject: gpg: KEYTOCARD failed: Unusable secret key 
*Without* the smart card reader connected, it says:
    # gpg ?list-secret-keys
    /ramdisk/pubring.kbx
    --------------------
    sec>  rsa4096 2016-07-26 [SC] [expires: ?]
          AFADB5A?
          Card serial no. = ?
    uid           [ultimate] Felix ?
    ssb>  rsa4096 2016-07-26 [E] [expires: ?]
Also I can export the private key:
    # gpg --armor --export-secret-keys | wc -l
    53
So it seems to be still there, no?

@_date: 2016-07-26 15:17:07
@_author: Felix E. Klee 
@_subject: gpg: KEYTOCARD failed: Unusable secret key 
Hitting  to quit did the trick. Now I could copy the key ? a new
one ? to two cards. Thanks for the suggestion!
Before that I tried re-importing the private key from the `.asc` file,
but it still was not possible to write it to another card. The error
message was the same as before. I don?t understand this: The key is
around, but somehow I cannot use it.

@_date: 2017-10-21 23:38:36
@_author: Felix E. Klee 
@_subject: gpg: [don't know]: 1st length byte missing 
See the attached file. When I try to decrypt it using `gpg -d`, I get:
    gpg: [don't know]: 1st length byte missing
`gpg --version` (on Windows):
    gpg (GnuPG) 2.2.1
    libgcrypt 1.8.1
    Copyright (C) 2017 Free Software Foundation, Inc.
    License GPLv3+: GNU GPL version 3 or later
    This is free software: you are free to change and redistribute it.
    There is NO WARRANTY, to the extent permitted by law.
    Home: C:/Users/Felix/AppData/Roaming/gnupg
    Supported algorithms:
    Pubkey: RSA, ELG, DSA, ECDH, ECDSA, EDDSA
    Cipher: IDEA, 3DES, CAST5, BLOWFISH, AES, AES192, AES256, TWOFISH,
            CAMELLIA128, CAMELLIA192, CAMELLIA256
    Hash: SHA1, RIPEMD160, SHA256, SHA384, SHA512, SHA224
    Compression: Uncompressed, ZIP, ZLIB, BZIP2
IIRC I haven?t updated gpg since I encrypted the file. So I assume that
the same gpg 2.2.1 has been used for encryption.
The private key is on an OpenPGP smartcard by ZeitControl.
*Any idea how to fix the issue?*

@_date: 2017-10-22 12:10:54
@_author: Felix E. Klee 
@_subject: gpg: [don't know]: 1st length byte missing 
Thanks for pointing that out. Here you go:
-----BEGIN PGP ARMORED FILE-----
Comment: Use "gpg --dearmor" for unpacking
-----END PGP ARMORED FILE-----

@_date: 2017-10-22 23:11:16
@_author: Felix E. Klee 
@_subject: gpg: [don't know]: 1st length byte missing 
Thanks, Werner!
No backup, and I think there is no way to recover the password, which
- in this case - is very unfortunate. :( I wonder how this happened.
The drive is a Samsung EVO SSD with NTFS.

@_date: 2018-08-02 11:07:12
@_author: Felix E. Klee 
@_subject: Cannot decrypt file encrypted with enQsig 
Hi Dirk,
thanks for all your suggestions!
If I can, I want to avoid creating another key. I prefer getting the
issue resolved and have bugs reported/fixed along the way. I had it once
before that I could not decrypt a document encrypted by a big German
company with my private key. These enterprise ?solutions? seem to have
On Mon, Jul 30, 2018 at 5:14 PM, Dirk Gottschalk via Gnupg-users
I now removed my signature key BEF6EFD38FE8DCA0 from the encrypted
    $ gpg --dearmor encrypted.asc
    $ gpgsplit encrypted.asc.gpg
    $ ls -1
    000001-001.pk_enc
    000002-001.pk_enc
    000003-001.pk_enc
    000004-001.pk_enc
    000005-018.encrypted_mdc
    encrypted.asc
    encrypted.asc.gpg
    $ pgpdump 000001-001.pk_enc
    New: Public-Key Encrypted Session Key Packet(tag 1)(524 bytes)
            New version(3)
            Key ID - 0xBEF6EFD38FE8DCA0
            Pub alg - RSA Encrypt or Sign(pub 1)
            RSA m^e mod n(4096 bits) - ...
                    -> m = sym alg(1 byte) + checksum(2 bytes) + PKCS-1
    block type 02
    $ pgpdump 000002-001.pk_enc
    New: Public-Key Encrypted Session Key Packet(tag 1)(524 bytes)
            New version(3)
            Key ID - 0x04FDF78D1679DD94
            Pub alg - RSA Encrypt or Sign(pub 1)
            RSA m^e mod n(4095 bits) - ...
                    -> m = sym alg(1 byte) + checksum(2 bytes) + PKCS-1
    block type 02
    $ pgpdump 000003-001.pk_enc
    New: Public-Key Encrypted Session Key Packet(tag 1)(524 bytes)
            New version(3)
            Key ID - 0x92663E7CA68E4EC6
            Pub alg - RSA Encrypt or Sign(pub 1)
            RSA m^e mod n(4096 bits) - ...
                    -> m = sym alg(1 byte) + checksum(2 bytes) + PKCS-1
    block type 02
    $ pgpdump 000004-001.pk_enc
    New: Public-Key Encrypted Session Key Packet(tag 1)(524 bytes)
            New version(3)
            Key ID - 0x9D8C454A43A6D2DE
            Pub alg - RSA Encrypt or Sign(pub 1)
            RSA m^e mod n(4094 bits) - ...
                    -> m = sym alg(1 byte) + checksum(2 bytes) + PKCS-1
    block type 02
    $ pgpdump 000005-018.encrypted_mdc
    New: Symmetrically Encrypted and MDC Packet(tag 18)(1718 bytes)
            Ver 1
                    (plain text + MDC SHA1(20 bytes))
    $ cat 000002-001.pk_enc 000003-001.pk_enc 000004-001.pk_enc \
    000005-018.encrypted_mdc >new.gpg
Decryption still fails:
    $ gpg -d new.gpg
    gpg: encrypted with RSA key, ID 9D8C454A43A6D2DE
    gpg: encrypted with RSA key, ID 92663E7CA68E4EC6
    gpg: encrypted with 4096-bit RSA key, ID 04FDF78D1679DD94, created
    2016-12-17
          "Felix E. Klee "
    gpg: public key decryption failed: Missing item in object
    gpg: decryption failed: No secret key
    $ gpg --list-packets new.gpg
    gpg: encrypted with RSA key, ID 9D8C454A43A6D2DE
    gpg: encrypted with RSA key, ID 92663E7CA68E4EC6
    gpg: encrypted with 4096-bit RSA key, ID 04FDF78D1679DD94, created
    2016-12-17
          "Felix E. Klee "
    gpg: public key decryption failed: Missing item in object
    gpg: decryption failed: No secret key
    # off=0 ctb=c1 tag=1 hlen=3 plen=524 new-ctb
    :pubkey enc packet: version 3, algo 1, keyid 04FDF78D1679DD94
    data: [4095 bits]
    # off=527 ctb=c1 tag=1 hlen=3 plen=524 new-ctb
    :pubkey enc packet: version 3, algo 1, keyid 92663E7CA68E4EC6
    data: [4096 bits]
    # off=1054 ctb=c1 tag=1 hlen=3 plen=524 new-ctb
    :pubkey enc packet: version 3, algo 1, keyid 9D8C454A43A6D2DE
    data: [4094 bits]
    # off=1581 ctb=d2 tag=18 hlen=3 plen=1718 new-ctb
    :encrypted data packet:
    length: 1718
    mdc_method: 2
As before, the reason given for ?public key decryption failed? depends
on the card reader used:
  * SCM SPR332 v2: ?Missing item in object?
  * Cherry ST-2000: ?Invalid value?
  * REINER SCT cyberJack: ?Missing item in object?
It seems like the card reader cannot decrypt the session key. *Is that correct?*
I also tried removing all keys except for my encryption key
04FDF78D1679DD94. This does not make a difference, i.e. encryption fails
as above.

@_date: 2018-08-03 09:16:59
@_author: Felix E. Klee 
@_subject: Cannot decrypt file encrypted with enQsig 
As I would like to understand things a bit better, do you think it is
possible to get some more details? In particular:
  * Is the encrypted packet in a bad format?
  * Does the 4096 bit RSA decryption fail?
  * Or: Is the decrypted packet in a bad format?
Again, the output by `pgpdump` for the packet associated with my
encryption key 04FDF78D1679DD94:
    $ pgpdump 000002-001.pk_enc
    New: Public-Key Encrypted Session Key Packet(tag 1)(524 bytes)
            New version(3)
            Key ID - 0x04FDF78D1679DD94
            Pub alg - RSA Encrypt or Sign(pub 1)
            RSA m^e mod n(4095 bits) - ...
                    -> m = sym alg(1 byte) + checksum(2 bytes) + PKCS-1
    block type 02
For comparison, the output for a packet encrypted with GnuPG:
    $ gpg --version
    gpg (GnuPG) 2.2.9
    libgcrypt 1.8.3
    [?]
    $ gpg --recv BEF6EFD38FE8DCA0
    $ echo "Hello world!" >test
    $ gpg -e -r BEF6EFD38FE8DCA0 test
    $ gpgsplit test.gpg
    $ ls -1
    000001-001.pk_enc
    000002-018.encrypted_mdc
    test
    test.gpg
    $ pgpdump 000001-001.pk_enc
    Old: Public-Key Encrypted Session Key Packet(tag 1)(524 bytes)
            New version(3)
            Key ID - 0x04FDF78D1679DD94
            Pub alg - RSA Encrypt or Sign(pub 1)
            RSA m^e mod n(4095 bits) - ...
                    -> m = sym alg(1 byte) + checksum(2 bytes) + PKCS-1
    block type 02
The only difference: `Old` vs. `New` ? Could this be an issue?
PS: Had to think a bit that PKESK = ?Public-Key Encrypted Session Key?.
The crypto world seems to love acronyms. ;) (which does not make things
easier for us users)

@_date: 2018-08-15 09:08:42
@_author: Felix E. Klee 
@_subject: Cannot decrypt file encrypted with enQsig 
*Update:* Yesterday, I was reading the [GnuPG wiki page on
SmartCards][1] due to another issue. At its bottom I found listed as
known bug:
  * Encrypted message with 3DES can't be decrypted with OpenPGP Card
    (V2.1, V3.3 without fix)
      - Due to the bug, it results: Missing item in object       - See: Well, indeed if I encrypt a message with 3DES, I cannot decrypt it with
my SmartCard:
    $ echo "Hello, world!" >foo
    $ gpg -e -r felix.klee at inka.de --personal-cipher-preference 3DES foo
    $ gpg -d --debug=crypto foo.gpg
    [?]
    gpg: encrypted with 4096-bit RSA key, ID 04FDF78D1679DD94, created 2
    016-12-17
          "Felix E. Klee "
    gpg: public key decryption failed: Missing item in object
    gpg: decryption failed: No secret key
    gpg: secmem usage: 0/32768 bytes in 0 blocks
    $ gpg --version
    gpg (GnuPG) 2.2.9
    libgcrypt 1.8.3
    [?]
?Missing item in object? is the same message that I get when trying to
decrypt the enQsig encrypted message! So, perhaps enQsig is using 3DES.
*How do I find that out?*
Also, I don?t understand: I was assuming that all the card does is
decrypt my session key using my private 4096 bit RSA key. *If the
session key is a 3DES key, why should the card care?*
[1]:

@_date: 2018-08-16 07:52:53
@_author: Felix E. Klee 
@_subject: Cannot decrypt file encrypted with enQsig 
I do have a backup of the private key, but it?s 1. out of reach at the
moment and 2. it?s a pain to restore. So far, I?m still optimistic that
the sender will eventually provide me with a message that I can decrypt.
Thanks a lot for your explanations!
PS: I?m toying with the idea of switching from my smart card to a Trezor
hardware token. This would mean generating an entirely new key (only
256 bit ECC supported). OTOH there are several advantages such as the
Trezor being a well documented open source device, and ? of course ? its
size with integrated key pad solution. It also depends on whether I can
get either a smart card reader or the Trezor to work with

@_date: 2018-08-22 11:07:59
@_author: Felix E. Klee 
@_subject: Android/Termux: How to build gpg-agent without maintainer mode? 
I managed to get `gpg-agent` run with USB smart card support under
What bugs me is that I had to compile in maintainer mode: Now I get
warnings that the software should not used be used with production keys.
Maintainer mode is in fact suggested by `autogen.sh`:
    $ git clone git://git.gnupg.org/gnupg.git
    [?]
    $ cd gnupg
    $ export C_INCLUDE_PATH=$PREFIX/include/:$PREFIX/include/libusb-1.0/
    :$PREFIX/include/libandroid-support
    $ ./autogen.sh
    [?]
    autogen.sh: You may now run:
      ./configure --sysconfdir=/etc --enable-maintainer-mode  && make
If I try without maintainer mode, then I get:
    $ ./configure
    [output attached]
    $ make
    make  all-recursive
    make[1]: Entering directory '/data/data/com.termux/files/home/src/g/
    gnupg'
    Making all in m4
    make[2]: Entering directory '/data/data/com.termux/files/home/src/g/
    gnupg/m4'
    make[2]: Nothing to be done for 'all'.
    make[2]: Leaving directory '/data/data/com.termux/files/home/src/g/
    gnupg/m4'
    Making all in common
    make[2]: Entering directory '/data/data/com.termux/files/home/src/g/
    gnupg/common'
    make[2]: *** No rule to make target 'audit-events.h', needed by 'all
    '.  Stop.
    make[2]: Leaving directory '/data/data/com.termux/files/home/src/g/g
    nupg/common'
    make[1]: *** [Makefile:613: all-recursive] Error 1
    make[1]: Leaving directory '/data/data/com.termux/files/home/src/g/g
    nupg'
    make: *** [Makefile:533: all] Error 2
*How do I build `gpg-agent` without maintainer mode?*
Note that I only need the agent, so I could probably speed up compile
time by quite a lot if disable the other tools in `./configure`. But
that?s not a priority now.

@_date: 2018-08-22 13:21:21
@_author: Felix E. Klee 
@_subject: Android/Termux: How to build gpg-agent without maintainer mode? 
Well if I call `g10/gpg` in the build, I get a big fat warning:
    gpg: NOTE: THIS IS A DEVELOPMENT VERSION!
    gpg: It is only intended for test purposes and should NOT be
    gpg: used in a production environment or with production keys!
*Shouldn?t that bug me?*
That being said:
  * The `agent/gpg-agent` does not output the warning.
  * As said in my original post, I am only interested in the agent. It
    is compatible with the `gpg` provided with Termux.

@_date: 2018-08-22 21:45:31
@_author: Felix E. Klee 
@_subject: Android/Termux: How to build gpg-agent without maintainer mode? 
On 8/22/18, Dirk Gottschalk Uh oh, I didn?t check out a release! Changed the [build
instructions][1] now to also include:
    $ git checkout gnupg-2.2.9 # matches GnuPG in Termux
Thanks for pointing me in the right direction!
Doesn?t really matter anyhow. The compile process on my phone is quite
fast, profiting from the multi core architecture.
[1]:

@_date: 2018-08-25 21:25:34
@_author: Felix E. Klee 
@_subject: Communication with card reader encrypted? 
When I decrypt a file using an OpenPGP card, is the communication
between a USB card reader and the GnuPG daemon encrypted? Or: Is the
decrypted session key sent unencrypted through the cable?

@_date: 2018-08-26 09:48:31
@_author: Felix E. Klee 
@_subject: Communication with card reader encrypted? 
I am more thinking about a hardware attack. If the communication is not
encrypted, this opens another attack vector. For comparison, think about
[key loggers][1]. Putting a hardware logger somewhere between the USB
peripheral device and the computer is potentially easier and quicker
than tampering with either the peripheral device or the computer.
Background: I want to put my SCM SPR332 v2 card reader into a different
enclosure, so that it?s more portable for [use with my mobile phone][2].
The very long cable also needs to be replaced. One option is to add a
USB port to the reader so that arbitrary cables can be used. This
thought coincided with me reading about [doctored USB cables][3]. I
don?t want to be required to trust three devices: phone, reader, and now
[1]: [2]: [3]:

@_date: 2018-08-26 11:12:32
@_author: Felix E. Klee 
@_subject: Communication with card reader encrypted? 
Would be interesting to find out.
Well, if the cable is soldered to the reader, then it?s much harder to
tamper with. Swapping a replaceable cable requires much less effort.
Concerning key loggers for comparison: It is possible that the [attack
at TAZ][1] would not have happened had the attacker to tamper with the
victim?s keyboards, their computers, or their software.
I would not be surprised if you can find USB cables on Alibaba that
include sniffers and multiple GBs of flash memory for logging
everything, for debugging of course. ;)
[1]:

@_date: 2018-08-27 17:09:01
@_author: Felix E. Klee 
@_subject: Communication with card reader encrypted? 
Thanks for clarification!
The host could provide a public encryption key to the card reader. Of
  * With a tampered USB cable, there still would be attacks possible,
    though different ones. That is, unless the reader can know the
    identify of the host, which would again require a priori exchange,
    so nothing gained.
  * This is very likely not part of the existing API (PC/SC?).

@_date: 2018-07-27 16:49:07
@_author: Felix E. Klee 
@_subject: Cannot decrypt file encrypted with enQsig 
To receive a document in encrypted form, I provided my public key to the
sender. See attachment. The key contains a sub key for encryption:
    sec  rsa4096/BEF6EFD38FE8DCA0
         created: 2016-12-17  expires: 2018-12-17  usage: SC
         card-no: 0005 00004980
         trust: ultimate      validity: ultimate
    ssb  rsa4096/04FDF78D1679DD94
         created: 2016-12-17  expires: 2018-12-17  usage: E
         card-no: 0005 00004980
    [ultimate] (1). Felix E. Klee The sender then prepared the encrypted file using a software called
enQsig: ?wir verwenden eine zentrale Gateway Verschl?sselungsl?sung
(EnQsig).? (German)
After I received `encrypted.asc` from the sender, I tried to decrypt it,
to no avail:
    C:\Users\Felix\Desktop>gpg -v -d encrypted.asc
    gpg: armor header: Version: enQsig
    gpg: public key is BEF6EFD38FE8DCA0
    gpg: no running gpg-agent - starting 'C:\Program Files (x86)\Gpg4win
    \..\GnuPG\bin\gpg-agent.exe'
    gpg: waiting for the agent to come up ... (5s)
    gpg: waiting for the agent to come up ... (4s)
    gpg: connection to agent established
    gpg: pinentry launched (9620 qt 1.1.1-beta5 - - -)
    gpg: public key is 04FDF78D1679DD94
    gpg: using subkey 04FDF78D1679DD94 instead of primary key BEF6EFD38F
    E8DCA0
    gpg: pinentry launched (4608 qt 1.1.1-beta5 - - -)
    gpg: public key is 92663E7CA68E4EC6
    gpg: public key is 9D8C454A43A6D2DE
    gpg: encrypted with RSA key, ID 9D8C454A43A6D2DE
    gpg: encrypted with RSA key, ID 92663E7CA68E4EC6
    gpg: using subkey 04FDF78D1679DD94 instead of primary key BEF6EFD38F
    E8DCA0
    gpg: encrypted with 4096-bit RSA key, ID 04FDF78D1679DD94, created 2
    016-12-17
          "Felix E. Klee "
    gpg: public key decryption failed: Missing item in object
    gpg: encrypted with 4096-bit RSA key, ID BEF6EFD38FE8DCA0, created 2
    016-12-17
          "Felix E. Klee "
    gpg: public key decryption failed: Invalid ID
    gpg: decryption failed: No secret key
encryption key is the sub key 04FDF78D1679DD94. The private key is on a
smart card. As you can see, decryption fails with an error message:
?gpg: public key decryption failed: Missing item in object?
*What does the error message mean? Why does encryption fail?*
I wonder if perhaps enQsig cannot properly deal with encryption sub keys:
*Would it be possible to extract the public encryption sub key?* (to
only provide that to the sender)
I am using Gpg4win 3.1.2 on Windows 7x64. If more information is needed,
then I am happy to provide it!

@_date: 2018-07-30 11:26:31
@_author: Felix E. Klee 
@_subject: Cannot decrypt file encrypted with enQsig 
I use it daily for encryption/decryption of documents, though only with
*But how?*
Your suggestion doesn?t seem to work:
    >gpg --export 04FDF78D1679DD94 | gpg --keyid-format long
    gpg: WARNING: no command supplied.  Trying to guess what you mean ..
    .
    pub   rsa4096/BEF6EFD38FE8DCA0 2016-12-17 [SC] [expires: 2018-12-17]
          5EF8B6017F668171259945D6BEF6EFD38FE8DCA0
    uid                           Felix E. Klee     sub   rsa4096/04FDF78D1679DD94 2016-12-17 [E] [expires: 2018-12-17]
I can ask him of course. First I would like to see, though, if GnuPG can
tell us what?s the problem.
Here you go (again my encryption key is `04FDF78D1679DD94`):
    >gpg --list-packets encrypted.asc
    # off=0 ctb=c1 tag=1 hlen=3 plen=524 new-ctb
    :pubkey enc packet: version 3, algo 1, keyid BEF6EFD38FE8DCA0
            data: [4096 bits]
    # off=527 ctb=c1 tag=1 hlen=3 plen=524 new-ctb
    :pubkey enc packet: version 3, algo 1, keyid 04FDF78D1679DD94
            data: [4095 bits]
    # off=1054 ctb=c1 tag=1 hlen=3 plen=524 new-ctb
    :pubkey enc packet: version 3, algo 1, keyid 92663E7CA68E4EC6
            data: [4096 bits]
    # off=1581 ctb=c1 tag=1 hlen=3 plen=524 new-ctb
    :pubkey enc packet: version 3, algo 1, keyid 9D8C454A43A6D2DE
            data: [4094 bits]
    gpg: encrypted with RSA key, ID 9D8C454A43A6D2DE
    gpg: encrypted with RSA key, ID 92663E7CA68E4EC6
    gpg: encrypted with 4096-bit RSA key, ID 04FDF78D1679DD94, created 2
    016-12-17
          "Felix E. Klee "
    gpg: public key decryption failed: Missing item in object
    gpg: encrypted with 4096-bit RSA key, ID BEF6EFD38FE8DCA0, created 2
    016-12-17
          "Felix E. Klee "
    gpg: public key decryption failed: Invalid ID
    gpg: decryption failed: No secret key
    # off=2108 ctb=d2 tag=18 hlen=3 plen=1718 new-ctb
    :encrypted data packet:
            length: 1718
            mdc_method: 2
I wonder what ?Missing item in object? means.

@_date: 2018-07-30 12:18:40
@_author: Felix E. Klee 
@_subject: Cannot decrypt file encrypted with enQsig 
Zum Vergleich eine Datei, die ich selbst f?r mich verschl?sselt habe,
und die ich erfolgreich entschl?sseln kann:
    >gpg --list-packets foo.gpg
    gpg: encrypted with 4096-bit RSA key, ID 04FDF78D1679DD94, created 2
    016-12-17
          "Felix E. Klee "
    # off=0 ctb=85 tag=1 hlen=3 plen=524
    :pubkey enc packet: version 3, algo 1, keyid 04FDF78D1679DD94
            data: [4094 bits]
    # off=527 ctb=d2 tag=18 hlen=2 plen=76 new-ctb
    :encrypted data packet:
            length: 76
            mdc_method: 2
    # off=548 ctb=a3 tag=8 hlen=1 plen=0 indeterminate
    :compressed packet: algo=2
    # off=550 ctb=cb tag=11 hlen=2 plen=23 new-ctb
    :literal data packet:
            mode b (62), created 1532945681, name="",
            raw data: 17 bytes

@_date: 2018-07-30 12:40:30
@_author: Felix E. Klee 
@_subject: Cannot decrypt file encrypted with enQsig 
Now I tried a different card reader (after restarting Windows 7x64).
This time it?s a Cherry ST-2000. Previously it was a ReinerSCT
With the Cherry I get a different error message! This time it?s ?Invalid
value? instead of ?Invalid ID?!
*What does that mean?*
    >gpg --list-packets encrypted.asc
    # off=0 ctb=c1 tag=1 hlen=3 plen=524 new-ctb
    :pubkey enc packet: version 3, algo 1, keyid BEF6EFD38FE8DCA0
            data: [4096 bits]
    # off=527 ctb=c1 tag=1 hlen=3 plen=524 new-ctb
    :pubkey enc packet: version 3, algo 1, keyid 04FDF78D1679DD94
            data: [4095 bits]
    # off=1054 ctb=c1 tag=1 hlen=3 plen=524 new-ctb
    :pubkey enc packet: version 3, algo 1, keyid 92663E7CA68E4EC6
            data: [4096 bits]
    # off=1581 ctb=c1 tag=1 hlen=3 plen=524 new-ctb
    :pubkey enc packet: version 3, algo 1, keyid 9D8C454A43A6D2DE
            data: [4094 bits]
    gpg: encrypted with RSA key, ID 9D8C454A43A6D2DE
    gpg: encrypted with RSA key, ID 92663E7CA68E4EC6
    gpg: encrypted with 4096-bit RSA key, ID 04FDF78D1679DD94, created 2
    016-12-17
          "Felix E. Klee "
    gpg: public key decryption failed: Invalid value
    gpg: encrypted with 4096-bit RSA key, ID BEF6EFD38FE8DCA0, created 2
    016-12-17
          "Felix E. Klee "
    gpg: public key decryption failed: Invalid ID
    gpg: decryption failed: No secret key
    # off=2108 ctb=d2 tag=18 hlen=3 plen=1718 new-ctb
    :encrypted data packet:
            length: 1718
            mdc_method: 2

@_date: 2018-09-17 18:44:46
@_author: Felix E. Klee 
@_subject: Cannot decrypt file encrypted with enQsig 
Created a custom key pair not on a smart card, just for this single
transaction. Result:
    >gpg --verbose --decrypt encrypted.asc | head
    gpg: armor header: Version: enQsig
    gpg: public key is FDE5C6E97DA42AE8
    gpg: public key is 92663E7CA68E4EC6
    gpg: public key is 9D8C454A43A6D2DE
    gpg: encrypted with RSA key, ID 9D8C454A43A6D2DE
    gpg: encrypted with RSA key, ID 92663E7CA68E4EC6
    gpg: encrypted with 4096-bit RSA key, ID FDE5C6E97DA42AE8, created
    2018-09-06
          "Felix E. Klee "
    gpg: 3DES encrypted data
    gpg: Note: sender requested "for-your-eyes-only"
So yes, 3DES!
Fortunately, as can be seen above, with the custom key I was able to
decrypt the message.
Issue solved.

@_date: 2019-02-10 23:26:10
@_author: Felix E. Klee 
@_subject: 0.332 
This is a mod of the SCM SPR332 v2 smart card reader, making it
smaller and lighter. For quite a while I have regularly been using it
with my phone:

@_date: 2019-02-11 23:24:22
@_author: Felix E. Klee 
@_subject: 0.332 
* cyberJack RFID standard:
    62 x 95 x 13 mm
  * 0.332 enclosure:
    69 ? 111 ? 13 mm
It could be fun to replace the pin pad by a smaller one and create a
custom board. IOW it could be fun to create an open source card reader!
Did that in the past too. However, the ?cyberJack RFID standard? needs
dedicated drivers while the Reiner SCT directly interfaces with
GnuPG. In particular with Termux on my rooted Android phone, I did not
get the cyberJack to work.
I understand, but that?s not my use-case. If someone wants to give it a
go, it should not be too hard to modify the current design. You can
start from the STL files if you don?t have Rhino3D (proprietary).

@_date: 2020-12-15 11:13:05
@_author: Felix E. Klee 
@_subject: Decrypting fails unless card status 
Since some time, maybe since a minor system update, before decrypting
from my OpenPGP smart card, I always have to run:
    gpg --card-status
Otherwise, I get an error message:
    $ gpg --faked-system-time 20200101T000000 -d world.gpg
    gpg: WARNING: running with faked system time: 2020-01-01 00:00:00
    gpg: encrypted with 4096-bit RSA key, ID 04FDF78D1679DD94, created
    2016-12-17
          "Felix E. Klee "
    gpg: public key decryption failed: Invalid ID
    gpg: decryption failed: No secret key
Note that I have to run with faked system time since I cannot extend the
validity of my key. Anyhow, even without faking the time, I get the
error message.
*Any idea how to get `gpg` back to normal?*

@_date: 2020-12-15 20:49:26
@_author: Felix E. Klee 
@_subject: Decrypting fails unless card status 
No. I do have an accessible private key, but it?s more than 9,000 km
away, and traveling is not so easy these days.
