
@_date: 2008-02-19 14:35:55
@_author: Maury Markowitz 
@_subject: passphrase doesn't work? 
I'm being sent a file that's encrypted using our PK by some version of
PGP using IDEA (or course). I'd like to decrypt it using gpg, in a CMD
shell, under Windows XP.
To get started, I downloaded and installed gpg, downloaded and copied
over idea.dll, copied over our PGP keyrings and renamed them to
".gpg", used --homedir to point everything to the network folder where
I put it all, and started experimenting...
gpg --homedir o:\utilities\ --list-keys
returns a list of keys in "pubring.gpg" (should it do the same for
secring?). One of the keys in the list is the 2048-bit key that I'm
trying to use. It seems to be working so far!
Ok, let's try to open the file...
gpg --homedir o:\utilities\ --load-extension o:\utilities\idea.dll -d
You need a passphrase to [...]
[type in the passphrase]
gpg: Invalid passphrase; please try again ...
[repeat, making very sure]
gpg: Invalid passphrase; please try again ...
Ok, the passphrase is correct. Any ideas what's going on here?

@_date: 2008-02-20 09:34:19
@_author: Maury Markowitz 
@_subject: Moving from PGP to GPG 
I'm in the process of automating a number of manual tasks. Several of
these require a user to manually download e-mail attachments to a
folder, decrypt them using PGP, and then open them in Excel. So far I
have managed to redirect the mail to a public folder in Exchange, find
and download the attachments (MS does NOT make that easy!) and in the
unencrypted cases, open the files and automatically process them.
Now there's the encrypted ones. I have downloaded and installed both
GPG and IDEA.DLL on a network share. I then copied over our keyfiles
from the existing PGP installs, and renamed them ".gpg" which seems to
make life simpler (do I need to do this? is can I specify the file
directly and thus leave it named ".skr" and ".pkr"?)
After the install I did:
gpg --homedir o:\utilities\ --list-keys
and got a list of the expected keys. One of these is our 2048-bit
public key that I know the other side is using to encrypt the file in
question. So then I try the actual extraction...
gpg --homedir o:\utilities\ --load-extension o:\utilities\idea.dll -d
And this gets me:
You need a passphrase to unlock the secret key for...
Ok, no problem, so I type in the passphrase...
gpg: Invalid passphrase; please try again ...
Uhhh, no, it's NOT invalid. And this is where I am stuck.
So am I correct in thinking that I should be able to copy the keyfiles
over? If not, is there some sort of process I can use to do so? Is
there such thing as a "cross platform" keyfile that works in both GPG
and PGP?

@_date: 2008-02-20 15:40:08
@_author: Maury Markowitz 
@_subject: Moving from PGP to GPG 
Ok, this is much more in keeping with my experience. Thanks for that,
I thought I was going crazy!
Ok, I put ultimate trust on both of our public keys. Do I need to do
the same for the private ones? If so, it's not entirely obvious how to
do so, because the hex doesn't show up when I --list-keys, is there
some additional option I need?
The bad news: it still says my passphrase is wrong! Which increasingly
leads me to believe my passphrase is wrong...
I will try removing it first.

@_date: 2008-02-21 10:25:50
@_author: Maury Markowitz 
@_subject: Still no luck on the passphrase 
Ok, I have done everything I can think of. I have used the original
keyfiles, I've exported/imported the keyfiles, I've typed in every
possible variation of the passphrase I can think of, and it still
doesn't work.
Is there a way to simply remove the passphrase. Yes I know this is
bad, but it's better than "doesn't work at all".

@_date: 2008-02-29 15:10:47
@_author: Maury Markowitz 
@_subject: _almost_ working, now a command line question... 
So after finally deciding to trust that gpg was giving me an accurate
error, and that the passphrase really was wrong, I spend the last week
scaring up someone within the labyrinths that could actually change
the key to the one that we know works. Presto! Working file.
Lesson learned: You CAN simply copy binary key files from pgp to gpg,
which is really nice.
All that's left now is to fully automate this, and my Windows CMD
noobishness is an issue. Here's my command line:
O:\Utilities>echo o:\apricing\pass.txt | o:\utilities\gpg --homedir o:\utilities
\ --passphrase-fd 0 --load-extension o:\utilities\idea.dll -o "o:\apricing\morga
n_cds_20080229.txt" -d "o:\apricing\24476.txt.pgp"
And here are the results (slightly trimmed to protect the innocent):
Reading passphrase from file descriptor 0
You need a passphrase to unlock the secret key for
user: "Polar Securities Inc "
2048-bit ELG-E key, ID 3E396FC9, created 2000-10-27 (main key ID F0ED5CDC)
gpg: encrypted with 2048-bit ELG-E key, [snip]
gpg: public key decryption failed: bad passphrase
pass.txt absolutely has the right key in it. I tried both | and >, the
later did nothing at all (which I guess makes sense).
Anything obvious here?

@_date: 2008-03-03 11:44:29
@_author: Maury Markowitz 
@_subject: _almost_ working, now a command line question... 
Holy smokes, this is much more annoying than I thought possible!
Using either the | and < methods of passing in the passphrase works
from the CMD window and I can decrypt the file fine. Even cutting and
pasting the command string in works fine.
But when I shell the exact same line of text (which is where I cut it
from) into the VBA Shell command, which I do for literally dozens of
tasks, it does not work. GPG puts up the message:
Reading passphrase from file descriptor 0 ...
And then just sits there. Perhaps I can't call a pipe or redirect in
the VBA shell command; if try I'm pretty much sunk unless I can get
--passphrase-file to work. And it doesn't.
Is --passphrase-file a feature of 2.0 only? If so, is there somewhere
where I can get a compiled windows binary of it?

@_date: 2008-03-03 14:27:35
@_author: Maury Markowitz 
@_subject: _almost_ working, now a command line question... 
Worth a try, but:
gpg: failed to translate osfhandle 0000004A

@_date: 2008-03-04 11:51:13
@_author: Maury Markowitz 
@_subject: IDEA? 
Didn't IDEA's patent expire last year? I notice it's still not in the
list unless I load it by hand. Is there something else preventing it
from being used?

@_date: 2008-03-04 11:48:57
@_author: Maury Markowitz 
@_subject: _almost_ working, now a command line question... 
Frigging frig! I had download 1.2.2! Where the heck did I get that?!
Everything is working perfectly now. Thanks to everyone that helped
this noob get up and running. I'll try to repay the kindness by
returning the favor.
