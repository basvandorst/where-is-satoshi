
@_date: 2020-01-03 13:53:00
@_author: Gabriele Pohl 
@_subject: Decryption fails with "No secret key" 
After upgrading my PC to Fedora 30 a problem with decrypting came up.
Encryption works:
$ gpg --verbose --output test.txt.gpg --recipient contact at dipohl.de --encrypt test.txt
gpg: Note: signature key E747789CEA208551 expired Fri 06 Jun 2014 07:46:32 PM CEST
gpg: using pgp trust model
gpg: using subkey 4BB3049F19616A80 instead of primary key 9C7646202CE0CBB2
gpg: automatically retrieved 'contact at dipohl.de' via Local
gpg: This key belongs to us
gpg: reading from 'test.txt'
gpg: writing to 'test.txt.gpg'
gpg: RSA/AES256 encrypted for: "4BB3049F19616A80 Gabriele Pohl "
$ ls -l test.txt*
-rw-rw-r--. 1 gap gap 119 Jan  3 13:04 test.txt
-rw-rw-r--. 1 gap gap 697 Jan  3 13:07 test.txt.gpg
But decrypting fails:
$ gpg --verbose --decrypt test.txt.gpg gpg: public key is 4BB3049F19616A80
gpg: using subkey 4BB3049F19616A80 instead of primary key 9C7646202CE0CBB2
gpg: encrypted with 4096-bit RSA key, ID 4BB3049F19616A80, created 2016-09-05
      "Gabriele Pohl "
gpg: decryption failed: No secret key
The secret key is available:
gpg> list
sec  rsa2048/9C7646202CE0CBB2
     created: 2012-09-05  expires: 2020-03-16  usage: SC       trust: ultimate      validity: ultimate
ssb  rsa2048/51E12CABCB4F0264
     created: 2012-09-05  expired: 2016-09-04  usage: E   sub  rsa4096/4BB3049F19616A80
     created: 2016-09-05  expires: 2020-03-16  usage: E   [ultimate] (1). Gabriele Pohl My gpg-agent.conf:
# Cache settings
default-cache-ttl 10800
default-cache-ttl-ssh 10800
max-cache-ttl 10800
# Environment file
 /home/gap/.gpg-agent-info
# Keyboard control
# PIN entry program
 /usr/bin/pinentry
pinentry-program /usr/bin/pinentry-curses
 /usr/bin/pinentry-qt4
 /usr/bin/pinentry-kwallet
 /usr/bin/pinentry-gtk-2
 /usr/bin/pinentry-gtk
 /usr/bin/pinentry-qt
display :0.0
debug-level basic
I hope you can help me to solve the problem.
Thanks and kind regards,

@_date: 2020-01-06 11:50:20
@_author: Gabriele Pohl 
@_subject: Decryption fails with "No secret key" 
Hi Ingo,
On Sun, 05 Jan 2020 16:17:04 +0100
with your recipe the missing secret key was migrated again
and decryption is possible now :-)
The key listing now shows:
----------- snip -----------
Secret key is available.
sec  rsa2048/9C7646202CE0CBB2
     created: 2012-09-05  expires: 2020-03-16  usage: SC       trust: ultimate      validity: ultimate
ssb  rsa2048/51E12CABCB4F0264
     created: 2012-09-05  expired: 2016-09-04  usage: E   ssb  rsa4096/4BB3049F19616A80
     created: 2016-09-05  expires: 2020-03-16  usage: E   ssb  rsa4096/534EADA0332CFAAF
     created: 2016-09-09  expired: 2018-09-09  usage: S   [ultimate] (1). Gabriele Pohl ----------- snip -----------
hmmm, I searched for fedora bug reports (before I wrote
to this mailing list) but didn't find my issue there.
I reckon there are not many users who add encryption keys
to an existent key and this special case may be the reason for the problem arising in my case.
I think it is too late to file a bug report now
as the move from Fedora 29 to 30 is no longer relevant.
And by searching the internet this thread may arise in the future for lucky finders ;-)
Thank you very much for your help and kind regards,
