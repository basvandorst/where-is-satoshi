
@_date: 2007-08-20 22:10:31
@_author: Srihari Vijayaraghavan 
@_subject: GnuPG & OpenSSH 
I've lightly read through a few gnupg man & info pages, though my questions
might sound like FAQ or outright annoying :-). I'm a happy user with OpenSSH &
GPG independently, but of late am trying to find if it's possible to unify
them with just a key pair.
1. Is it possible to have only one key pair (public & secret pref. DSA) that
can be used for both GPG & OpenSSH? (as a sys admin of some interest in
cryptography, this is an important question)
2. Is gpg-agent, SSH agent service provided by GPG etc. somehow useful only
when one has a card reader? Or put it other way, is it useful even when one
has no card reader?
3. Am I missing a simple 'GPG/OpenSSH unification for dummies' (dummies like
me :-)) with a few solid examples on unifying GPG (keys - including exporting
GPG public key to add into .ssh/authorized_keys, gpg-agent) with OpenSSH
client side?
The potentials are huge if OpenSSH & GPG can share the same key pair, I
reckon. I wish somebody writes a nice article on one of the reputed computer
magazines about this topic, with simple pictures & hands on procedures etc.
(A careful reader would notice I've carefully constructed questions to lead to
yes or no type of answers to avoid any ambiguity, as at this stage I should be
delighted with such answers alone on the concepts/ideas/idioms. You're welcome
to point me to any additional materials, of course.)
Thanks in advance.
PS: Keep up the good work on GPG.
      ____________________________________________________________________________________
Feel safe with award winning spam protection on Yahoo!7 Mail.

@_date: 2007-08-21 21:40:47
@_author: Srihari Vijayaraghavan 
@_subject: GnuPG & OpenSSH  
It's not a crazy idea then :-). It'd be nice to discover how to achieve this
though (if at all possible).
Thanks for that. On that note, I spent a few hours on gpg-agent & getting it
to look after my SSH private keys (with individual pass-phrases etc.). All
looking good. Wonderful.
Indeed, it greatly helped me in understanding the mental picture of what was
going on in gpg-agent :-). Thank you for that.
Srihari       ____________________________________________________________________________________
Get the World's number 1 free email service.

@_date: 2007-08-21 21:51:32
@_author: Srihari Vijayaraghavan 
@_subject: GnuPG & OpenSSH 
Good. Agreed it's a good idea to maintain a key per task (in fact in OpenSSH
automation side of things having a key pair per task does help a lot).
Question: when I did gpg2 --gen-keys (& ran through with the default
DSA/Elgamal keys), the 'authentication key' (that'd be suitable for SSH
authentication you're referring to) created by default? (or the DSA private
key be suitable for that purpose? I suspect so.)
Then the question is, now for the OpenSSH private key, how to extract/create
the said 'authentication key' that can be stored in ~/.ssh/id_dsa format for
SSH authentication?
(I've worked out the extraction of the SSH compatible public key from the GPG
using gpgkey2ssh tool, so ~/.ssh/id_dsa.pub is taken care of. Alas, gpg2
--list-public-keys and --list-secret-keys gives the same ID for both public &
secret keys.)
Or is there a trick involved in gpg-agent directly handling private key needed
for SSH client somehow? (by only propagating the gpgkey2ssh extracted public
key to .ssh/authorized_hosts of the remote machines)
      ____________________________________________________________________________________
Get the World's number 1 free email service.

@_date: 2007-08-22 23:41:54
@_author: Srihari Vijayaraghavan 
@_subject: GnuPG & OpenSSH 
Thanks for the direction there.
I now have an 'authentication' subkey created. I've even extracted the SSH
compatible public key from the subkey using gpgkey2ssh (which I can propagate
to .ssh/authorized_keys of the remote machines).
I'm stuck on unable to understand how to integrate the secret key of the above
authentication subkey with gpg-agent (or ssh-agent for that matter though
gpg-agent is my preferred choice now :-)).
Just by observing things, I'd say I've two choices:
1. Extract the SSH compatible secret key from the authentication subkey
somehow; then use ssh-add to populate .gnupg/sshcontrol &
.gnupg/private-keys-v1.d/.key files. Naturally, I don't know how to
extract an SSH compatible key from the subkey to feed it to ssh-add, so I can
make no progress here.
2. Or by "other means" populate .gnupg/sshcontrol &
.gnupg/private-keys-v1.d/.key files. I've made no progress here
either for the lack of skill & knowledge.
I'd appreciate if a GnuPG expert can guide me with either one of the choices
above (or perhaps Smartcard's the only path suitable etc. as gpg-agent man
pages imply smartcard approach is capable of handling .gnupg/sshcontrol &
.gnupg/private-keys-v1.d/.key files 'automatically').
I also couldn't work out how to extract the keygrip id of a subkey (using gpg2
--fingerprint  OR gpg2 --edit-key  etc.). I suspect the
keygrip of a subkey might be the same as the primary key it's associated with.
(If yes, then the next question is how to populate
.gnupg/private-keys-v1.d/.key with the right content :-).)
Thank you.
PS: Indeed with gpg-agent I've struck a gold-mine ;-). Would be nice if I can
get the SSH integration using GPG subkey going somehow. I've some very useful
use for these ideas.
      ____________________________________________________________________________________
Sick of deleting your inbox? Yahoo!7 Mail has free unlimited storage.

@_date: 2007-10-01 16:48:58
@_author: Srihari Vijayaraghavan 
@_subject: GPG, card reader & udev 
Looking at the Installation of Card Reader page at:
I'm unable to download gnupg-ccid from that page (cos it points to a broken
link or something). I've downloaded the gnupg-ccid.rules files perfectly fine
Could somebody give me a copy of this file? (or provide a working link on that
PS: Looks like it's needed to get the shiny new card reader & OpenPGP card
      Sick of deleting your inbox? Yahoo!7 Mail has free unlimited storage.

@_date: 2007-10-03 11:30:33
@_author: Srihari Vijayaraghavan 
@_subject: GPG, card reader & udev 
For the record, here's the link from where I could download the file from:
PS: Might help another poor soul looking for this kind of info. Who knows?
      Sick of deleting your inbox? Yahoo!7 Mail has free unlimited storage.

@_date: 2007-10-03 11:41:35
@_author: Srihari Vijayaraghavan 
@_subject: OmniKey CardMan 6121 & OpenPGP card anyone? 
If they're working fine for you, what do you see when you execute pcsc_scan. This is what I see:
PC/SC device scanner
V 1.4.8 (c) 2001-2006, Ludovic Rousseau Compiled with PC/SC lite version: 1.3.2
Scanning present readers
0: OmniKey CardMan 6121 00 00
Wed Oct  3 11:24:47 2007
 Reader 0: OmniKey CardMan 6121 00 00
  Card state: Card inserted, Unresponsive card,
I'm unsure whether 'Unresponsive card' is a normal message or highlights some
problem with my card. Indeed the card is no go yet, yet I've tried it on 3
different OmniKey CardMan 6121 readers with the same result.
Many variables to isolate, definitely proving electrical connectivity & the
integrity of the OpenPGP card are the most important tasks.
      Sick of deleting your inbox? Yahoo!7 Mail has free unlimited storage.

@_date: 2007-10-08 09:37:18
@_author: Srihari Vijayaraghavan 
@_subject: OmniKey CardMan 6121 & OpenPGP card anyone? 
Fair enough. I really don't know how to get this thing working on my
up-to-date Fedora 7 system.
(I've stopped pcscd service.)
Now this's my .gnupg/gpg-agent:
log-file gpg-agent.log
debug-level guru
This is what happens when I execute "gpg --card-status":
winscard_clnt.c:3349:SCardCheckDaemonAvailability() PCSC Not Running
gpg: pcsc_establish_context failed: no service (0x8010001d)
gpg: card reader not available
gpg: OpenPGP card not available: general error
Here's the contents of gpg-agent.log:
2007-10-08 09:29:42 gpg-agent[3136] listening on socket
2007-10-08 09:29:42 gpg-agent[3136] listening on socket
2007-10-08 09:31:15 gpg-agent[3137] handler 0x927bcd8 for fd 8 started
gpg-agent[3137.8] DBG: -> OK Pleased to meet you
gpg-agent[3137.8] DBG: <- OPTION display=:0.0
gpg-agent[3137.8] DBG: -> OK
gpg-agent[3137.8] DBG: <- OPTION ttyname=/dev/pts/1
gpg-agent[3137.8] DBG: -> OK
gpg-agent[3137.8] DBG: <- OPTION ttytype=xterm
gpg-agent[3137.8] DBG: -> OK
gpg-agent[3137.8] DBG: <- OPTION lc-ctype=en_US.UTF-8
gpg-agent[3137.8] DBG: -> OK
gpg-agent[3137.8] DBG: <- OPTION lc-messages=en_US.UTF-8
gpg-agent[3137.8] DBG: -> OK
gpg-agent[3137.8] DBG: <- SCD SERIALNO openpgp
2007-10-08 09:31:15 gpg-agent[3137] no running SCdaemon - starting it
2007-10-08 09:31:15 gpg-agent[3137] DBG: first connection to SCdaemon
2007-10-08 09:31:15 gpg-agent[3137] DBG: additional connections at
gpg-agent[3137.8] DBG: -> ERR 100663356 Not supported gpg-agent[3137.8] DBG: <- BYE
gpg-agent[3137.8] DBG: -> OK closing connection
2007-10-08 09:31:15 gpg-agent[3137] handler 0x927bcd8 for fd 8 terminated
I'm unable to decipher what the problem is, are you? Would appreciate some
help here.
(To my untrained/inexperienced eyes, the "ERR 100663356 Not supported "
looks like the problem here. Don't know how to solve it though.)
Thank you.
      Sick of deleting your inbox? Yahoo!7 Mail has free unlimited storage.

@_date: 2007-10-09 09:07:03
@_author: Srihari Vijayaraghavan 
@_subject: OmniKey CardMan 6121 & OpenPGP card anyone? 
Thanks for your assistance. I've just then downloaded gpg 1.4.7 source from
gnupg.org & have built it & have installed it.
$ egrep 'HAVE_LIBUSB' config.h
 HAVE_LIBUSB 1
$ which gpg
$ gpg --version
gpg (GnuPG) 1.4.7
Copyright (C) 2006 Free Software Foundation, Inc.
$ gpg --card-status
gpg: detected reader `OmniKey CardMan 6121 00 00'
gpg: pcsc_connect failed: proto mismatch (0x8010000f)
gpg: card reader not available
gpg: OpenPGP card not available: general error
$ gpg --card-status --debug-ccid-driver
gpg: DBG: ccid-driver: using CCID reader 0 (ID=076B:6622:X:0)
gpg: DBG: ccid-driver: idVendor: 076B  idProduct: 6622  bcdDevice: 0203
gpg: DBG: ccid-driver: ChipCard Interface Descriptor:
gpg: DBG: ccid-driver:   bLength                54
gpg: DBG: ccid-driver:   bDescriptorType        33
gpg: DBG: ccid-driver:   bcdCCID              1.00
gpg: DBG: ccid-driver:   nMaxSlotIndex           0
gpg: DBG: ccid-driver:   bVoltageSupport         7  ?
gpg: DBG: ccid-driver:   dwProtocols             3  T=0 T=1
gpg: DBG: ccid-driver:   dwDefaultClock       4800
gpg: DBG: ccid-driver:   dwMaxiumumClock      8000
gpg: DBG: ccid-driver:   bNumClockSupported      4
gpg: DBG: ccid-driver:   dwDataRate          10752 bps
gpg: DBG: ccid-driver:   dwMaxDataRate      412903 bps
gpg: DBG: ccid-driver:   bNumDataRatesSupp.    106
gpg: DBG: ccid-driver:   dwMaxIFSD             254
gpg: DBG: ccid-driver:   dwSyncProtocols  00000007  2-wire 3-wire I2C
gpg: DBG: ccid-driver:   dwMechanical     00000000
gpg: DBG: ccid-driver:   dwFeatures       000207B2
gpg: DBG: ccid-driver:     Auto configuration based on ATR
gpg: DBG: ccid-driver:     Auto clock change
gpg: DBG: ccid-driver:     Auto baud rate change
gpg: DBG: ccid-driver:     Auto PPS made by CCID
gpg: DBG: ccid-driver:     CCID can set ICC in clock stop mode
gpg: DBG: ccid-driver:     NAD value other than 0x00 accepted
gpg: DBG: ccid-driver:     Auto IFSD exchange
gpg: DBG: ccid-driver:     Short APDU level exchange
gpg: DBG: ccid-driver:   dwMaxCCIDMsgLen       271
gpg: DBG: ccid-driver:   bClassGetResponse    echo
gpg: DBG: ccid-driver:   bClassEnvelope       echo
gpg: DBG: ccid-driver:   wlcdLayout           none
gpg: DBG: ccid-driver:   bPINSupport             0
gpg: DBG: ccid-driver:   bMaxCCIDBusySlots       1
gpg: DBG: ccid-driver: usb_claim_interface failed: -1
gpg: detected reader `OmniKey CardMan 6121 00 00'
gpg: pcsc_connect failed: proto mismatch (0x8010000f)
gpg: card reader not available
gpg: OpenPGP card not available: general error
I have it provided some clues. Thanks for your help.
      Sick of deleting your inbox? Yahoo!7 Mail has free unlimited storage.

@_date: 2007-10-09 21:12:28
@_author: Srihari Vijayaraghavan 
@_subject: OmniKey CardMan 6121 & OpenPGP card anyone? 
Both conditions I've eliminated. Pls read below.
Now I've done that. It was starting between reboots. Sorry about that. Now
I've disabled the pcscd service for good now.
Here's the current status:
[root at laptop ~]# /usr/local/bin/gpg --card-status --debug-ccid-driver
gpg: DBG: ccid-driver: using CCID reader 0 (ID=076B:6622:X:0)
gpg: DBG: ccid-driver: idVendor: 076B  idProduct: 6622  bcdDevice: 0203
gpg: DBG: ccid-driver: ChipCard Interface Descriptor:
gpg: DBG: ccid-driver:   bLength                54
gpg: DBG: ccid-driver:   bDescriptorType        33
gpg: DBG: ccid-driver:   bcdCCID              1.00
gpg: DBG: ccid-driver:   nMaxSlotIndex           0
gpg: DBG: ccid-driver:   bVoltageSupport         7  ?
gpg: DBG: ccid-driver:   dwProtocols             3  T=0 T=1
gpg: DBG: ccid-driver:   dwDefaultClock       4800
gpg: DBG: ccid-driver:   dwMaxiumumClock      8000
gpg: DBG: ccid-driver:   bNumClockSupported      4
gpg: DBG: ccid-driver:   dwDataRate          10752 bps
gpg: DBG: ccid-driver:   dwMaxDataRate      412903 bps
gpg: DBG: ccid-driver:   bNumDataRatesSupp.    106
gpg: DBG: ccid-driver:   dwMaxIFSD             254
gpg: DBG: ccid-driver:   dwSyncProtocols  00000007  2-wire 3-wire I2C
gpg: DBG: ccid-driver:   dwMechanical     00000000
gpg: DBG: ccid-driver:   dwFeatures       000207B2
gpg: DBG: ccid-driver:     Auto configuration based on ATR
gpg: DBG: ccid-driver:     Auto clock change
gpg: DBG: ccid-driver:     Auto baud rate change
gpg: DBG: ccid-driver:     Auto PPS made by CCID
gpg: DBG: ccid-driver:     CCID can set ICC in clock stop mode
gpg: DBG: ccid-driver:     NAD value other than 0x00 accepted
gpg: DBG: ccid-driver:     Auto IFSD exchange
gpg: DBG: ccid-driver:     Short APDU level exchange
gpg: DBG: ccid-driver:   dwMaxCCIDMsgLen       271
gpg: DBG: ccid-driver:   bClassGetResponse    echo
gpg: DBG: ccid-driver:   bClassEnvelope       echo
gpg: DBG: ccid-driver:   wlcdLayout           none
gpg: DBG: ccid-driver:   bPINSupport             0
gpg: DBG: ccid-driver:   bMaxCCIDBusySlots       1
gpg: DBG: ccid-driver: usb_bulk_read error: Resource temporarily unavailable
gpg: DBG: ccid-driver: USB: CALLING USB_CLEAR_HALT
gpg: DBG: ccid-driver: usb_bulk_read error: Resource temporarily unavailable
gpg: DBG: ccid-driver: USB: RETRYING bulk_in AGAIN
gpg: DBG: ccid-driver: usb_bulk_read error: Resource temporarily unavailable
gpg: DBG: ccid-driver: USB: RETRYING bulk_in AGAIN
gpg: DBG: ccid-driver: status: 41  error: FE  octet[9]: 00
               data:
gpg: DBG: ccid-driver: CCID command failed: CCID timed out while talking to
the ICC
gpg: DBG: ccid-driver: status: 41  error: FE  octet[9]: 00
               data:
gpg: DBG: ccid-driver: CCID command failed: CCID timed out while talking to
the ICC
gpg: apdu_send_simple(0) failed: card inactive
gpg: DBG: ccid-driver: status: 01  error: 00  octet[9]: 01
               data:
gpg: DBG: ccid-driver: idVendor: 076B  idProduct: 6622  bcdDevice: 0203
gpg: DBG: ccid-driver: ChipCard Interface Descriptor:
gpg: DBG: ccid-driver:   bLength                54
gpg: DBG: ccid-driver:   bDescriptorType        33
gpg: DBG: ccid-driver:   bcdCCID              1.00
gpg: DBG: ccid-driver:   nMaxSlotIndex           0
gpg: DBG: ccid-driver:   bVoltageSupport         7  ?
gpg: DBG: ccid-driver:   dwProtocols             3  T=0 T=1
gpg: DBG: ccid-driver:   dwDefaultClock       4800
gpg: DBG: ccid-driver:   dwMaxiumumClock      8000
gpg: DBG: ccid-driver:   bNumClockSupported      4
gpg: DBG: ccid-driver:   dwDataRate          10752 bps
gpg: DBG: ccid-driver:   dwMaxDataRate      412903 bps
gpg: DBG: ccid-driver:   bNumDataRatesSupp.    106
gpg: DBG: ccid-driver:   dwMaxIFSD             254
gpg: DBG: ccid-driver:   dwSyncProtocols  00000007  2-wire 3-wire I2C
gpg: DBG: ccid-driver:   dwMechanical     00000000
gpg: DBG: ccid-driver:   dwFeatures       000207B2
gpg: DBG: ccid-driver:     Auto configuration based on ATR
gpg: DBG: ccid-driver:     Auto clock change
gpg: DBG: ccid-driver:     Auto baud rate change
gpg: DBG: ccid-driver:     Auto PPS made by CCID
gpg: DBG: ccid-driver:     CCID can set ICC in clock stop mode
gpg: DBG: ccid-driver:     NAD value other than 0x00 accepted
gpg: DBG: ccid-driver:     Auto IFSD exchange
gpg: DBG: ccid-driver:     Short APDU level exchange
gpg: DBG: ccid-driver:   dwMaxCCIDMsgLen       271
gpg: DBG: ccid-driver:   bClassGetResponse    echo
gpg: DBG: ccid-driver:   bClassEnvelope       echo
gpg: DBG: ccid-driver:   wlcdLayout           none
gpg: DBG: ccid-driver:   bPINSupport             0
gpg: DBG: ccid-driver:   bMaxCCIDBusySlots       1
Please insert the card and hit return or enter 'c' to cancel:
I've ensured the card is inserted & pressed enter many times to no avail :-(.
(I've a few extra OpenPGP cards, so if push comes to shove, I'll slice them to
SIM size to check it out on this reader(s). Alas I've no other model of a card
reader to rule out the readers themselves.)
Thanks for your assistance.
      Sick of deleting your inbox? Yahoo!7 Mail has free unlimited storage.
