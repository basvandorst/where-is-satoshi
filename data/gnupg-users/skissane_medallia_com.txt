
@_date: 2018-01-19 19:57:56
@_author: Simon Kissane 
@_subject: failed to convert unprotected openpgp key: Checksum error 
I have written some code in Java to generate private/public keys, and
export them in OpenPGP format (using BouncyCastle's OpenPGP classes).
However, when I try to decrypt data encrypted with the private key, I
get a "failed to convert unprotected openpgp key: Checksum error"
I presume there is something about the key file that GPG doesn't like?
But can anyone tell me what it is?
I am using GnuPG 2.2.4 on macOS 10.12.6.
Here is my private key:
(This is just a test key generated for testing purposes, so it is fine
to share it publicly.)
Now, run this script against that private key file:
Like so: ./testGpg.sh testPrivateKey.asc
You will note the errors from gpg-agent:
gpg-agent[29270]: failed to convert unprotected openpgp key: Checksum error
gpg-agent[29270]: failed to read the secret key
gpg-agent[29270]: command 'PKDECRYPT' failed: Checksum error
gpg-agent[29270]: DBG: chan_7 -> ERR 67108874 Checksum error What confuses me is the key imports into the GPG home fine, the error
only happens when I try to use it to perform decryption. If the key
format was wrong, I would have thought the error would have happened
when I tried to import it.

@_date: 2018-01-22 13:40:33
@_author: Simon Kissane 
@_subject: failed to convert unprotected openpgp key: Checksum error 
Hi Zechariah, thank you for taking the time to have a look at this for me. It
sounds like you are concerned that running my script may import some strange
key into your GPG home. If you read the script, you will see that it creates
two new GPG homes under a temporary directory, so no odd keys are going to be
imported into your day-to-day GPG config.
I realise the User ID is weird. To explain, in the use case I am working on we
are only using GPG for file encryption/decryption using keys pre-agreed out
of band. As such, we aren't actually using any of the PGP "web-of-trust"
functionality, and the actual User IDs are rather irrelevant. Maybe we should
just use S/MIME or CMS instead (and I'm looking into that option), but since
we are already using GPG for this I was looking at how to possibly integrate
our existing usage of GPG with an external key management system.
That said, I have changed my key generation code to generate more normal
looking User IDs, as you can see with this key:
which has User ID:
  Test Key 123 And, if you run the new key against my script, you get the same error,
showing that problem (whatever it is) isn't the User ID. (My reading of RFC4880
section 5.11 is that having an email in the User ID is just a convention not
mandatory, so software should be robust in the face of User IDs breaking that
Thank you
On Mon, Jan 22, 2018 at 11:36 AM, Zechariah Seth
