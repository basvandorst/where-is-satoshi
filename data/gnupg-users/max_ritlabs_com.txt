
@_date: 2001-04-22 01:17:02
@_author: Maxim Masiutin 
@_subject: --passphrase-fd with a pipe handle under Win32 
I'm writing a program that launches GnuPG in --batch mode, it
  creates pipes via CreatePipe() Win32 API function and uses these
  pipes as stdin/stdout/stderr handles to pass data to GnuPG and get the
  result back.
  However, I can't manage to transfer a passphrase via passphrase-fd
  using pipes. If I pass a pipe handle as a parameter of
  --passphrase-fd, GnuPG alyaws reports
gpg: no default secret key: bad passphrase
gpg: [stdin]: sign+encrypt failed: bad passphrase    I found a workaround: to specify the passphrase via stdin,
  delimiting the passphrase from data by LF character.
  --passphrase-fd 0 is using in that case. I don't like this solution
  much because the passphrase is mixed with data to be signed. It
  introduces the potential risk of passphrase to be exposed.
  Did anyone spawn GnuPG under Win32?

@_date: 2001-04-22 14:00:01
@_author: Maxim Masiutin 
@_subject: Re[2]: --passphrase-fd with a pipe handle under Win32 
Hello Timo!
TS> Another solution would be to use the 'command-fd' switch.
  Thank you for the hint! The problem, however, is in interprocess
  communication under Win32. It seems that GnuPG is unable to read
  from a pipe handle passed as a numeric value. Maybe that was because
  mingw32 adds some unwanted wrappers to operations with handles? I
  should continue the investigation. I took a look into GnuPG source
  code but it seems to be all right there. I tried to download mingw32
  to do see what's really happening inside GnuPG, but
  ftp://ftp.openit.de gave me a timeout today. Should try again later.
  I wrote a program that works with a modem under Win32 via COM-port
  without using TAPI. This program runs external applications (e.g.
  fax receiver) passing COM port handle to it as a numeric value in
  the command line. I wonder why GnuPG doesn't work.
TS> Then all input from the keyboard is redirected to the file
TS> descriptor you specify for the command. For example:
TS> gpg --status-fd=2 --command-fd=23 -c foo
TS> Then all input would be read from fd 23 which was created by
TS> a pipe call. You've to watch for the 'status-fd' messages to
TS> send the correct strings.
  It seems that it's all that is needed to integrate GnuPG into a MUA.
TS> If you want a more elegant solution you should use GPGME.
  Although there was written that "authors of MUAs should consider to
  use GPGME", I found no API reference inside gpgme-0.2.1 archive. Is
  there any reference exist?
  I do not agree that the direct use of GnuPG from an application is
  a complicated programming task, if there are no key management
  functions in the application. It's very easy when it only comes to
  encryption/signing/decryption/signature checking.

@_date: 2001-04-22 14:48:02
@_author: Maxim Masiutin 
@_subject: Re[2]: --passphrase-fd with a pipe handle under Win32 
Hello Timo!
TS> Hmm, the last time I checked this it worked perfectly. Did you
TS> miss anything?
   Dou you have any samples left?

@_date: 2001-04-22 21:34:01
@_author: Maxim Masiutin 
@_subject: Re[2]: --passphrase-fd with a pipe handle under Win32 
Hello Werner!
WK> Filehandles under W32 are very different than the Posix ones.  USe
WK> the lates GnuPG version (1.0.4h) and they should work.  A new W32
WK> binary will be released along with 1.0.5.
  Thank you (I'm currently using GnuPG 1.0.4-1).
  Could you please help me and send the 1.0.4h binary or the URL to it!?

@_date: 2001-04-22 22:38:02
@_author: Maxim Masiutin 
@_subject: Re[2]: --passphrase-fd with a pipe handle under Win32 
Hello Werner!
WK> Filehandles under W32 are very different than the Posix ones.  USe
WK> the lates GnuPG version (1.0.4h) and they should work.  A new W32
WK> binary will be released along with 1.0.5.
  I've just took GnuPG binary 1.0.4g for Win32 from
   and, miracle, it works! I'm now passing the
  passpharase via --passphrase-fd, separately from stdin!
  Thank you for your support!
