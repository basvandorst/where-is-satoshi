
@_date: 2016-06-24 11:21:15
@_author: Andreas Fenkart 
@_subject: Tamper Resistance of SmartCards -- NitroKey Pro/ KernelConcepts 
I'm comparing NitroKey Pro and KernelConcepts OpenPGP card.
I'm only interested in creating signatures for FW releases. What
confuses me is the claim made by NitroKey that it is "tamper
resistant". I guess kernelconcepts card being a BasicCard[1] should be
"tamper resistant" as well.
I did a bit of googling:
- uses STM32F103TB
- the chip supports JTAG
- no special counter measures, or security section in the specification
- - didn't find the exact BOM, but probably it's there
Probably either cards resist hardware attacks, "side-channel", etc...
- -  "What is the attack scenario you?re most worried about ? a backdoor
or bug, accessible via the standard interface over the network,
someone owning your computer while extracting sensitive information
from your security token, or that someone in possession of your key
could retrieve such information?"
I'm okay with number one. I don't want anybody to extract the key
while it's connected to a computer that I don't trust. I'm not so much
concerned about the smartcard being stolen and the key extracted, by
observing heat ouput or JTAG. But I have to make sure the key never
leaves the hands of people I fully trust,
that means:
- don't send it via postal service
- if it's lost/found key must be revoked
Nonetheless, what are the low hanging fruit, to improve its tamper resistance?
- kernelconcepts / NitroKey are they equivalent?
- of course change admin/user pin
- what is the card manager key mentionned in the yubic link? Do I need
to change something?
[1]  Manufacturer: ZeitControl
reported by gpg2 --card-status
[2] discussion discussing internals of various vendors

@_date: 2018-04-26 10:59:49
@_author: Andreas Fenkart 
@_subject: gpgsm/cms: int_rsa_verify:wrong signature length 
I'm using GnuPG to sign 'swupdate' update images. They are verified on the
target using openssl:
  gpgsm -o sw-description.sig -sb sw-description
swupdate links against the openssl, but the equivalent cmd line is:
  openssl cms -verify -in sw-description.sig -inform DER -content
sw-description \
                -CAfile mycert.cert.pem -binary
This works for quite a while with no problem, just suddenly I see this error
when verifying
  140250102395072:error:04091077:rsa routines:int_rsa_verify:wrong
signature length:../crypto/rsa/rsa_sign.c:132:
  140250102395072:error:2E09809E:CMS
gpgsm verfication though works.
Comparing the asn1parse output of working/non-working signatures, I can see
that the non-working signature block is 1-byte shorter then the working version
$ diff /tmp/works /tmp/broken
<   929:d=3  hl=4 l= 561 cons: SET
<   933:d=4  hl=4 l= 557 cons: SEQUENCE
<  1234:d=5  hl=4 l= 256 prim: OCTET STRING      [HEX
<  1494:d=3  hl=2 l=   0 prim: EOC
<  1496:d=2  hl=2 l=   0 prim: EOC
<  1498:d=1  hl=2 l=   0 prim: EOC
This is my gpgsm version, I did not upgrade to the latest version yet
  $ gpgsm --version
  gpgsm (GnuPG) 2.1.7-unknown
  libgcrypt 1.6.3
  libksba 1.3.3-unknown
  Copyright (C) 2015 Free Software Foundation, Inc.
  License GPLv3+: GNU GPL version 3 or later   This is free software: you are free to change and redistribute it.
  There is NO WARRANTY, to the extent permitted by law.
I also sent an email to openssl mailing list:
The suggestion was that it might be lacking zero-padding. Might this be
the problem here? I will update the gpgsm version to latest of course. But
since I observed the problem only once I wonder if this is a known issue and
has been fixed in upstream version.
kind regards,
