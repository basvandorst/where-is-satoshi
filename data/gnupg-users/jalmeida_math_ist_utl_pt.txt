
@_date: 2006-11-21 19:54:08
@_author: Jorge Almeida 
@_subject: gpg 
I've been reading whatever documentation I could find about gpg-agent,
but I couldn't get the whole picture yet.
Assuming that the gpg-agent daemon is running and some client
application needs to encrypt or decrypt something, what happens? As I
understood it, the client connects to the socket and gpg-agent tells
pinentry to ask for a passphrase, if it doesn't have it yet. Now, the
first question is whether the passphrase is kept in locked memory
(assuming the OS supports it), i.e, the passphrase is never send to disk
or swap. Is this correct?
The other question (not independent from the former) is what is (and
where is) gpg-agent cache: a directory? containing what? the passphrases
for several keys? and are they protected only by the filesystem
permissions, or is there a more elaborate setup?
The page  says "GpgAgent that stores
passphrases like ssh-agent does", but the truth is that the
documentation of ssh-agent is not clearer about these points.

@_date: 2006-11-22 10:03:31
@_author: Jorge Almeida 
@_subject: gpg 
I suppose Linux does the right thing wrt this issue. Correct?
And the cache is also is secure memory, just like the passphrases.
Thanks a lot.

@_date: 2006-11-23 10:24:16
@_author: Jorge Almeida 
@_subject: adding passphrases to gpg-agent 
Isn't there some way to do for gpg-agent what ssh-add does for
I'm trying to use a unique gpg-agent listening at a standard socket.
Unless I'm missing something, the only way I have to provide passphrases
to gpg-agent is to try some job (signing something, or whatever) and
then give the passphrase when asked for it. But the pinentry-program
entry in gpg-agent.conf decides whether I'm supposed to be in an X
session or not. (BTW, pinentry-curses didn't work for me. But that's not
the real issue.)
Is there an alternative?

@_date: 2006-11-23 11:52:58
@_author: Jorge Almeida 
@_subject: adding passphrases to gpg-agent 
OK, that seems to do the job (not much different from ssh-add, is it?),
judging by the contents of
Now, my system doesn't have such command. I have gnupg 1.4.5 and
1.9.20. (OS is gentoo linux) Is gpg-preset-passphrase new to version
And what about gpgsm --dump-secret-keys, necessary to know the "keygrip"
argument of gpg-preset-passphrase? This is what I get:
 	$ gpgsm --dump-secret-keys
 	gpgsm: NOTE: THIS IS A DEVELOPMENT VERSION!
 	gpgsm: It is only intended for test purposes and should NOT be
 	gpgsm: used in a production environment or with production keys!
Did I misunderstood something, or is it just that I'm using a package
not recent enough?
Jorge Almeida

@_date: 2006-11-24 10:01:03
@_author: Jorge Almeida 
@_subject: adding passphrases to gpg-agent 
Yep, it's good to do updatedb regularly :)
Anyway, it seems the design of gpg-agent is not compatible with what I
wanted. With ssh-agent, I have a always-running service (supervised by
daemontools), which is easy to bring down if needed (but there's no
need) and which I can setup once and forget about it. Of course,
identities must be added (with ssh-add) after rebooting or if the
service goes down for some random reason (it didn't happen yet) or if I
chose to clear everything by sending the service a HUP. It works
transparently, regardless of whether ssh is called from X or from
another ssh session or whatever.
I hoped to have a similar setup for gpg-agent, but the way to add
identities just won't allow it. It seems to be a design decision, so
there's nothing to do. (I'm not a C programmer, and even if I could I
woudn't try to hack such an important package!)
Thanks everyone.

@_date: 2006-11-24 15:06:04
@_author: Jorge Almeida 
@_subject: adding passphrases to gpg-agent 
My talk about ssh-agent may have induced you in error. My fault.
I was not comparing ssh-agent with gpg-agent as replacement for
ssh-agent! I mentioned my setup of ssh-agent just to give an idea of
what I was trying to accomplish. In other words, I wanted a similar
setup for gpg-agent but only for its uses of signing and encrypting, not
for ssh authentication.
Correct me if I'm wrong, but there is no way to add passphrases other
than by using it for some signing or encrypting. And how to do it from a
remote box? I know about X forwarding, but I don't want to use it (slow
& clumsy). And pinentry-curses didn't work for me, even at the local
box. Even assuming that there was some misconfiguration that caused
this, I think a CLI way to add passphrases was a natural thing to
expect, at least for UNIX users (of course, this would not be
incompatible with graphical alternatives).
What about the passphrase gpg-agent asks when adding the key via
ssh-add? Is it needed only after gpg-agent receives a TERM or HUP? And
is it the same for all keys stored?
Interesting. I didn't have a real close look at gpg-agent as ssh-agent
replacement yet, but the --enable-ssh-support entry in
says that a different socket is opened for this functionality. But then
a client would know about it only through inheriting an env variable; I
would use the --use-standard-socket for gpg-agent signing/encryption
socket, but what about the other socket?
