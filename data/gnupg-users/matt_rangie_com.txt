
@_date: 2003-04-23 23:40:02
@_author: Matthew Reeve 
@_subject: Blank encrypted messages 
Hi group,
I have just implemented gnupg to encrypt the contents of a webform and =
it. It took a while to get the PHP script to work, but it finally is. I
tried decrypting the block on my local machine (with the private key on) =
it comes up as an empty mail.=20
I have already checked that the string being executed contains the =
in the code below. Can anyone suggest what I can try to fix this?
The PHP code is as follows...
function _encrypt($msg)=20
$oldhome =3D getEnv("HOME");=20
$command =3D 'echo "$msg" | /usr/bin/gpg -e -a --always-trust  --batch
--no-secmem-warning -u matt -r matt
exec($command, $encrypted, $errorcode);=20
if ($errorcode)=20
} else {
Many thanks in advance,
Matthew Reeve

@_date: 2003-04-29 13:25:03
@_author: Matthew Reeve 
@_subject: Blank encrypted messages 
It must be running a shell, as I end up with an encrypted message -
unfortunately it's just an encryption of nothing. I can log in as the same
user (apache) and run the command from the shell and get an output which,
when decrypted, contains the data. However when run from PHP the encrypted
data, when decrypted, contains nothing.
I've re-written to use files being passed in and out, and the command when
exec'd or system'd returns an error code of 0 (zero). I'm absolutely stumped on this.
Thanks for the suggestions so far, Matthew Reeve

@_date: 2003-04-30 09:24:02
@_author: Matthew Reeve 
@_subject: Blank encrypted messages 
It's an interesting thought - I rewrote the script to look like this, =
addressing Adam's concerns about the security of echoing $msg.
The file called $plainTxt is created and contains the correct data. The =
called $crypted is also created and contains a PGP message. However,
decrypting the contents of $crypted gives an empty string.
The 'echo' shows the encryption command is the following.
matt /var/www/tempFiles/1195e9ed7ad15a57907ff4b87bc4653adata
If I copy and paste the encryption command into a shell running as the
apache user (instead of calling it from PHP), an encrypted file is =
containing a PGP message which contains the correct data when decrypted.
Is there any way to see what is going on with gpg while it's running?=20
function _encrypt($msg)=20
matt $plainTxt";
matt $plainTxt");
Thanks for the help!
Matthew Reeve

@_date: 2003-05-02 18:15:02
@_author: Matthew Reeve 
@_subject: Blank encrypted messages 
Found it!!
In the function below, I 'fopen' then 'fputs' to the file, but it's not
flushed until the file pointer goes out of scope at the end of the =
At the time of calling gpg, the file is created but empty. By adding an
'fclose' call on that pointer prior to calling gpg the problem is =
That's why when running it from the command line there was no problem, =
when using the same files.
Anyway, thanks everyone for your help, both on and off list!
Matthew Reeve
