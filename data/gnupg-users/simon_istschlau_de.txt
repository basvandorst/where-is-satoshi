
@_date: 2009-04-03 14:11:59
@_author: Simon Ferber 
@_subject: GnuPG with pcsc-lite, scdaemon segfaults 
I have to say, it segfaults when using the static build of GnuPG. If I
Right, no shared libs.
It's gentoo 2008.0:
Linux ray 2.6.28-gentoo-r4  SMP Sun Mar 29 15:51:52 CEST 2009 x86_64 AMD Phenom(tm) 9600 Quad-Core Processor AuthenticAMD GNU/Linux
Well, I don't really have an idea, where to look for an OS-problem. It is a fresh install and everything else works fine so far. The most obviously would be to switch to a differnt kernel, wich I already tried with two versions.
What else could be the cause? Maybe the gcc version 4.1.2?

@_date: 2009-03-29 20:57:36
@_author: Simon Ferber 
@_subject: GnuPG with pcsc-lite, scdaemon segfaults 
Hello list,
I installed an fresh amd64 system with gnupg and smartcard support.
When pcsc-lite is started, I can see following in the logs:
Mar 29 20:51:13 [pcscd] ifdhandler.c:1249:init_driver() DriverOptions:
Mar 29 20:51:13 [pcscd] ifdhandler.c:77:IFDHCreateChannelByName() lun:
0, device: usb:046a/003e:libusb:004:002
Mar 29 20:51:13 [pcscd] ccid_usb.c:233:OpenUSBByName() Manufacturer:
Ludovic Rousseau (ludovic.rousseau at free.fr)
Mar 29 20:51:13 [pcscd] ccid_usb.c:243:OpenUSBByName() ProductString:
Generic CCID driver v1.3.1
Mar 29 20:51:13 [pcscd] ccid_usb.c:249:OpenUSBByName() Copyright: This
driver is protected by terms of the GNU Lesser General Public License
version 2.1, or (at your option) any later version.
Mar 29 20:51:13 [pcscd] ccid_usb.c:397:OpenUSBByName() Found
Vendor/Product: 046A/003E (Cherry SmartTerminal ST-2XXX)
Mar 29 20:51:13 [pcscd] ccid_usb.c:399:OpenUSBByName() Using USB
bus/device: 004/002
Mar 29 20:51:13 [pcscd] ccid_usb.c:752:get_data_rates() IFD does not
support GET_DATA_RATES request: Broken pipe
Mar 29 20:51:13 [pcscd] ifdhandler.c:271:IFDHGetCapabilities() lun: 0,
tag: 0xFAE
Mar 29 20:51:13 [pcscd] ifdhandler.c:313:IFDHGetCapabilities() Reader
supports 1 slot(s)
Mar 29 20:51:18 [pcscd] ifdhandler.c:841:IFDHPowerICC() lun: 0, action:
Mar 29 20:51:18 [pcscd] eventhandler.c:431:EHStatusHandlerThread() Card
inserted into Cherry SmartTerminal ST-2XXX (00000aa4) 00 00
Mar 29 20:51:18 [pcscd] Card ATR: 3B FA 13 00 FF 81 31 80 45 00 31 C1 73
C0 01 00 00 90 00 B1
Mar 29 20:51:21 [pcscd] eventhandler.c:358:EHStatusHandlerThread() Card
Removed From Cherry SmartTerminal ST-2XXX (00000aa4) 00 00
As you can see, it find the reader and recognises the insertion of an card.
Well, no matter, which options I give to gnupg, I get an segfault in the
Mar 29 20:52:43 [kernel] gnupg-pcsc-wrap[21763]: segfault at 0 ip
0000000000000000 sp 00007fffc815e0d8 error 14 in
Or when I try to start scdaemon, it segfault again:
ray ~ # scdaemon  --debug-all --pcsc-driver
scdaemon[21766]: Optionen werden aus '/root/.gnupg/scdaemon.conf' gelesen
scdaemon[21766]: Handhabungsroutine f?r fd -1 gestartet
I tried several versions of gnupg and pcsc-lite. But always it
segfaults. :-/
Any idea? Oh, btw, now I use:
Kernel 2.6.28
gpg 2.0.11
libgcrypt 1.4.4
pcsc-lite 1.4.2
I ran out of ideas...
Kind regards,

@_date: 2009-03-31 22:06:31
@_author: Simon Ferber 
@_subject: GnuPG with pcsc-lite, scdaemon segfaults 
Hello Werner,
gnupg-pcsc-wrapper --verbose  1
segfaults too.
I don't know, if I did it right, but here is a backtrace:
gdb /usr/libexec/gnupg-pcsc-wrapper --core core --batch --quiet -ex
thread apply all bt full -ex quit
warning: core file may not match specified executable file.
Core was generated by `/usr/libexec/gnupg-pcsc-wrapper --verbose 1'.
Program terminated with signal 11, Segmentation fault.             [New process 13335]                                                  0x0000000000000000 in ?? ()                                    Thread 1 (process 13335):
  0x0000000000000000 in ?? ()
No symbol table info available.
  0x00007fab4ae7271f in __pthread_initialize_minimal_internal () from
No symbol table info
available.                                                              0x00007fab4ae71e59 in _init () from
No symbol table info
available.                                                              0x00007fab4b494fe0 in ?? () from
No symbol table info
available.                                                              0x0000000000436eeb in call_init
()                                                     No symbol table info
available.                                                              0x0000000000437075 in _dl_init ()
No symbol table info available.
  0x0000000000415180 in dl_open_worker ()
No symbol table info available.
  0x00000000004136f6 in _dl_catch_error ()
No symbol table info available.
---Type  to continue, or q  to quit---
  0x0000000000414a55 in _dl_open ()
No symbol table info available.
  0x0000000000404dfc in dlopen_doit ()
No symbol table info available.
 0x00000000004136f6 in _dl_catch_error ()
No symbol table info available.
 0x0000000000405061 in _dlerror_run ()
No symbol table info available.
 0x0000000000404d7e in __dlopen ()
No symbol table info available.
 0x00000000004007de in main (argc=,
argv=0x7fff534c0128) at pcsc-wrapper.c:318
        last_argc =         api_number = 8388608
        c = Is it useful or do I have to use different options?
Werner Koch schrieb:
