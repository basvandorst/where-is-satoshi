
@_date: 2009-11-02 21:24:23
@_author: Ede Wolf 
@_subject: OpenPGP card usage 
No, it's a pretty natural question. I had the same idea
Wishful thinking. Unfortunately it does not work that way. At least from what I have experienced so far. You need the corresponding public key imported before usage on that new  machine/account and run a gpg2 --card-status afterwards to make the key on the card known to gnupg. AFAIK there is no option like --keyring=smartcard
So next to the card you also need an usb stick to transport the public key, when using the smartcard on a different account/machine. Not sure wether this is also true for S/MIME. But that would probably need a different kind of smartcard and there is no up to date documentation that I am aware of what recent PKI/X509 cards are properly supported by linux. And maybe you are bound to gnupg anyway. You are too optimistic about the usage of a smartcart with gnupg ;) However, I am pretty new to this topic, too, so maybe some more experienced user will correct me.

@_date: 2009-10-27 10:49:22
@_author: listac@nebelschwaden.de 
@_subject: gnupg and smartcard -> recovery issues 
I am currently struggeling with smartcard and gnupg. The basic stuff
works, but where it gets interesting the howtos I've found end and I am
not able to figure out how to do it correctly:
Scenario 1:
I have created a key on the disk (ordinary way, without card) and now
decide, that I want to use the card instead. And only the card. So I issue
an --edit-key  and toggle && keytocard.
I remove the card and try to decrypt a file. Decrypting still works
without a card being inserted and the password instead of the PIN. Ok, not
what I intended, but somewhat comprehendible, as the key is still on
No problem, so I completely remove the .gnupg folder, do a --list-key for
it to be recreated, insert the card and try to decrypt the file. Gnupg
complains about "no valid OpenPGP Data found" (translated from german).
Even though the key is visible with --card-status.
Now, what is really most important to me and what I would like to know: What to do / how to use the card on a virgin system?
Scenario 2:
Virgin System again, I create the key on the card with the backup key
written to disk. Now I have some cryptical_name.gpg file.
However, someday, that's all I have left. I've lost the card, I've lost
the .gnupg folder and all my backup tapes.
All I have is the cryptical_name.gpg on some rescued USB stick. Just, how
do I get this key back on my card please?
 --import sk_13510880590EE2D4.gpg
gpg: key 590EE2D4: no user ID
gpg: Total number processed: 1
gpg:       secret keys read: 1
 --allow-secret-key-import sk_13510880590EE2D4.gpg
sec  1024R/590EE2D4 2009-10-27
 --allow-secret-key-import --import sk_13510880590EE2D4.gpg
gpg: key 590EE2D4: no user ID
gpg: Total number processed: 1
gpg:       secret keys read: 1
But: gpg --list[-secret-key] does never show anything.
This behaviour is true for gnupg1.4x on linux as well as the latest
gpg4win, using gnupg2.0.12.
I haven't managed to find any linux distribution so far, where gnupg2 is
working with my card or reader. But that'll be another post.
Card is the kernelconcepts gnupg card v2.0. Reader a Dell Keyboard reader.
Last question:
Is there any way, to the copy the key on the card to the drive? Or do a
backup after generation?
Thanks to anyone who took time to read and tries to help.

@_date: 2009-10-29 13:59:21
@_author: listac@nebelschwaden.de 
@_subject: can't connect to `C:/Program Files/GNU/GnuPG//S.gpg-agent' 
I pretty much have a similar problem. WIth gpg4win as well as with linux.
However, using gpg4win I do not see any usage problem asides this message.
When using linux, even when I start gpg-agent --daemon, it creates it's
socket under /tmp/, while gpg searches for .gnupg/S.gpg-agent.
The environment the daemon exports seems to be ignored.
So I have to manually link .gnupg/S.gpg-agent to theat file below /tmp to
be able to work with a smartcard at all.
# gpg-agent --daemon
GPG_AGENT_INFO=/tmp/gpg-mS2h6N/S.gpg-agent:1510:1; export GPG_AGENT_INFO;
# gpg2 --card-status
can't connect to `/root/.gnupg/S.gpg-agent': No such file or directory
-> Same error message as if no gpg-agent has been started manually at all
# ln -s /tmp/gpg-mS2h6N/S.gpg-agent /root/.gnupg/S.gpg-agent
# gpg2 --card-status
gpg: selecting openpgp failed: Card not present

@_date: 2009-10-29 15:29:27
@_author: listac@nebelschwaden.de 
@_subject: gnupg and smartcard -> recovery issues 
First of all, thanks very much for your time.
This does not work. Maybe the problem is somwhere else. When I issue a
toggle & keytocard, I only can chose between Signature Key(1) or
Authentication Key (3). The encryption key (2) is not offered.
However I do get asked, wether I want to replace the main key, what I
considered as the encryption key so far.
No matter wether I choose (1) or (3), after removal of the secret key from
the ring I cannot decrypt any file. Natural, if the encryption key has not
been transferred.
bkuptocard requires a filename, which I do not have. Unless I export the
secret key before, but haven't tried this yet.
As I am currently using gpg4win due to the fact, that no linux gnupg2 I
tested so far does work reliably with the smartcard, this does
unfortunately not work.
The URL field is empty (not set). Also I can see the card owner, but not
to whom the key was issued. However, I am not using any keyserver nor do I
plan to.
I did try this, however, this does not work. When I import the public key
into a virgin system and edit that key, the bkuptocard menuitem does not
appear and entering "toggle" as well as "bkuptocards" complain: "no secret
key found" or "secret key needed".
Running "gpg --card-status" before does not change this behaviour.
To be able to get the key back on the card I currently do need both, the
secret key, which is most likely more a stub, and the publc key.
Jep. After some thinking on my side this is absolutely correct.

@_date: 2009-10-29 16:07:50
@_author: listac@nebelschwaden.de 
@_subject: gnupg and smartcard -> recovery issues 
Thanks to the help of Mr. Donnachie I am now able to run gnupg2 under
linux, even though gpg-agent regularily dies. Maybe as well be a
distribution issue.
And now the restore with just the public key and the --card-status works.
Either gpg4win behaves differently or maybe I am running into a gpg-agent
issue, too.
However, transfering a disk based secret encryption key to smart card
still does not.
