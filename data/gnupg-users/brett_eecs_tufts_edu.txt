
@_date: 2005-04-26 15:23:14
@_author: brett 
@_subject: Apache/PHP - 'loading shared library error'??? 
I'm trying to get gpg to run from PHP and have run into a problem i can't
solve. I can use proc_open() to execute other commands, but not gpg.
It wont even run:
Grrrr... When i do run that, the stderr pipe shows me the following
prot after reloc: Permission denied
Can anyone tell me what that means?
Also, the process exit status is '127'. I looked but can't find any
explanation of that either (though its a php code i imagine).
Thanks in advance,
Here's the php code i used:
   function gpgVerify()
   {
      $gpgPath = '/usr/bin/gpg';
      if(!is_executable($gpgPath))
      {
         trigger_error("gpgVerify::gpg is not executable", E_USER_ERROR);
         die();
      }
      else
      {
         // first we'll set up a pipe for gpg to write STDOUT to
         $descriptorSpec = array(
            1 => array("pipe", "w"),
            2 => array("pipe", "w")
         );
         $command = $gpgPath . " --version";
         $gpgProcess = proc_open( $command, $descriptorSpec, $pipes);
         if(is_resource($gpgProcess))
         {
            $gpgOutput = '';
            while(!feof($pipes[1]))
            {
               $gpgOutput .= fgets($pipes[1], 1024);
            }
            echo 'pipe[1] = '.$gpgOutput;
            fclose($pipes[1]);
            $stdErrOut = '';
            while(!feof($pipes[2]))
            {
               $stdErrOut .= fgets($pipes[2], 1024);
            }
            echo 'pipe[2] = '.$stdErrOut;
            fclose($pipes[2]);
            // close the $gpgProcess
            $processExitStatus = proc_close($gpgProcess);
           echo '$processExitStatus:'.$processExitStatus;
           if(!ereg('^gpg ', $gpgOutput))
           {
              trigger_error("gpg executable is not GnuPG.", E_USER_ERROR);
                die();
           }
           unset(
               $gpgPath,
               $gpgOutput,
               $descriptorSpec,
               $command,
               $gpgProcess,
               $pipes,
               $processExitStatus,
               $gpgErrorMessage
           );
         }
         else
         {
            trigger_error("gpgVerify::proc_open failed.", E_USER_ERROR);
               die();
         }
      }
      return true;
   }

@_date: 2005-04-27 04:20:13
@_author: brett 
@_subject: gpg and SELinux 
AH, so i've determined that the reason i can't run gpg from my php script
is because of SELinux. The evidence was in /var/log/messages and follows.
Has anyone gotten around this?
Apr 26 22:20:53 XXXXXXXXX kernel: audit(1114568453.515:0): avc:  denied
{ execmod } for  pid=8035 comm=gpg path=/usr/bin/gpg dev=dm-0 ino=4972274
tcontext=system_u:object_r:bin_t tclass=file
Apr 26 22:20:53 XXXXXXXXX kernel: audit(1114568453.515:0): avc:  denied  {
execmod } for  pid=8035 comm=gpg path=/usr/bin/gpg dev=dm-0 ino=4972274
tcontext=system_u:object_r:bin_t tclass=file
