
@_date: 2020-08-30 20:12:19
@_author: =?UTF-8?Q?Bj=c3=b6rn_Jacke?= 
@_subject: gnupg --fetch-key problems 
Hello Werner,
Hello gnupg  community,
I recently implemented WKD and stumbled over a couple of pitfalls with
that. One problem was that after implementing it and watching the server
logs I noticed that a number of WKD related http requests were refused
with HTTP 403. The User-agent string of those requests was empty/not
existing. Taking a closer look at it reveled, that those requests were
refused because it were HTTP 1.0 requests. That site's load balancer is
rejecting HTTP 1.0 requests usually because those requests are mostly
coming from bad robots these days and legit clients use at lease HTTP
1.1. It turned out that gnupg --fetch-key is actually making those HTTP
1.0 requests without user agent string. A rule that forbids HTTP 1.0
requests is not uncommon these days. In order to make gpg users'
experience better I suggest that gnupg should not use HTTP 1.0 but at
least HTTP 1.1 and also send a user agent header. Actually I think it
would be best if gnupg would use libcurl for that. The web server
protocols a becoming more and more complex and even HTTP 1.1 might not
be good enough for some sites now or in the near future. I guess gnupg
doesn't want to implement a valid HTTP 2.0 or QUIC client in the future.
Using libcurl would be a simple solution. Also the portability and
quality of libcurl is excellent. What do you think?
Best regards

@_date: 2020-08-31 22:59:13
@_author: =?UTF-8?Q?Bj=c3=b6rn_Jacke?= 
@_subject: gnupg --fetch-key problems 
as I wrote in my provious mail, it is not uncommon that sites are
blocking HTTP 1.0 these days. So it is not a good idea to only support
HTTP 1.0 in gpg. This makes gpg work suboptimal for it's users. You need
to face the fact that HTTP is not available everywhere any more and http
clients have also to adopt to what servers support. It's my choice what
I configure on my server of course and only for gpg I allow HTTP 1.0 for
the needed paths here. I managed to figure out what the problem was but
most sites and most users will not. It's up to the gnupg developers to
improve the situation for your users.
see what I wrote above and I already proposed in my previous mail that
libcurl would probably a very good idea.

@_date: 2020-09-01 14:27:35
@_author: =?UTF-8?Q?Bj=c3=b6rn_Jacke?= 
@_subject: gnupg --fetch-key problems 
Hello Werner,
you may find it lame or not, disabling http 1.0 is recommended at a
number of places and a number servers out there already have it disabled
and it will probably be more and not less sites doing that in the
future, that's nothing that we can change. Ignoring all those sites and
let the gpg users suffer by not being able to connect would not be nice.
I talked with Wiktor about the http 1.0 issue in gpg and he also
mentioned that a number of weird problems that people have reported with
WKD in the past might be related to gpg talking http 1.0 only.
You didn't mention the suggested libcurl yet - if you would use that you
would not have to worry about the details of how to implement more
modern http protocols in gpg.
yes, I found out that the trouble making http clients are gpg clients
only because Wiktor found that out by chance.
Best regards
