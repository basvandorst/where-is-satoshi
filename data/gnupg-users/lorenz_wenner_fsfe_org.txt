
@_date: 2013-07-13 11:01:51
@_author: Lorenz Wenner 
@_subject: Problem with omnikey cardman 4040 
Hello there,
I have the omnikey cardman 4040 pcmcia cardreader in my Notebook and want to use it with gnupg. Imho all requirements are met:
a few sessions ago I added myself to the group scard and ls -l /dev/cm*
crw-rw---T 1 root scard 251, 0 Jul 12 12:49 /dev/cmx0
(in the file /etc/udev/rules.d/50-pcscd_ccid.rules there is the line
ACTION=="add", SUBSYSTEM=="cardman_4040", GROUP="scard", MODE="0660"
but when I do gpg --card-status --debug-ccid-driver
I get
gpg: DBG: ccid-driver: failed to open `/dev/cmx0': Device or resource busy
gpg: DBG: ccid-driver: failed to open `/dev/cmx1': No such file or directory
gpg: DBG: ccid-driver: no CCID reader with number 0
gpg: pcsc_establish_context failed: no service (0x8010001d)
gpg: card reader not available
gpg: OpenPGP card not available: general error
any suggestions?
Kind Regards

@_date: 2013-07-13 14:54:41
@_author: Lorenz Wenner 
@_subject: Problem with omnikey cardman 4040 
I am running debian testing (jessie) and there is no pcsc package installed
To be precise I removed it manually. The only package still being installed with pcsc in its name is libpcsclite1, which gnupg depends on.
I know that one can use fuser to get information about the processes using specific file(-system). So by doing fuser -vm /dev/cmx0 I get
                     USER        PID ACCESS COMMAND
                     root     kernel mount /dev
                     lorenz     2677 f.... startkde
                     lorenz     2772 F.... gpg-agent
                     lorenz     2778 F.... dbus-launch
                     lorenz     2782 F.... dbus-daemon
                     lorenz     3139 F.... kded4
                     lorenz     3280 f.... kwrapper4
                     lorenz     3323 f.... knotify4
                     lorenz     3326 f.... plasma-desktop
                     lorenz     3408 F.... kuiserver
                     lorenz     3430 f.... akonadiserver
                     lorenz     3483 F.... pulseaudio
                     lorenz     3497 f.... krunner
                     lorenz     3524 f.... akonadi_contact
                     lorenz     3525 f.... akonadi_gcal_re
                     lorenz     3541 f.... korgac
                     lorenz     3853 f.... kontact
                     lorenz     4833 f.... iceweasel
                     lorenz     4838 F.... gconfd-2
                     lorenz     4852 F.... gvfsd
                     lorenz    21972 F.... konsole
                     lorenz    22066 F.... dolphin
                     lorenz    22248 F.... gvfsd-metadata
                     lorenz    22660 f.... ffmpeg
but I am not sure how to interpret these informations. Does it mean, that all these processes have gotten in the of gnupg/ccid? The good thing: gpg-agent appears in the above list.
        Lorenz

@_date: 2013-07-14 19:23:06
@_author: Lorenz Wenner 
@_subject: Problem with omnikey cardman 4040 
Dear folks,
yes. Using my other cardreader through pcsc I get
gpg --card-status
Application ID ...: D276000124010200000500000FA00000
Version ..........: 2.0
Manufacturer .....: ZeitControl
Serial number ....: 00000FA0
Name of cardholder: Lorenz Wenner
Language prefs ...: de
Sex ..............: male
URL of public key : [not set]
Login data .......: lorenz.wenner
Private DO 2 .....: [2053] Lorenz Wenner CA fingerprint 1 .: C485 A6CD 7EC6 6E9E EC33  65F2 70F2 75E4 C32F 6CA5
Signature PIN ....: not forced
Key attributes ...: 2048R 2048R 2048R
Max. PIN lengths .: 32 32 32
PIN retry counter : 3 0 3
Signature counter : 0
Signature key ....: [none]
Encryption key....: [none]
Authentication key: [none]
General key info..: [none]
but I don't want to you that one because
* it needs pcsc
* it the Cheery ST-1044U, which I cannot easily take with me inside the Laptop whereas I can so with the omnikey
* I cannot use it but edit my card either
will you tell me?
and meanwhile I could identify it: lsof | grep cmx led to
scdaemon  12382           lorenz    8u      CHR      250,0     0t10     5728 /dev/cmx0
when I kill -9 the scdaemon and retry gpg --card-status, scdaemon gets restarted.
 Lebbing: yes, there is a use-agent line in my ~/.gnupg/gpg.conf
