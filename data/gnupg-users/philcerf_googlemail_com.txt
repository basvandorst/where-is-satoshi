
@_date: 2009-09-10 00:43:48
@_author: Philippe Cerfon 
@_subject: howto secure older keys after the recent attacks 
Now something more realistic and pracitcal.
I'm using gpg for anonymous but secured communication together with some of
my friends for some years now....
Recently I've read on severa attacks on SHA1 and AES256 that could also
affect gpg and its keys.
So waht I'd like to see is some step by step howto on securing older keys
(written by some expert probably ;-) ).
I have two keys a the moment one is a 4096 bit RSA key, the oder (for daily
use) has 1024 bits.
Using the pgpdump tool I found out that it has these settings:
Old: Signature Packet(tag 2)(567 bytes)
    Ver 4 - new
    Sig type - Positive certification of a User ID and Public Key
    Pub alg - RSA Encrypt or Sign(pub 1)
    Hash alg - SHA1(hash 2)
    Hashed Sub: key flags(sub 27)(1 bytes)
        Flag - This key may be used to certify other keys
        Flag - This key may be used to sign data
    Hashed Sub: preferred symmetric algorithms(sub 11)(5 bytes)
        Sym alg - AES with 256-bit key(sym 9)
        Sym alg - AES with 192-bit key(sym 8)
        Sym alg - AES with 128-bit key(sym 7)
        Sym alg - CAST5(sym 3)
        Sym alg - Triple-DES(sym 2)
    Hashed Sub: preferred hash algorithms(sub 21)(2 bytes)
        Hash alg - SHA1(hash 2)
        Hash alg - RIPEMD160(hash 3)
    Hashed Sub: preferred compression algorithms(sub 22)(2 bytes)
        Comp alg - ZLIB (comp 2)
        Comp alg - ZIP (comp 1)
    Hashed Sub: features(sub 30)(1 bytes)
        Flag - Modification detection (packets 18 and 19)
    Hashed Sub: key server preferences(sub 23)(1 bytes)
        Flag - No-modify
    Hashed Sub: signature creation time(sub 2)(4 bytes)
        Time - Fri Oct 28 20:48:23 CEST 2005
    Hashed Sub: primary User ID(sub 25)(1 bytes)
        Primary - Yes
    Sub: issuer key ID(sub 16)(8 bytes)
and a more recent User ID has these:
Old: Signature Packet(tag 2)(566 bytes)
    Ver 4 - new
    Sig type - Positive certification of a User ID and Public Key
    Pub alg - RSA Encrypt or Sign(pub 1)
    Hash alg - SHA1(hash 2)
    Hashed Sub: signature creation time(sub 2)(4 bytes)
        Time - Fri Apr 25 01:23:36 CEST 2008
    Hashed Sub: key flags(sub 27)(1 bytes)
        Flag - This key may be used to certify other keys
        Flag - This key may be used to sign data
    Hashed Sub: preferred symmetric algorithms(sub 11)(5 bytes)
        Sym alg - AES with 256-bit key(sym 9)
        Sym alg - AES with 192-bit key(sym 8)
        Sym alg - AES with 128-bit key(sym 7)
        Sym alg - CAST5(sym 3)
        Sym alg - Triple-DES(sym 2)
    Hashed Sub: preferred hash algorithms(sub 21)(3 bytes)
        Hash alg - SHA1(hash 2)
        Hash alg - SHA256(hash 8)
        Hash alg - RIPEMD160(hash 3)
    Hashed Sub: preferred compression algorithms(sub 22)(3 bytes)
        Comp alg - ZLIB (comp 2)
        Comp alg - BZip2(comp 3)
        Comp alg - ZIP (comp 1)
    Hashed Sub: features(sub 30)(1 bytes)
        Flag - Modification detection (packets 18 and 19)
    Hashed Sub: key server preferences(sub 23)(1 bytes)
        Flag - No-modify
As far as I understand thise means:
- The signatures on them are created with SHA1
- The differ in preferred algorihtms for hashes and compression
- It seems that I can easily change these preferences via gpg --edit-key,..
so I could simply remove e.g. SHA1
-But I'd also like to have the signatures themselves using e.g. SHA256 or
SHA512,... but they're alread using SHA1
Can this be changed?
Or can I simply add new self signatures?
And if I do so the old ones would still be on the keyservers, right? And no
way to delete them.
So does this mean any harm to me? At some day SHA1 might be fully broken,
and then an attacker could use simply these older self signatures instead of
the newer ones, or not?
Or should I better start with a fresh key without any old signatures?
Another thing I've read about is, that gpg keys are using SHA1 hard coded in
some places with no way to use another algortihm... which places are these
so one could avoid them perhaps?
Thanks for your insight,

@_date: 2009-09-10 13:42:26
@_author: Philippe Cerfon 
@_subject: howto secure older keys after the recent attacks 
Hi Robert.
And you think this is enough? Not removing and recreating and older
signatures that use SHA1?

@_date: 2009-09-10 14:02:53
@_author: Philippe Cerfon 
@_subject: howto secure older keys after the recent attacks 
Uhm,.. what a pity. What would happen if SHA1 gets fully broken? Would
we have to create a new OpenPGP and new keys?
Does this work via --cert-digest-algo option?
If so what must I do to get gpg to:
- resign my own key
- resign other keys
Is it simply with the sign command, or will it complain that there's
already a signture there?
Well.. not sure... I've heard that one can add many settings to these
signatures like rovcations or policies. But I have not enough
knowledge on them (although I could imagine that someone could
probably use them to do evil things which might be impossible with a
newer hash-algo).
But perhaps it could be used to do some forgery with User IDs?
Oh,.. so what is this --cert-digest-algo then good for?
I thought the key ID is only used for humans to short check the
keys,.. but not in the system itself?!
So this would basically mean, once SHA1 is broken, we're totally screwed?!
At least at the moment you mean? I mean we had the "same" thing with
MD4, MD5 and so on,... so probably it will hit us with SHA1, too?
Ok,.. thanks for that information :)
I'd have some additional poor men's questions ;-)...
- When creating a new key,.. it uses the entropy, right? So is there
some way to improve this entropy? Perhaps not using Linux but instead
OpenBSD which might have a better PRNG (don't know if this is actually
the case ;) ) or use a specific Linux kernel version where a newer and
better PRNG was added?
-Currently the default (and I assume suggested) algorithm is RSA,
right? How does DSA2 compare with it? I once read, that RSA would
provide a hash algorithm armor which the DSA's wouldn't have. Is this
still true?
-My course's professor showed us some number from NIST (don't recall
the exact ones, though) where they suggested about something like
15360 (or so) bits for the asymetric key <-> 512 bits for the hash
size <-> 256 symmetric key
should lead to about the same "strenght"...
So we have 512/256 bits for the later two,.. but per default much less
for the asymmetric... Does this mean, that the other two are overkill
for what we use in gpg?
- When creating new keys (I'd like to "convince" some more friends to
take part :) )... should they create their keys with gpg1 or gpg2? Or
is the key generation equally secure?
Best wishes,

@_date: 2009-09-10 16:51:05
@_author: Philippe Cerfon 
@_subject: howto secure older keys after the recent attacks 
Hi Robert.
Ah,.. right... it was the other way round it didn't work (GPL2 to BSD ;) )
One should perhaps count in all the King Kong vs. Godzilla moviews,..
who has won more often? ;-)
ooook...  ^^
Ok,.. I see.
Thanks :)

@_date: 2009-09-10 23:33:51
@_author: Philippe Cerfon 
@_subject: howto secure older keys after the recent attacks 
Hi Robert.
What specifically do you mean? Crypto-stuff in banking etc.?
Of course,... just wondered if there might be any known issues due to that.
Ok,.. I see.
But attackers could still attack older data, that they intercepted, right?
Best wishes,

@_date: 2009-09-10 23:38:58
@_author: Philippe Cerfon 
@_subject: howto secure older keys after the recent attacks 
Ok,.. but then people would "loose" all their collected signatures on
their keys and to other keys :-(
So I better use Linux and not FreeBSD ;)
Yeah,.. that's the issue I've meant...
*still cannot believe, that I've remembered the exact number :-O *

@_date: 2009-09-10 23:43:00
@_author: Philippe Cerfon 
@_subject: howto secure older keys after the recent attacks 
Hello Daniel.
On Thu, Sep 10, 2009 at 6:22 PM, Daniel Kahn Gillmor
I think I've messed up the terms fingerprint and key ID, sorry :-(
Ok,.. I'm confused now.
David said,.. the community would probably have to create a new key
type or version at some point.
But this sounds more, that if I simply don't use designated revocation
keys,... I don't use SHA1 at all,.. and would be fine to simply swtich
to another algorithm.

@_date: 2009-09-10 23:44:29
@_author: Philippe Cerfon 
@_subject: howto secure older keys after the recent attacks 
I meant the fingerprint, yes.
But now that you say it. Would it be "better" to not just check other
keys via their fingerprint, but to really copy them (e.g. per
USB-stick) from their owners and sign only such direct copies?

@_date: 2009-09-11 01:19:30
@_author: Philippe Cerfon 
@_subject: howto secure older keys after the recent attacks 
Thanks,.. got what you meant :-)
Ah I see,...
And encryption does not suffer from hash algorithm weaknesses anyway, does it?
I mean there it wouldn't help to revoke my key,... (given the fact
that one has such long term secrets).
