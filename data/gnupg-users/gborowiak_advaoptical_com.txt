
@_date: 2015-04-28 12:32:30
@_author: Grzegorz Borowiak 
@_subject: Building libgpg-error for powerpc64-e5500-linux-gnu 
I'm trying to cross-compile libgpg-error for powerpc64-e5500-linux-gnu and I fail:
make[1]: Entering directory '/targ/arch/powerpc64-e5500-linux-gnu/modes/eos/tmp/portage/dev-libs/libgpg-error-1.18/work/libgpg-error-1.18-.default'
Making all in m4
make[2]: Entering directory '/targ/arch/powerpc64-e5500-linux-gnu/modes/eos/tmp/portage/dev-libs/libgpg-error-1.18/work/libgpg-error-1.18-.default/m4'
make[2]: Nothing to be done for 'all'.
make[2]: Leaving directory '/targ/arch/powerpc64-e5500-linux-gnu/modes/eos/tmp/portage/dev-libs/libgpg-error-1.18/work/libgpg-error-1.18-.default/m4'
Making all in src
make[2]: Entering directory '/targ/arch/powerpc64-e5500-linux-gnu/modes/eos/tmp/portage/dev-libs/libgpg-error-1.18/work/libgpg-error-1.18-.default/src'
gawk -f /targ/arch/powerpc64-e5500-linux-gnu/modes/eos/tmp/portage/dev-libs/libgpg-error-1.18/work/libgpg-error-1.18/src/mkerrnos.awk /targ/arch/powerpc64-e5500-linux-gnu/modes/eos/tmp/portage/dev-libs/libgpg-error-1.18/work/libgpg-error-1.18/src/errnos.in >code-to-errno.h
gawk -f /targ/arch/powerpc64-e5500-linux-gnu/modes/eos/tmp/portage/dev-libs/libgpg-error-1.18/work/libgpg-error-1.18/src/mkerrcodes1.awk /targ/arch/powerpc64-e5500-linux-gnu/modes/eos/tmp/portage/dev-libs/libgpg-error-1.18/work/libgpg-error-1.18/src/errnos.in >_mkerrcodes.h
gawk -f /targ/arch/powerpc64-e5500-linux-gnu/modes/eos/tmp/portage/dev-libs/libgpg-error-1.18/work/libgpg-error-1.18/src/mkstrtable.awk -v textidx=2 -v nogettext=1 \
    /targ/arch/powerpc64-e5500-linux-gnu/modes/eos/tmp/portage/dev-libs/libgpg-error-1.18/work/libgpg-error-1.18/src/err-sources.h.in >err-sources-sym.h
gawk -f /targ/arch/powerpc64-e5500-linux-gnu/modes/eos/tmp/portage/dev-libs/libgpg-error-1.18/work/libgpg-error-1.18/src/mkstrtable.awk -v textidx=2 -v nogettext=1 \
    /targ/arch/powerpc64-e5500-linux-gnu/modes/eos/tmp/portage/dev-libs/libgpg-error-1.18/work/libgpg-error-1.18/src/err-codes.h.in >err-codes-sym.h
powerpc64-e5500-linux-gnu-gcc -E   _mkerrcodes.h | grep GPG_ERR_ | \
               gawk -f /targ/arch/powerpc64-e5500-linux-gnu/modes/eos/tmp/portage/dev-libs/libgpg-error-1.18/work/libgpg-error-1.18/src/mkerrcodes.awk >mkerrcodes.h
gawk -f /targ/arch/powerpc64-e5500-linux-gnu/modes/eos/tmp/portage/dev-libs/libgpg-error-1.18/work/libgpg-error-1.18/src/mkstrtable.awk -v textidx=2 -v nogettext=1 \
    -v prefix=GPG_ERR_ -v namespace=errnos_ \
    /targ/arch/powerpc64-e5500-linux-gnu/modes/eos/tmp/portage/dev-libs/libgpg-error-1.18/work/libgpg-error-1.18/src/errnos.in >errnos-sym.h
x86_64-pc-linux-gnu-gcc -g -O0 -I. -I/targ/arch/powerpc64-e5500-linux-gnu/modes/eos/tmp/portage/dev-libs/libgpg-error-1.18/work/libgpg-error-1.18/src -o mkheader /targ/arch/powerpc64-e5500-linux-gnu/modes/eos/tmp/portage/dev-libs/libgpg-error-1.18/work/libgpg-error-1.18/src/mkheader.c
cat /targ/arch/powerpc64-e5500-linux-gnu/modes/eos/tmp/portage/dev-libs/libgpg-error-1.18/work/libgpg-error-1.18/src/gpg-error.def.in >_gpg-error.def.h
echo "/*dummy*/" > mkw32errmap.map.c
powerpc64-e5500-linux-gnu-gcc -E -I. -I/targ/arch/powerpc64-e5500-linux-gnu/modes/eos/tmp/portage/dev-libs/libgpg-error-1.18/work/libgpg-error-1.18/src -I..   _gpg-error.def.h | \
  grep -v '^ >gpg-error.def
rm _mkerrcodes.h
x86_64-pc-linux-gnu-gcc -I. -I/targ/arch/powerpc64-e5500-linux-gnu/modes/eos/tmp/portage/dev-libs/libgpg-error-1.18/work/libgpg-error-1.18/src -o mkerrcodes /targ/arch/powerpc64-e5500-linux-gnu/modes/eos/tmp/portage/dev-libs/libgpg-error-1.18/work/libgpg-error-1.18/src/mkerrcodes.c
rm _gpg-error.def.h
rm lock-obj-pub.native.h 2>/dev/null
./mkerrcodes | gawk -f /targ/arch/powerpc64-e5500-linux-gnu/modes/eos/tmp/portage/dev-libs/libgpg-error-1.18/work/libgpg-error-1.18/src/mkerrcodes2.awk >code-from-errno.h
Makefile:1282: recipe for target 'gpg-error.h' failed
make[2]: [gpg-error.h] Error 1 (ignored)
./mkheader linux-gnu powerpc64-e5500-linux-gnu  /targ/arch/powerpc64-e5500-linux-gnu/modes/eos/tmp/portage/dev-libs/libgpg-error-1.18/work/libgpg-error-1.18/src/gpg-error.h.in \
                   ../config.h 1.18 0x011200 >gpg-error.h
Makefile:1282: recipe for target 'gpg-error.h' failed
make[2]: *** [gpg-error.h] Error 1
make[2]: Leaving directory '/targ/arch/powerpc64-e5500-linux-gnu/modes/eos/tmp/portage/dev-libs/libgpg-error-1.18/work/libgpg-error-1.18-.default/src'
Makefile:470: recipe for target 'all-recursive' failed
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory '/targ/arch/powerpc64-e5500-linux-gnu/modes/eos/tmp/portage/dev-libs/libgpg-error-1.18/work/libgpg-error-1.18-.default'
Makefile:401: recipe for target 'all' failed
make: *** [all] Error 2
I already have done some debugging and it seems that powerpc64-e5500-linux-gnu is not supported, nor is it falling back to powerpc64-unknown-linux-gnu (which is supported).
How to cope with situation like that?
Can I somehow convince it to recognise powerpc64-e5500-linux-gnu as powerpc64-unknown-linux-gnu?
Or is there some way to build it architecture-independently (even if it means decreased performance)?
This issue starts with libgpg-error version 1.13. Version 1.12 builds without error.
Grzegorz Borowiak

@_date: 2015-04-28 15:55:48
@_author: Grzegorz Borowiak 
@_subject: Building libgpg-error for powerpc64-e5500-linux-gnu 
Thank you for so quick answer.
I will try how it works.
I'm almost sure the ABI is the same, but I must check. And is there an architecture-independent and ABI-independent way of building libgpg-error?
Sent: 28 April 2015 17:48
On Tue, 28 Apr 2015 14:32, GBorowiak at advaoptical.com said:
If both systems use the same ABI config.sub should have returned a
canonicalized versions.  If not we can use a new mechanism available in
1.19.  You need to change the code, though: In src/mkheader.c find the
--8<---------------cut here---------------start------------->8---
static char *
canon_host_triplet (const char *triplet)
  struct {
    const char *name;
    const char *alias;
  } tbl[] = {
    {"i486-pc-linux-gnu", "i686-pc-linux-gnu" },
    {"i586-pc-linux-gnu" },
    { NULL }
  };
--8<---------------cut here---------------end--------------->8---
and add a line
    {"powerpc64-e5500-linux-gnu", "powerpc64-unknown-linux-gnu" },
before the {NULL} marker.  But do that only if you are sure both use the
same ABI.
Let me know if this works and I'll add it for 1.20.
   Werner
Die Gedanken sind frei.  Ausnahmen regelt ein Bundesgesetz.
