
@_date: 2007-07-03 11:30:01
@_author: Guillaume Yziquel 
@_subject: Ownership of usb device with udev. 
Werner Koch a ?crit :
I read the hotplug stuff was deprecated, and that udev should be used
instead. The output of lsusb -v concerning the smart card reader follows.
My main problem is that I do not really understand how udev works. I
understood there was lots of renaming involved. And with all these
renamings, I do not really know how to make ownership changes.
I'd really love to find a good document on how udev works. In particular
with debian.
Thank you.
Guillaume Yziquel.

@_date: 2007-07-03 13:35:10
@_author: Guillaume Yziquel 
@_subject: Ownership of usb device with udev. 
Werner Koch a ?crit :
This link describes the udev thingy in an understandable way:
Maybe it is too specific to Debian. I do not know.
It deals with ownership problems somewhere inside. I think it should be
a good reference for the HOWTO. As it was mentioned in some mail before,
 the HOWTO is not completely complete, concerning udev machinery. If you
type the commands somewhat too fast, reading blindly, then you get my
problem. Rights management is mentioned in the GPG Smartacard HOWTO, but
 very very quickly, without instructions to follow. It is therefore
somewhat hard to follow.
I think the HOWTO needs this information, because its absence really
makes life complicated for average or below-average users trying to get
the smartacard reader working.
Guillaume Yziquel.

@_date: 2007-07-03 15:00:35
@_author: Guillaume Yziquel 
@_subject: Ownership of usb device with udev. 
In fact, what puzzled me is that I already had all this written down.
The problem was that there was some \newline between two of the keys.
This splitted off the line in two, and it was not parsed correctly at
boot time.
It's now settled. At least for the hardware part. I'm getting error
messages through Thunderbird/Icedove, now, and I hope that it's because
of some wrong pin...
Thank you all very much.
Guillaume Yziquel.

@_date: 2007-07-09 11:14:06
@_author: Guillaume Yziquel 
@_subject: Pin fails with svn & ssh & gnupg-agent & smartcard. 
Hello list.
I'm into trouble again. I'm still on this svn+ssh+gpg-agent+smartcard
problem. I'm not using pcscd any more, but scdaemon, which used to work
fine. I do not recall having done anything special that might have
broken things up.
However, I get the following kind of error messages while trying to use
svn + ssh + gnupg-agent + smartcard:
It then pops some gtk pinentry program, and I entered my pin inside.
Below are some logs. gpg-agent.log and scdaemon.log.
Some interesting error messages in these logs are:
I thank you for all the help you guys have and might lend me.
Guillaume Yziquel.

@_date: 2007-07-09 11:24:42
@_author: Guillaume Yziquel 
@_subject: Pin fails with svn & ssh & gnupg-agent & smartcard. 
Guillaume Yziquel a ?crit :
Sorry. Made a mistake. Everything is now fine. The smartcard was not
correctly inserted, and even plugging out and back in, it was
incorrectly inserted in the smartcard reader. False negatives...
Guillaume Yziquel.

@_date: 2007-07-12 10:31:00
@_author: Guillaume Yziquel 
@_subject: Pin fails with svn & ssh & gnupg-agent & smartcard. 
Guillaume Yziquel a ?crit :
Well, no. In fact, I'm still having a problem...
Everything's working, but after a while, everything fails again. I get
these kind of messages from the smartcard daemon. And unplugging and
replugging everything does not change the result.
I'd appreciate comments, and I'd like to understand what this log could
Guillaume Yziquel.

@_date: 2007-07-12 22:21:05
@_author: Guillaume Yziquel 
@_subject: Pin fails with svn & ssh & gnupg-agent & smartcard. 
Hi, Werner.
Georg is quite busy... I'll ask. But what worries me is that I seem
somehow to get in the same kind of problem that made me change from
pcscd to scdaemon.
I'm afraid I'll have to revert to pcscd.
Therefore, one small question: Should I use pcscd or scdaemon. What are
the major pros and cons between these two solutions?
And how does one usually attempt to localise the "bug" in this situation?
Thanks, Werner.

@_date: 2007-07-13 10:47:58
@_author: Guillaume Yziquel 
@_subject: Pin fails with svn & ssh & gnupg-agent & smartcard. 
Alon Bar-Lev a ?crit :
And to what extent is your solution free software and free hardware?

@_date: 2007-07-13 11:21:21
@_author: Guillaume Yziquel 
@_subject: Pin fails with svn & ssh & gnupg-agent & smartcard. 
Alon Bar-Lev a ?crit :
That's one point of view...
I'm afraid I do not see an answer to my question, here.

@_date: 2007-07-14 05:00:09
@_author: Guillaume Yziquel 
@_subject: Pin fails with svn & ssh & gnupg-agent & smartcard. 
Werner Koch a ?crit :
Well, I followed the following howto:
and it now works fine. Quite stable.
A few comments on the howto:
  - This howto is not really the first thing that pops up when you
search for things on the smartcard, unfortunately.
  - poldi's documentation is rather hard to find on the web. For now, I
found it only in the source of the poldi, and in the the source itself
was not that easy to find. It's here:
  - in gpg-agent.conf, the line write-env-file
Debian distribution, with a rather standard setup, this file looks more
like ~/.gnupg/.gpg-agent-info-.
  - there's a confusion between the documentation of poldi and the
output of gpg --card-status concerning the expressions "serial number"
and "application ID". The wording should be consistent in order to avoid
Glad to have it working and stable,
Guillaume Yziquel.

@_date: 2007-07-19 15:17:03
@_author: Guillaume Yziquel 
@_subject: Pin fails with svn & ssh & gnupg-agent & smartcard. 
Guillaume Yziquel a ?crit :
Well, it still is bothersome... Signing and decrypting emails is no
problem. But svn+ssh still gets the same problems I have described on
this mail:
So I guess it's not resolved. I'd like to know from anyone using
smartcard for ssh authentification is they have similar problems, or am
I alone. Could this be some amd64 problem?
Thank for any help into this.

@_date: 2007-06-14 13:00:56
@_author: Guillaume Yziquel 
@_subject: Regenerating keys on a cryptocard. 
I've got a cryptocard, and I wish to regenerate keys on it. I've already
got a few keys on it, that I wish to discard. Here's part of the output
of what I did:
I do not really get the meaning of this message.
Any help would be highly appreciated.
Sincerely yours,
Guillaume Yziquel.

@_date: 2007-06-25 17:58:18
@_author: Guillaume Yziquel 
@_subject: Problems svn+ssh+gpg(-agent)+smartcard 
I have the following problem:
I'm using svn with an ssh access, and I use gpg and gpg-agent with a
smartcard to access my key and replace the passphrase.
I'm using a debian etch with a 2.6.18-4 kernel.
After my computer has freshly booted up, it works like a charm. But, as
time goes on (and perhaps a screensaver goes by, I don't know), the
system with gpg fails, and my computer ends up asking me some vulgar
Some version numbers:
svn, version 1.4.2 (r22196)  gpg (GnuPG) 1.4.6  gpg-agent (GnuPG) 2.0.4
I started logging messages for the purpose of looking into this, and I
get the following messages, which I do not find extremely helpful:
It works fine.
It then fails.
I reboot, and it works:
I'd really appreciate understanding what is happening...
Guillaume Yziquel.

@_date: 2007-06-26 10:36:54
@_author: Guillaume Yziquel 
@_subject: Problems svn+ssh+gpg(-agent)+smartcard 
James Davis a ?crit :
Thank you, James.
Well, I haven't tried your solution yet. But I will soon, I'll bet...
I think the scdaemon you're talking about is:
But, what is weird is that when this combination
fails, I can still sign and decrypt electronic messages through the
smartcard, handled through gpg-agent and the scdaemon (I guess).
But perhaps the smartcard is handled in a different way in these two
different cases.
Is their anyway to monitor more closely what is happening than just
looking at the logs?

@_date: 2007-06-27 11:51:16
@_author: Guillaume Yziquel 
@_subject: Problems svn+ssh+gpg(-agent)+smartcard 
James Davis a ?crit :
No it does not. I just tested it, and I still have the same problem...
And killing pcscd tursns off the little green LED on my smartcard reader.
However, a ps fauxw yields (everything on this mail has been done in the
same chronological order as the reading order):
So I guess I am also using scdaemon. Even if up to know it seems that
things were going through pcscd, since I'm not able to sign an email
since pcscd got killed.

@_date: 2007-06-27 13:45:52
@_author: Guillaume Yziquel 
@_subject: Problems svn+ssh+gpg(-agent)+smartcard 
I've created the following scdeamon.conf file in my ~/.gnupg/ directory:
I've removed pcscd. In fact, I needed pcscd because I was using some
opensc packge together with some modified version of openssh-client.
Now, I'm left with gnupg, scdaemon, but scdaemon does not seem to want
to talk to the smartcard reader...
Using Thunderbird and Enigmail, GnuPG, et ceter?, I get the following
output in the scdaemon.log file:
Using an SCR 335 smartcard reader.

@_date: 2007-06-27 18:33:56
@_author: Guillaume Yziquel 
@_subject: Problems svn+ssh+gpg(-agent)+smartcard 
James Davis a ?crit :
OK. So I've been using the PC/SC daemon up to now...
Thanks anyway!

@_date: 2007-06-28 15:49:50
@_author: Guillaume Yziquel 
@_subject: Broken pipe? [was: Problems svn+ssh+gpg(-agent)+smartcard] 
OK. I've a little more time to invest into solving this issue. I just
turned the debugging level to "basic" in both gpg-agent and scdaemon's
logging files. I also added the debug-ccid-driver into scdaemon.conf.
When failing to decrypt and failing to access the SCR 335 smartcard
reader, I get the logged output decribed below this message.
It seems I have a broken pipe issue:
Any further information, help, guidance, hints, suggested readings is
And also:

@_date: 2007-06-29 11:04:54
@_author: Guillaume Yziquel 
@_subject: Broken pipe? [was: Problems svn+ssh+gpg(-agent)+smartcard] 
Alon Bar-Lev a ?crit :
I'm reading through the GnuPG 2.0 manual, in .pdf version, available from
What I know is that it is an OpenPGP card. I've read
and I'm quite positive that it's not using a PKCS interface.
I think that the problem is that no card-reader seems recognized. I'd be
glad if it was only a smartcard protocol problem.
Maybe the following helps:
Where do I get details about error codes?
In the manual, it is written:
and I was rather surprised by that: do you still need libpcsclite.so.xxx
to run the builtin ccid driver? Because I removed these file through
aptitude. Because I've got the following complaint:
I'll try to connect directly to scdaemon to see what is happening.

@_date: 2007-06-29 11:38:52
@_author: Guillaume Yziquel 
@_subject: Broken pipe? 
Werner Koch a ?crit :
I've already purged pcsc with aptitude. And I still get the same messages:
(Logging with option debug-level advanced and debug-ccid-driver)
Well instead of a broken pipe, I get a premature EOF...
Uhh. I'll read how strace works, and I'll come back to you.
Visibly, purging pcscd does not solve the problem. Concerning
permissions, I guess I have some work to do:
Thanks, Werner.

@_date: 2007-06-29 13:44:58
@_author: Guillaume Yziquel 
@_subject: Broken pipe? 
Werner Koch a ?crit :
I did run the scdaemon under strace, and I tried to post the output. But:

@_date: 2007-06-29 12:07:43
@_author: Guillaume Yziquel 
@_subject: Broken pipe? 
============================== START ==============================
Werner Koch a ?crit :
I apologize for the weight of this message.
OK. Here goes:
There's the output:
