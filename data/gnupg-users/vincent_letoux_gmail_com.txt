
@_date: 2010-02-16 23:35:30
@_author: Vincent Le Toux 
@_subject: generating / reading public key on smart card 
I'm encountering an "gpg: key generation failed"
when I try to generate new keys on OpenPGP smart card v2.
My config is Windows 7 ultimate 64 bits with gpg running on 32 bits.
I've tried two smart card (including the one Werner sent to me)
with 2 readers :
gpg: detected reader `ACS CCID USB Reader 0'
gpg: detected reader `SCM Microsystems Inc. SCR33x USB Smart Card Reader 0'
When I'm tracing APDU sent (using a tool from IDRIX), I see:
2010-02-16 22:55:12.753 - SCardTransmit( hCard = 0xEA010000 ):
 Input APDU =
  00 47 80 00 02 B6 00 00
 Response   =
  67 00
67 00 means "Wrong length (Lc and/or Le)"
Bellow one complete dialog (sorry, in French)
Any ideas ?
C:\Program Files (x86)\GNU\GnuPG>gpg --card-edit
gpg: detected reader `ACS CCID USB Reader 0'
gpg: detected reader `SCM Microsystems Inc. SCR33x USB Smart Card Reader 0'
Application ID ...: D2760001240102000005000000390000
Version ..........: 2.0
Manufacturer .....: unknown
Serial number ....: 00000039
Name of cardholder: Enoch Root
Language prefs ...: de
Sex ..............: non sp?cifi?
URL of public key : Login data .......: [non positionn?]
Private DO 1 .....: [non positionn?]
Private DO 2 .....: [non positionn?]
Signature PIN ....: non forc?
Max. PIN lengths .: 32 32 32
PIN retry counter : 3 0 3
Signature counter : 5
Signature key ....: 69A7 FC5E 6974 866E 917B  D53D E455 F2D7 CC9C 6BBC
      created ....: 2009-11-05 17:01:08
Encryption key....: 8DC1 3BB5 A0F0 DBA6 7E81  B2E5 D367 147F 5CB0 CDF0
      created ....: 2009-11-05 17:01:08
Authentication key: 4676 0AA3 4E97 1FE5 7189  A741 591B 5112 D5A9 C5A6
      created ....: 2009-11-05 17:01:08
General key info..: [none]
Commande> admin
Les commandes d'administration sont permises
Commande> generate
Faire une sauvegarde hors carte de la cl? de chiffrement ? (O/n) n
gpg: NOTE: keys are already stored on the card!
Remplacer les cl?s existantes ? (o/N) O
Sp?cifiez combien de temps cette cl? devrait ?tre valide.
         0 = la cl? n'expire pas
        = la cl? expire dans n jours
      w = la cl? expire dans n semaines
      m = la cl? expire dans n mois
      y = la cl? expire dans n ann?es
La cl? est valide pour ? (0)
La cl? n'expire pas du tout
Est-ce correct ? (o/N) O
Vous avez besoin d'un nom d'utilisateur pour identifier votre cl?; le
programme le construit ? partir du nom r?el, d'un commentaire et d'une
adresse e-mail de cette mani?re:
   ? Heinrich Heine (Der Dichter)  ?
Nom r?el: vincent
Adresse e-mail: vincent at vincent.com
Commentaire: vincent
Vous avez s?lectionn? ce nom d'utilisateur:
    "vincent (vincent) "
Changer le (N)om, le (C)ommentaire, l'(E)-mail ou (O)K/(Q)uitter ? O
gpg: la cl? existante sera remplac?e
gpg: 3 tentatives de PIN admin restent jusqu'? ce que la carte
soit irr?m?diablement bloqu?e
code PIN d'administration
gpg: attendez que la cl? se g?n?re...
gpg: la g?n?ration de la cl? a ?chou?
gpg: key generation failed: erreur g?n?rale
La g?n?ration de cl? a ?chou?: erreur g?n?rale
Commande> *
