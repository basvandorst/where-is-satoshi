
@_date: 2000-07-25 01:45:44
@_author: Nick Rasmussen 
@_subject: problems importing signature/compilation patch 
A friend signed my public key with a dss key using pgp-5.0, and gpg (1.0.2)
seems to have problems reading in the signed key.  importing it into pgp-5.0
and pgp-6.5.1 works fine.
Here's what the import does:
gpg: Warning: using insecure memory!
gpg: mpi too large (54458 bits)
gpg: Ohhhh jeeee: mpi crosses packet bordersecmem usage: 0/0 bytes in 0/0 blocks of pool 0/16384
Here is the signed key that is triggering the bug:
-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: PGPfreeware 5.0i for non-commercial use
-----END PGP PUBLIC KEY BLOCK-----
Just out of curiosity, I recompiled gpg (1.0.2) with --enable-m-debug and
--enable-m-guard, and it did not link.  After making the small fix needed,
the behaviour was still the same.
Any ideas as to what is wrong?
The changes that I make to get it compile were:
diff -ru gnupg-1.0.2/mpi/mpiutil.c gnupg-1.0.2-memfix/mpi/mpiutil.c
--- gnupg-1.0.2/mpi/mpiutil.c	Tue Jun  1 09:08:55 1999
+++ gnupg-1.0.2-memfix/mpi/mpiutil.c	Tue Jul 25 00:06:40 2000
 -388,14 +388,24      MPI b;
     if( a && (a->flags & 4) ) {
+ M_DEBUG
+	void *p = m_is_secure(a->d)? m_debug_alloc_secure( a->nbits, "alloc_like" )
+				   : m_debug_alloc( a->nbits, "alloc_like" );
 	void *p = m_is_secure(a->d)? m_alloc_secure( a->nbits )
 				   : m_alloc( a->nbits );
 	memcpy( p, a->d, a->nbits );
 	b = mpi_set_opaque( NULL, p, a->nbits );
     }
     else if( a ) {
+ M_DEBUG
+	b = mpi_is_secure(a)? mpi_debug_alloc_secure( a->nlimbs, "alloc_like" )
+			    : mpi_debug_alloc( a->nlimbs, "alloc_like" );
 	b = mpi_is_secure(a)? mpi_alloc_secure( a->nlimbs )
 			    : mpi_alloc( a->nlimbs );
 	b->nlimbs = 0;
 	b->sign = 0;
 	b->flags = a->flags;

@_date: 2000-07-25 01:45:44
@_author: Nick Rasmussen 
@_subject: problems importing signature/compilation patch 
A friend signed my public key with a dss key using pgp-5.0, and gpg (1.0.2)
seems to have problems reading in the signed key.  importing it into pgp-5.0
and pgp-6.5.1 works fine.
Here's what the import does:
gpg: Warning: using insecure memory!
gpg: mpi too large (54458 bits)
gpg: Ohhhh jeeee: mpi crosses packet bordersecmem usage: 0/0 bytes in 0/0 blocks of pool 0/16384
Here is the signed key that is triggering the bug:
-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: PGPfreeware 5.0i for non-commercial use
-----END PGP PUBLIC KEY BLOCK-----
Just out of curiosity, I recompiled gpg (1.0.2) with --enable-m-debug and
--enable-m-guard, and it did not link.  After making the small fix needed,
the behaviour was still the same.
Any ideas as to what is wrong?
The changes that I make to get it compile were:
diff -ru gnupg-1.0.2/mpi/mpiutil.c gnupg-1.0.2-memfix/mpi/mpiutil.c
--- gnupg-1.0.2/mpi/mpiutil.c	Tue Jun  1 09:08:55 1999
+++ gnupg-1.0.2-memfix/mpi/mpiutil.c	Tue Jul 25 00:06:40 2000
 -388,14 +388,24      MPI b;
     if( a && (a->flags & 4) ) {
+ M_DEBUG
+	void *p = m_is_secure(a->d)? m_debug_alloc_secure( a->nbits, "alloc_like" )
+				   : m_debug_alloc( a->nbits, "alloc_like" );
 	void *p = m_is_secure(a->d)? m_alloc_secure( a->nbits )
 				   : m_alloc( a->nbits );
 	memcpy( p, a->d, a->nbits );
 	b = mpi_set_opaque( NULL, p, a->nbits );
     }
     else if( a ) {
+ M_DEBUG
+	b = mpi_is_secure(a)? mpi_debug_alloc_secure( a->nlimbs, "alloc_like" )
+			    : mpi_debug_alloc( a->nlimbs, "alloc_like" );
 	b = mpi_is_secure(a)? mpi_alloc_secure( a->nlimbs )
 			    : mpi_alloc( a->nlimbs );
 	b->nlimbs = 0;
 	b->sign = 0;
 	b->flags = a->flags;
