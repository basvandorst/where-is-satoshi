
@_date: 2020-12-06 13:43:45
@_author: John Scott 
@_subject: =?UTF-8?B?4oCcSGFyZHdhcmUgcHJvYmxlbeKAnQ==?= with OpenPGP smart 
It looks like you're trying to decrypt a file and your encryption PIN counter is zero. I wonder why it was giving you the strange error message.
Does signing work?

@_date: 2020-05-16 23:24:23
@_author: John Scott 
@_subject: Help setting gpgsm to do LDAP lookup 
I'm stumped getting gpgsm to lookup S/MIME certificates in my organization. I've got a temporary working solution with ldapsearch after logging into my VPN with NetworkManager+OpenConnect:
    ldapsearch -Wt -b OU=Accounts,DC=ads,DC=foo,DC=com -D CN=jscott,OU=Accounts,DC=ads,DC=foo,DC=com '(mailNickname=[recipient])' This saves the signed message to a temporary file which I do gpgsm --verify on, although the certs themselves are also stored in the userCertificate record IIRC. ldapsearch also works if I use only LDAPv2.
My dirmngr_ldapservers.conf reads
and to be extra safe I've put an explicit no-use-tor and ldapserverlist-file dirmngr_ldapservers.conf in my dirmngr.conf. Reloading dirmngr and gpgsm after getting on the VPN doesn't help.
Looking up recipients with both dirmngr-client and
    gpgsm --verbose --list-external-keys [recipient]
are fruitless whether I drop the ads\ from my username or not. I've bumped the ldaptimeout to 25. Still both commands finish instantaneously?not unlike ldapsearch however.
$ gpgsm --debug-level expert -vvvvv --list-external-keys anything
gpgsm: enabled debug flags: x509 crypto cache ipc
gpgsm: DBG: chan_3 <- # Home: /home/john/.gnupg
gpgsm: DBG: chan_3 <- # Config: /home/john/.gnupg/dirmngr.conf
gpgsm: DBG: chan_3 <- OK Dirmngr 2.2.20 at your service
gpgsm: DBG: connection to the dirmngr established
gpgsm: DBG: chan_3 -> GETINFO version
gpgsm: DBG: chan_3 <- D 2.2.20
gpgsm: DBG: chan_3 <- OK
gpgsm: DBG: chan_3 -> OPTION audit-events=1
gpgsm: DBG: chan_3 <- OK
gpgsm: DBG: chan_3 -> LOOKUP anything
gpgsm: DBG: chan_3 <- OK
secmem usage: 0/16384 bytes in 0 blocks
I'm using 2.2.20 on Debian Bullseye. Other options set are add-servers in dirmngr.conf and auto-issuer-key-retrieve in gpgsm.conf.
$ systemctl --user status dirmngr
? dirmngr.service - GnuPG network certificate management daemon
     Loaded: loaded (/usr/lib/systemd/user/dirmngr.service; static; vendor preset: enabled)
     Active: active (running) since Sat 2020-05-16 22:52:38 EDT; 23min ago
TriggeredBy: ? dirmngr.socket
       Docs: man:dirmngr(8)
   Main PID: 26309 (dirmngr)
     CGroup: /user.slice/user-1000.slice/user at 1000.service/dirmngr.service
             ??26309 /usr/bin/dirmngr --supervised
I also use GnuPG's SSH agent emulation and have in my .bashrc
    export GPG_TTY=$(tty)
    export SSH_AUTH_SOCK=$(gpgconf --list-dirs agent-ssh-socket)
    gpg-connect-agent updatestartuptty /bye >/dev/null

@_date: 2020-05-25 13:31:11
@_author: John Scott 
@_subject: Backup of Keys 
Having only heard of it just now, I was surprised it's not included in Debian, until I saw the word of caution and lack of commit history.
Whether in Sherpa or GnuPG directly I would be grateful for a more semantic way to make a backup. In fact I think this is a regular unmet need with software, especially to distinguish machine-specific configuration info from user preferences.

@_date: 2020-05-28 00:33:16
@_author: John Scott 
@_subject: Help setting gpgsm to do LDAP lookup 
Thank you. The extra logging and options didn't reveal anything insightful to me (attached). I've also adjusted the credentials after getting help in my I notice that if I use a non-SSL port like 389 or 3268?which I'm not sure they support the use of, I think they might require non-opportunistic TLS?I get an 'S PROGRESS TICK ? 0 0" message and Dirmngr takes its time before calling it On the other hand using 636 or 3269 Dirmngr seems to not try and gets the log. The URI says only ldap://, can/could/should I specify TLS?

@_date: 2020-11-07 20:27:57
@_author: John Scott 
@_subject: Clarification on getting a validity reason in GPGME 
I'm writing a tool using GPGSM and want to print signature validation information without reinventing the wheel with case statements, also for the sake of localization. These members in gpgme_signature_t [1] seem to be what I'm looking for:
gpgme_validity_t validity
gpgme_error_t validity_reason
so I can get a string from the gpgme_error_t, although it appears to be conditional on the signature being invalid. That's not clear since gpgme_validity_t is an enumeration of
GPGME_VALIDITY_{UNKNOWN, UNDEFINED, NEVER, MARGINAL,FULL, ULTIMATE}
I wonder if this is the case already and it's just a documentation quirk, but it'd be helpful if validity_reason were set to some value for good signatures, although this isn't technically an error.
[1]
