
@_date: 2011-06-10 10:39:48
@_author: Steve Strobel 
@_subject: GPG encryption and decryption in windows 
This may be completely unrelated, but I also ran into a problem where I was prompted for a passphrase when the real issue was something else.  Running on an Ubuntu host trying to connect to and Ubuntu server running on Amazon web services:
ssh -i keyfile.pem ubuntu at mydomain.net
Enter passphrase for key 'keyfile.pem': Permission denied (publickey).
sudo ssh -i keyfile.pem ubuntu at vtrunk.net
The keyfile was created without a passphrase, but trying to use it when I didn't have permission for the host's filesystem caused a prompt for a passphrase that AFAIK doesn't exist.  I don't see how or why using sudo had anything to do with a passphrase for the key.  When the key was created without a passphrase, it seems wrong for gpg to prompt for one regardless of what else might be wrong.
I guess what I am suggesting is that the logic that causes gpg to prompt for a passphrase either has a problem or my understanding of it does.  Whether the problem you are experiencing on a Windows system is related at all is a question I can't answer.
Steve Strobel
Link Communications, Inc.
1035 Cerise Rd
Billings, MT 59101-7378
(406) 245-5002 ext 102
(406) 245-4889 (fax)
WWW: MailTo:steve.strobel at link-comm.com

@_date: 2011-05-16 11:32:15
@_author: Steve Strobel 
@_subject: Why is "--allow-non-selfsigned-uid" needed to import this key? 
I am using gnupg to encrypt and sign a file transferred from a server to an embedded client.  I generated a 2048 bit RSA keypair on the server (using gpg V1.4.6) with "gpg --gen-key" and got the output:
        gpg: key CBF38289 marked as ultimately trusted
        public and secret key created and signed.
I exported it with "
gpg --output test-key.gpg --export --armor CBF38289", transferred the file to the client and tried to import it using gpg V1.4.11 (the embedded device doesn't have a real-time clock):
        root:~> gpg --import test-key.gpg
        gpg: key CBF38289 was created 137948617 seconds in the future (time warp or clock problem)
        gpg: key CBF38289 was created 137948617 seconds in the future (time warp or clock problem)
        gpg: key CBF38289: no valid user IDs
        gpg: this may be caused by a missing self-signature
        gpg: Total number processed: 1
        gpg:           w/o user IDs: 1
I can import it using the "--allow-non-selfsigned-uid" option:
        root:~> gpg --import --allow-non-selfsigned-uid test-key.gpg
        gpg: key CBF38289 was created 137948550 seconds in the future (time warp or clock problem)
        gpg: key CBF38289 was created 137948550 seconds in the future (time warp or clock problem)
        gpg: key CBF38289: accepted non self-signed user ID "Test User (do not use) "
        gpg: key CBF38289 was created 137948550 seconds in the future (time warp or clock problem)
        gpg: key CBF38289: public key "Test User (do not use) " imported
        gpg: Total number processed: 1
        gpg:               imported: 1  (RSA: 1)
I have tried a variety of things but been unable to get import to work without using "--allow-non-selfsigned-uid".  When the key was created, the output indicated it was signed.  When I edit it, the output looks like this:
        Secret key is available.
        pub  2048R/CBF38289  created: 2011-05-16  expires: never       usage: SC
                             trust: ultimate      validity: ultimate
        [ultimate] (1). Test User (do not use) What am I missing?  I presume that there security implications of using "--allow-non-selfsigned-uid"?  Thanks for any suggestions.
Steve Strobel
Link Communications, Inc.
1035 Cerise Rd
Billings, MT 59101-7378
(406) 245-5002 ext 102
(406) 245-4889 (fax)
WWW: MailTo:steve.strobel at link-comm.com

@_date: 2011-05-16 14:12:42
@_author: Steve Strobel 
@_subject: Why is "--allow-non-selfsigned-uid" needed to import this 
Thanks for the tip.  Just setting the date on the embedded device before importing the key made it work without "--allow-non-selfsigned-uid".
That still leaves me without a straightforward solution, though.  The embedded device doesn't have a battery-backed clock and doesn't need one.  It will sometimes have Internet access and could potentially use NTP when available to set the date.  That seems like a lot of extra complexity just to import a key.  The user interface doesn't make it easy to ask the user for the date.  What would the security implications be of just setting the clock to a fixed future date before importing the key?
[1] As an undergraduate Prof. Hill once mused to me, "Math is funny.  You
That is a great way to remember.  Now if remembering names was just as easy...
Thanks again,
Steve Strobel
Link Communications, Inc.
1035 Cerise Rd
Billings, MT 59101-7378
(406) 245-5002 ext 102
(406) 245-4889 (fax)
WWW: MailTo:steve.strobel at link-comm.com

@_date: 2011-05-17 08:31:20
@_author: Steve Strobel 
@_subject: Why is "--allow-non-selfsigned-uid" needed to import this 
That works perfectly.  Thanks a bunch.
Steve Strobel
Link Communications, Inc.
1035 Cerise Rd
Billings, MT 59101-7378
(406) 245-5002 ext 102
(406) 245-4889 (fax)
WWW: MailTo:steve.strobel at link-comm.com

@_date: 2014-03-07 16:29:16
@_author: Steve Strobel 
@_subject: Size of client key jumped from 2KB to 25KB 
We have a Windows application that automatically generates a key pair on
first startup (no passphrase), then sends its public key to a server.  It
exports its public key to a file with a command like this:
gpg --output client-key.gpg --export -a ID49C207DF
I recently got an error message caused by the keyfile it created exceeding
a 10 KB threshold in the application code.  It is normally 2 KB or 3 KB,
but in this case it was 25KB.  Its size apparently jumped suddenly rather
than growing slowly, or it would have errored out at 11 KB rather than at
25 KB.  The extra-large key file has typical GPG headers and footers, but a
lot more data between them than usual.
Renaming the gnupg directory (which forces it to generate a new key pair)
resolved the issue for now, but I would like to know what might have gone
wrong to make the public key so large.
In both cases, the info about the keys looks normal, something like this:
$ gpg --list-keys
C:/Documents and Settings/steve.strobel/Application Data/gnupg\pubring.gpg

@_date: 2014-03-10 09:36:18
@_author: Steve Strobel 
@_subject: Size of client key jumped from 2KB to 25KB 
Johan Wevers I would not have said so, but you are right.
On Sat, Mar 8, 2014 at 2:42 AM, Peter Lebbing Thanks for that command.  It does show a couple dozen additional sections
for the large key, sections like this:
:trust packet: flag=00 sigcache=03
:signature packet: algo 1, keyid E497A900BC02EE05
        version 4, created 1392850339, md5len 0, sigclass 0x13
        digest algo 2, begin of digest 15 d2
        hashed subpkt 2 len 4 (sig created 2014-02-19)
        hashed subpkt 27 len 1 (key flags: 2F)
        hashed subpkt 11 len 5 (pref-sym-algos: 9 8 7 3 2)
        hashed subpkt 21 len 3 (pref-hash-algos: 2 8 3)
        hashed subpkt 22 len 3 (pref-zip-algos: 2 3 1)
        hashed subpkt 30 len 1 (features: 01)
        hashed subpkt 23 len 1 (key server preferences: 80)
        subpkt 16 len 8 (issuer key ID E497A900BC02EE05)
        data: [2040 bits]
Our application doesn't use the trust system for much, but the client does
assign ultimate trust to the server's key.  Maybe it is doing that more
than once (such as each time the program is started).  It could skip that
step if it has already been done.  Is there a better way to check that than
to use --list-packets and parse the output?
When we export the public key with a command like "gpg --output
client-key.gpg --export -a ID49C207DF", is there a way to do so without the
signatures?  We send that key to the server so it can be used to encrypt
data for the client, but we don't really need to transfer any information
about how trusted the client is.  Does that make sense?  Now that I think
about it, the client key shouldn't have any signatures at all;  there is
nothing else in the system to attest to them.  I posted the complete
--list-packets (and --list-keys) output at the URLs below in case it is
Thanks, Peter and Johan, for your help.

@_date: 2014-03-11 13:11:15
@_author: Steve Strobel 
@_subject: Size of client key jumped from 2KB to 25KB 
Thanks, Olav and Pete, for the info about how to clean up the signatures.
 Adding the "--export-options export-minimal" option reduced the file to
the expected size.  So that is a great solution for the keys I already have.
I don't know why it would have, but I haven't looked specifically for that
to me,
Sure.  I will send you those keys by direct email.
