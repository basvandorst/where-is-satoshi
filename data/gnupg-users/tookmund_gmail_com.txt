
@_date: 2018-08-01 15:28:23
@_author: Jacob Adams 
@_subject: GPGME status callback not working for need entropy 
I've been trying to use the GPGME status callback to get an indication
of when the system is low on entropy, but I don't seem to get a callback
when such an even occurs. I've enabled full status and I get Pinentry
Launched status messages, so it seems to sort of be working. When
generating a key without enough randomness, the whole application just
locks up with no indication of what is happening. Is there anything else
I could query to inform the user of what's occurring in this scenario?

@_date: 2018-08-23 16:58:47
@_author: Jacob Adams 
@_subject: Fwd: GPGME status callback not working for need entropy 
Resending with a compressed log file since it ended up way bigger than I
-------- Forwarded Message --------
I have a progress callback installed but it's not reporting anything.
My progress callback currently looks like this:
def _progress(what, type, current, total, prog):
    if what == "primegen":
        prog.inc()
    else:
        _log.info(what+" "+type+" "+current+" "+total)
    if prog.gk.redraw:
        prog.screen.finish()
        prog.screen = newt.Screen()
        prog.recreate()
(_log is a Logger that logs to a file, and prog is a progress bar I
setup earlier)
But I don't have anything logged when the application runs out of
entropy. The progress callback is simply not called as far as I can
tell. So I was hoping I could maybe get something out of status, but I
guess not. Any idea why progress wouldn't be called?
I've captured a GPGME debug log from an affected system and attached it
below. It seems _gpgme_io_select is just waiting on some file
descriptor, probably for randomness that never arrives. This same test
system completely locked up on shutdown and had to be forced off. Not
sure if that's related but seems likely.

@_date: 2018-02-26 15:33:29
@_author: Jacob Adams 
@_subject: PGP Clean Room GSoC Mentoring 
Hello all,
I'm a prospective student for Debian's Google Summer of Code 2018 and
I am interested in working on a project that may be of interest to
those on this mailing list and that requires at least one more
co-mentor to move forward.
The biggest hurdle I faced when setting up my GPG key was creating and
storing it offline. Many live cds like TAILS can be manipulated for
this purpose, but are not designed for it and require quite a bit of
space for what is otherwise a relatively small amount of information.
I am looking to create a proper interface for a PGP Clean Room Live CD
that walks a user through setting up a set of USB flash drives or sd
cards as a raid disk, generating new GPG keys, storing them there, and
then exporting subkeys either on a separate USB stick or a security
key like a Yubikey. I'd also like to add the ability to do things like
revoke keys or extend expiration dates for them through the
application. You can see more of the ideas behind the project here:
Daniel Pocock has already agreed to be the primary mentor for this
project, but he will most likely be involved in at least one other
GSoC project. I've sent out a few emails in Debian but have received
no reply as yet so I'm reaching out to the wider open source
You can find the Mentor Guide here: Someone with experience in python, especially python's GPGME bindings,
would be much appreciated.

@_date: 2018-07-02 12:03:44
@_author: Jacob Adams 
@_subject: Generating NIST/Brainpool subkeys with GPGME 
Should I file a bug against GPGME? GPG? Not really sure where the
problem is here.
Some testing confirms that I just need to add "/ecdsa" when creating a
signing or authentication key.
Thanks for your help!

@_date: 2018-07-03 17:12:05
@_author: Jacob Adams 
@_subject: Pinentry: Inappropriate ioctl for device when getting smartcard 
I have a solution for this but it's definitely the wrong solution.
I've applied the following patch to pinentry to fix this problem:
--- a/pinentry/pinentry-curses.c
+++ b/pinentry/pinentry-curses.c
 -1187,7 +1187,8        alarm (pinentry->timeout);
     }
 +  if (pinentry->ttyname == NULL)
+    pinentry->ttyname = getenv("GPG_TTY");
   rc = dialog_run (pinentry, pinentry->ttyname, pinentry->ttytype);
   do_touch_file (pinentry);
   return rc;
Clearly this is not the right approach as it appears that gpg-agent is
supposed to handle the GPG_TTY variable. For some reason, it is simply
not passing it on to pinentry in this one case.
I've tried to reproduce this issue in a separate program but have been
unsuccessful. However it's consistently reproducible without this patch
in my program. Does anyone have an insight into why this patch would be

@_date: 2018-07-05 11:34:57
@_author: Jacob Adams 
@_subject: Pinentry: Inappropriate ioctl for device when getting smartcard 
I had been manually setting the Assuan context's homedir to ~/.gnupg by
accident (Was originally using a temporary directory, but that caused
all kinds of issues). Setting it to NULL instead appears to have fixed
the problem.

@_date: 2018-07-13 18:00:07
@_author: Jacob Adams 
@_subject: GPGME python bindings query 
(Redirecting to -users since that seems more appropriate)
Oh ok that makes a lot more sense now!
Most of what I know about GPG is just picked up from random Internet
tutorials of dubious quality so I end up with a very spotty
understanding of how all this works. Thank you for the clear overview.
Sorry random was the wrong word here. I meant only that the generation
of this revocation certificate seems to happen later than I would
expect. (Actually I was entirely wrong here about the order of events
anyway, see below.)
When I don't generate my own revocation certificate, I get a second
password prompt when generating the first subkey. I had been assuming
that this was for the revocation certificate, but some testing confirms
that the certificate already exists before this. I'm still not sure why
I would be getting a second prompt however. Any ideas?

@_date: 2018-07-27 16:23:54
@_author: Jacob Adams 
@_subject: Second unexplained pinentry when generating subkeys with GPGME 
When generating a new GPG master key and some subkeys with GPGME I
noticed some odd behavior. I get a second passphrase pinentry when
generating the first subkey and I don't know why. I initially thought it
was for creating the automatic revocation certificate, as it doesn't
seem to happen if I suppress the creation of the automatic one by
generating my own directly. However, the revocation certificate exists
before these passphrase prompts.
Does any know what might be happening here?

@_date: 2018-06-01 16:02:07
@_author: Jacob Adams 
@_subject: Pinentry: Permission Denied 
I've been getting the occasional "Pinentry: Permission Denied" error
when generating new keys with GPGME and leaving pinentry to get the
password instead of passing it directly (passphrase=True with the python
bindings). Typically a reboot will fix it but it's rather odd.
I've attached a couple logs. If there's something else I should be
logging to catch this error, please let me know.
Any ideas on what might be causing this?
A reboot usually fixes it but it's quite annoying.

@_date: 2018-06-12 13:03:52
@_author: Jacob Adams 
@_subject: Pinentry: Permission Denied 
That seems to be it. I was overriding getty and launching my own service
as a non-root user and tty1 was still owned by root
I've fixed permissions on the tty in ExecPreStart and haven't seen a
pinentry error since.

@_date: 2018-06-27 16:50:25
@_author: Jacob Adams 
@_subject: Pinentry: Inappropriate ioctl for device when getting smartcard PIN 
I've got another pinentry problem unfortunately.
The tty is owned by the correct user this time and $GPG_TTY is set
I have two gpgme contexts, one for openpgp and another for assuan
commands to the smartcard. Pinentry triggered by the openpgp context
works perfectly, but any pinentry launched in service of the assuan
context fails with the error in the subject. They're both using the same
gpg-agent launched shortly after the creation of the openpgp context
with gpgconf --launch gpg-agent.
The relevant logs are available at:
I'm really not sure what's going wrong here and any insight would be
much appreciated.

@_date: 2018-06-29 16:07:00
@_author: Jacob Adams 
@_subject: Generating NIST/Brainpool subkeys with GPGME 
It appears that one cannot currently generate NIST or Brainpool subkeys
with GPGME. Using GPG itself works fine with --expert, so am I missing
an option or is this simply not possible yet?
I've attached a simple test program and the output I get on my machine
is below:
./eccsubkeys rsa1024
GPGME Version: 1.11.1
GPG Version: 2.2.8
Master: 2D14FBF15919954E4334D451C67CB3237C3CFFF4
Signing: A8B50168D9051846A570445A5DD5249F5CD0825F
Encryption: F8D8B9A453E5A7E98F44CC029F8450A1638414BE
Authentication: 866E75EDC8BDEB4B5A4DBD62865FAF7AB6DE6367
./eccsubkeys nistp384
GPGME Version: 1.11.1
GPG Version: 2.2.8
Master: 27A05F867C37442B675CFC1B9C647EA952B0D156
GPGME: General error
./eccsubkeys brainpoolP384r1
GPGME Version: 1.11.1
GPG Version: 2.2.8
Master: 26B2C8D94AD12A160262C82FED06C709E119D584
GPGME: General error

@_date: 2018-06-29 19:45:16
@_author: Jacob Adams 
@_subject: Pinentry: Inappropriate ioctl for device when getting smartcard 
I've now done a bit of poking around into this.
Attached is the patch I used to try and get some information out of
It appears that tty_name is not being set, despite the fact that GPG_TTY
is set and thus gpg-agent has this information from the previous Context.
The above is still definitely true.

@_date: 2018-05-08 11:49:05
@_author: Jacob Adams 
@_subject: Python Bindings for GPGME 
I?m a GSoC student as well and I asked a similar question on the pki-clean-room-devel list. The relevant part of the response I got from Debian?s GPGME maintainer is quoted below,  the full message can be found here:
?If you want to use GnuPG with python3, please use python3-gpg (for
python2, use python-gpg).  These packages are built and shipped as part
of gpgme, which is maintained by the GnuPG developers.?
I?m not sure what platform you?re developing on but the python3-gpg package in Debian corresponds to the official Python GPGME bindings which are shipped with recent versions of GPGME. Hope this helps,

@_date: 2018-05-13 18:26:04
@_author: Jacob Adams 
@_subject: smartcards and GPGME 
Hello all,
As part of a program I'm writing this summer for GSoC, I'd like to be
able to both move gpg private keys to a smartcard and generate keys on
the smartcard from an application. While this can be done from gpg, it
doesn't look like I can do so from GPGME or any other wrappers that
exist. Have I missed something or is this simply not possible yet?
While I could wrap this functionality of gpg, I'd really prefer not to
and I'd rather not drop the user to a gpg prompt if I don't have to.

@_date: 2018-05-15 14:38:22
@_author: Jacob Adams 
@_subject: smartcards and GPGME 
Awesome! That's a bit more complex than I was hoping but better than
calling gpg directly. Thanks for the pointer!
That's also an option but I'll try the AssuanEngine first.

@_date: 2018-05-15 14:45:25
@_author: Jacob Adams 
@_subject: GPGME progress callback no current or total 
I was testing the progress callback of GPGME in python and got some
strange results.
I'm using GPGME v1.11.1
$ cat progresstest.py
import gpg, tempfile
# Borrowed from callbacks.py
def progress_stdout(what, type, current, total, hook=None):
tmp = tempfile.TemporaryDirectory()
ctx = gpg.Context(home_dir=tmp.name)
ctx.create_key("Test ", algorithm="rsa4096")
$ python3 progresstest.py
PROGRESS UPDATE: what = primegen, type = 46, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 46, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 46, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 46, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 46, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 46, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 46, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 46, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 46, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 46, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 46, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 46, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 46, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 46, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 46, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 46, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 46, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 46, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 46, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 46, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 43, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 43, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 43, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 43, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 43, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 46, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 46, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 46, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 43, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 43, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 43, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 43, current = 0, total = 0
PROGRESS UPDATE: what = primegen, type = 43, current = 0, total = 0
Aren't current and total supposed to indicate progress? Why might they
be zero?

@_date: 2018-05-30 11:22:43
@_author: Jacob Adams 
@_subject: GPGME export secret subkeys 
GPGME has export and import functions that work well as alternatives to
"gpg --import" and "gpg --export". However, looking through the
documentation I cannot find an equivalent to "gpg
--export-secret-subkeys". Have I missed something, or does such
functionality not yet exist?

@_date: 2018-05-31 11:25:41
@_author: Jacob Adams 
@_subject: GPGME export secret subkeys 
Ah ok thank you. That's definitely more sensible than having a function
for everything.
I'm using the python bindings and actually having a bit of trouble with
op_spawn. I've fallen back on setting GNUPGHOME and calling python's
subprocess.run which pretty much does the same thing.
The simple test case attached fails for me with:
Traceback (most recent call last):
  File "/tmp/opspawn.py", line 7, in     ctx.op_spawn(gpgbin, ['', '--version'], None, out, None, 0)
  File "/usr/local/lib/python3.6/dist-packages/gpg/core.py", line 151,
in wrapper
    return _funcwrap(self, *args)
  File "/usr/local/lib/python3.6/dist-packages/gpg/core.py", line 132,
in _funcwrap
    result = func(slf.wrapped, *args)
  File "/usr/local/lib/python3.6/dist-packages/gpg/gpgme.py", line 2267,
in gpgme_op_spawn
    return _gpgme.gpgme_op_spawn(ctx, file, argv, datain, dataout,
dataerr, flags)
TypeError: in method 'gpgme_op_spawn', argument 5 of type 'gpgme_data_t'
Like I said it's not really a problem since I'm using subprocess but I
thought I should report it nonetheless.

@_date: 2018-05-31 13:21:31
@_author: Jacob Adams 
@_subject: Problem signing git commits with smartcard key 
I think this is simply because you have the wrong key id in your command
(Thus "Invalid ID").
Assuming that the key on hkps.pool.sks-keyservers.net is correct, your
key id should be 9F18A093CF65F938E4C8EFA429E057516FE1BBF3, not
Hope this helps,
