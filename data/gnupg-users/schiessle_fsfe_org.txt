
@_date: 2006-12-20 16:04:33
@_author: Bjoern Schiessle 
@_subject: gpg smartcard: copy subkeys from backupt to a second card 
i have followed this howto[0] to set up my smartcard and to create a
backup of the subkeys.
Now i want to copy the subkeys from the backup to a second gpg
smartcard. Therefore i have copied the backup files back to my ~/.gnupg
directory and tried to move the subkeys with the command "keytocard" to
my second smartcard. But the process always stops with this message:
"gpg: secret key already stored on a card"
How can i copy the subkeys to a new card?
[0]

@_date: 2006-02-13 00:48:03
@_author: Bjoern Schiessle 
@_subject: gnupg cryptocard and cardman4040 
i have some problems with my gnupg cryptocard and pcmcia cardman4040.
Currently i'm using gnupg 1.4.2, but patched with the new driver for my
pcmcia card[0]. So i think the gnupg version should be ok for my needs.
If i try to decrypt a file without inserting the cryptocard i get a
message to insert the card. But after i have insert the card and proceed
i got this message:
$ gpg -d foo.gpg
gpg: anonymous recipient; trying secret key BD609BA5 ...
gpg: apdu_send_simple(0) failed: no card
Please insert the card and hit return or enter 'c' to cancel:
gpg: pcsc_connect failed: unknown reader (0x80100009)
gpg: card reader not available
*** glibc detected *** corrupted double-linked list: 0xb7e9b938 ***
As far as i know this occurs because pcscd is running. So i have stopped
the service and tried it again. Without pcsd i get this message after i
have insert the card:
$ gpg -d foo.gpg
gpg: anonymous recipient; trying secret key BD609BA5 ...
gpg: apdu_send_simple(0) failed: no card
Please insert the card and hit return or enter 'c' to cancel:
gpg: pcsc_establish_context failed: no service (0x8010001d)
gpg: card reader not available
gpg: anonymous recipient; trying secret key CDBCD48F ...
gpg: pcsc_establish_context failed: no service (0x8010001d)
gpg: card reader not available
gpg: anonymous recipient; trying secret key C6109924 ...
gpg: pcsc_establish_context failed: no service (0x8010001d)
gpg: card reader not available
gpg: encrypted with ELG-E key, ID 00000000
gpg: encrypted with RSA key, ID 00000000
gpg: decryption failed: secret key not available
Everything stops before i get a chance to insert the PIN.
If i insert the card before trying to encrypt the file i can insert at
least my PIN but also than i can't decrypt the file:
$ gpg -d kernel2.6.15.cardreader.gpg
gpg: anonymous recipient; trying secret key BD609BA5 ...
gpg: anonymous recipient; trying secret key CDBCD48F ...
gpg: anonymous recipient; trying secret key C6109924 ...
gpg: okay, we are the anonymous recipient.
gpg: encrypted with ELG-E key, ID 00000000
gpg: encrypted with RSA key, ID 00000000
Feb 11 21:23:12 localhost udevd[1028]: udevd.c: udevd event message
Feb 11 21:23:12 localhost udevd[1028]: udevd.c: seq 1011 queued, devpath
Feb 11 21:23:12 localhost udevd[1028]: udevd.c: seq 1011 forked, pid
4699, 0 seconds old
Feb 11 21:23:12 localhost cardmgr[4036]: unsupported card in socket 1
Feb 11 21:23:12 localhost udevd[1028]: udevd.c: seq 1011 exit, 0 seconds
Feb 11 21:23:12 localhost cardmgr[4036]:   product info: "OMNIKEY",
"CardMan 4040"
Feb 11 21:23:12 localhost cardmgr[4036]:   manfid: 0x0223, 0x0200
What's going wrong? Any hints?
[0]

@_date: 2006-07-06 08:55:47
@_author: Bjoern Schiessle 
@_subject: poldi and cardman4040 
i have tried to use libpam-poldi to login with my GnuPG smartcard.
On my PC everything works. I'm using Ubuntu Dapper, libpam-poldi
(version 0.3.0-4) from Debian Sid and the SPR532 card reader.
On my notebook I'm using Ubuntu Dapper too, but with a cardman4040.
GnuPG with the smartcard works: sign mails, encrypt/decrypt mails,
etc.. But if i try to set up poldi with:
poldi-ctrl --set-key
i get this error messages:
poldi-ctrl: pcsc_establish_context failed: no service (0x8010001d)
poldi-ctrl: Error: failed to open card: Card Error.
The only difference between PC and notebook should be the card reader.
Any idea what's going wrong? Maybe poldi doesn't work with the
