
@_date: 2003-02-25 23:27:02
@_author: Adi Linden 
@_subject: gnuPG and Php 
I am still new to gnupg but perhaps I can help. I read some info on it, one suggested piping the data to encrypt into gpg via stdin using     `echo $data | gpg ....`
Unfortunatly many nasty things happened when I did that, because i was sending a xml form to gpg. I suspect quoting got mixed up. Instead I used popen to write the data to gpg and output the data to a temporary file. I figured that even in scenary where the site is hosted on a shered server there is little risk in writing the ascii armored output of gpg to a file, since the webserver only has the public key but no private key.
Here's the php function I came up with. The global variables $email_recipients, $gpg_path and $gpg_home need to be set prior to calling this. $email_recipients is an array of recipient email addresses, $gpg_path is the path and name of gpg (i.e. /usr/bin/gpg) and $gpg_home is the directory containing the key ring.
 * enc_gpg -- encode data using gpg
 *            To make this work I open a pipe to gpg and write the output
 *            to a file. This should be safe since the private key to
 *            decrypt the file is nowhere on the server.
 *
 * &$data    - data is modified only on success
 * returns   - true on success
 */
function enc_gpg(&$data)
    global $email_recipients;
    global $gpg_path, $gpg_home;
    /* Create a temporary file name for gpg */
    $tmpfile = '/tmp/phpbasket_' . md5(uniqid(time()));
    /* Build the command line for gpg */
    $cmd  = $gpg_path . ' --always-trust --batch --no-tty -e -a ';
    $cmd .= ' --no-secmem-warning --homedir ' . $gpg_home;
    $cmd .= ' -o ' . $tmpfile;
    foreach ($email_recipients as $r) {
        $cmd .= ' -r ' . $r;
    }       /* Pipe data to gpg */
    $fp = (popen($cmd, 'w'));
    if (!$fp) {
        unlink($tmpfile);
        return false;
    }
    fwrite($fp, $data);
    pclose($fp);
    /* Read data from temporary file */
    $fp = (fopen($tmpfile, 'r'));
    if (!$fp) {
        unlink($tmpfile);
        return false;
    }
    $res = fread($fp, filesize($tmpfile));
    fclose($fp);
    unlink($tmpfile);
    /* Verify we have valid encrypted data */
    if(ereg("-----BEGIN PGP MESSAGE-----.*-----END PGP MESSAGE-----", $res)) {
        $data = $res;
        return true;
    }           return false;
}           Hope this is of use...

@_date: 2003-02-25 23:48:01
@_author: Adi Linden 
@_subject: Good read online read on gnupg? 
I am muddling my way through gnupg. I am successfully encrypting user data on a webserver which is attached to an email. I can also encrypt it once it's been received. Yeeeeepie...!!!
Now that my curiousity has been awakened, I am trying to understand how all this business with signing, trust and keyservers works. I read the "The GNU Privacy Handbook" and a few howtos. Unfortunately they're just that, guides on how to do it. I still don't understand the concept - how and why things are done.
Any suggestions on what's good to read?

@_date: 2003-02-25 23:55:01
@_author: Adi Linden 
@_subject: Windows XP and Outlook 2000 
I posess one WinXP box running Outlook 2000 (everything else is Linux or some *nix variant). I can't seem to get GPGExch_091 to work, it always crashes with some error or another at various stages of importing keys.
What other alternatives are there? Any thoughts about PGP v8.0 Peronal Edition, does it deal well with imported gnupg provate and public keys?
Adi

@_date: 2003-03-03 19:17:02
@_author: Adi Linden 
@_subject: Stripped down (minimalistic) gpg? 
Just wondering how I could build a small, minimalistic gpg binary. I need a small statically build gpg binary to run on a webserver. All it'll ever do is encrypt data using public keys. Don't need keyserver support or anything else fancy.
Anyone done that before that would share their experiences?

@_date: 2003-03-04 00:56:02
@_author: Adi Linden 
@_subject: Stripped down (minimalistic) gpg? 
Did the ./configure --disable-exec --disable-dynload --enable-minimal followed by a make LDFLAGS="-Wl,-static" and I got a working static gpg binary. Good stuff, thanks a bunch!

@_date: 2003-03-04 04:59:01
@_author: Adi Linden 
@_subject: What are subkeys for? 
Just creating some keys. Being able to have multiple uid's associated with the same key is great. But what is the purpose of subkeys? Just curious (wanting to learn :)
