
@_date: 2015-11-27 16:43:09
@_author: Charlie Brown 
@_subject: gpg-agent prompt slow to show up 
Hello everyone,
I'm new to gpg, and I'm trying the agent.
I noticed that when gpg needs to prompt me for pass phrase, the prompt
shows up about 15 seconds after I issue the command (e.g. gpg
--decrypt or git commit -S). The problem exists with both gpg
--use-agent and gpg2.
I then tried the --no-use-agent flag of gpg, and the cli prompt showed
up instantly, but sadly it doesn't not use the agent by its nature.
My colleagues say that they do not have such problem. Any idea, or how
can I look into this problem?
This is the output from gpg-agent --daemon -vv:
<-- Issue a command that will prompt for pass phrase -->
gpg-agent[6458]: handler 0x7f42eb30c700 for fd 5 started
gpg-agent[6458]: starting a new PIN Entry
<-- Long annoying delay -->
<-- Then the prompt show up -->
gpg-agent[6458]: handler 0x7f42ebb0d700 for fd 8 started
gpg-agent[6458]: socket is still served by this server
gpg-agent[6458]: handler 0x7f42ebb0d700 for fd 8 terminated
Here's the version of the gpg components:
gpg-agent 2.1.9
libgcrypt 1.6.4
gpg 1.4.19
gpg2 2.1.9
Wenxin Wang
Department of Electronic Engineering,
Tsinghua University,
Beijing 100084, P. R. China
Email?wangwx12 at mails.tsinghua.edu.cn

@_date: 2015-11-27 23:40:38
@_author: Charlie Brown 
@_subject: gpg-agent prompt slow to show up 
Sorry for the lack of information. I'm on Debian unstable, and
installed GnuPG using apt-get.
And (again) the version of gpg components:
gpg-agent  2.1.9
libgcrypt    1.6.4
gpg           1.4.19
gpg           2 2.1.9
Wenxin Wang
Department of Electronic Engineering,
Tsinghua University,
Beijing 100084, P. R. China
Email?wangwx12 at mails.tsinghua.edu.cn

@_date: 2015-11-28 11:33:34
@_author: Charlie Brown 
@_subject: gpg-agent prompt slow to show up 
Thank you for pointing to dbus, that is a good place to find out what
happens. And you are right, I'm using pinentry-gnome3 and there's a 25
second gap between
method call time=1448678135.935348 sender=:1.30 ->
destination=org.a11y.Bus serial=2 path=/org/a11y/bus;
interface=org.a11y.Bus; member=GetAddress
method call time=1448678160.965303 sender=:1.31 ->
destination=org.freedesktop.DBus serial=1 path=/org/freedesktop/DBus;
interface=org.freedesktop.DBus; member=Hello
And for me, there's *another* 25 second gap between
signal time=1448678160.983489 sender=org.freedesktop.DBus ->
destination=(null destination) serial=101 path=/org/freedesktop/DBus;
interface=org.freedesktop.DBus; member=NameOwnerChanged
   string ":1.32"
   string ":1.32"
   string ""
signal time=1448678185.987561 sender=org.freedesktop.DBus ->
destination=:1.31 serial=6 path=/org/freedesktop/DBus;
interface=org.freedesktop.DBus; member=NameLost
   string ":1.31"
So it's not 15 seconds, it's 50 seconds in all. I wish I had timed
this. If anyone is interested, the output from `dbus-monitor` between
a gpg command was triggered and the passphrase prompt showed up is
attached as `dbus-gpg.log`.
I removed at-spi2-core and save 25 seconds. But that's not a perfect solution.
Then I look deeper into the gnome-keyring bug. I removed ssh, pkcs11
and secret autostart for gnome-keyring in /etc/xdg/autostart (the
gnome-keyring-daemon still get launched by pam), and found that in the
first time the prompt showed up quickly (and the dbus log is attached
as `dbus-gpg-1.log`, that one still has the a11y problem), but
following ones have the same problem. I'm not familiar with dbus, but
comparing the two logs, it appears to me that gnome-keyring is setting
'org.gnome.keyring' to empty string. If anyone have seen the same
problem, please help me.
It seems that none of these two bugs is related to GnuPG. I will send
emails to a11y and gnome-keyring and see if they have any idea.
Thanks for your help!
Wenxin Wang
