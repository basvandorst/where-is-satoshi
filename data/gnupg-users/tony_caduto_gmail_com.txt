
@_date: 2016-03-19 13:06:51
@_author: Tony Caduto 
@_subject: win32 gpgme passphrase callback FD issues 
I have looked back in the list archives and did find some info about this
but no resolutions.
I am using FPC (free pascal) and have gpgme.dll working (currently using
older versions that don't require the pinentry support)
The problem I am having is with the passphrase call back.
Basically the win32 writefile function does not work, I did see in the docs
that a internal function
is available in newer versions called gpgme_io_writen
problem is I can't find a version that has that function exposed except the
newest which have that pinentry, I need to use this on a server and a
dialog popping up
to ask for the passphrase is not good.
I have tried this with verison 1.1.8 through 1.3.0 and they all fail.
What happens is it just goes into a loop calling back over and over that
the password was bad.
The only way I can get it to not hang is to close the file handle, then on
the next callback it fails because
the file handle is gone.
Does anyone know what is the newest version of gpgme.dll that still
supports the passphrase call back function?
Here is my FCP call back function:
(it gets called back and all params are populated but it just hangs after
returning 0.
   password:pchar;
   ret:dword;
   filehandle:windows.HANDLE;
   newline:pchar =      filehandle:=windows.HANDLE(fd);
     password:='coutweha';
     windows.WriteFile(filehandle,password,Length(password),ret,nil);
     windows.WriteFile(filehandle,newline,Length(newline),ret,nil);
     //windows.FlushFileBuffers(filehandle);   // Tried this to see if it
was not fully writing to handle.
     windows.CloseHandle(filehandle);    //Loops forever if you don't close
handle, errors out on second try because handle is closed.
     result.errorcode:=GPG_ERR_NO_ERROR;
     result.error:=GPG_ERR_NO_ERROR;;
     result.errorsource:=0;
