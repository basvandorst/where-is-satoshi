
@_date: 2011-04-14 04:43:07
@_author: Jesus Cea 
@_subject: Creating signatures with expiration time 
Hash: SHA1
Hi, everybody.
I have a corporate PGP key we use to sign employee keys to validate the
UID belonging to the corporation (that is, that the email present in the
key is actually assigned by us).
My idea was to create a signature with a expiration date, so signatures
should be renewed every year. The OpenPGP Standard documents this type
of signature , but
GPG doesn't seems to have the option to create them.
That is, when I create a signature, I have no way to introduce an
expiration date.
Am I missing anything?. I am using GPG 1.4.10. I would consider moving
to GPG 2 if necessary.
PS: We could manage with revocation signatures, but people would need to
refresh the keys. With a expired signatures people would need to refresh
to see the extension, so they would do.

@_date: 2011-04-14 11:45:07
@_author: Jesus Cea 
@_subject: Creating signatures with expiration time 
Hash: SHA1
Thanks, Daniel. Looking the manual, I see "--default-sig-expire" and
"--ask-sig-expire" too. What is the difference with "cert"?.
Maybe "cert" only ask for expiration when signing a key, while "sig"
always ask for an expiration for any kind of signature?

@_date: 2015-06-07 01:46:04
@_author: Jesus Cea 
@_subject: gpg 2.0.27 is updating the trustdb constantly, and taking minutes 
Upgraded to 2.0.28. No improvements in this area.
Any hint?.
I am surprised and dissapointed that 1.4.19 does this in 7 seconds and
2.0.27/2.0.28 are taking minutes. I am sure there is something "fishy"
going on.
Please, advice/hints.

@_date: 2015-03-27 17:07:44
@_author: Jesus Cea 
@_subject: gpg 2.0.27 is updating the trustdb constantly, and taking minutes 
I upgraded my GNUPG form 1.4.x to 2.0.27. I kept the configuration,
public and private keyrings. I have recreated the trustdb from scratch,
trying to solve this, with no success (using "--export-ownertrust").
My pubring.gpg is 34MB in size and I usually create local signatures via
My problem is that any change to the pubring, like downloading a new
key, refreshing, adding a new local signature with "--lsign", etc., will
force a trustdb update (in the next execution. For instance, decrypting
a private message). And that operation is VERY slow.
An example execution retrieving a new key from the keyservers:
jcea at ubuntu:/tmp$ time gpg2 --recv-keys 010D6F3A
gpg: requesting key 010D6F3A from hkp server pgp.rediris.es
gpg: DBG: armor-keys-failed (KEY 0x010D6F3A BEGIN
) ->0
gpg: DBG: armor-keys-failed (KEY 0x010D6F3A END
) ->0
gpg: key 010D6F3A: public key "dirk astrath (mobile key)
" imported
gpg: Note: signatures using the MD5 algorithm are rejected
gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model
gpg: depth: 0  valid:  21  signed:  96  trust: 0-, 0q, 0n, 0m, 0f, 21u
gpg: depth: 1  valid:  96  signed: 106  trust: 3-, 93q, 0n, 0m, 0f, 0u
gpg: next trustdb check due at 2015-04-08
gpg: Total number processed: 1
gpg:               imported: 1  (RSA: 1)
real	12m52.782s
user	9m27.720s
sys	1m43.040s
13 minutes!!.
As I said, my pubring.gpg is 34MB long. With gnupg 1.4.x it would take a
few seconds only.
Doing a "strace" I can confirm gnupg reprocessing the entire pubring file.
Forcing a "trustdb" update takes ages too:
jcea at ubuntu:/tmp$ time gpg2 --check-trustdb
gpg: Note: signatures using the MD5 algorithm are rejected
gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model
gpg: depth: 0  valid:  21  signed:  96  trust: 0-, 0q, 0n, 0m, 0f, 21u
gpg: depth: 1  valid:  96  signed: 106  trust: 3-, 93q, 0n, 0m, 0f, 0u
gpg: next trustdb check due at 2015-04-08
real	2m39.769s
user	1m9.620s
sys	0m14.200s
PS: Bonus: how to get rid of
gpg: DBG: armor-keys-failed (KEY 0x010D6F3A BEGIN
) ->0
gpg: DBG: armor-keys-failed (KEY 0x010D6F3A END
) ->0

@_date: 2015-03-29 19:41:15
@_author: Jesus Cea 
@_subject: gpg 2.0.27 is updating the trustdb constantly, and taking minutes 
I understand that, nice hack, but I used 1.4.19 until a week ago and
this recalculation was taking a few seconds. Now it is taking minutes.
Same configuration, same keyring files:
With 1.4 GPG:
jcea at ubuntu:~/video$ time gpg.OLD --update-trustdb
gpg: public key FBBB8AB1 is 58138 seconds newer than the signature
gpg: public key D3A42C61 is 2009 seconds newer than the signature
gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model
gpg: depth: 0  valid:  21  signed:  96  trust: 0-, 0q, 0n, 0m, 0f, 21u
gpg: depth: 1  valid:  96  signed: 116  trust: 0-, 96q, 0n, 0m, 0f, 0u
gpg: next trustdb check due at 2015-04-08
real	0m7.570s
user	0m6.800s
sys	0m0.440s
With 2.0.27 GPG:
jcea at ubuntu:~/video$ time gpg2 --update-trustdb
gpg: Note: signatures using the MD5 algorithm are rejected
gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model
gpg: depth: 0  valid:  21  signed:  96  trust: 0-, 0q, 0n, 0m, 0f, 21u
gpg: depth: 1  valid:  96  signed: 106  trust: 0-, 96q, 0n, 0m, 0f, 0u
gpg: next trustdb check due at 2015-04-08
real	1m27.370s
user	1m10.240s
sys	0m13.950s
Trustdb rebuild time has skyrocketed. Unless GPG 1.4 has a serious bug,
2.0.17 is doing something wrong. The sys time is interesting, looks like
GPG 2.0.27 is doing a lot of syscalls. I wonder if it is doing the
calculations several times, or what.
jcea at ubuntu:~/video$ gpg.OLD --version
gpg (GnuPG) 1.4.19
Copyright (C) 2015 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Home: ~/.gnupg
Supported algorithms:
Pubkey: RSA, RSA-E, RSA-S, ELG-E, DSA
Cipher: IDEA, 3DES, CAST5, BLOWFISH, AES, AES192, AES256, TWOFISH,
        CAMELLIA128, CAMELLIA192, CAMELLIA256
Hash: MD5, SHA1, RIPEMD160, SHA256, SHA384, SHA512, SHA224
Compression: Uncompressed, ZIP, ZLIB, BZIP2
Great. Thanks.
PS: Thanks for GNUPG!.
