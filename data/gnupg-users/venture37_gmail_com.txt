
@_date: 2011-06-13 19:12:43
@_author: Sevan / Venture37 
@_subject: Key generation on card fails with key sizes larger than 1024 bits 
I've still not made any progress with this on the *BSD side, however I
had the opportunity to try my SCR335 on a friends ThinkPad running
OpenSUSE 11.4, I was also unable to generate 2048bit keys on the card
there as well.
System details
openSUSE 11.4 (x86_64)
VERSION = 11.4
CODENAME = Celadon
Linux vader.site 2.6.37.6-0.5-desktop  SMP PREEMPT 2011-04-25
21:48:33 +0200 x86_64 x86_64 x86_64 GNU/Linux
gpg (GnuPG) 2.0.17
libgcrypt 1.4.6
Copyright (C) 2011 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Home: ~/.gnupg
Supported algorithms:
Pubkey: RSA, ELG, DSA
Cipher: 3DES, CAST5, BLOWFISH, AES, AES192, AES256, TWOFISH, CAMELLIA128,
       CAMELLIA192, CAMELLIA256
Hash: MD5, SHA1, RIPEMD160, SHA256, SHA384, SHA512, SHA224
Compression: Uncompressed, ZIP, ZLIB, BZIP2
S | Name         | Type    | Version    | Arch   | Repository
i | libusb-0_1-4 | package | 0.1.13-9.1 | x86_64 | openSUSE-11.4-Oss
Attempting to generate keys resulted in the following error:
scdaemon[5968]: please wait while key is being generated ...
scdaemon[5968]: ccid_transceive failed: (0x1000a)
scdaemon[5968]: apdu_send_simple(0) failed: card I/O error
scdaemon[5968]: generating key failed
So I configured scdaemon.conf with the values you suggested &
reattempted, below is a snippet from where it failed, I can post the
whole log file if required
2011-06-09 21:10:21 scdaemon[6556] please wait while key is being generated ...
2011-06-09 21:10:21 scdaemon[6556] DBG: ccid-driver: PC_to_RDR_XfrBlock:
2011-06-09 21:10:21 scdaemon[6556] DBG: ccid-driver:   dwLength ..........: 15
2011-06-09 21:10:21 scdaemon[6556] DBG: ccid-driver:   bSlot .............: 0
2011-06-09 21:10:21 scdaemon[6556] DBG: ccid-driver:   bSeq ..............: 140
2011-06-09 21:10:21 scdaemon[6556] DBG: ccid-driver:   bBWI ..............: 0x04
2011-06-09 21:10:21 scdaemon[6556] DBG: ccid-driver:   wLevelParameter
...: 0x0000
2011-06-09 21:10:21 scdaemon[6556] DBG: ccid-driver:   [0010]  00 00 0B 00 47 80
2011-06-09 21:10:21 scdaemon[6556] DBG: ccid-driver:   [0016]  00 00
00 02 B6 00 08 00 70
2011-06-09 21:10:21 scdaemon[6556] DBG: ccid-driver: RDR_to_PC_DataBlock:
2011-06-09 21:10:21 scdaemon[6556] DBG: ccid-driver:   dwLength ..........: 5
2011-06-09 21:10:21 scdaemon[6556] DBG: ccid-driver:   bSlot .............: 0
2011-06-09 21:10:21 scdaemon[6556] DBG: ccid-driver:   bSeq ..............: 140
2011-06-09 21:10:21 scdaemon[6556] DBG: ccid-driver:   bStatus ...........: 0
2011-06-09 21:10:21 scdaemon[6556] DBG: ccid-driver:   bChainParameter ...: 0x04
2011-06-09 21:10:21 scdaemon[6556] DBG: ccid-driver:   [0010]  00 C3 01 64 A6
2011-06-09 21:10:21 scdaemon[6556] DBG: ccid-driver: T=1: S-block
request received cmd=3
2011-06-09 21:10:21 scdaemon[6556] DBG: ccid-driver: T=1: waittime
extension of bwi=100
scdaemon[6556]: chan_7 -> S PROGRESS card_busy w 0 0
2011-06-09 21:10:21 scdaemon[6556] DBG: ccid-driver: PC_to_RDR_XfrBlock:
2011-06-09 21:10:21 scdaemon[6556] DBG: ccid-driver:   dwLength ..........: 5
2011-06-09 21:10:21 scdaemon[6556] DBG: ccid-driver:   bSlot .............: 0
2011-06-09 21:10:21 scdaemon[6556] DBG: ccid-driver:   bSeq ..............: 141
2011-06-09 21:10:21 scdaemon[6556] DBG: ccid-driver:   bBWI ..............: 0x04
2011-06-09 21:10:21 scdaemon[6556] DBG: ccid-driver:   wLevelParameter
...: 0x0000
2011-06-09 21:10:21 scdaemon[6556] DBG: ccid-driver:   [0010]  00 E3 01 64 86
2011-06-09 21:10:26 scdaemon[6556] DBG: ccid-driver: usb_bulk_read
error: Connection timed out
2011-06-09 21:10:26 scdaemon[6556] ccid_transceive failed: (0x1000a)
2011-06-09 21:10:26 scdaemon[6556] apdu_send_simple(0) failed: card I/O error
2011-06-09 21:10:26 scdaemon[6556] generating key failed
2011-06-09 21:10:26 scdaemon[6556] operation genkey result: Card error
scdaemon[6556]: chan_7 -> ERR 100663404 Card error 2011-06-09 21:10:26 scdaemon[6556] DBG: ccid-driver: usb_bulk_read
error: Connection timed out
2011-06-09 21:10:26 scdaemon[6556] DBG: ccid-driver: USB: CALLING USB_CLEAR_HALT
2011-06-09 21:10:27 scdaemon[6556] DBG: ccid-driver: bulk-in seqno
does not match (143/141)
2011-06-09 21:10:27 scdaemon[6556] DBG: ccid-driver: bulk-in seqno
does not match (143/142)
scdaemon[6556]: chan_7 <- RESTART
scdaemon[6556]: chan_7 -> OK
scdaemon[6556]: chan_7 <- [eof]
2011-06-09 21:10:32 scdaemon[6556] handler for fd -1 terminated
2011-06-09 21:10:32 scdaemon[6556] scdaemon (GnuPG) 2.0.17 stopped

@_date: 2011-06-16 17:40:59
@_author: Sevan / Venture37 
@_subject: Key generation on card fails with key sizes larger than 1024 bits 
Made a fresh install of Debian i386 6.0.1
with gpg 1.4.10 I was able to successfully generate 3072bit keys on
the card without any problems.
Now to roll back to FreeBSD 7 & try that.

@_date: 2011-06-17 16:12:43
@_author: Sevan / Venture37 
@_subject: Key generation on card fails with key sizes larger than 1024 bits 
Hi Werner,
I installed Debian i386 6.0.1 on my ThinkPad X61s, I can confirm I was
able to generate 3072bit keys on my openpgp v2 card using the Gemalto
PCMCIA card reader mentioned above.
Now onto FreeBSD 7.4 & to see how far that goes.

@_date: 2011-05-14 17:12:56
@_author: Sevan / Venture37 
@_subject: Key generation on card fails with key sizes larger than 1024 bits 
I purchased a v2 OpenPGP card for use with a SCM SCR335 card reader,
attempting to generate keys larger than 1024 bits fails, I've been
able to reproduce this consistently on MacOS 10.6.6, FreeBSD &
I was successfully able to complete the key generation process on
Windows, but the card was unreadable afterwards.
I had a brief attempt on OpenSUSE with gnupg 2.0.16 but that failed
flat out to even give me the card-status.
ccd_transceive_failed: (0x1000a)
apdu_send_simple(0) failed: card I/O error
I've set debug-all in my gpg-agent & scdaemon config files to get
better answers,
Attempting to generate 3072 bit keys l get an ERR 100663404 Card error Switching to 2048 bit keys, I can generate a signature key
successfully, then it fails after that,  switching down to 1024bit for
all keys results in the process completing successfully.
Any ideas on why the process fails?
Sevan / Venture37

@_date: 2011-05-17 18:39:25
@_author: Sevan / Venture37 
@_subject: Key generation on card fails with key sizes larger than 1024 bits 
Hi Werner
gpg (GnuPG) 2.0.17
libgcrypt 1.4.6
Copyright (C) 2011 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Home: ~/.gnupg
Supported algorithms:
Pubkey: RSA, ELG, DSA
Cipher: 3DES, CAST5, BLOWFISH, AES, AES192, AES256, TWOFISH, CAMELLIA128,
        CAMELLIA192, CAMELLIA256
Hash: MD5, SHA1, RIPEMD160, SHA256, SHA384, SHA512, SHA224
Compression: Uncompressed, ZIP, ZLIB, BZIP2
No, I assumed I didn't need to as the reader works fine with the
internal CCID driver (I can fetch card status, edit card details &
generate 1024bit keyson the card)
I have the first reader listed on:
scdaemon.log output on FreeBSD:
2011-05-17 17:55:44 scdaemon[95141] DBG: ccid-driver: T=1: waittime
extension of bwi=100
scdaemon[95141]: chan_7 -> S PROGRESS card_busy w 0 0
2011-05-17 17:55:44 scdaemon[95141] DBG: ccid-driver: PC_to_RDR_XfrBlock:
2011-05-17 17:55:44 scdaemon[95141] DBG: ccid-driver:   dwLength ..........: 5
2011-05-17 17:55:44 scdaemon[95141] DBG: ccid-driver:   bSlot .............: 0
2011-05-17 17:55:44 scdaemon[95141] DBG: ccid-driver:   bSeq ..............: 123
2011-05-17 17:55:44 scdaemon[95141] DBG: ccid-driver:   bBWI
..............: 0x04
2011-05-17 17:55:44 scdaemon[95141] DBG: ccid-driver:
wLevelParameter ...: 0x0000
2011-05-17 17:55:44 scdaemon[95141] DBG: ccid-driver:   [0010]  00 E3 01 64 86
2011-05-17 17:55:44 scdaemon[95141] DBG: ccid-driver: RDR_to_PC_DataBlock:
2011-05-17 17:55:44 scdaemon[95141] DBG: ccid-driver:   dwLength ..........: 5
2011-05-17 17:55:44 scdaemon[95141] DBG: ccid-driver:   bSlot .............: 0
2011-05-17 17:55:44 scdaemon[95141] DBG: ccid-driver:   bSeq ..............: 123
2011-05-17 17:55:44 scdaemon[95141] DBG: ccid-driver:   bStatus ...........: 0
2011-05-17 17:55:44 scdaemon[95141] DBG: ccid-driver:
bChainParameter ...: 0x04
2011-05-17 17:55:44 scdaemon[95141] DBG: ccid-driver:   [0010]  00 C3 01 64 A6
2011-05-17 17:55:44 scdaemon[95141] DBG: ccid-driver: T=1: S-block
request received cmd=3
2011-05-17 17:55:44 scdaemon[95141] DBG: ccid-driver: T=1: waittime
extension of bwi=100
2011-05-17 17:55:44 scdaemon[95141] DBG: ccid-driver: PC_to_RDR_XfrBlock:
2011-05-17 17:55:44 scdaemon[95141] DBG: ccid-driver:   dwLength ..........: 5
2011-05-17 17:55:44 scdaemon[95141] DBG: ccid-driver:   bSlot .............: 0
2011-05-17 17:55:44 scdaemon[95141] DBG: ccid-driver:   bSeq ..............: 124
2011-05-17 17:55:44 scdaemon[95141] DBG: ccid-driver:   bBWI
..............: 0x04
2011-05-17 17:55:44 scdaemon[95141] DBG: ccid-driver:
wLevelParameter ...: 0x0000
2011-05-17 17:55:44 scdaemon[95141] DBG: ccid-driver:   [0010]  00 E3 01 64 86
2011-05-17 17:55:49 scdaemon[95141] DBG: ccid-driver: usb_bulk_read
error: Device busy
2011-05-17 17:55:49 scdaemon[95141] ccid_transceive failed: (0x1000a)
2011-05-17 17:55:49 scdaemon[95141] apdu_send_simple(0) failed: card I/O error
2011-05-17 17:55:49 scdaemon[95141] generating key failed
2011-05-17 17:55:49 scdaemon[95141] operation genkey result: Card error
scdaemon[95141]: chan_7 -> ERR 100663404 Card error 2011-05-17 17:55:49 scdaemon[95141] DBG: ccid-driver: usb_bulk_read
error: Device busy
2011-05-17 17:55:49 scdaemon[95141] DBG: ccid-driver: USB: CALLING
2011-05-17 17:55:51 scdaemon[95141] DBG: ccid-driver: usb_bulk_read
error: Device busy
2011-05-17 17:55:51 scdaemon[95141] DBG: ccid-driver: USB: RETRYING
bulk_in AGAIN
2011-05-17 17:55:51 scdaemon[95141] DBG: ccid-driver: bulk-in seqno
does not match (127/125)
scdaemon[95141]: chan_7 <- RESTART
scdaemon[95141]: chan_7 -> OK
On OpenBSD:
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver: PC_to_RDR_XfrBlock:
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   dwLength ..........: 17
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   bSlot .............: 0
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   bSeq ..............: 124
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   bBWI
..............: 0x04
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:
wLevelParameter ...: 0x0000
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   [0010]  00 40
0D 00 20 00
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   [0016]  83 08
31 32 33 34 35 36 37 38 EE
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver: RDR_to_PC_DataBlock:
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   dwLength ..........: 6
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   bSlot .............: 0
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   bSeq ..............: 124
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   bStatus ...........: 0
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:
bChainParameter ...: 0x04
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   [0010]  00 00
02 90 00 92
2011-05-17 19:12:41 scdaemon[13770] please wait while key is being generated ...
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver: PC_to_RDR_XfrBlock:
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   dwLength ..........: 15
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   bSlot .............: 0
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   bSeq ..............: 125
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   bBWI
..............: 0x04
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:
wLevelParameter ...: 0x0000
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   [0010]  00 00
0B 00 47 80
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   [0016]  00 00
00 02 B6 00 08 00 70
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver: RDR_to_PC_DataBlock:
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   dwLength ..........: 5
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   bSlot .............: 0
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   bSeq ..............: 125
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   bStatus ...........: 0
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:
bChainParameter ...: 0x04
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   [0010]  00 C3 01 64 A6
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver: T=1: S-block
request received cmd=3
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver: T=1: waittime
extension of bwi=100
scdaemon[13770]: chan_7 -> S PROGRESS card_busy w 0 0
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver: PC_to_RDR_XfrBlock:
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   dwLength ..........: 5
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   bSlot .............: 0
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   bSeq ..............: 126
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   bBWI
..............: 0x04
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:
wLevelParameter ...: 0x0000
2011-05-17 19:12:41 scdaemon[13770] DBG: ccid-driver:   [0010]  00 E3 01 64 86
2011-05-17 19:12:48 scdaemon[13770] DBG: ccid-driver: usb_bulk_read
error: Connection timed out
2011-05-17 19:12:48 scdaemon[13770] ccid_transceive failed: (0x1000a)
2011-05-17 19:12:48 scdaemon[13770] apdu_send_simple(0) failed: card I/O error
2011-05-17 19:12:48 scdaemon[13770] generating key failed
2011-05-17 19:12:48 scdaemon[13770] operation genkey result: Card error
scdaemon[13770]: chan_7 -> ERR 100663404 Card error 2011-05-17 19:12:48 scdaemon[13770] DBG: ccid-driver: bulk-in seqno
does not match (127/126)

@_date: 2011-05-18 23:26:21
@_author: Sevan / Venture37 
@_subject: Key generation on card fails with key sizes larger than 1024 bits 
Hi Werner
I will try & give a Linux distro a spin but it's a  catch 22 situation
on the BSD front, it could likely be a USB stack problem, certainly
for FreeBSD, the implementation of libusb has diverged/lagged (i'm not
sure which tbh) where anything that depends on a recent version of
libusb is broken on anything newer than FreeBSD 7.x, this includes
pcscd which can't be built with USB support on newer versions.
However, I have just managed to pick up a Gemalto pcmcia card reader
(lenovo part # 41N3004) so I can give that a try instead, as soon as
I've worked out how to get it working with pcscd.

@_date: 2012-06-03 19:17:37
@_author: Sevan / Venture37 
@_subject: Problem: cannot generate / copy keys larger than 1024bit on my 
Hi Rob,
I was having the same issue on FreeBSD & recently manage to address
the issue, it turned out to be the internal CCID driver which was the
cause of the problem, what worked for me was to install pcsc-lite &
libccid, then set my ~/gnupg/scdaemon.conf as:
pcsc-driver libpcsclite.so
By disabling the insternal driver I was able to able to generate keys
up to 3072 bits on my v2 card using a SCM-335 card reader via
Sevan / Venture37

@_date: 2015-03-23 05:31:00
@_author: Sevan / Venture37 
@_subject: Clarification on advisories 
In the 1.4.19 announcement, the entry: "Fixed bugs related to bogus
keyrings." is the fix for CVE-2015-1606?
The following commit appears to be present in 1.4.19
Am I right in thinking the issues found through fuzzing which led to
the release of 2.1.2 still have not be back ported to previous
releases? certainly most of the changes in the commits highlighted are
applicable accounting for the change of line numbers.
Sevan / Venture37

@_date: 2015-03-23 10:05:28
@_author: Sevan / Venture37 
@_subject: Clarification on advisories 
Hi Werner,
Apologies, I bundled 2 enquiries about completely separate issues in one email.
Are the applicable parts of the issues highlighted here:
Backported to 2.0.27?
Sevan / Venture37
