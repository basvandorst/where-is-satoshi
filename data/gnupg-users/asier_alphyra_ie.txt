
@_date: 2003-10-29 21:58:11
@_author: Asier Urrutia 
@_subject: gpg:cannot open /dev/tty: No such device or address 
Hi all,
attachments from emails and decrypt them. If I run the perl script from a
bash$ cat mailbox | mbox-parser.pl
Reading passphrase from file descriptor 11
You need a passphrase to unlock the secret key for
user: "GPG user (GPG user's key) "
1024-bit ELG-E key, ID D49D1DBC, created 2003-10-28 (main key ID 7724AA8E)
passphrase output. I tried to redirect STDOUT to a log file, but doesn't
make any difference.
bash$ cat .procmailrc
:0 HB : user.procmail.lock
* ^To:.*user
gpg: Warning: using insecure memory!
gpg: cannot open /dev/tty: No such device or address
a terminal, but can't be found any and it fails. I'll enclose here the subroutine I'm using on the decryption, just in case somebody wants to know what I'm doing...
sub decrypting
  my $attachment  = $_[0];
  my $gnupg = GnuPG::Interface->new();
  $gnupg->options->hash_init( armor    => 1,
                              recipients => [ 'tj-cl-testing ]
                            );
  my ( $input, $output, $error, $passphrase_fh, $status_fh )
    = ( IO::Handle->new(),
        IO::Handle->new(),
        IO::Handle->new(),
        IO::Handle->new(),
        IO::Handle->new(),
      );
  my $handles = GnuPG::Handles->new( stdin      => $input,
                                     stdout     => $output,
                                     stderr     => $error,
                                     passphrase => $passphrase_fh,
                                     status     => $status_fh,
                                   );
  my $cipher_file = IO::File->new( "$attachment" );
  my $pid = $gnupg->decrypt( handles => $handles );
  print $passphrase_fh $passphrase;
  close $passphrase_fh;
  print $input $_ while <$cipher_file>;
  close $input;
  close $cipher_file;
  my     = <$output>;   # reading the output
  my  = <$error>;    # reading the error
  my   = <$status_fh>; # read the status info
  open(LOGFILE,">>$DECRLOG");
  my $date = `date`;
  chomp($date);
  print LOGFILE "\n$date -- $attachment decryption   print LOGFILE   print LOGFILE   close(LOGFILE);
open (SAVE,">$ATTACHLOC/$ATTACHMENT.decrypted");
print SAVE   # clean up...
  close $output;
  close $error;
  close $status_fh;
  waitpid $pid, 0;  # clean up the finished GnuPG process
Thanks a million,

@_date: 2003-10-29 23:26:21
@_author: Asier Urrutia 
@_subject: cannot open /dev/tty: No such device or address 
got it,
  defining meta_interactive => 0   in   $gnupg->options->hash_init
Thanks everybody!!!
