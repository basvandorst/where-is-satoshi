
@_date: 2002-12-10 16:26:02
@_author: Xavier Nodet 
@_subject: GPG support in Mahogany 
Hi all,
We are beginning to provide support for PGP operations in Mahogany[1],
an open-source cross-platform mail client. So far, we have only
verification of signatures (in ASCII armor format), and decryption of
messages, but this already leads to some questions.
A general first question: when I use --sign and --encrypt at the same
time, do I get a signed then encrypted message, the other way round, or
does it depend on the order of options on the command line?
My understanding is that encryption/signing layers can be artitrarily
nested. For example, a message could be signed, encrypted, then signed
again[2]. Is there a way to get such an S/E/S message in one step? Using
'-s -e -s' on the command line gives an error... Could GPG handle all
those nested levels in one step when given such a message?
I guess the answers are 'No' (except when -s and -e were used in the
same command), but I thought I'd better ask, just in case...
When a message is multiply signed as above, we should verify that the
signatures have actually been done with the same key: the point in
signing twice is to assert that the signer actually encrypted the
document himself, thus proving that he wanted the recipient to get it
(while, if a message is only signed then encrypted, the recipient could
decrypt it, then forward it re-encrypted to a third person without this
third person noticing that he was not the intended recipient).
This should not be very difficult to do.
Something more specific to mails. When a message is signed, we should
verify that the 'From:' header actually matches one of the IDs of the
signing key. This prevents an attacker from forging headers to make the
recipient believe he got the message from a third person.
Are there other things we should take into account to deal with the
'receive' part of GPG handling?
Thanks for your answers and comments.
[1] [2]  gives
    reasons to do that.

@_date: 2002-12-10 17:22:02
@_author: Xavier Nodet 
@_subject: GPG support in Mahogany 
What if I use several successive commands. For example, I can do this:
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

@_date: 2002-12-10 17:40:02
@_author: Xavier Nodet 
@_subject: GPG support in Mahogany 
I was not clear enough. I was only speaking about a warning (which could
be disabled) when the user *receives* a message. I had not thought about
a warning when sending a signed message.
I was wondering about the following: if signing messages becomes more
and more common, I guess people will more and more rely on the fact that
the signature is good, without checking that this signature is actually
from the correct person.
One could receive a forged mail in the name of its boss, that tells him
to do something, and that is actually signed by some key that does not
belong to his boss. I would like to help, as far as possible, to
recognize such a situation.
Actually, while writing this, I realize that such a key would most
probably not be trusted. Maybe this alone is a reason for this
discussion to be moot...
So I guess that making sure a message signed by an untrusted key is
displayed as such should be enough. Thanks for your input, and sorry for the fuss...

@_date: 2002-12-10 17:46:02
@_author: Xavier Nodet 
@_subject: GPG support in Mahogany 
No, but as I noticed while answering Michael Nahrath, either the key is
trusted, or it is not. There is not much to get from checking the
Thanks for you time.

@_date: 2002-12-10 18:39:17
@_author: Xavier Nodet 
@_subject: GPG support in Mahogany 
Could you point me to some document that describes this threat model,
please? I know I have much more to read than I already did.
Warn the user. I, as a developper of a mail client, do not want to
decide anything. But I do want to provide some information when it is
And please remember that I'm only considering the decrypt/verify
process. My objective is not at all to setup a way to send some
encrypted information, but to receive it in such a way that a user will
be warned when this is needed.
I want to detect it.
I want to provide as much information as possible to the user, who is
not necessarily a crypto-expert. And I am just beginning to use GPG for
myself, just enough to understand that doing cryptography the right way
is not necessarily easy.
Maybe I am completely off here. Maybe the sign-and-encrypt feature of
GPG is fundamentally different than first signing, then encrypting. I'd
be glad to learn that.
Do you consider to be part of those 'wildly announces'?

@_date: 2002-12-12 11:22:01
@_author: Xavier Nodet 
@_subject: GPG support in Mahogany 
I found this: . I will look at
I now see that, as you say below, this is a social problem I was trying
to solve. If I send some information to someone, there is no way I can
prevent him to do whatever he wants with this info.
I do not understand how a compromised machine in the path is a problem.
The reason to encrypt is exactly to make sure one does not have to
bother with that, no? Would you want to say that an external (w.r.t.
encryption) signature could be removed?
Yes. I see that now. Thanks for this enlightment.
It seems easy for sending: something like a checkbox in the 'Encrypt'
dialog would be enough, no?
Upon reception of an encrypted 'for your eyes only' message, we should
not allow the user to save the clear-text. Of course, this does not
really prevent anything, but it makes it clear that this was not what
the originator had in mind.
Is there anything else? BTW, is there some forum or mailing list
specifically devoted to those 'mail+crypto' problems?
I (or, rather, we) will try to do that.
Thanks again for your time.

@_date: 2002-12-12 11:47:01
@_author: Xavier Nodet 
@_subject: GPG support in Mahogany 
Oops, sorry! ;) Yes, yes...
If you forward the whole message, then the check should be against the
'forwarded headers'. This won't be so simple. Maybe simply displaying the primary ID of the signing key is enough,
after all...
Of course this would be optional.
We already have a pop-up menu when right-clicking an email address. It
should be easy to add a 'look-up public key' entry. Thanks for the

@_date: 2002-12-12 21:00:02
@_author: Xavier Nodet 
@_subject: GPG support in Mahogany 
I guess that for this setting, as for all other settings in Mahogany, we
would not force anything. There is no point in doing so, actually: the
user always as the possibility to workaround such forbidden things, so
why anger him...

@_date: 2002-12-17 09:29:01
@_author: Xavier Nodet 
@_subject: GPG support in Mahogany 
I now understand what Janusz wanted to say: I thought he was refering to
the MTA that the message passes through. Obviously, if the machine of
some recipient is compromised, everything can happen.
Thanks for the enlightment.

@_date: 2002-12-17 09:33:01
@_author: Xavier Nodet 
@_subject: problems on WINxp 
Your PATH environment variable should contain the directory where
gpg.exe is located. It seems not to be the case.
Click Start, right-click on 'My Computer', go to 'Advanced' tab, click
on 'Environment Variables'. 'PATH' is part of the System variables...
Hope this helps,

@_date: 2003-01-06 11:35:02
@_author: Xavier Nodet 
@_subject: No [GNUPG:] tag when 'not a detached signature' error 
I noticed, using GnuPG 1.2.1, that when there is an error because
a signature should have been detached, there is never a corresponding
message beginning with "[GNUPG:] ", although I use --status-fd.
I got this problem when trying to verify the signature of an ill-formed
PGP-MIME message, and parsing only the "[GNUPG:] " lines.
Here are steps to reproduce this problem.
C:\tmp>echo clear-text > message.txt
C:\tmp>gpg -a --sign message.txt
You need a passphrase to unlock the secret key
C:\tmp>gpg --status-fd=2 --command-fd 0 --verify message.asc message.txt
gpg: not a detached signature
I feel there should also be an output line like:
[GNUPG:] ERRSIG ...
Did I miss something?

@_date: 2003-01-06 22:19:02
@_author: Xavier Nodet 
@_subject: No [GNUPG:] tag when 'not a detached signature' error 
I know that, thanks. The problem is that this is a message that
I received (not me, actually, but this does not matter), not one that
I sent.
I would like that Mahogany, the mailer I use, can correctly report that
the message is not well-formed. Until now, we only had to check
"[GNUPG:] " lines. I would prefer to continue this way.
Thanks for your help.

@_date: 2003-01-07 12:33:02
@_author: Xavier Nodet 
@_subject: No [GNUPG:] tag when 'not a detached signature' error 
Of course! I was not asking for the detailed reason why the check
failed, but only to positively know that it failed: something like
'[GNUPG:] UNKNOWNERR'...
Yes, that's what we already do.
Thanks for your help.
