
@_date: 2008-08-14 21:42:01
@_author: Steve Revilak 
@_subject: Unable to run gpg command in JAVA 
The perl seems reasonable, but what does your java code look like? :)
If you gave the entire command line as a single string, then you're at
the mercy of java's tokenization of the command line.  For example,
the javadoc for java.lang.Runtime says this:
   More precisely, the command string is broken into tokens using a
   StringTokenizer created by the call new StringTokenizer(command) with
   no further modification of the character categories. The tokens
   produced by the tokenizer are then placed in the new string array
   cmdarray, in the same order.
My guess is that `"The', `Certificate', and `Key"', are being treated
as three separate arguments.
Try providing the command as a String[], e.g.
   String cmd[] = {
      "gpg",
     "--homedir",
     System.getProperty("user.dir") + File.separator + ".gnupg",
     "-s",
     "-u",
     "The Certificate Key"
   };
   runtime.exec(cmd);

@_date: 2008-08-19 20:49:50
@_author: Steve Revilak 
@_subject: Unable to run gpg command in JAVA 
nishant> open(COMMAND, "echo $text | gpg --homedir $ENV{HOME}/.gnupg -s -u \"The Certificate Key\" |");
srevilak> Try providing the command as a String[], e.g.
srevilak> srevilak>    String cmd[] = {
srevilak>       "gpg",
srevilak>      "--homedir",
srevilak>      System.getProperty("user.dir") + File.separator + ".gnupg",
srevilak>      "-s",
srevilak>      "-u",
srevilak>      "The Certificate Key"
srevilak>    };
srevilak> srevilak>    runtime.exec(cmd);
Harakiri> All of that is still not the right way to do it, what people
Harakiri> need to know about java is that Runtime.exec does not START
Harakiri> a shell - i.e. its not a bash or anything you are used.
Sorry, my java example was more incomplete than it should have been.
I was only trying to show how to preserve the integrity of
command-line arguments, and I completed glossed over the mechanics of
writing data to and reading data back from from the gpg process.
As you note, Runtime.exec does not start a shell; it's much closer in
spirit to C's execv than to perl's piped open.

@_date: 2008-02-06 10:27:13
@_author: Steve Revilak 
@_subject: Safe decryption with GnuPG? 
I was going to suggest
   gpg --decrypt file.gpg | grep "interesting stuff" | banner | less >/dev/null
but I'll try to be more serious. :)
Out of curiosity, what kind of a threat vector are you anticipating?
By reading your list of requirements, the ones I've extracted are
  * Access to sensitive data via system memory is a threat.
  * Access to sensitive data via the file system (i.e. by examining
    swap space) is a threat.
  * Access to sensitive data via the graphics system framebuffer is a
    threat.
  * Access to sensitive data via visual observation (someone sees the
    text on the screen, or takes a picture of the text on the screen)
    is a threat.
As someone else mentioned, this brings up a lot of issues in the area
of trusting the hardware, trusting the operating system and so fourth.
Granted, they are interesting issues, but my gut instinct tells me
that this problem might be easier to solve with physical security.
For example, the first three threats imply that the data has to leave
the system where it is being viewed.  Removing network access to that
system (unplug the ethernet cable, remove any wireless/bluetooth
hardware), would mitigate those threats, no?
As for threat  if you're viewing the data in a small, bare-walled,
locked room, you'd be able to tell (a) whether someone else was in the
room looking over your shoulder or (b) whether there was a camera
being pointed at your screen.
And if you don't trust the isolated computer in the small locked room,
you could even go as far as removing its hard drive -- you'd walk in
with a bootable CD that contained your encrypted file, boot up, read
what you needed, then halt.

@_date: 2008-02-06 10:03:09
@_author: Steve Revilak 
@_subject: Safe decryption with GnuPG? 
I was going to suggest
   gpg --decrypt file.gpg | grep "interesting stuff" | banner | less >/dev/null
but I'll try to be more serious. :)
Out of curiosity, what kind of a threat vector are you anticipating?
By reading your list of requirements, the ones I've extracted are
  * Access to sensitive data via system memory is a threat.
  * Access to sensitive data via the file system (i.e. by examining
    swap space) is a threat.
  * Access to sensitive data via the graphics system framebuffer is a
    threat.
  * Access to sensitive data via visual observation (someone sees the
    text on the screen, or takes a picture of the text on the screen)
    is a threat.
As someone else mentioned, this brings up a lot of issues in the area
of trusting the hardware, trusting the operating system and so fourth.
Granted, they are interesting issues, but my gut instinct tells me
that this problem might be easier to solve with physical security.
For example, the first three threats imply that the data has to leave
the system where it is being viewed.  Removing network access to that
system (unplug the ethernet cable, remove any wireless/bluetooth
hardware), would mitigate those threats, no?
As for threat  if you're viewing the data in a small, bare-walled,
locked room, you'd be able to tell (a) whether someone else was in the
room looking over your shoulder or (b) whether there was a camera
being pointed at your screen.
And if you don't trust the isolated computer in the small locked room,
you could even go as far as removing its hard drive -- you'd walk in
with a bootable CD that contained your encrypted file, boot up, read
what you needed, then halt.

@_date: 2008-02-19 21:19:39
@_author: Steve Revilak 
@_subject: pinentry stdin problems 
Hash: SHA1
I noticed a (slightly) similar thing when moving from gpg to gpg2, but
I happened to be going in the other direction.
Here's a small bit of text that was encrypted with gpg2 --armour

@_date: 2008-02-29 17:45:55
@_author: Steve Revilak 
@_subject: _almost_ working, now a command line question... 
Hash: SHA1
   echo o:\apricing\pass.txt
produce output of "o:\apricing\pass.txt"?
You might have better luck redirecting gpg's standard input from
pass.txt, like this:
   o:\utilities\gpg
       --homedir o:\utilities \
       --passphrase-fd 0  \
       --load-extension o:\utilities\idea.dll \
       -o "o:\apricing\morgan_cds_20080229.txt" \
       -d "o:\apricing\24476.txt.pgp" < o:\apricing\pass.txt
Also, be careful of extra whitespace in pass.txt.

@_date: 2008-03-20 20:41:12
@_author: Steve Revilak 
@_subject: Help with version gpg-agent on Mac-Tiger 
Hash: SHA1
Yes, I've been using gpg 2.0.8 on OSX 10.4.11 for about two months.  I
built it via the macports "gpg2" package.  I use gpg2/gpg-agent in
conjunction with Alpine (a curses-based MUA).
As a user, one of the first differences you'll see between gpg and
gpg2 is they way you're prompted for passphrases.  gpg 1.4.8 reads
passphrases directly from the terminal, but gpg2 hands the passphrase
reading off to a separate program called "pinentry".
As I understand things, gpg2 uses GPG_AGENT_INFO to figure out how to
talk to gpg-agent, and gpg-agent uses the GPG_TTY environment variable
to tell pinentry which tty to grab when prompting for a passphrase.
(I suppose gpg2 passes the value of GPG_TTY to the agent?)
If anyone can give a more accurate outline of gpg2 -> agent ->
pinentry communications, please chime in.
The macports gpg2 package only includes pinentry-ncurses.  For me, I'd
assume that means the passphrase prompt _has_ to come from a terminal.
Since I use a curses-based MUA, that's fine.  But I don't know how
well it would work for a Carbon app like Thunderbird.
Did your gpg2 build install any other pinentry programs?  You can try
running them directly, to see what kind of prompt shows up.  Here's a
description of pinentry's protocol
   Another question - are you starting thunderbird in a way that provides
access to the GPG_TTY and GPG_AGENT_INFO environment variables?  If
these environment variables are set in your shell and you start
Thunderbird via "open /Applications/Thunderbird.app", then Thunderbird
should see them.  (~/.MacOSX/environment.plist doesn't seem like a
good option for this).  gpg-agent's man page gives a pretty good
recipie for setting the environment variables.

@_date: 2008-03-20 20:49:16
@_author: Steve Revilak 
@_subject: Decyrption via scheduled task fails 
Hash: SHA1
Here's something you might try.  Let's your scheduled task is calling
a.bat.  Have it call b.bat, where b.bat is
    on
   a.bat > output.txt 2>&1
That should give you stdout and stderr from cmd.exe, as well as
You might also try checking for differences between the set of
environment variables your batch file sees under Windows task manager
vs the set of environment variables your batch file sees from an
interactive login session.

@_date: 2008-09-02 09:59:22
@_author: Steve Revilak 
@_subject: confusing message: 'no pinentry' 
Hash: SHA1
Is there a pinentry in root's path?  For example, on my system, I have
  $ type pinentry
  pinentry is /opt/local/bin/pinentry
This sounds like normal behavior for su.  "su -" is supposed to
simulate a full login of the target account; it discards most
environment.  By contrast, "su" (without the minus) doesn't discard
the environment.
The su(1) manpage on your system should give more specific about how
"su - " is handled.

@_date: 2008-09-02 10:32:49
@_author: Steve Revilak 
@_subject: confusing message: 'no pinentry' 
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
srevilak> This sounds like normal behavior for su.  "su -" is supposed
srevilak> to simulate a full login of the target account; it discards
srevilak> most environment.  By contrast, "su" (without the minus)
srevilak> doesn't discard the environment.
petr.uzel> I know all of this. My question was whether the gpg
petr.uzel> behavior under specified circumstances ('incorrect'
petr.uzel> GPG_AGENT_INFO env. variable) should not be adjusted
petr.uzel> somehow.
petr.uzel> petr.uzel> In other words, I know how to solve my issue (use 'su
petr.uzel> -'/unset GPG_AGENT_INFO/killall gpg-agent/whatever), but
petr.uzel> I'm uncertain that all other gpg users know it
petr.uzel> too. Especially when the message about missing pinentry is
petr.uzel> quite confusing.
Ah, sorry I misunderstood.

@_date: 2009-03-28 11:51:34
@_author: Steve Revilak 
@_subject: Signing all outgoing mails on MTA, not on MUA 
Hash: SHA1
grover> We'd like to be able to sign all our outgoing mails.
grover> But not on each client system, which would mean everyone has
grover> to install some plugin or gpg-aware mail client, but on the
grover> mailserver itself.
grover> This way nobody has to think about it and signing works
grover> transparently for everyone. We would have one key for all,
grover> like a corporate key.
cbabcock> The corporate value of public key cryptography is much more
cbabcock> readily attained using DKIM. Milter setup and key management
cbabcock> for signing DKIM mail is pretty straight forward. You place
cbabcock> your key in Text records in DNS. That establishes a
cbabcock> meaningful connection between the identity of the sender (or
cbabcock> at least ownership of the mail server) and the owner of the
cbabcock> domain. Setting up DKIM with Postfix was at least as easy as
cbabcock> setting up GPG with Claws and it makes an identity assertion
cbabcock> that is appropriate for a server environment.
I agree with Chris -- this seems like a good application for DKIM.
In addition to non-repudiation, some email service providers will be
much less likely to categorize DKIM-signed messages as spam (if that
kind of thing matters to you.)
One DKIM implementation I've used is
.  dkim-milter is very
straightforward to set up with sendmail, and I know of people who've
used it with postfix (configured as a mail filter.)
