
@_date: 2006-06-02 23:12:15
@_author: Volker Dormeyer 
@_subject: GnuPG Smartcard and Authentication Key  
* On Sun, 28 May 2006 23:12:34 +0200,
 * On Sun, 28 May 2006 16:30:55 -0400,
 >> Hello all,
 >>  >> recently I received a message which is encrypted with my public
 >> authentication key instead of my encryption key.
 >>  >> I wonder how this can happen, because I thought GnuPG does not use the
 >> authentication key as encryption key. Am I wrong?
 >>  >> Further, I am not able to decrypt the message. I tried it manually with
 >> "--try-all-secrets", but it doesn't seem to work. Basically it should
 >> work. I mean, I have the authentication private key.
 > This is unfortunately turning into a FAQ.  Basically, you've run into
 > an old PGP bug.  It was recently fixed (I don't recall exactly in what
 > version), but there are countless installations of PGP that predate
 > the fix.
 > This is what I read in the gnupg-users archive before I send the
 > question. I have to admit, I do not understand exactly, because I know
 > that the user who sent me the message is using GnuPG. It shows
 > -----BEGIN PGP MESSAGE-----
 > Version: GnuPG v1.2.5 (GNU/Linux)
Just thought a bit about it...
Is it possible, that GnuPG prior to version 1.4 was not able to
interpret those "key flags"? I didn't use an authentication with
versions prior to 1.4 for myself.
 > in the ASCII armored cipher text.
 > OpenPGP keys have "key flags" that indicate what a key is to be used
 > for (encryption, signing, or authentication).  GnuPG honors these
 > flags and will not encrypt to any key that isn't marked for
 > encryption.  The bug is that PGP is not properly looking at the key
 > and will happily encrypt to a signing or authentication key.
 > I am aware of the different "key flags". This was the reason why I
 > wondered how this could be happen.
 > As to what you can do about it, your best bet is to contact the sender
 > and ask for a retransmission encrypted to the proper key.  It might be
 > possible to write a program that can essentially trick the smartcard
 > into decrypting the message by pretending it is a signature that needs
 > to be verified but it depends on how exactly the card handles
 > signatures.  In any event, no such program exists today.

@_date: 2006-05-28 21:55:53
@_author: Volker Dormeyer 
@_subject: GnuPG Smartcard and Authentication Key 
Hello all,
recently I received a message which is encrypted with my public
authentication key instead of my encryption key.
I wonder how this can happen, because I thought GnuPG does not use the
authentication key as encryption key. Am I wrong?
Further, I am not able to decrypt the message. I tried it manually with
"--try-all-secrets", but it doesn't seem to work. Basically it should
work. I mean, I have the authentication private key.
Can somebody give me a hint?
Thanks and regards,

@_date: 2006-05-28 23:11:28
@_author: Volker Dormeyer 
@_subject: GnuPG Smartcard and Authentication Key  
Hi David,
thanks for the reply.
 * On Sun, 28 May 2006 16:30:55 -0400,
 >> Hello all,
 >>  >> recently I received a message which is encrypted with my public
 >> authentication key instead of my encryption key.
 >>  >> I wonder how this can happen, because I thought GnuPG does not use the
 >> authentication key as encryption key. Am I wrong?
 >>  >> Further, I am not able to decrypt the message. I tried it manually with
 >> "--try-all-secrets", but it doesn't seem to work. Basically it should
 >> work. I mean, I have the authentication private key.
 > This is unfortunately turning into a FAQ.  Basically, you've run into
 > an old PGP bug.  It was recently fixed (I don't recall exactly in what
 > version), but there are countless installations of PGP that predate
 > the fix.
This is what I read in the gnupg-users archive before I send the
question. I have to admit, I do not understand exactly, because I know
that the user who sent me the message is using GnuPG. It shows
-----BEGIN PGP MESSAGE-----
Version: GnuPG v1.2.5 (GNU/Linux)
in the ASCII armored cipher text.
 > OpenPGP keys have "key flags" that indicate what a key is to be used
 > for (encryption, signing, or authentication).  GnuPG honors these
 > flags and will not encrypt to any key that isn't marked for
 > encryption.  The bug is that PGP is not properly looking at the key
 > and will happily encrypt to a signing or authentication key.
I am aware of the different "key flags". This was the reason why I
wondered how this could be happen.
 > As to what you can do about it, your best bet is to contact the sender
 > and ask for a retransmission encrypted to the proper key.  It might be
 > possible to write a program that can essentially trick the smartcard
 > into decrypting the message by pretending it is a signature that needs
 > to be verified but it depends on how exactly the card handles
 > signatures.  In any event, no such program exists today.

@_date: 2007-12-10 21:55:12
@_author: Volker Dormeyer 
@_subject: Decryption using Smartcard using CCID and PCSCD driver 
Thank you, Werner.
I plan to try the version in SVN within the next days.
 * On Monday 10 December 2007 16:42:03,
 > it took quite some time but I fixed it today. The solution is in the SVN
 > and will go into 1.4.8 and 2.0.8.  Both to be released before Christmas.

@_date: 2007-11-01 08:07:25
@_author: Volker Dormeyer 
@_subject: Decryption using Smartcard using CCID and PCSCD driver 
I'm experiencing problems decrypting an email I received, recently.
Decryption of other emails, even from the same sender works fine.
Although the other recipients of this particular email don't seem
to have a problem with the decryption of it.
GPG tells me (recipients have been anonymised by xxxxxxxx,
except myself):
volker at freedom:~$ gpg -v email.asc
gpg: armor header: Version: GnuPG v2.0.5 (GNU/Linux)
gpg: public key is xxxxxxxx
gpg: public key is 9107C5AC
gpg: using subkey 9107C5AC instead of primary key DB5349DB
gpg: sending command `SCD PKDECRYPT' to agent failed: ec=6.131
gpg: public key is xxxxxxxx
gpg: public key is xxxxxxxx
gpg: using subkey xxxxxxxx instead of primary key xxxxxxxx
gpg: encrypted with 2048-bit RSA key, ID xxxxxxxx, created xxxxxxxx
      "other recipient "
gpg: using subkey xxxxxxxx instead of primary key xxxxxxxx
gpg: encrypted with 1024-bit RSA key, ID xxxxxxxx, created xxxxxxxx
      "other recipient "
gpg: using subkey 9107C5AC instead of primary key DB5349DB
gpg: encrypted with 1024-bit RSA key, ID 9107C5AC, created 2005-08-31
      "Volker Dormeyer "
gpg: public key decryption failed: general error
gpg: using subkey xxxxxxxx instead of primary key xxxxxxxx
gpg: encrypted with 1024-bit RSA key, ID xxxxxxxx, created xxxxxxxx
      "other recipient "
gpg: decryption failed: secret key not available
I've set the debug-level of scdaemon and gpg-agent to guru to receive
the following log:
volker at freedom:~$ watchgnupg --force .gnupg/log-socket >watchgnupg.log
[client at fd 6 connected]
[client at fd 7 connected]
  6 - 2007-11-01 07:39:32 gpg-agent[4052.6] DBG: -> OK Pleased to meet you
  6 - 2007-11-01 07:39:32 gpg-agent[4052.6] DBG: <- OPTION display=:0.0
  6 - 2007-11-01 07:39:32 gpg-agent[4052.6] DBG: -> OK
  6 - 2007-11-01 07:39:32 gpg-agent[4052.6] DBG: <- OPTION ttyname=/dev/pts/1
  6 - 2007-11-01 07:39:32 gpg-agent[4052.6] DBG: -> OK
  6 - 2007-11-01 07:39:32 gpg-agent[4052.6] DBG: <- OPTION ttytype=xterm
  7 - 2007-11-01 07:39:32 scdaemon[4213]: listening on socket `/tmp/gpg-glRCWp/S.scdaemon'
  7 - 2007-11-01 07:39:32 scdaemon[4213]: handler for fd -1 started
  6 - 2007-11-01 07:39:32 gpg-agent[4052.6] DBG: -> OK
  6 - 2007-11-01 07:39:32 gpg-agent[4052.6] DBG: <- OPTION lc-ctype=en_US.UTF-8
  6 - 2007-11-01 07:39:32 gpg-agent[4052.6] DBG: -> OK
  6 - 2007-11-01 07:39:32 gpg-agent[4052.6] DBG: <- OPTION lc-messages=en_US.UTF-8
  6 - 2007-11-01 07:39:32 gpg-agent[4052.6] DBG: -> OK
  6 - 2007-11-01 07:39:32 gpg-agent[4052.6] DBG: <- SCD SERIALNO openpgp
  6 - 2007-11-01 07:39:32 gpg-agent[4052]: no running SCdaemon - starting it
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver: using CCID reader 0 (ID=04E6:5115:60500033:0)
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver: idVendor: 04E6  idProduct: 5115  bcdDevice: 0514
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver: ChipCard Interface Descriptor:
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   bLength                54
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   bDescriptorType        33
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   bcdCCID              1.00
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   nMaxSlotIndex           0
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   bVoltageSupport         1  5.0V
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   dwProtocols             3  T=0 T=1
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   dwDefaultClock       4000
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   dwMaxiumumClock     12000
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   bNumClockSupported      0
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   dwDataRate           9600 bps
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   dwMaxDataRate      307200 bps
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   bNumDataRatesSupp.      0
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   dwMaxIFSD             252
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   dwSyncProtocols  00000000   7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   dwMechanical     00000000   7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   dwFeatures       000100BA
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:     Auto configuration based on ATR
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:     Auto voltage selection
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:     Auto clock change
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:     Auto baud rate change
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:     Auto PPS made by CCID
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:     TPDU level exchange
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   dwMaxCCIDMsgLen       263
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   bClassGetResponse    echo
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   bClassEnvelope       echo
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   wlcdLayout           none
  7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   bPINSupport             0   7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   bMaxCCIDBusySlots       1
  7 - 2007-11-01 07:39:33 scdaemon[4213]: DBG: ccid-driver: usb_bulk_read error: Resource temporarily unavailable
  7 - 2007-11-01 07:39:33 scdaemon[4213]: DBG: ccid-driver: USB: CALLING USB_CLEAR_HALT
  7 - 2007-11-01 07:39:34 scdaemon[4213]: DBG: ccid-driver: usb_bulk_read error: Resource temporarily unavailable
  7 - 2007-11-01 07:39:34 scdaemon[4213]: DBG: ccid-driver: USB: RETRYING bulk_in AGAIN
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver: usb_bulk_read error: Resource temporarily unavailable
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver: USB: RETRYING bulk_in AGAIN
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver: status: 00  error: 00  octet[9]: 00
  7 - 2007-11-01 07:39:35                data: 3B FA 13 00 FF 81 31 80 45 00 31 C1 73 C0 01 00 00 90 00 B1
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver: status: 00  error: 00  octet[9]: 01
  7 - 2007-11-01 07:39:35                data: 11 10 00 45 00 80 00
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver: GetParametes returned 82 07 00 00 00 00 05 00 00 01 11 10 00 45 00 80 00
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver:   protocol ..........: T=1
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver:   bmFindexDindex ....: 11
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver:   bmTCCKST1 .........: 10
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver:   bGuardTimeT1 ......: 00
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver:   bmWaitingIntegersT1: 45
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver:   bClockStop ........: 00
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver:   bIFSC .............: 128
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver:   bNadValue .........: 0
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver: sending 61 07 00 00 00 00 06 01 00 00 11 10 00 45 00 80 00
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver: status: 00  error: 00  octet[9]: 01
  7 - 2007-11-01 07:39:35                data: 11 10 00 45 00 80 00
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver: sending 6F 05 00 00 00 00 07 00 00 00 00 C1 01 FC 3C
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver: status: 00  error: 00  octet[9]: 00
  7 - 2007-11-01 07:39:35                data: 00 E1 01 FC 1C
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver: IFSD has been set to 252
  7 - 2007-11-01 07:39:35 scdaemon[4213]: reader slot 0: using ccid driver
  7 - 2007-11-01 07:39:35 scdaemon[4213]: slot 0: ATR=3B FA 13 00 FF 81 31 80 45 00 31 C1 73 C0 01 00 00 90 00 B1
  7 - 2007-11-01 07:39:35 scdaemon[4213.0] DBG: -> OK GNU Privacy Guard's Smartcard server ready
  6 - 2007-11-01 07:39:35 gpg-agent[4052]: DBG: first connection to SCdaemon established
  7 - 2007-11-01 07:39:35 scdaemon[4213]: updating status of slot 0 to 0x0007
  7 - 2007-11-01 07:39:35 scdaemon[4213.0] DBG: <- GETINFO socket_name
  7 - 2007-11-01 07:39:35 scdaemon[4213.0] DBG: -> D /tmp/gpg-glRCWp/S.scdaemon
  7 - 2007-11-01 07:39:35 scdaemon[4213.0] DBG: -> OK
  7 - 2007-11-01 07:39:35 scdaemon[4213.0] DBG: <- OPTION event-signal=12
  7 - 2007-11-01 07:39:35 scdaemon[4213.0] DBG: -> OK
  7 - 2007-11-01 07:39:35 scdaemon[4213.0] DBG: <- SERIALNO openpgp
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: send apdu: c=00 i=A4 p0=00 p1=0C lc=2 le=-1
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG:   APDU_data: 00 A4 00 0C 02 3F 00
  6 - 2007-11-01 07:39:35 gpg-agent[4052]: DBG: additional connections at `/tmp/gpg-glRCWp/S.scdaemon'
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver: sending 6F 0B 00 00 00 00 09 04 00 00 00 00 07 00 A4 00 0C 02 3F 00 92
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver: status: 00  error: 00  octet[9]: 04
  7 - 2007-11-01 07:39:35                data: 00 00 02 6B 00 69
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG:  response: sw=6B00  datalen=0
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: send apdu: c=00 i=A4 p0=04 p1=00 lc=6 le=-1
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG:   APDU_data: 00 A4 04 00 06 D2 76 00 01 24 01
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver: sending 6F 0F 00 00 00 00 0A 04 00 00 00 40 0B 00 A4 04 00 06 D2 76 00 01 24 01 6D
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver: status: 00  error: 00  octet[9]: 04
  7 - 2007-11-01 07:39:35                data: 00 40 16 6F 12 84 10 D2 76 00 01 24 01 01 01 00 01 00 00 02 EB 00 00 90 00 47
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG:  response: sw=9000  datalen=20
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG:      dump:  6F 12 84 10 D2 76 00 01 24 01 01 01 00 01 00 00 02 EB 00 00
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: send apdu: c=00 i=CA p0=00 p1=4F lc=-1 le=256
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG:   APDU_data: 00 CA 00 4F 00
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver: sending 6F 09 00 00 00 00 0B 04 00 00 00 00 05 00 CA 00 4F 00 80
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver: status: 00  error: 00  octet[9]: 04
  7 - 2007-11-01 07:39:35                data: 00 00 12 D2 76 00 01 24 01 01 01 00 01 00 00 02 EB 00 00 90 00 EA
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG:  response: sw=9000  datalen=16
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG:       dump:  D2 76 00 01 24 01 01 01 00 01 00 00 02 EB 00 00
  7 - 2007-11-01 07:39:35 scdaemon[4213]: AID: D2 76 00 01 24 01 01 01 00 01 00 00 02 EB 00 00
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: send apdu: c=00 i=CA p0=00 p1=C4 lc=-1 le=256
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG:   APDU_data: 00 CA 00 C4 00
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver: sending 6F 09 00 00 00 00 0C 04 00 00 00 40 05 00 CA 00 C4 00 4B
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver: status: 00  error: 00  octet[9]: 04
  7 - 2007-11-01 07:39:35                data: 00 40 09 00 FE FE FE 03 03 03 90 00 24
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG:  response: sw=9000  datalen=7
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG:       dump:  00 FE FE FE 03 03 03
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: send apdu: c=00 i=CA p0=00 p1=6E lc=-1 le=256
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG:   APDU_data: 00 CA 00 6E 00
  7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver: sending 6F 09 00 00 00 00 0D 04 00 00 00 00 05 00 CA 00 6E 00 A1
  7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG: ccid-driver: status: 00  error: 00  octet[9]: 04
  7 - 2007-11-01 07:39:36                data: 00 00 CA 4F 10 D2 76 00 01 24 01 01 01 00 01 00 00 02 EB 00 00 73 81 9D C0 01 78 C1 05 01 04 00 00 20 C2 05 01 04 00 00 20 C3 05 01 04 00 00 20 C4 07 00 FE FE FE 03 03 03 C5 3C 14 B6 61 3A 82 AF 0D D7 11 7D 6A 10 10 96 7F 77 2E 30 51 1B 82 E8 9C C3 85 F6 92 F8 40 50 64 36 36 40 86 9B 91 07 C5 AC B9 94 D5 C4 0C 93 39 16 15 FC 39 D9 96 36 0E 36 24 38 0E 54 C6 3C C4 85 A6 CD 7E C6 6E 9E EC 33 65 F2 70 F2 75 E4 C3 2F 6C A5 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 CD 0C 43 16 11 B6 43 16 13 0D 43 16 13 46 5E 06 76 6F 6C 6B 65 72 90 00 30
  7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG:  response: sw=9000  datalen=200
  7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG:       dump:  4F 10 D2 76 00 01 24 01 01 01 00 01 00 00 02 EB 00 00 73 81 9D C0 01 78 C1 05 01 04 00 00 20 C2 05 01 04 00 00 20 C3 05 01 04 00 00 20 C4 07 00 FE FE FE 03 03 03 C5 3C 14 B6 61 3A 82 AF 0D D7 11 7D 6A 10 10 96 7F 77 2E 30 51 1B 82 E8 9C C3 85 F6 92 F8 40 50 64 36 36 40 86 9B 91 07 C5 AC B9 94 D5 C4 0C 93 39 16 15 FC 39 D9 96 36 0E 36 24 38 0E 54 C6 3C C4 85 A6 CD 7E C6 6E 9E EC 33 65 F2 70 F2 75 E4 C3 2F 6C A5 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 CD 0C 43 16 11 B6 43 16 13 0D 43 16 13 46 5E 06 76 6F 6C 6B 65 72
  7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG: send apdu: c=00 i=CA p0=00 p1=5E lc=-1 le=256
  7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG:   APDU_data: 00 CA 00 5E 00
  7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG: ccid-driver: sending 6F 09 00 00 00 00 0E 04 00 00 00 40 05 00 CA 00 5E 00 D1
  7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG: ccid-driver: status: 00  error: 00  octet[9]: 04
  7 - 2007-11-01 07:39:36                data: 00 40 08 76 6F 6C 6B 65 72 90 00 D1
  7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG:  response: sw=9000  datalen=6
  7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG:       dump:  76 6F 6C 6B 65 72
  7 - 2007-11-01 07:39:36 scdaemon[4213.0] DBG: -> S SERIALNO D2760001240101010001000002EB0000 0
  7 - 2007-11-01 07:39:36 scdaemon[4213.0] DBG: -> OK
  6 - 2007-11-01 07:39:36 gpg-agent[4052.6] DBG: -> S SERIALNO D2760001240101010001000002EB0000 0
  6 - 2007-11-01 07:39:36 gpg-agent[4052.6] DBG: -> OK
  6 - 2007-11-01 07:39:36 gpg-agent[4052.6] DBG: <- SCD SETDATA FEF51A7BB7DC6A19710A98D918C3DD54DA95C1E0F72264276C97534B1A11B9D043149BD3DF00254F2FAADC6D6F5DBB1FA14C6DFD53EE6C7553BD71FBFAC9C8F1FD01F6097321F021D3D67F1DC3C7A9F2E43274CB3B8BD39E1B684B21AE01AAB6D216A6B7A3056D677997D84A3C34AC8267EC4A49AF726A56D35645B66C070B
  7 - 2007-11-01 07:39:36 scdaemon[4213.0] DBG: <- SETDATA FEF51A7BB7DC6A19710A98D918C3DD54DA95C1E0F72264276C97534B1A11B9D043149BD3DF00254F2FAADC6D6F5DBB1FA14C6DFD53EE6C7553BD71FBFAC9C8F1FD01F6097321F021D3D67F1DC3C7A9F2E43274CB3B8BD39E1B684B21AE01AAB6D216A6B7A3056D677997D84A3C34AC8267EC4A49AF726A56D35645B66C070B
  7 - 2007-11-01 07:39:36 scdaemon[4213.0] DBG: -> OK
  6 - 2007-11-01 07:39:36 gpg-agent[4052.6] DBG: -> OK
  6 - 2007-11-01 07:39:36 gpg-agent[4052.6] DBG: <- SCD PKDECRYPT D2760001240101010001000002EB0000/82E89CC385F692F8405064363640869B9107C5AC
  7 - 2007-11-01 07:39:36 scdaemon[4213.0] DBG: <- PKDECRYPT D2760001240101010001000002EB0000/82E89CC385F692F8405064363640869B9107C5AC
  7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG: send apdu: c=00 i=CA p0=00 p1=6E lc=-1 le=256
  7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG:   APDU_data: 00 CA 00 6E 00
  7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG: ccid-driver: sending 6F 09 00 00 00 00 0F 04 00 00 00 00 05 00 CA 00 6E 00 A1
  7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG: ccid-driver: status: 00  error: 00  octet[9]: 04
  7 - 2007-11-01 07:39:36                data: 00 00 CA 4F 10 D2 76 00 01 24 01 01 01 00 01 00 00 02 EB 00 00 73 81 9D C0 01 78 C1 05 01 04 00 00 20 C2 05 01 04 00 00 20 C3 05 01 04 00 00 20 C4 07 00 FE FE FE 03 03 03 C5 3C 14 B6 61 3A 82 AF 0D D7 11 7D 6A 10 10 96 7F 77 2E 30 51 1B 82 E8 9C C3 85 F6 92 F8 40 50 64 36 36 40 86 9B 91 07 C5 AC B9 94 D5 C4 0C 93 39 16 15 FC 39 D9 96 36 0E 36 24 38 0E 54 C6 3C C4 85 A6 CD 7E C6 6E 9E EC 33 65 F2 70 F2 75 E4 C3 2F 6C A5 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 CD 0C 43 16 11 B6 43 16 13 0D 43 16 13 46 5E 06 76 6F 6C 6B 65 72 90 00 30
  7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG:  response: sw=9000  datalen=200
  7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG:       dump:  4F 10 D2 76 00 01 24 01 01 01 00 01 00 00 02 EB 00 00 73 81 9D C0 01 78 C1 05 01 04 00 00 20 C2 05 01 04 00 00 20 C3 05 01 04 00 00 20 C4 07 00 FE FE FE 03 03 03 C5 3C 14 B6 61 3A 82 AF 0D D7 11 7D 6A 10 10 96 7F 77 2E 30 51 1B 82 E8 9C C3 85 F6 92 F8 40 50 64 36 36 40 86 9B 91 07 C5 AC B9 94 D5 C4 0C 93 39 16 15 FC 39 D9 96 36 0E 36 24 38 0E 54 C6 3C C4 85 A6 CD 7E C6 6E 9E EC 33 65 F2 70 F2 75 E4 C3 2F 6C A5 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 CD 0C 43 16 11 B6 43 16 13 0D 43 16 13 46 5E 06 76 6F 6C 6B 65 72
  7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG: asking for PIN 'PIN'
  7 - 2007-11-01 07:39:36 scdaemon[4213.0] DBG: -> INQUIRE NEEDPIN PIN
  6 - 2007-11-01 07:39:36 gpg-agent[4052]: starting a new PIN Entry
  6 - 2007-11-01 07:39:36 gpg-agent[4052]: DBG: connection to PIN entry established
  7 - 2007-11-01 07:39:48 scdaemon[4213.0] DBG: <- [ 44 20 33 31 31 32 38 32 00 00 00 00 ...(80 bytes skipped) ]
  7 - 2007-11-01 07:39:48 scdaemon[4213.0] DBG: <- END
  7 - 2007-11-01 07:39:48 scdaemon[4213]: DBG: send apdu: c=00 i=20 p0=00 p1=82 lc=6 le=-1
  7 - 2007-11-01 07:39:48 scdaemon[4213]: DBG:   APDU_data: 00 20 00 82 06 33 31 31 32 38 32
  7 - 2007-11-01 07:39:48 scdaemon[4213]: DBG: ccid-driver: sending 6F 0F 00 00 00 00 16 04 00 00 00 40 0B 00 20 00 82 06 33 31 31 32 38 32 E4
  7 - 2007-11-01 07:39:49 scdaemon[4213]: DBG: ccid-driver: status: 00  error: 00  octet[9]: 04
  7 - 2007-11-01 07:39:49                data: 00 40 02 90 00 D2
  7 - 2007-11-01 07:39:49 scdaemon[4213]: DBG:  response: sw=9000  datalen=0
  7 - 2007-11-01 07:39:49 scdaemon[4213]: DBG:      dump:    7 - 2007-11-01 07:39:49 scdaemon[4213]: DBG: send apdu: c=00 i=2A p0=80 p1=86 lc=128 le=256
  7 - 2007-11-01 07:39:49 scdaemon[4213]: DBG:   APDU_data: 00 2A 80 86 80 00 FE F5 1A 7B B7 DC 6A 19 71 0A 98 D9 18 C3 DD 54 DA 95 C1 E0 F7 22 64 27 6C 97 53 4B 1A 11 B9 D0 43 14 9B D3 DF 00 25 4F 2F AA DC 6D 6F 5D BB 1F A1 4C 6D FD 53 EE 6C 75 53 BD 71 FB FA C9 C8 F1 FD 01 F6 09 73 21 F0 21 D3 D6 7F 1D C3 C7 A9 F2 E4 32 74 CB 3B 8B D3 9E 1B 68 4B 21 AE 01 AA B6 D2 16 A6 B7 A3 05 6D 67 79 97 D8 4A 3C 34 AC 82 67 EC 4A 49 AF 72 6A 56 D3 56 45 B6 6C 07 0B
  7 - 2007-11-01 07:39:49 scdaemon[4213]: DBG: ccid-driver: sending 6F 84 00 00 00 00 17 04 00 00 00 20 80 00 2A 80 86 80 00 FE F5 1A 7B B7 DC 6A 19 71 0A 98 D9 18 C3 DD 54 DA 95 C1 E0 F7 22 64 27 6C 97 53 4B 1A 11 B9 D0 43 14 9B D3 DF 00 25 4F 2F AA DC 6D 6F 5D BB 1F A1 4C 6D FD 53 EE 6C 75 53 BD 71 FB FA C9 C8 F1 FD 01 F6 09 73 21 F0 21 D3 D6 7F 1D C3 C7 A9 F2 E4 32 74 CB 3B 8B D3 9E 1B 68 4B 21 AE 01 AA B6 D2 16 A6 B7 A3 05 6D 67 79 97 D8 4A 3C 34 AC 82 67 EC 4A 49 AF 72 6A 56 D3 56 99
  7 - 2007-11-01 07:39:49 scdaemon[4213]: DBG: ccid-driver: status: 00  error: 00  octet[9]: 04
  7 - 2007-11-01 07:39:49                data: 00 90 00 90
  7 - 2007-11-01 07:39:49 scdaemon[4213]: DBG: ccid-driver: sending 6F 09 00 00 00 00 18 04 00 00 00 40 05 45 B6 6C 07 0B D6
  7 - 2007-11-01 07:39:49 scdaemon[4213]: DBG: ccid-driver: status: 00  error: 00  octet[9]: 04
  7 - 2007-11-01 07:39:49                data: 00 00 02 69 85 EE
  7 - 2007-11-01 07:39:49 scdaemon[4213]: DBG:  response: sw=6985  datalen=0
  7 - 2007-11-01 07:39:49 scdaemon[4213]: operation decipher result: Conditions of use not satisfied
  6 - 2007-11-01 07:39:49 gpg-agent[4052.6] DBG: -> ERR 100663427 Conditions of use not satisfied   6 - 2007-11-01 07:39:49 gpg-agent[4052.6] DBG: <- BYE
  6 - 2007-11-01 07:39:49 gpg-agent[4052.6] DBG: -> OK closing connection
  6 - 2007-11-01 07:39:49 gpg-agent[4052]: handler 0x8092f90 for fd 6 terminated
  7 - 2007-11-01 07:39:49 scdaemon[4213]: card_create_signature failed: Conditions of use not satisfied
  7 - 2007-11-01 07:39:49 scdaemon[4213.0] DBG: -> ERR 100663427 Conditions of use not satisfied   7 - 2007-11-01 07:39:49 scdaemon[4213.0] DBG: <- RESTART
  7 - 2007-11-01 07:39:49 scdaemon[4213.0] DBG: -> OK
Does anybody have an idea on this?
The outcome is similiar to when I use the pcscd driver.

@_date: 2007-11-07 18:38:24
@_author: Volker Dormeyer 
@_subject: Decryption using Smartcard using CCID and PCSCD driver 
does nobody have an idea on this?
 * On Thursday 01 November 2007 08:07:25,
 > Hi,
 >
 > I'm experiencing problems decrypting an email I received, recently.
 > Decryption of other emails, even from the same sender works fine.
 > Although the other recipients of this particular email don't seem
 > to have a problem with the decryption of it.
 >
 > GPG tells me (recipients have been anonymised by xxxxxxxx,
 > except myself):
 >
 > volker at freedom:~$ gpg -v email.asc
 > gpg: armor header: Version: GnuPG v2.0.5 (GNU/Linux)
 > gpg: public key is xxxxxxxx
 > gpg: public key is 9107C5AC
 > gpg: using subkey 9107C5AC instead of primary key DB5349DB
 > gpg: sending command `SCD PKDECRYPT' to agent failed: ec=6.131
 > gpg: public key is xxxxxxxx
 > gpg: public key is xxxxxxxx
 > gpg: using subkey xxxxxxxx instead of primary key xxxxxxxx
 > gpg: encrypted with 2048-bit RSA key, ID xxxxxxxx, created xxxxxxxx
 >       "other recipient "
 > gpg: using subkey xxxxxxxx instead of primary key xxxxxxxx
 > gpg: encrypted with 1024-bit RSA key, ID xxxxxxxx, created xxxxxxxx
 >       "other recipient "
 > gpg: using subkey 9107C5AC instead of primary key DB5349DB
 > gpg: encrypted with 1024-bit RSA key, ID 9107C5AC, created 2005-08-31
 >       "Volker Dormeyer "
 > gpg: public key decryption failed: general error
 > gpg: using subkey xxxxxxxx instead of primary key xxxxxxxx
 > gpg: encrypted with 1024-bit RSA key, ID xxxxxxxx, created xxxxxxxx
 >       "other recipient "
 > gpg: decryption failed: secret key not available
 >
 > I've set the debug-level of scdaemon and gpg-agent to guru to receive
 > the following log:
 >
 > volker at freedom:~$ watchgnupg --force .gnupg/log-socket >watchgnupg.log
 > [client at fd 6 connected]
 > [client at fd 7 connected]
 >   6 - 2007-11-01 07:39:32 gpg-agent[4052.6] DBG: -> OK Pleased to meet you
 >   6 - 2007-11-01 07:39:32 gpg-agent[4052.6] DBG: <- OPTION display=:0.0
 >   6 - 2007-11-01 07:39:32 gpg-agent[4052.6] DBG: -> OK
 >   6 - 2007-11-01 07:39:32 gpg-agent[4052.6] DBG: <- OPTION
 > ttyname=/dev/pts/1 6 - 2007-11-01 07:39:32 gpg-agent[4052.6] DBG: -> OK
 >   6 - 2007-11-01 07:39:32 gpg-agent[4052.6] DBG: <- OPTION ttytype=xterm
 >   7 - 2007-11-01 07:39:32 scdaemon[4213]: listening on socket
 > `/tmp/gpg-glRCWp/S.scdaemon' 7 - 2007-11-01 07:39:32 scdaemon[4213]:
 > handler for fd -1 started 6 - 2007-11-01 07:39:32 gpg-agent[4052.6] DBG:
 > -> OK
 >   6 - 2007-11-01 07:39:32 gpg-agent[4052.6] DBG: <- OPTION
 > lc-ctype=en_US.UTF-8 6 - 2007-11-01 07:39:32 gpg-agent[4052.6] DBG: -> OK
 >   6 - 2007-11-01 07:39:32 gpg-agent[4052.6] DBG: <- OPTION
 > lc-messages=en_US.UTF-8 6 - 2007-11-01 07:39:32 gpg-agent[4052.6] DBG: ->
 > OK
 >   6 - 2007-11-01 07:39:32 gpg-agent[4052.6] DBG: <- SCD SERIALNO openpgp
 >   6 - 2007-11-01 07:39:32 gpg-agent[4052]: no running SCdaemon - starting
 > it 7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver: using CCID
 > reader 0 (ID=04E6:5115:60500033:0) 7 - 2007-11-01 07:39:32 scdaemon[4213]:
 > DBG: ccid-driver: idVendor: 04E6  idProduct: 5115  bcdDevice: 0514 7 -
 > 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver: ChipCard Interface
 > Descriptor: 7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   > bLength                54 7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG:
 > ccid-driver:   bDescriptorType        33 7 - 2007-11-01 07:39:32
 > scdaemon[4213]: DBG: ccid-driver:   bcdCCID              1.00 7 -
 > 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   nMaxSlotIndex      >      0 7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   > bVoltageSupport         1  5.0V 7 - 2007-11-01 07:39:32 scdaemon[4213]:
 > DBG: ccid-driver:   dwProtocols             3  T=0 T=1 7 - 2007-11-01
 > 07:39:32 scdaemon[4213]: DBG: ccid-driver:   dwDefaultClock       4000 7 -
 > 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   dwMaxiumumClock    >  12000 7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   > bNumClockSupported      0 7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG:
 > ccid-driver:   dwDataRate           9600 bps 7 - 2007-11-01 07:39:32
 > scdaemon[4213]: DBG: ccid-driver:   dwMaxDataRate      307200 bps 7 -
 > 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   bNumDataRatesSupp.
 >      0 7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   > dwMaxIFSD             252 7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG:
 > ccid-driver:   dwSyncProtocols  00000000 7 - 2007-11-01 07:39:32
 > scdaemon[4213]: DBG: ccid-driver:   dwMechanical     00000000 7 -
 > 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   dwFeatures       > 000100BA 7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:     > Auto configuration based on ATR 7 - 2007-11-01 07:39:32 scdaemon[4213]:
 > DBG: ccid-driver:     Auto voltage selection 7 - 2007-11-01 07:39:32
 > scdaemon[4213]: DBG: ccid-driver:     Auto clock change 7 - 2007-11-01
 > 07:39:32 scdaemon[4213]: DBG: ccid-driver:     Auto baud rate change 7 -
 > 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:     Auto PPS made by
 > CCID 7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:     TPDU
 > level exchange 7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   > dwMaxCCIDMsgLen       263 7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG:
 > ccid-driver:   bClassGetResponse    echo 7 - 2007-11-01 07:39:32
 > scdaemon[4213]: DBG: ccid-driver:   bClassEnvelope       echo 7 -
 > 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   wlcdLayout         >   none 7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG: ccid-driver:   > bPINSupport             0 7 - 2007-11-01 07:39:32 scdaemon[4213]: DBG:
 > ccid-driver:   bMaxCCIDBusySlots       1 7 - 2007-11-01 07:39:33
 > scdaemon[4213]: DBG: ccid-driver: usb_bulk_read error: Resource
 > temporarily unavailable 7 - 2007-11-01 07:39:33 scdaemon[4213]: DBG:
 > ccid-driver: USB: CALLING USB_CLEAR_HALT 7 - 2007-11-01 07:39:34
 > scdaemon[4213]: DBG: ccid-driver: usb_bulk_read error: Resource
 > temporarily unavailable 7 - 2007-11-01 07:39:34 scdaemon[4213]: DBG:
 > ccid-driver: USB: RETRYING bulk_in AGAIN 7 - 2007-11-01 07:39:35
 > scdaemon[4213]: DBG: ccid-driver: usb_bulk_read error: Resource
 > temporarily unavailable 7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG:
 > ccid-driver: USB: RETRYING bulk_in AGAIN 7 - 2007-11-01 07:39:35
 > scdaemon[4213]: DBG: ccid-driver: status: 00  error: 00  octet[9]: 00 7 -
 > 2007-11-01 07:39:35                data: 3B FA 13 00 FF 81 31 80 45 00 31
 > C1 73 C0 01 00 00 90 00 B1 7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG:
 > ccid-driver: status: 00  error: 00  octet[9]: 01 7 - 2007-11-01 07:39:35   >              data: 11 10 00 45 00 80 00 7 - 2007-11-01 07:39:35
 > scdaemon[4213]: DBG: ccid-driver: GetParametes returned 82 07 00 00 00 00
 > 05 00 00 01 11 10 00 45 00 80 00 7 - 2007-11-01 07:39:35 scdaemon[4213]:
 > DBG: ccid-driver:   protocol ..........: T=1 7 - 2007-11-01 07:39:35
 > scdaemon[4213]: DBG: ccid-driver:   bmFindexDindex ....: 11 7 - 2007-11-01
 > 07:39:35 scdaemon[4213]: DBG: ccid-driver:   bmTCCKST1 .........: 10 7 -
 > 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver:   bGuardTimeT1
 > ......: 00 7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver:   > bmWaitingIntegersT1: 45 7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG:
 > ccid-driver:   bClockStop ........: 00 7 - 2007-11-01 07:39:35
 > scdaemon[4213]: DBG: ccid-driver:   bIFSC .............: 128 7 -
 > 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver:   bNadValue
 > .........: 0 7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver:
 > sending 61 07 00 00 00 00 06 01 00 00 11 10 00 45 00 80 00 7 - 2007-11-01
 > 07:39:35 scdaemon[4213]: DBG: ccid-driver: status: 00  error: 00  > octet[9]: 01 7 - 2007-11-01 07:39:35                data: 11 10 00 45 00
 > 80 00 7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver: sending 6F
 > 05 00 00 00 00 07 00 00 00 00 C1 01 FC 3C 7 - 2007-11-01 07:39:35
 > scdaemon[4213]: DBG: ccid-driver: status: 00  error: 00  octet[9]: 00 7 -
 > 2007-11-01 07:39:35                data: 00 E1 01 FC 1C
 >   7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver: IFSD has been
 > set to 252 7 - 2007-11-01 07:39:35 scdaemon[4213]: reader slot 0: using
 > ccid driver 7 - 2007-11-01 07:39:35 scdaemon[4213]: slot 0: ATR=3B FA 13
 > 00 FF 81 31 80 45 00 31 C1 73 C0 01 00 00 90 00 B1 7 - 2007-11-01 07:39:35
 > scdaemon[4213.0] DBG: -> OK GNU Privacy Guard's Smartcard server ready 6 -
 > 2007-11-01 07:39:35 gpg-agent[4052]: DBG: first connection to SCdaemon
 > established 7 - 2007-11-01 07:39:35 scdaemon[4213]: updating status of
 > slot 0 to 0x0007 7 - 2007-11-01 07:39:35 scdaemon[4213.0] DBG: <- GETINFO
 > socket_name 7 - 2007-11-01 07:39:35 scdaemon[4213.0] DBG: -> D
 > /tmp/gpg-glRCWp/S.scdaemon 7 - 2007-11-01 07:39:35 scdaemon[4213.0] DBG:
 > -> OK
 >   7 - 2007-11-01 07:39:35 scdaemon[4213.0] DBG: <- OPTION event-signal=12
 >   7 - 2007-11-01 07:39:35 scdaemon[4213.0] DBG: -> OK
 >   7 - 2007-11-01 07:39:35 scdaemon[4213.0] DBG: <- SERIALNO openpgp
 >   7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: send apdu: c=00 i=A4 p0=00
 > p1=0C lc=2 le=-1 7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG:   APDU_data:
 > 00 A4 00 0C 02 3F 00 6 - 2007-11-01 07:39:35 gpg-agent[4052]: DBG:
 > additional connections at `/tmp/gpg-glRCWp/S.scdaemon' 7 - 2007-11-01
 > 07:39:35 scdaemon[4213]: DBG: ccid-driver: sending 6F 0B 00 00 00 00 09 04
 > 00 00 00 00 07 00 A4 00 0C 02 3F 00 92 7 - 2007-11-01 07:39:35
 > scdaemon[4213]: DBG: ccid-driver: status: 00  error: 00  octet[9]: 04 7 -
 > 2007-11-01 07:39:35                data: 00 00 02 6B 00 69
 >   7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG:  response: sw=6B00  > datalen=0 7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: send apdu: c=00
 > i=A4 p0=04 p1=00 lc=6 le=-1 7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG:   > APDU_data: 00 A4 04 00 06 D2 76 00 01 24 01 7 - 2007-11-01 07:39:35
 > scdaemon[4213]: DBG: ccid-driver: sending 6F 0F 00 00 00 00 0A 04 00 00 00
 > 40 0B 00 A4 04 00 06 D2 76 00 01 24 01 6D 7 - 2007-11-01 07:39:35
 > scdaemon[4213]: DBG: ccid-driver: status: 00  error: 00  octet[9]: 04 7 -
 > 2007-11-01 07:39:35                data: 00 40 16 6F 12 84 10 D2 76 00 01
 > 24 01 01 01 00 01 00 00 02 EB 00 00 90 00 47 7 - 2007-11-01 07:39:35
 > scdaemon[4213]: DBG:  response: sw=9000  datalen=20 7 - 2007-11-01
 > 07:39:35 scdaemon[4213]: DBG:      dump:  6F 12 84 10 D2 76 00 01 24 01 01
 > 01 00 01 00 00 02 EB 00 00 7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG:
 > send apdu: c=00 i=CA p0=00 p1=4F lc=-1 le=256 7 - 2007-11-01 07:39:35
 > scdaemon[4213]: DBG:   APDU_data: 00 CA 00 4F 00 7 - 2007-11-01 07:39:35
 > scdaemon[4213]: DBG: ccid-driver: sending 6F 09 00 00 00 00 0B 04 00 00 00
 > 00 05 00 CA 00 4F 00 80 7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG:
 > ccid-driver: status: 00  error: 00  octet[9]: 04 7 - 2007-11-01 07:39:35   >              data: 00 00 12 D2 76 00 01 24 01 01 01 00 01 00 00 02 EB 00
 > 00 90 00 EA 7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG:  response:
 > sw=9000  datalen=16 7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG:       > dump:  D2 76 00 01 24 01 01 01 00 01 00 00 02 EB 00 00 7 - 2007-11-01
 > 07:39:35 scdaemon[4213]: AID: D2 76 00 01 24 01 01 01 00 01 00 00 02 EB 00
 > 00 7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: send apdu: c=00 i=CA p0=00
 > p1=C4 lc=-1 le=256 7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG:   > APDU_data: 00 CA 00 C4 00 7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG:
 > ccid-driver: sending 6F 09 00 00 00 00 0C 04 00 00 00 40 05 00 CA 00 C4 00
 > 4B 7 - 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver: status: 00  > error: 00  octet[9]: 04 7 - 2007-11-01 07:39:35                data: 00 40
 > 09 00 FE FE FE 03 03 03 90 00 24 7 - 2007-11-01 07:39:35 scdaemon[4213]:
 > DBG:  response: sw=9000  datalen=7 7 - 2007-11-01 07:39:35 scdaemon[4213]:
 > DBG:       dump:  00 FE FE FE 03 03 03 7 - 2007-11-01 07:39:35
 > scdaemon[4213]: DBG: send apdu: c=00 i=CA p0=00 p1=6E lc=-1 le=256 7 -
 > 2007-11-01 07:39:35 scdaemon[4213]: DBG:   APDU_data: 00 CA 00 6E 00 7 -
 > 2007-11-01 07:39:35 scdaemon[4213]: DBG: ccid-driver: sending 6F 09 00 00
 > 00 00 0D 04 00 00 00 00 05 00 CA 00 6E 00 A1 7 - 2007-11-01 07:39:36
 > scdaemon[4213]: DBG: ccid-driver: status: 00  error: 00  octet[9]: 04 7 -
 > 2007-11-01 07:39:36                data: 00 00 CA 4F 10 D2 76 00 01 24 01
 > 01 01 00 01 00 00 02 EB 00 00 73 81 9D C0 01 78 C1 05 01 04 00 00 20 C2 05
 > 01 04 00 00 20 C3 05 01 04 00 00 20 C4 07 00 FE FE FE 03 03 03 C5 3C 14 B6
 > 61 3A 82 AF 0D D7 11 7D 6A 10 10 96 7F 77 2E 30 51 1B 82 E8 9C C3 85 F6 92
 > F8 40 50 64 36 36 40 86 9B 91 07 C5 AC B9 94 D5 C4 0C 93 39 16 15 FC 39 D9
 > 96 36 0E 36 24 38 0E 54 C6 3C C4 85 A6 CD 7E C6 6E 9E EC 33 65 F2 70 F2 75
 > E4 C3 2F 6C A5 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 > 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 CD 0C 43 16 11
 > B6 43 16 13 0D 43 16 13 46 5E 06 76 6F 6C 6B 65 72 90 00 30 7 - 2007-11-01
 > 07:39:36 scdaemon[4213]: DBG:  response: sw=9000  datalen=200 7 -
 > 2007-11-01 07:39:36 scdaemon[4213]: DBG:       dump:  4F 10 D2 76 00 01 24
 > 01 01 01 00 01 00 00 02 EB 00 00 73 81 9D C0 01 78 C1 05 01 04 00 00 20 C2
 > 05 01 04 00 00 20 C3 05 01 04 00 00 20 C4 07 00 FE FE FE 03 03 03 C5 3C 14
 > B6 61 3A 82 AF 0D D7 11 7D 6A 10 10 96 7F 77 2E 30 51 1B 82 E8 9C C3 85 F6
 > 92 F8 40 50 64 36 36 40 86 9B 91 07 C5 AC B9 94 D5 C4 0C 93 39 16 15 FC 39
 > D9 96 36 0E 36 24 38 0E 54 C6 3C C4 85 A6 CD 7E C6 6E 9E EC 33 65 F2 70 F2
 > 75 E4 C3 2F 6C A5 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 > 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 CD 0C 43 16
 > 11 B6 43 16 13 0D 43 16 13 46 5E 06 76 6F 6C 6B 65 72 7 - 2007-11-01
 > 07:39:36 scdaemon[4213]: DBG: send apdu: c=00 i=CA p0=00 p1=5E lc=-1
 > le=256 7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG:   APDU_data: 00 CA 00
 > 5E 00 7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG: ccid-driver: sending 6F
 > 09 00 00 00 00 0E 04 00 00 00 40 05 00 CA 00 5E 00 D1 7 - 2007-11-01
 > 07:39:36 scdaemon[4213]: DBG: ccid-driver: status: 00  error: 00  > octet[9]: 04 7 - 2007-11-01 07:39:36                data: 00 40 08 76 6F
 > 6C 6B 65 72 90 00 D1 7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG:  > response: sw=9000  datalen=6 7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG:  >      dump:  76 6F 6C 6B 65 72 7 - 2007-11-01 07:39:36 scdaemon[4213.0]
 > DBG: -> S SERIALNO D2760001240101010001000002EB0000 0 7 - 2007-11-01
 > 07:39:36 scdaemon[4213.0] DBG: -> OK
 >   6 - 2007-11-01 07:39:36 gpg-agent[4052.6] DBG: -> S SERIALNO
 > D2760001240101010001000002EB0000 0 6 - 2007-11-01 07:39:36
 > gpg-agent[4052.6] DBG: -> OK
 >   6 - 2007-11-01 07:39:36 gpg-agent[4052.6] DBG: <- SCD SETDATA
 > FEF51A7BB7DC6A19710A98D918C3DD54DA95C1E0F72264276C97534B1A11B9D043149BD3DF
 >00254F2FAADC6D6F5DBB1FA14C6DFD53EE6C7553BD71FBFAC9C8F1FD01F6097321F021D3D67
 >F1DC3C7A9F2E43274CB3B8BD39E1B684B21AE01AAB6D216A6B7A3056D677997D84A3C34AC82
 >67EC4A49AF726A56D35645B66C070B 7 - 2007-11-01 07:39:36 scdaemon[4213.0]
 > DBG: <- SETDATA
 > FEF51A7BB7DC6A19710A98D918C3DD54DA95C1E0F72264276C97534B1A11B9D043149BD3DF
 >00254F2FAADC6D6F5DBB1FA14C6DFD53EE6C7553BD71FBFAC9C8F1FD01F6097321F021D3D67
 >F1DC3C7A9F2E43274CB3B8BD39E1B684B21AE01AAB6D216A6B7A3056D677997D84A3C34AC82
 >67EC4A49AF726A56D35645B66C070B 7 - 2007-11-01 07:39:36 scdaemon[4213.0]
 > DBG: -> OK
 >   6 - 2007-11-01 07:39:36 gpg-agent[4052.6] DBG: -> OK
 >   6 - 2007-11-01 07:39:36 gpg-agent[4052.6] DBG: <- SCD PKDECRYPT
 > D2760001240101010001000002EB0000/82E89CC385F692F8405064363640869B9107C5AC
 > 7 - 2007-11-01 07:39:36 scdaemon[4213.0] DBG: <- PKDECRYPT
 > D2760001240101010001000002EB0000/82E89CC385F692F8405064363640869B9107C5AC
 > 7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG: send apdu: c=00 i=CA p0=00
 > p1=6E lc=-1 le=256 7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG:   > APDU_data: 00 CA 00 6E 00 7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG:
 > ccid-driver: sending 6F 09 00 00 00 00 0F 04 00 00 00 00 05 00 CA 00 6E 00
 > A1 7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG: ccid-driver: status: 00  > error: 00  octet[9]: 04 7 - 2007-11-01 07:39:36                data: 00 00
 > CA 4F 10 D2 76 00 01 24 01 01 01 00 01 00 00 02 EB 00 00 73 81 9D C0 01 78
 > C1 05 01 04 00 00 20 C2 05 01 04 00 00 20 C3 05 01 04 00 00 20 C4 07 00 FE
 > FE FE 03 03 03 C5 3C 14 B6 61 3A 82 AF 0D D7 11 7D 6A 10 10 96 7F 77 2E 30
 > 51 1B 82 E8 9C C3 85 F6 92 F8 40 50 64 36 36 40 86 9B 91 07 C5 AC B9 94 D5
 > C4 0C 93 39 16 15 FC 39 D9 96 36 0E 36 24 38 0E 54 C6 3C C4 85 A6 CD 7E C6
 > 6E 9E EC 33 65 F2 70 F2 75 E4 C3 2F 6C A5 00 00 00 00 00 00 00 00 00 00 00
 > 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 > 00 00 00 00 CD 0C 43 16 11 B6 43 16 13 0D 43 16 13 46 5E 06 76 6F 6C 6B 65
 > 72 90 00 30 7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG:  response:
 > sw=9000  datalen=200 7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG:       > dump:  4F 10 D2 76 00 01 24 01 01 01 00 01 00 00 02 EB 00 00 73 81 9D C0
 > 01 78 C1 05 01 04 00 00 20 C2 05 01 04 00 00 20 C3 05 01 04 00 00 20 C4 07
 > 00 FE FE FE 03 03 03 C5 3C 14 B6 61 3A 82 AF 0D D7 11 7D 6A 10 10 96 7F 77
 > 2E 30 51 1B 82 E8 9C C3 85 F6 92 F8 40 50 64 36 36 40 86 9B 91 07 C5 AC B9
 > 94 D5 C4 0C 93 39 16 15 FC 39 D9 96 36 0E 36 24 38 0E 54 C6 3C C4 85 A6 CD
 > 7E C6 6E 9E EC 33 65 F2 70 F2 75 E4 C3 2F 6C A5 00 00 00 00 00 00 00 00 00
 > 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 > 00 00 00 00 00 00 CD 0C 43 16 11 B6 43 16 13 0D 43 16 13 46 5E 06 76 6F 6C
 > 6B 65 72 7 - 2007-11-01 07:39:36 scdaemon[4213]: DBG: asking for PIN 'PIN'
 > 7 - 2007-11-01 07:39:36 scdaemon[4213.0] DBG: -> INQUIRE NEEDPIN PIN 6 -
 > 2007-11-01 07:39:36 gpg-agent[4052]: starting a new PIN Entry 6 -
 > 2007-11-01 07:39:36 gpg-agent[4052]: DBG: connection to PIN entry
 > established 7 - 2007-11-01 07:39:48 scdaemon[4213.0] DBG: <- [ 44 20 33 31
 > 31 32 38 32 00 00 00 00 ...(80 bytes skipped) ] 7 - 2007-11-01 07:39:48
 > scdaemon[4213.0] DBG: <- END
 >   7 - 2007-11-01 07:39:48 scdaemon[4213]: DBG: send apdu: c=00 i=20 p0=00
 > p1=82 lc=6 le=-1 7 - 2007-11-01 07:39:48 scdaemon[4213]: DBG:   APDU_data:
 > 00 20 00 82 06 33 31 31 32 38 32 7 - 2007-11-01 07:39:48 scdaemon[4213]:
 > DBG: ccid-driver: sending 6F 0F 00 00 00 00 16 04 00 00 00 40 0B 00 20 00
 > 82 06 33 31 31 32 38 32 E4 7 - 2007-11-01 07:39:49 scdaemon[4213]: DBG:
 > ccid-driver: status: 00  error: 00  octet[9]: 04 7 - 2007-11-01 07:39:49   >              data: 00 40 02 90 00 D2
 >   7 - 2007-11-01 07:39:49 scdaemon[4213]: DBG:  response: sw=9000  > datalen=0 7 - 2007-11-01 07:39:49 scdaemon[4213]: DBG:      dump:
 >   7 - 2007-11-01 07:39:49 scdaemon[4213]: DBG: send apdu: c=00 i=2A p0=80
 > p1=86 lc=128 le=256 7 - 2007-11-01 07:39:49 scdaemon[4213]: DBG:   > APDU_data: 00 2A 80 86 80 00 FE F5 1A 7B B7 DC 6A 19 71 0A 98 D9 18 C3 DD
 > 54 DA 95 C1 E0 F7 22 64 27 6C 97 53 4B 1A 11 B9 D0 43 14 9B D3 DF 00 25 4F
 > 2F AA DC 6D 6F 5D BB 1F A1 4C 6D FD 53 EE 6C 75 53 BD 71 FB FA C9 C8 F1 FD
 > 01 F6 09 73 21 F0 21 D3 D6 7F 1D C3 C7 A9 F2 E4 32 74 CB 3B 8B D3 9E 1B 68
 > 4B 21 AE 01 AA B6 D2 16 A6 B7 A3 05 6D 67 79 97 D8 4A 3C 34 AC 82 67 EC 4A
 > 49 AF 72 6A 56 D3 56 45 B6 6C 07 0B 7 - 2007-11-01 07:39:49
 > scdaemon[4213]: DBG: ccid-driver: sending 6F 84 00 00 00 00 17 04 00 00 00
 > 20 80 00 2A 80 86 80 00 FE F5 1A 7B B7 DC 6A 19 71 0A 98 D9 18 C3 DD 54 DA
 > 95 C1 E0 F7 22 64 27 6C 97 53 4B 1A 11 B9 D0 43 14 9B D3 DF 00 25 4F 2F AA
 > DC 6D 6F 5D BB 1F A1 4C 6D FD 53 EE 6C 75 53 BD 71 FB FA C9 C8 F1 FD 01 F6
 > 09 73 21 F0 21 D3 D6 7F 1D C3 C7 A9 F2 E4 32 74 CB 3B 8B D3 9E 1B 68 4B 21
 > AE 01 AA B6 D2 16 A6 B7 A3 05 6D 67 79 97 D8 4A 3C 34 AC 82 67 EC 4A 49 AF
 > 72 6A 56 D3 56 99 7 - 2007-11-01 07:39:49 scdaemon[4213]: DBG:
 > ccid-driver: status: 00  error: 00  octet[9]: 04 7 - 2007-11-01 07:39:49   >              data: 00 90 00 90
 >   7 - 2007-11-01 07:39:49 scdaemon[4213]: DBG: ccid-driver: sending 6F 09
 > 00 00 00 00 18 04 00 00 00 40 05 45 B6 6C 07 0B D6 7 - 2007-11-01 07:39:49
 > scdaemon[4213]: DBG: ccid-driver: status: 00  error: 00  octet[9]: 04 7 -
 > 2007-11-01 07:39:49                data: 00 00 02 69 85 EE
 >   7 - 2007-11-01 07:39:49 scdaemon[4213]: DBG:  response: sw=6985  > datalen=0 7 - 2007-11-01 07:39:49 scdaemon[4213]: operation decipher
 > result: Conditions of use not satisfied 6 - 2007-11-01 07:39:49
 > gpg-agent[4052.6] DBG: -> ERR 100663427 Conditions of use not satisfied
 >  6 - 2007-11-01 07:39:49 gpg-agent[4052.6] DBG: <- BYE
 >   6 - 2007-11-01 07:39:49 gpg-agent[4052.6] DBG: -> OK closing connection
 >   6 - 2007-11-01 07:39:49 gpg-agent[4052]: handler 0x8092f90 for fd 6
 > terminated 7 - 2007-11-01 07:39:49 scdaemon[4213]: card_create_signature
 > failed: Conditions of use not satisfied 7 - 2007-11-01 07:39:49
 > scdaemon[4213.0] DBG: -> ERR 100663427 Conditions of use not satisfied
 >  7 - 2007-11-01 07:39:49 scdaemon[4213.0] DBG: <- RESTART
 >   7 - 2007-11-01 07:39:49 scdaemon[4213.0] DBG: -> OK
 >
 > Does anybody have an idea on this?
 > The outcome is similiar to when I use the pcscd driver.

@_date: 2007-11-07 22:24:43
@_author: Volker Dormeyer 
@_subject: Decryption using Smartcard using CCID and PCSCD driver 
* On Wednesday 07 November 2007 19:50:54,
 > On Thu,  1 Nov 2007 08:07, volker at ixolution.de said:
 > FWIW, we can see you PIN in the log:
 >
 >  DBG: send apdu: c=00 i=20 p0=00 p1=82 lc=6 le=-1
 >  DBG:   APDU_data: 00 20 00 82 06 33 31 31 32 38 32
 >                                   ^^^^^^^^^^^^^^^^^
Thanks for this hint.
 > Can you send me the encrypted message by PM?  I only need the the public
 > key encrypted packet.  Run gpgsplit on the message and send me the
 > *.pk_enc files or just the one encrypted to your key (gpg --list-packets
 > on the pk_enc file shows you the keyid for of that packet)
Okay, I am going to send the pk_enc file via PM.

@_date: 2008-01-23 01:24:18
@_author: Volker Dormeyer 
@_subject: Decryption using Smartcard using CCID and PCSCD driver 
* On Monday 10 December 2007 21:55:12,
 > I plan to try the version in SVN within the next days.
Although I am very late, I was able to test decryption with GnuPG 1.4.8/2.0.8. I can confirm, decryption is working fine, now.
 >  * On Monday 10 December 2007 16:42:03,
 >  > it took quite some time but I fixed it today. The solution is in the
 >  > SVN and will go into 1.4.8 and 2.0.8.  Both to be released before
 >  > Christmas.
Thanks and regards,
