
@_date: 2015-07-07 15:40:35
@_author: Marek Szuba 
@_subject: gpg-2.1.6 scdaemon: cannot disable OpenPGP application 
I have run into problems trying to get GnuPG (version 2.1.6, running
under Linux/amd64) to talk to my SmartCard-HSM. The card has been
working perfectly so far, ditto the reader (indeed, I can see in the
logs that the latter is seen by scdaemon). Judging from the fact the
string sd-hsm does appear inside the scdaemon binary, this application
should - as expected - be supported. Okay, here goes:
$ gpg --card-status
[the reader gets detected and its LED blinks once]
scdaemon[2513] can't select application 'openpgp': Not supported
gpg: OpenPGP card not available: Not supported
Makes sense, this is not an OpenPGP card so no wonder the application
cannot be selected. I've killed the running instance of scdaemon and in
order to prevent it from getting stuck on this in the future, added
disable-application openpgp
to ~/.gnupg/scdaemon.conf.
The problem is, I still get exactly the same error with that line in the
config... Messing with debug levels hasn't revealed anything
enlightening, merely confirming that scdaemon happily keeps on trying to
use the supposedly-disabled application. Running gpg as root has not
helped either.
I would very much appreciate any help you could offer me with solving
this problem. Should you require any more information, please let me know!
Yours sincerely,

@_date: 2015-07-08 11:29:48
@_author: Marek Szuba 
@_subject: gpg-2.1.6 scdaemon: cannot disable OpenPGP application 
Should have made this more clear, sorry. This is the first time I tried
using this card with GnuPG, what I meant is that it had been working
perfectly with other applications (via PKCS PKCS and dedicated
SmartCard-HSM tools).
I see. In other words, even though scdaemon does support this type of
card now gpg itself (I've just tried gpgsm, I've got no X.509
certificates on that card but at least no errors appear) still requires
an OpenPGP SmartCard?

@_date: 2015-07-09 15:48:29
@_author: Marek Szuba 
@_subject: gpg-2.1.6 scdaemon: cannot disable OpenPGP application 
Indeed. To be precise, the SmartCard-HSM Web site states clearly GnuPG
only supports this card as key store for X.509 certificates and private
keys so there should be no false expectations regarding OpenPGP support
- but given we are talking about a powerful, highly versatile and
apparently increasingly popular SmartCard here it would in the long run
be a waste not to let it be used in this mode.
One problem is that as you pointed out in your previous post, the Assuan
command which explicitly demands cards accessed by gpg to support the
openpgp application is hard-coded in the sources and has been there for
quite a few years. Hopefully relaxing this restriction will not prove to
be too much of a paradigm shift.
It is excellent news that there shouldn't be too much left to implement!
I will be very happy to provide any help I can. Shall we continue off
the mailing list?
