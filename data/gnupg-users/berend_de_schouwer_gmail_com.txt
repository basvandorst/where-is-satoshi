
@_date: 2015-05-14 13:16:42
@_author: Berend De Schouwer 
@_subject: gnupg migration corrupt db? 
On my system both gnupg 1.4.19 and 2.1.2 are installed.  I'm still
trying to track down what needs what.
gnupg2 seems to have attempted to automatically migrate my DB from an
older version to a newer version on first execution.  However, it
seems to have failed:
gpg: starting migration from earlier GnuPG versions
gpg: porting secret keys from '/home/berend/.gnupg/secring.gpg' to gpg
gpg: keydb_get_keyblock failed: Value not found
gpg: key 77731557: failed to re-lookup public key
gpg: keydb_get_keyblock failed: Value not found
gpg: migration succeeded
Five keys failed like this.
Right now gnupg1 works, but gnupg2 does not.  With that, I mean gnupg1
can decrypt, but gnupg2 cannot decrypt the same files.  The reason
seems to be a failure to read or accept certain secret keys.
gnupg1 --list-secret-keys lists 6 secret keys.  Some are old.  One is
expired.  Two are "active" for different e-mail accounts.
gnupg2 --list-secret-keys lists 1 secret key.
Attempting to re-import the DB, using gpg2 --import secring-old.gpg
gpg: keydb_get_keyblock failed: Value not found
gpg: key 77731557: public key "[User ID not found]" imported
gpg: key 77731557: failed to re-lookup public key
gnupg2 --list-keys lists a key as:
pub ... date
uid [unknown] name email
sub ... date
gnupg1 --list-keys doesn't print [unknown]
I do have backups :)  Is this salvageable?

@_date: 2015-05-15 13:57:35
@_author: Berend De Schouwer 
@_subject: gnupg migration corrupt db? 
Some of them were likely created with GnuPG 0.0001, in the year 1917
:)  Some of them are more recent.  They are unlikely to have been
created by PGP any version.  How do I check if they are PGP2 keys?
Will do.  gnupg.org/download is my friend.
They do.  But I don't want to keep two gnupg versions installed
indefinitely, and use different binaries for different keys.  That's
I'll restore from backup, and create that file.

@_date: 2015-05-15 15:40:19
@_author: Berend De Schouwer 
@_subject: gnupg migration corrupt db? 
With 2.1.4:
1. the secret keys do import.
2. each key asks for a passphrase. (2.1.2 did not)
3. It still prints "value not found", but no longer "failed to re
-lookup public key"
4. --decrypt on an encrypted file:
   gpg: decryption failed: No secret key
5. the keys listed with --list-secret-keys are now listed multiple
times.  It's possible that the keys were imported -- incorrectly -- by
2.1.2.  This might cause decrypting to fail.  Time to recover backups.

@_date: 2015-05-16 08:26:17
@_author: Berend De Schouwer 
@_subject: gnupg migration corrupt db? 
I restored from backup, and 2.1.4 migrated successfully.  The keys are
not PGP2 keys.
Thank you for the help.

@_date: 2015-05-16 08:21:07
@_author: Berend De Schouwer 
@_subject: gnupg migration corrupt db? 
Then no, they are not PGP2 keys.
fingerprint = 10 x 4 hex digits.
