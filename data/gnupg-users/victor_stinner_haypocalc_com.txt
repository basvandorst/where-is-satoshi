
@_date: 2009-06-17 13:30:14
@_author: Victor Stinner 
@_subject: Hasard library and secure random pool 
I wrote a library to generate random numbers called Hasard:
   It can use gcrypt to generate numbers using the different security levels:
  "gcrypt_nonce": gcry_create_nonce()
  "gcrypt_weak": gcry_randomize(GCRY_WEAK_RANDOM)
  "gcrypt_strong": gcry_randomize(GCRY_STRONG_RANDOM)
  "gcrypt_very_strong": gcry_randomize(GCRY_VERY_STRONG_RANDOM)
I just fixed my source code to initialize correctly the library:
 1. call gcry_check_version(GCRYPT_VERSION)
 2. call gcry_control(GCRYCTL_USE_SECURE_RNDPOOL) (only for strong     and very strong engines)
 3. gcry_control(GCRYCTL_INITIALIZATION_FINISHED, 0)
Is it correct? Or can you check directly gcrypt.c?
   You can use Hasard to test gcrypt: it includes a lot of unit tests and can use external programs/libraries (ENT, TestU01, ...) to test the generator quality.
I wrote Hasard because of the OpenSSL bug in the Debian package (one year ago). Hasard includes, for example, a test to check that multiple initialization gives differents seeds (and not only 2^15 differents seeds...).
But Hasard has many more interesting features, see:
  Hasard can also OpenSSL :-)

@_date: 2009-06-17 13:26:46
@_author: Victor Stinner 
@_subject: Documentations bugs? 
I think that gcrypt documentation contains some bugs.
Extract (1):
GCRYCTL_USE_SECURE_RNDPOOL; Arguments: none
This command tells the PRNG to store random numbers in secure memory. This command should be run right after gcry_check_version and not later than the command GCRYCTL_INIT_SECMEM. Note that in FIPS mode the secure memory is always used.
Does it mean that GCRYCTL_USE_SECURE_RNDPOOL can be used before GCRYCTL_INIT_SECMEM? Because if I use both, I get this:
   Oops, secure memory pool already initialized
Extract (2):
       /* Allocate a pool of 16k secure memory.  This make the secure memory
          available and also drops privileges where needed.  */
       gcry_control (GCRYCTL_INIT_SECMEM, 16384, 0);
Does gcry_control have one or two arguments? I think that it's just one and the doc is wrong.

@_date: 2009-06-19 14:47:20
@_author: Victor Stinner 
@_subject: Documentations bugs? 
Le mercredi 17 juin 2009 13:26:46, Victor Stinner a ?crit :
I found my error. It was not the usage of GCRYCTL_USE_SECURE_RNDPOOL + GCRYCTL_INIT_SECMEM, but that I load gcrypt twice using dlopen(), and that I do initialize it twice. But at the second dlopen() call, i just get the same reference to the first dlopen() and so the library is already open. I was my fault :-p
