
@_date: 2010-04-01 15:00:59
@_author: Chris Ruff 
@_subject: poldi-ctrl error - No public key 
I recently configured poldi-0.4 on OpenSuSE and cannot successfully run
'poldi-ctrl -d'.  My openpgp v2.0 smartcard with fine gnupg and 'gpg
--card-status' has no problems.  Any ideas?
$ poldi-ctrl -s
$ poldi-ctrl -d --debug
poldi-ctrl: debug: got scdaemon socket name from gpg-agent, connected to
socket '/tmp/gpg-rtKTrS/S.scdaemon'
poldi-ctrl: error: failed to retrieve key from card: No public key
poldi-ctrl: error: failed to retrieve key from card: No public key

@_date: 2010-04-01 19:33:31
@_author: Chris Ruff 
@_subject: poldi-ctrl error - No public key 
Hash: SHA1
Here's the scdaemon debug output:
scdaemon[27120.0] DBG: <- GETINFO socket_name
scdaemon[27120.0] DBG: -> D /tmp/gpg-s3IPzO/S.scdaemon
scdaemon[27120.0] DBG: -> OK
2010-04-01 19:32:51 scdaemon[27120] handler for fd 10 started
scdaemon[27120.10] DBG: -> OK GNU Privacy Guard's Smartcard server ready
scdaemon[27120.0] DBG: <- RESTART
scdaemon[27120.0] DBG: -> OK
scdaemon[27120.10] DBG: <- SERIALNO
scdaemon[27120.10] DBG: -> S SERIALNO D2760001240102000005000003740000 0
scdaemon[27120.10] DBG: -> OK
scdaemon[27120.10] DBG: <- LEARN --force
scdaemon[27120.10] DBG: -> S SERIALNO D2760001240102000005000003740000 0
scdaemon[27120.10] DBG: -> S APPTYPE OPENPGP
scdaemon[27120.10] DBG: -> S EXTCAP gc=1+ki=1+fc=1+pd=1+mcl3=2048+aac=1+sm=0
scdaemon[27120.10] DBG: -> S DISP-NAME Ruff< S DISP-LANG en
scdaemon[27120.10] DBG: -> S DISP-SEX 1
scdaemon[27120.10] DBG: -> S PUBKEY-URL pool.sks-keyservers.net
scdaemon[27120.10] DBG: -> S LOGIN-DATA techniq
scdaemon[27120.10] DBG: -> S KEY-FPR 1
scdaemon[27120.10] DBG: -> S KEY-FPR 2
scdaemon[27120.10] DBG: -> S KEY-FPR 3
scdaemon[27120.10] DBG: -> S KEY-TIME 1 1264299016
scdaemon[27120.10] DBG: -> S KEY-TIME 2 1270162182
scdaemon[27120.10] DBG: -> S KEY-TIME 3 1270162439
2010-04-01 19:32:51 scdaemon[27120] DBG: send apdu: c=00 i=CA p1=00
p2=C4 lc=-1 le=256 em=0
2010-04-01 19:32:51 scdaemon[27120] DBG:   PCSC_data: 00 CA 00 C4 00
2010-04-01 19:32:51 scdaemon[27120] DBG:  response: sw=9000  datalen=7
2010-04-01 19:32:51 scdaemon[27120] DBG:       dump:  00 20 20 20 03 00 03
scdaemon[27120.10] DBG: -> S CHV-STATUS +0+32+32+32+3+0+3
2010-04-01 19:32:51 scdaemon[27120] DBG: send apdu: c=00 i=CA p1=00
p2=7A lc=-1 le=256 em=0
2010-04-01 19:32:51 scdaemon[27120] DBG:   PCSC_data: 00 CA 00 7A 00
2010-04-01 19:32:51 scdaemon[27120] DBG:  response: sw=9000  datalen=5
2010-04-01 19:32:51 scdaemon[27120] DBG:       dump:  93 03 00 00 7A
scdaemon[27120.10] DBG: -> S SIG-COUNTER 122
scdaemon[27120.10] DBG: -> OK
scdaemon[27120.10] DBG: <- READKEY OPENPGP.3
2010-04-01 19:32:51 scdaemon[27120] app_readkey failed: No public key
scdaemon[27120.10] DBG: -> ERR 100663305 No public key scdaemon[27120.10] DBG: <- RESTART
scdaemon[27120.10] DBG: -> OK
scdaemon[27120.10] DBG: <- BYE
scdaemon[27120.10] DBG: -> OK closing connection
2010-04-01 19:32:51 scdaemon[27120] handler for fd 10 terminated

@_date: 2010-04-03 15:01:55
@_author: Chris Ruff 
@_subject: poldi-ctrl error - No public key 
Hash: SHA1
OK, so the OpenSuSE build of gnupg is 2.0.12 and would fail when trying
to issue the command 'SCD READKEY OPENPGP.3' via gpg-connect-agent.  I
don't know if this was a incomplete build or what.  Not surprised though
since generation a key on the smartcard didn't prompt for the RSA key
size.  So I built gnupg-2.0.15 and whola! It works!
For OpenSuSE 11.x you'll want to edit '/etc/pam.d/common-auth-smartcard'
to contain only the line:
    auth    required    pam_poldi.so
Then unlink 'common-auth' from 'common-auth-pc' and then link to
The only thing I can't figure out is how to get this to work for the
screensaver unlock.  I'm using Gnome/GDM.  Any ideas?

@_date: 2010-04-03 20:28:19
@_author: Chris Ruff 
@_subject: poldi-ctrl error - No public key 
Hash: SHA1
Well, it appears the screensaver does work except the prompt does ask
for "PIN" as does the gdm login prompt, so it just say "Password".
however, inputting the PIN does unlock the screensaver.
Sometimes typing/explaining the issue(s) enlightens one to the
resolution.  Hope this helps someone else.

@_date: 2010-04-03 20:30:16
@_author: Chris Ruff 
@_subject: poldi-ctrl error - No public key 
Hash: SHA1
*Correction: "...the prompt doesn't ask..."

@_date: 2010-04-05 16:46:42
@_author: Chris Ruff 
@_subject: poldi-ctrl error - No public key 
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
I stand corrected.  It seems gnome-screensaver has a different behavior
if the process has been restarted.  Apparently the gnome-screensaver
doesn't work the same as the login screen (ie I assume it doesn't
implement PAM correctly?).
Under Gnome/GDM it works better to select "Switch User" from the
gnome screensaver authentication prompt, then select the existing user
session and perform an authentication.  This way PAM/Poldi work properly
and you are prompted for your smartcard's PIN  Authentication works
fine and you're back in your original session.

@_date: 2010-12-17 11:22:37
@_author: Chris Ruff 
@_subject: clearsign failed: Bad signature 
The documentation for OpenPGP v2 smartcard states that only RIPEMD-160 &
SHA-1 are supported as a digest algorithm at this point in time.  You'll
have to change your digest prefs accordingly to use the card.
excert from doc:
"Cards with Version < 2.0 sup?port RIPEMD-160 and SHA-1 only and may
check it, so other hash algorithms cannot be
Although I assume it should say =<2.0.  Feedback from others if this was
a typo in teh doc and should be =<2.0?

@_date: 2010-12-21 07:59:16
@_author: John Ruff 
@_subject: clearsign failed: Bad signature 
Interesting, but yes, when I attempt to sign with SHA256 I receive  'gpg: signing failed: Bad signature'.  I seem to recall a discussion  around this and it wasn't the signing that was failing but rather the  post validation check of the newly made signature.  I could be wrong.
Chris Ruff
jcruff at gmail.com
GPG Key: 0x307A351B4EC4B6A1
FGPR: BF2F 2497 22E7 FEB5 C805
       075C 307A 351B 4EC4 B6A1
"No one can see past a choice they don't understand." --The Oracle

@_date: 2010-02-02 20:04:12
@_author: Chris Ruff 
@_subject: OpenPGP SmartCard v2.0 w/OmniKey 6121 
Hash: SHA512
I've been researching the archives for the past week after receiving
my OpenPGP v2.0 smartcard from Kernelconcepts.  Problem seems to
revolve around the reader, but between by two systems OpenSUSE 11.2
(gnupg 2.0.13) and Mac OS X 10.5.8 (MacGPG/gnupg 2.0.14) I have
slightly different results.
First I was only able to create the 3 2048-bit keys on the linux
laptop but would fail to create a 3072/2048/2048 set on the same
system.  On the Mac I couldn't create anything (tried all 1024 and
2048 keys).
I could successfully change all my card options (did this before key
generation).  With the card now having 2048 keys, on the linux system I
could encrypt/decrypt but can not perform any signing/verify
operation.  On the Mac I can encrypt, but neither decrypt/sign/verify.
 Errors vary from "general signing error" to secret key not found
(when trying to decrypt. I was unclear how to actually setup my new
keys on the Mac so I performed an export using export/export-secret-keys
over to the Mac from the linux system.
Please let me know what types of debugs I can provide back for review
or any other test information one would like performed or provided.  I
would really like to get this reader working, but if not I'll take
recommendations for USB ID-000 readers (since I already punched mine out).
Output of '--card-status' below.  Thanks in advance.
$ gpg --card-status
Application ID ...: D2760001240102000005000003740000
Version ..........: 2.0
Manufacturer .....: ZeitControl
Serial number ....: 00000374
Name of cardholder: John Ruff
Language prefs ...: en
Sex ..............: male
URL of public key : [not set]
Login data .......: techniq
Signature PIN ....: forced
Key attributes ...: 2048R 2048R 2048R
Max. PIN lengths .: 32 32 32
PIN retry counter : 3 0 3
Signature counter : 18
Signature key ....: 6530 8DA8 805C 707F 3611  9851 D057 FC41 052A 4FAD
      created ....: 2010-01-24 02:10:16
Encryption key....: 0A2B BBEE 4B0D C392 A4E6  3673 ECCF B9FB 1488 8977
      created ....: 2010-01-24 02:10:16
Authentication key: 735C 977A DFBA 72B2 CDF0  D5D9 F9E8 742E FC34 E962
      created ....: 2010-01-24 02:10:16
General key info..: pub  2048R/052A4FAD 2010-01-24 John C. Ruff
(Techniq) sec>  2048R/052A4FAD  created: 2010-01-24  expires: never
                      card-no: 0005 00000374
ssb>  2048R/FC34E962  created: 2010-01-24  expires: never
                      card-no: 0005 00000374
ssb>  2048R/14888977  created: 2010-01-24  expires: never
                      card-no: 0005 00000374

@_date: 2010-02-28 17:05:53
@_author: Chris Ruff 
@_subject: OmniKey 6121 & OpenPGP Smartcard v2.0 
============================== START ==============================
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
Just wanted to share that while the OmniKey 6121 USB Reader for ID-000
cards is stated to work on the Fellowship HOW-TO page, when using the
OpenPGP v2.0 card it requires the actual OmniKey drivers to be fully
supported.  I've confirmed this on both Mac OS X and Linux.  The one
thing that doesn't work without their drivers is the ability to sign
anything but your own keys during creation.  The following error would
be seen:
gpg: signing failed: General error
gpg: signing failed: General error
Hope this helps someone trying to use the same card.

@_date: 2010-01-26 10:38:55
@_author: John Ruff 
@_subject: OpenPGP SmartCard v2.0 w/OmniKey 6121 
I've been researching the archives for the past week after receiving
my OpenPGP v2.0 smartcard from Kernelconcepts.  Problem seems to
revolve around signing, but between by two systems OpenSUSE 11.2
(gnupg 2.0.13) and Mac OS X 10.5.8 (MacGPG/gnupg 2.0.14) I have
slightly different results.
First I was only able to create the 3 2048-bit keys on the linux
laptop but would fail to create a 3072/2048/2048 set on the same
system.  On the Mac I couldn't create anything (tried all 1024 and
2048 keys).
With the card now having 2048 keys I could successfully change all my
card options (did this before key generation).  On the linux system I
could encrypt/decrypt but can not perform any signing/verify
operation.  On the Mac I can encrypt, but neither decrypt/sign/verify.
 Errors vary from "general signing error" to secret key not found
(when trying to decrypt. I was unclear how to actually setup my new
keys on the Mac so I performed an export and export/export-secret-keys
over to the Mac from the linux system.
Please let me know what types of debugs I can provide back for review
or any other test information one would like performed or provided.
Output of '--card-status' below.  Thanks in advance.
$ gpg --card-status
Application ID ...: D2760001240102000005000003740000
Version ..........: 2.0
Manufacturer .....: ZeitControl
Serial number ....: 00000374
Name of cardholder: John Ruff
Language prefs ...: en
Sex ..............: male
URL of public key : [not set]
Login data .......: techniq
Signature PIN ....: forced
Key attributes ...: 2048R 2048R 2048R
Max. PIN lengths .: 32 32 32
PIN retry counter : 3 0 3
Signature counter : 18
Signature key ....: 6530 8DA8 805C 707F 3611  9851 D057 FC41 052A 4FAD
      created ....: 2010-01-24 02:10:16
Encryption key....: 0A2B BBEE 4B0D C392 A4E6  3673 ECCF B9FB 1488 8977
      created ....: 2010-01-24 02:10:16
Authentication key: 735C 977A DFBA 72B2 CDF0  D5D9 F9E8 742E FC34 E962
      created ....: 2010-01-24 02:10:16
General key info..: pub  2048R/052A4FAD 2010-01-24 John C. Ruff
(Techniq) sec>  2048R/052A4FAD  created: 2010-01-24  expires: never
                      card-no: 0005 00000374
ssb>  2048R/FC34E962  created: 2010-01-24  expires: never
                      card-no: 0005 00000374
ssb>  2048R/14888977  created: 2010-01-24  expires: never
                      card-no: 0005 00000374

@_date: 2010-01-28 19:22:25
@_author: Chris Ruff 
@_subject: Gnupg doesn't recognize card. 
Hash: SHA512
On the Mac (10.5.8) I've found that when I receive this error to kill
the scdaemon and reinsert the reader/card.
$ killall -u  scdaemon      has to be entered 2-3x to
kill it
Then I'm able to reinsert and perform a 'gpg --card-status'
Hope this helps.

@_date: 2010-01-29 08:55:12
@_author: John Ruff 
@_subject: Gnupg doesn't recognize card. 
I will remember to use this in the future.
pkill is what I used (up until now) on Linux, but the command doesn't  exist by default on OS X (at least not mine).  Only killall.
Chris Ruff
jcruff at gmail.com
GPG Key: 0x307A351B4EC4B6A1
FGPR: BF2F 2497 22E7 FEB5 C805
       075C 307A 351B 4EC4 B6A1
"No one can see past a choice they don't understand." --The Oracle

@_date: 2010-07-20 17:47:14
@_author: Chris Ruff 
@_subject: SHA2 digest, V2 smartcard and gpg-agent problem 
Interesting, indeed.  I unfortunately had to change my prefs when I got
my openpgp v2 card since I was using gpg2 and the agent is required.  So
is this currently just an issue with gpg-agent?  If I'm reading section
7.2.8.1 [Hash Algorithms] in the OpenPGP smart application PDF correctly
it seems only OpenPGP cards <2.0 are limited to SHA1 & RIPEMD-160.
"The following hash algorithms are supported by RFC 4880 and can be used
as input in the DSI. However the card may not check the integrity of a
DSI. Cards with Version < 2.0 sup?port RIPEMD-160 and SHA-1 only and may
check it, so other hash algorithms cannot be used."
Or is this saying >=2.0 OpenPGP cards can generate SHA2 hashes but
cannot verify them?

@_date: 2010-07-20 18:31:38
@_author: Chris Ruff 
@_subject: [Announce] GnuPG 2.0.16 released 
Hash: SHA1
- - option --use-standard-socket may now be used to use this feature by
+ option --enable-standard-socket may now be used to use this feature by

@_date: 2010-07-20 18:09:13
@_author: Chris Ruff 
@_subject: GPG seems broken on FC13 after upgrade. 
I'm not sure if this is your exact problem but on my openSuSE 11.2
system Seahorse really made a mess of things.  Try running your
gpg-agent the old fashion way and export the variables.  I'm
initializing mine in .xinitrc with an eval statement and relevant
arguments b/c seahorse doesn't seem to work correctly with scdaemon.

@_date: 2010-07-22 01:22:36
@_author: John Ruff 
@_subject: verifying hashes with Gnupg 
not sure what version this was made available, but the '--print-md  ' option to gpg will generate a hash, albeit you must visually  $ gpg --print-md SHA1 10MB.dat
10MB.dat: 8C20 6A1A 8759 9F53 2CE6  8675 536F 0B15 4690 0D7A
$ openssl sha1 10MB.dat
SHA1(10MB.dat)= 8c206a1a87599f532ce68675536f0b1546900d7a
$ gpg --print-md SHA512 10MB.dat
10MB.dat: 868D3A19 0F272375 8D1A6449 8A4AC1F1 4B0297E1 6E731A0E EC3A446B
           775C65CB 8428AB33 140CEE13 EF51E7BB 3764B5FF 1900CFB3             FCC41DD6 CDD9FCEA
$ openssl dgst -sha512 10MB.dat
SHA512(10MB.dat)=  Chris Ruff
jcruff at gmail.com
GPG Key: 0x307A351B4EC4B6A1
FGPR: BF2F 2497 22E7 FEB5 C805
       075C 307A 351B 4EC4 B6A1
"No one can see past a choice they don't understand." --The Oracle

@_date: 2010-06-11 07:43:35
@_author: John C. Ruff 
@_subject: Test mail to jcruff@gmail.com 
Chris Ruff
email: jcruff at gmail.com
gpg key: 0x052A4FAD
gpg fgpr: 6530 8DA8 805C 707F 3611
           9851 D057 FC41 052A 4FAD
Good luck with the search!

@_date: 2010-11-01 22:51:06
@_author: Chris Ruff 
@_subject: 2.1.0beta1 - Smartcard Support? 
Thanks, missed that paragraph. However, things seem not to be working with subkeys.  I'm getting "Need
the secret key to do this" or "no default secret key" for a many
operations.  Including trying to import to gpg-agent, --edit-key ->
toggle or a signing operation.  I would assume 'toggle' would not be
considered a card related sub-command of '--edit-key'.
If using subkeys does the master private key need to be present to
perform the 'gpg --import ~/.gnupg/secring.gpg' into gpg-agent?
Signing and toggle works fine with 2.0.15/2.0.16 and the same gpg.conf.

@_date: 2010-10-01 23:44:08
@_author: Chris Ruff 
@_subject: bad file descriptor 
Anyone seen this error and know what could be the problem?  I've tried
rebuilding gnupg (2.0.16) but no luck.  It work previously on my
OpenSUSE 11.3 system w/o issue, but now when I try to sign or decrypt
something I get the following errors for each operation.  Still works on
my Mac OS X system.  Using OpenPGP SmartCard v2.0.
gpg: signing failed: Bad file descriptor
gpg: public key decryption failed: Bad file descriptor
Is it somehow related to scdaemon?  I did take an strace when doing
basic detach signing operation on a file:
read(9, "INQUIRE PINENTRY_LAUNCHED 28548\n", 1002) = 32
write(9, "END", 3)                      = 3
write(9, "\n", 1)                       = 1
read(9, "ERR 32779 Bad file descriptor <U"..., 1002) = 51
[...skipped messages about missing locales...]
mmap2(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1,
0) = 0xb733c000
write(2, "gpg: signing failed: Bad file de"..., 41gpg: signing failed:
Bad file descriptor
) = 41
unlink("RR-4568.pdf.asc")               = 0
close(8)                                = 0
write(2, "gpg: signing failed: Bad file de"..., 41gpg: signing failed:
Bad file descriptor
) = 41
munmap(0xb733e000, 32768)               = 0
exit_group(2)                           = ?

@_date: 2010-10-01 23:18:34
@_author: Chris Ruff 
@_subject: Can't use GPG key - secret key not available 
The long key id can be view with the command: gpg --list-keys --keyid-format long

@_date: 2010-10-04 14:07:33
@_author: John Ruff 
@_subject: gpg-agent and scdaemon confusion when card is removed 
I've been using the scd-event script found in the 'doc/examples'  folders in the source distribution to activate & lock my screensaver  when the card is pulled.  Logic exist in the script that would allow  you to call 'gpgconf --reload scdaemon' or 'pkill -9 scdaemon' when  the card is inserted.  You could play with this as a workaround.
This is only a workaround and not any official solution since the list  message below confirms code as the real issue.
Chris Ruff
jcruff at gmail.com
GPG Key: 0xDD55B6FC
GPG Fgpr: CF61 AE7A C909 973D 6C21
           A8DA 9FF8 CA22 DD55 B6FC
"No one can see past a choice they don't understand." --The Oracle

@_date: 2010-10-31 14:20:50
@_author: Chris Ruff 
@_subject: 2.1.0beta1 - Smartcard Support? 
Is it typical for smartcard support not to be in beta versions?
[techniq at silence: ~] $ gpg --card-status
gpg: invalid option "--card-status"
[techniq at silence: ~] $ gpg --version
gpg (GnuPG) 2.1.0beta1
libgcrypt 1.4.6
NOTE: THIS IS A DEVELOPMENT VERSION!
It is only intended for test purposes and should NOT be
used in a production environment or with production keys!
Copyright (C) 2010 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Home: ~/.gnupg
Supported algorithms:
Pubkey: RSA, ELG, DSA
Cipher: 3DES, CAST5, BLOWFISH, AES, AES192, AES256, TWOFISH,
CAMELLIA128,         CAMELLIA192, CAMELLIA256
Hash: MD5, SHA1, RIPEMD160, SHA256, SHA384, SHA512, SHA224
Compression: Uncompressed, ZIP, ZLIB
[...configure output...]
        GnuPG v2.1.0beta1 has been configured as follows:
        Platform:  GNU/Linux (i686-pc-linux-gnu)
        OpenPGP:   yes
        S/MIME:    yes
        Agent:     yes         Smartcard: yes (without internal CCID driver)
        G13:       yes
        Dirmngr:   yes
        Gpgtar:    no
        Protect tool:      (default)
        LDAP wrapper:      (default)
        Default agent:     (default)
        Default pinentry:  (default)
        Default scdaemon:  (default)
        Default dirmngr:   (default)
        Use standard socket: yes
        Dirmngr auto start:  no

@_date: 2010-10-31 14:26:47
@_author: Chris Ruff 
@_subject: Restoring a backup key 
Can you edit the key and toggle?  Maybe the trust level needs to be set.

@_date: 2010-09-26 09:53:19
@_author: Chris Ruff 
@_subject: gpg.conf for subkeys 
I've setup subkeys for my Open PGP v2.0 smartcard.  However, I seem to
be unclear about how/what configuration options should be used in
gpg.conf (ie encrypt-to, hidden-encrypt-to, default-recipient, etc).
So far I've reference the how-to on gnupg.org and we.riseup.net
If there are any additional how-to I should reference, please let me
know.  Thanks.

@_date: 2011-01-30 09:07:51
@_author: Chris Ruff 
@_subject: Did I just fry my smartcard? 
- to ~/.gnupg/scdaemon.log .
+   to ~/.gnupg/scdaemon.conf

@_date: 2011-03-21 08:21:22
@_author: Chris Ruff 
@_subject: libgcrypt git repository 
Is this an error on my part.  I went to git pull on the latest trunk for
gnupg and during configure discovered a newer libgcrypt (>=1.5.0) &
libksba (>=1.2.0) was needed.  However a git pull resulted in the
following error:
$ git clone git://git.gnupg.org/libgcrypt/trunk libgcrypt
Initialized empty Git repository in /path/to/libgcrypt/.git/
fatal: The remote end hung up unexpectedly
$ git clone git://git.gnupg.org/libksba/trunk libksba
Initialized empty Git repository in /path/to/libksba/.git/
fatal: The remote end hung up unexpectedly
