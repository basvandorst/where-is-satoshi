
@_date: 2017-02-09 05:59:05
@_author: Ali Hassan Hamed Al Ajmi (eChannels 
@_subject: GnuPG to create CSR 
I got the issue.
Firewall was blocking the "dirmngr" from communicating with CA to validate x.509 certificates. I have solved that by disabling it. However,
I am trying to use gpgsm from command line to do encryption/decryption & signing/verifying. I stuck with how to pass the passphrase in command line. I tried to use the option : passphrase-fd but I am getting this error:
gpgsm --batch --passphrase-fd 0 --decrypt "C:\Test\POC.txt.p7m"
gpgsm: invalid option "--passphrase-fd"
Is this a bug in the tool ( on windows/ linux). Or it is not supported
anyone could help me on that.
The idea is to use the tool on a server where no-human-interaction is required.
-----Original Message-----
Sent: Saturday, February 04, 2017 7:09 AM
I'm sorry, i don't know the answer here, as this is a platform i don't use myself.  hopefully someone else on the list here who uses GnuPG on Windows and Kleopatra can give you some feedback or suggestions for how to debug further.
        --dkg
"Disclaimer! This email message is intended for the named recipient only. If you are not the intended recipient and if you have received this message by error, please immediately notify us through E-Mail at notify at bankmuscat.com and please delete this message from your system. E-mail communications are insecure and capable of interception and corruption, bank muscat would not be liable for incorrect, incomplete transmission, loss or damage on this account or delayed receipt of this e-mail."

@_date: 2017-01-12 11:14:06
@_author: Ali Hassan Hamed Al Ajmi (eChannels 
@_subject: GnuPG to create CSR 
We are using GPG4win as files encryption tool which utilize "GnuPG" crypto engine. One of our requirements is to have certificate signed by our internal CA. since we have Microsoft CA, we need to create certification request that is compatible with Microsoft CA . Via gpg4win GUI, we are able to generate a X.509 keys CR (p10) that does not seem compatible with Microsoft CA.
The questions are:
Does "GnuPG" support creating CR (CSR) that is compatible with Microsoft CA (from command line/ other tools with GUI)?
If Yes, how to generate a certification request that is compatible with Microsoft CA (CSR)?
Can you please guide us to a manual /documentation where we will find such information.
Best Regards
Ali Al Ajmi
Assistant Manager - eChannels
Information Technology
AliAjmi at bankmuscat.com
T. +968 24801222
P.O. Box 134, P.C. 112 Ruwi, Sultanate of Oman
[cid:image001.png at 01D2508F.518FA700]
[cid:image005.jpg at 01CF3304.C768E5A0] [cid:image006.jpg at 01CF3304.C768E5A0]   [cid:image007.jpg at 01CF3304.C768E5A0]  [cid:image008.jpg at 01CF3304.C768E5A0] "Disclaimer! This email message is intended for the named recipient only. If you are not the intended recipient and if you have received this message by error, please immediately notify us through E-Mail at notify at bankmuscat.com and please delete this message from your system. E-mail communications are insecure and capable of interception and corruption, bank muscat would not be liable for incorrect, incomplete transmission, loss or damage on this account or delayed receipt of this e-mail."

@_date: 2017-01-31 12:05:45
@_author: Ali Hassan Hamed Al Ajmi (eChannels 
@_subject: GnuPG to create CSR 
============================== START ==============================
Thanks for your response,
I have successfully created the CSR and send it to internal CA (Microsoft CA) team. They sent me the certificate. I have used Kleopatra UI to import the created certificate after save it in a file (attaching sample file). Using same Kleopatra UI, I have also imported root & intermediate certificates for the CA. looks like attached img(kleopatra.png):
We I tried to encrypt or sign any file, it shows this error (attached error.png)
Is there anything wrong I have done?
Or it is just because Kleopatra does not support X.509 certificate created by Microsoft CA?
-----Original Message-----
Sent: Saturday, January 14, 2017 1:41 AM
When you say "does not seem compatible with Microsoft CA", i don't know what that means.  Is there a specific Microsoft CA product that you're using?  can you provide pointers to it?
can you provide error messages, warnings, or behaviors that indicate that the CSR you generated is incompatible?  What specific steps did you take with the Gpg4win gui to generate the CSR?
If you want to use a command-line part of the GnuPG suite to create an
X.509 CSR, the tool "gpgsm" should be capable of doing it.
   gpgsm --gen-key
and follow the prompts.
If it asks you "Create self-signed certificate? (y/N)", you want to answer "N" (no) because you want the csr instead.
For example (this is not on windows, this is on a GNU/Linux machine, but it should look similar to what you see in the windows cmd.exe shell:
0 dkg at alice:~$ gpgsm --gen-key
gpgsm (GnuPG) 2.1.17; Copyright (C) 2016 Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Please select what kind of key you want:
   (1) RSA
   (2) Existing key
   (3) Existing key from card
Your selection? 1
What keysize do you want? (2048)
Requested keysize is 2048 bits
Possible actions for a RSA key:
   (1) sign, encrypt
   (2) sign
   (3) encrypt
Your selection? 1
Enter the X.509 subject name: CN=bananas.example Enter email addresses (end with an empty line):
Enter DNS names (optional; end with an empty line):
Enter URIs (optional; end with an empty line):
Create self-signed certificate? (y/N)
These parameters are used:
    Key-Type: RSA
    Key-Length: 2048
    Key-Usage: sign, encrypt
    Name-DN: CN=bananas.example
    Name-DNS: bananas.example
    Name-DNS: Proceed with creation? (y/N) y
Now creating certificate request.  This may take a while ...
gpgsm: about to sign the CSR for key: &C6962BE32BF3CA7C3207BCECC0FC1CD3C24CC2E7
gpgsm: certificate request created
Ready.  You should now send this request to your CA.
-----BEGIN CERTIFICATE REQUEST-----
-----END CERTIFICATE REQUEST-----
0 dkg at alice:$
Then you'd copy/paste the stuff between the "-----BEGIN CERTIFICATE REQUEST-----" and "-----END CERTIFICATE REQUEST-----" lines (including those lines as
well) into a file that you can import into your CA.
make sense?
     --dkg
"Disclaimer! This email message is intended for the named recipient only. If you are not the intended recipient and if you have received this message by error, please immediately notify us through E-Mail at notify at bankmuscat.com and please delete this message from your system. E-mail communications are insecure and capable of interception and corruption, bank muscat would not be liable for incorrect, incomplete transmission, loss or damage on this account or delayed receipt of this e-mail."
