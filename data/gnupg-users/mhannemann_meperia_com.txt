
@_date: 2012-06-18 15:37:27
@_author: Michael Hannemann 
@_subject: decryption trouble - primary/subkey confusion, maybe version issues? 
Hi all,
I've searched the FAQ and the mailing list archives, and I don't see an answer to this question, so I will ask it here...
I'm having trouble sending an encrypted file to a collaborator -- even though they've sent me files that I've been able to decrypt.
Here's what they see, with their keys replaced -- TsTs = their subkey, TpTp = their primary key.  My keys:
pub   2048R/F7A48B98 2012-05-22       usage: SC
sub   2048R/BE7A105E 2012-05-22       usage: E
And my collaborator:
pub   1024D/TpTpTpTp 1999-04-08        usage: SCA
sub   2048g/TsTstsTs 1999-04-08        usage: E
gpg: public key is TsTsTsTs
[GNUPG:] ENC_TO xxxxxx--TsTsTsTs 16 0
gpg: using subkey TsTsTsTs instead of primary key TpTpTpTp
gpg: encrypted with 2048-bit ELG-E key, ID TsTsTsTs, created 1999-04-08
    [my collaborator]
[GNUPG:] NO_SECKEY xxxxxx--TsTsTsTs
[GNUPG:] BEGIN_DECRYPTION
[GNUPG:] DECRYPTION_FAILED
gpg: decryption failed: secret key not available [GNUPG:] END_DECRYPTION
My question is ... what is going on here?  Why can't they decrypt this file, when they were able to send me a file that I could decrypt?  Their technical guy wrote me to say that when sending files, I should be using primary key ID TpTpTpTp.   But, so far as I can tell, everything here is working as designed, and there's no way I *can* specifically say "use TpTpTpTp".  However, they say they haven't had any problems with anyone else, and the system has been working for years.  Data I've gathered:
1. Using --edit-key, I did compare fingerprints and have validated the fingerprint they sent me.  2. Early on, it appears that they had somehow used the wrong key for me.  I don't know where that came from, but once identified, I resent my key and they processed it, and I've been able to decrypt files they've sent to me since then.
3. I have a suspicion there are two pathways for them -- an automated system which picks up files & decrypts them, and their IT group trying to debug issues on the other side of the connection.
4. When they sent me their key, I noticed it was exported with GnuPG 1.0.6 (SunOS).  I'm using 1.4.12 on Mac and 1.4.10 on Ubuntu.
5. I accepted the default (RSA + RSA) version for key generation.  Is that a problem with an older GnuPG variant?  I wouldn't think that's the issue.
What questions can I ask them which will help shed light on this situation?  Is it possible that I'm doing something wrong?  I've created a test account with its own gpg keys, and have successfully sent files both directions on my own machine.
Many thanks,

@_date: 2012-06-19 01:03:26
@_author: Michael Hannemann 
@_subject: decryption trouble - primary/subkey confusion, 
I'd begun to suspect that, after digging through files I'd encrypted for any hint of my key.  Thanks for the confirmation.
No, they have not.  I can ask them to do so.
Almost -- I substituted the "xxxx-TsTsTs" gibberish in place of the real keys to protect the innocent here, just making sure I did it carefully & consistently, and re-verifying the fingerprint vs what they sent me again.
Right, that's what I keep seeing and trying to reconcile with their statement that this has been working without issue for other users and I'm the only one who has problems.
Here's the output of your requested command above:
pub:f:1024:17:xxxxxx--TpTpTpTp:1999-04-08:::-:[my collaborator]::scaESCA:
Useful, thanks!  I would've never thought to specify --fingerprint twice.
Good suggestions, thank you.  I can ask them to encrypt a file for themselves and send that to me, and then look to see what keys they're using there.  The others are good suggestions as well; I just want to make sure to them that I'm not asking for someone else's private data.
This seems better than my request that they send me the results of "gpg --vv --list-secret-keys ...", which I suggested because I read somewhere that if the passphrase is somehow disconnected, the "sec" header on that will show up with a # or some other indicator indicating a broken key.

@_date: 2012-06-19 11:37:25
@_author: Michael Hannemann 
@_subject: decryption trouble - primary/subkey confusion, 
I will check that when I get the response back from them.  I've been cautious,
since I'm getting back into GPG use after 10 years away, while they say this is
a system they've been using with other people.  But the closer I've looked, the
more it's seemed like this can't be any other way.  If, as you suggested, the
key I have matches the key they're using.
Sorry, thanks for the correction.  I knew there was a way that the secret key could
be removed, and I wondered if somehow this has been done to their system, perhaps without the knowledge of the particular person I'm working with.  I just wanted to rule that out as a possibility.

@_date: 2013-02-25 10:48:44
@_author: Michael Hannemann 
@_subject: options files 
Fantastic tips, thank you.  As to the "always set an expiration date", I certainly wish I had the first time I created a GPG key for my personal account, since that was several inattentive years ago, and I no longer know the passphrase.  (That's pretty much hopeless, right?)
