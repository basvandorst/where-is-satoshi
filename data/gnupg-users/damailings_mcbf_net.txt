
@_date: 2010-08-26 22:52:24
@_author: David Mohr 
@_subject: How to use the gnupg card with an akasa smart card reader? 
I recently bought a gnupg smart card (kudos to the organizers of
Froscon). I own an internal smart card reader made by akasa (AK-ICR-05).
Unfortunately it doesn't work with gnupg out of the box, and I have no
idea how to get it going.
I contacted the manufacturer and of course they don't have Linux support
but they were able to tell me that it uses an RTS5161 chipset. I wasn't
able to find anything using google about it...
lsusb -v says:
Bus 001 Device 002: ID 0bda:0161 Realtek Semiconductor Corp. Mass
Storage Device
Device Descriptor:
  bLength                18
  bDescriptorType         1
  bcdUSB               2.00
  bDeviceClass            0 (Defined at Interface level)
  bDeviceSubClass         0
  bDeviceProtocol         0
  bMaxPacketSize0        64
  idVendor           0x0bda Realtek Semiconductor Corp.
  idProduct          0x0161 Mass Storage Device
  bcdDevice           61.10
  iManufacturer           1 Generic
  iProduct                2 USB2.0-CRW
  iSerial                 3 20070818000000000
  bNumConfigurations      1
  Configuration Descriptor:
    bLength                 9
    bDescriptorType         2
    wTotalLength          116
    bNumInterfaces          2
    bConfigurationValue     1
    iConfiguration          4 CARD READER
    bmAttributes         0x80
      (Bus Powered)
    MaxPower              500mA
    Interface Descriptor:
      bLength                 9
      bDescriptorType         4
      bInterfaceNumber        0
      bAlternateSetting       0
      bNumEndpoints           3
      bInterfaceClass        11 Chip/SmartCard
      bInterfaceSubClass      0
      bInterfaceProtocol      0
      iInterface              6 Smart Card Reader Interface
      ChipCard Interface Descriptor:
        bLength                54
        bDescriptorType        33
        bcdCCID              1.10  (Warning: Only accurate for version 1.0)
        nMaxSlotIndex           0
        bVoltageSupport         7  5.0V 3.0V 1.8V
        dwProtocols             3  T=0 T=1
        dwDefaultClock       3750
        dwMaxiumumClock      7500
        bNumClockSupported      0
        dwDataRate          10080 bps
        dwMaxDataRate      312500 bps
        bNumDataRatesSupp.      0
        dwMaxIFSD             254
        dwSyncProtocols  00000000
        dwMechanical     00000000
        dwFeatures       00010030
          Auto clock change
          Auto baud rate change
          TPDU level exchange
        dwMaxCCIDMsgLen       271
        bClassGetResponse      00
        bClassEnvelope         00
        wlcdLayout           none
        bPINSupport             0
        bMaxCCIDBusySlots       1
      Endpoint Descriptor:
        bLength                 7
        bDescriptorType         5
        bEndpointAddress     0x83  EP 3 IN
        bmAttributes            3
          Transfer Type            Interrupt
          Synch Type               None
          Usage Type               Data
        wMaxPacketSize     0x0040  1x 64 bytes
        bInterval               8
      Endpoint Descriptor:
        bLength                 7
        bDescriptorType         5
        bEndpointAddress     0x05  EP 5 OUT
        bmAttributes            2
          Transfer Type            Bulk
          Synch Type               None
          Usage Type               Data
        wMaxPacketSize     0x0200  1x 512 bytes
        bInterval               0
      Endpoint Descriptor:
        bLength                 7
        bDescriptorType         5
        bEndpointAddress     0x86  EP 6 IN
        bmAttributes            2
          Transfer Type            Bulk
          Synch Type               None
          Usage Type               Data
        wMaxPacketSize     0x0200  1x 512 bytes
        bInterval               0
(omitting the mass storage part)
I tried:
% gpg --card-status
gpg: pcsc_establish_context failed: no service (0x8010001d)
gpg: card reader not available
gpg: OpenPGP card not available: general error
% opensc-tool --list-readers
Error: can't open /var/run/openct/status: No such file or directory
[opensc-tool] reader-pcsc.c:906:pcsc_detect_readers:
SCardEstablishContext failed: 0x8010001d
[opensc-tool] reader-pcsc.c:1015:pcsc_detect_readers: returning with: No
readers found
Readers known about:
Nr.    Driver     Name
0      openct     OpenCT reader (detached)
1      openct     OpenCT reader (detached)
Any help would be greatly appreciated!

@_date: 2010-08-27 20:04:22
@_author: David Mohr 
@_subject: How to use the gnupg card with an akasa smart card reader? 
I'm running gnupg 1.4.10 on Debian sid.
I had found that report but thought the guy was using a different reader
afterall since it was identified as MSI StarReader.
But your pointer caused me to try it again, and I found out that I
didn't have pcscd installed! Without this, pcsc_scan seems to be pretty
useless. I'm sure there is a reason not to have a dependency on there in
Debian, but it would have been pretty helpful in my case :-). I must
have overlooked that package since it was mentioned on the linked
ubuntuforum post.
Now I get some sensible output:
% gpg --card-status
gpg: detected reader `MSI StarReader SMART [Smart Card Reader Interface]
(20070818000000000) 00 00'
Thanks for doing some digging. Sometimes another little hint is all
that's required! :-)
I'll post again sometimes soon to see if the card _actually_ worked.
