
@_date: 2013-08-05 12:31:13
@_author: kardan 
@_subject: Why trust any software? 
I would like to widen the view of this thread as the question not only
apply to windows software in my eyes.
This is heard very often. How can I check if this is true for a
particular piece of software? For the kernel reviews can be tracked via
LKML but not every code is so popular. How to see how many people really
read and approved a patch for example? Also the number may not be that
relevant than if experienced developers did.
On Fri, 26 Jul 2013 09:22:32 -0400
I would love this person even showing up to approve if there is no
attack - just for me feeling better.
On Fri, 26 Jul 2013 00:14:08 +0200
Also many linux users look strange at me if I say I do compile parts
of my debian system.
Fri, 26 Jul 2013 09:22:32 -0400
Can you please explain what you mean by PKC in this context?
Do you know of signing mechanisms for developers to
 A have special keys for signing code changes
 B sign each others keys to approve they are knowledged enough to
 understand and check the code reliably.
 C sign a piece of software/patch/commit with it
? Also it is interesting to differ between source and binaries -
tracking source changes and builds separatedly or even confirm a
trust chain with a combination of both.
There is a discussion going on [1] about this proposing deterministic
builds system like gitian [2]. What do you think of it and is this
applicable to gnupg as well?
[1] [2]

@_date: 2013-08-07 21:37:46
@_author: kardan 
@_subject: Why trust any software? 
thanks for your thoughts and sorry for this copy/paste nightmare. I
tried to fit in my thoughts, but if you think this topic is on the wrong
list, don't hesitate to slap me into the right direction, please.
On Mon, 05 Aug 2013 08:35:24 -0400
I can't do that myself yet, but I can roughly imagine a scripted way for
storing the signatures on some pool which could be checked in a
scripted way from command line or even a "trusted" gui in the future. I
even could live with a mechanism of cenralized archive for this like
the debian's packaging system.
So looking a bit in the future I would say, if it is worth and really
would help to authenticate the trust of software, we [whoever sees
the need for it] could establish such an infrastructure in the next
Surely they do because I don't compile all of system.
I think it could set up on top of the debian web of trust or any
other developers's trust chain.
Currently for example debian maintainers undergo some social tests to
become DD once which does not mean that all their future  packages are
done well enough, to not allow any exploits (not talking about any
intended security holes). < I had not time to go through all of this, but maybe some of you still
remember and can add some final thoughts.
Package checks and bug tracking are merely done on a trial and error
base. Although I know the security team takes big efforts to find such
vulnerabilites and to fix them in short time. (Which I am extremely
grateful for).
However, this has be shown to be insufficient and I wonder how a
structured process could look like to check packages before they wander
into a distro.
Would this really help?
< < < $ gem install gitian
Fetching: gitian-0.0.3.gem (100%)
           Thanks for installing Gitian! You can now run:
    gem gitian        use Gitian.org or another distribution as your
    main gem source
Successfully installed gitian-0.0.3
1 gem installed
Installing ri documentation for gitian-0.0.3...
Installing RDoc documentation for gitian-0.0.3...
$  gem gitian
Please verify fingerprint for  is
 A9:24:34:B6:63:16:80:6A:06:9B:30:29:D0:EA:9C:0D:3D:86:A9:32
High security policy enabled.  You will get an 'unsigned gem' error if
you try to install a gem from a normal, non-signing gem repository.
Use 'gem gitian --undo' if you want to install an unsigned gem. Sources
in ~/.gemrc:
- Gem defaults: --trust-policy HighSecurity
So from now in theory I can trust that all gems installed in the future
are signed with a trusted certificate. Unfortunately the files on  are last touched in 2009 (same for
 ).
The gitian-builder for builds in a consolidated VM looks more current:
"This package can do a deterministic build of a package inside a VM"
So I have no conclusion but I would like to keep the discussion running
to step towards what seems impossible for now.

@_date: 2013-07-13 23:56:49
@_author: kardan 
@_subject: searching for keys 
When I search for a key via browser on [1] I get an unencrypted answer
from [2]. This happens for some keys that are onlyavailable on some servers. The problem is that the info, whose key I am
searching is presented to sniffers in plaintext. I think the encrypted
pool should not forward to unencrypted web interfaces.
[1] [2] Another but related issue on the command line:
$ gpg --search hkps.pool.sks-keyservers.net
gpg: searching for "hkps.pool.sks-keyservers.net" from hkps server
hkps.pool.sks-keyservers.net gpgkeys: HTTP search error 60: server
certificate verification failed.
CAfile: /usr/local/share/ca-certificates/sks-keyservers.netCA.crt
CRLfile: none gpg: key "hkps.pool.sks-keyservers.net" not found on
keyserver gpg: keyserver internal error gpg: keyserver search failed:
keyserver error
The last three error messages are misleading and contradicting, but this
is just a gpg problem. Interesting is error 60 by gpgkeys. Calling curl
$ curl
curl: (60) SSL certificate problem: unable to get local issuer
certificate chain
More details here: curl performs SSL certificate verification by default, using a "bundle"
 of Certificate Authority (CA) public keys (CA certs). If the default
 bundle file isn't adequate, you can specify an alternate file
 using the --cacert option.
If this HTTPS server uses a certificate signed by a CA represented in
 the bundle, the certificate verification probably failed due to a
 problem with the certificate (it might be expired, or the name might
 not match the domain name in the URL).
If you'd like to turn off curl's verification of the certificate, use
 the -k (or --insecure) option.
curl: (60) SSL certificate problem: self signed certificate in
certificate chain More details here:
Which is the same output as for
$ curl
--cacert /usr/local/share/ca-certificates/sks-keyservers.netCA.crt
$ curl
--cacert /etc/ssl/certs/sks-keyservers.netCA.pem
Both files are identical and can be seen below, retrieved via
echo "QUIT"|openssl s_client -connect $DOMAIN:443 2>&1 | \
sed -ne "/^-----BEGIN CERTIFICATE/,/^-----END CERTIFICATE/p" > $PEMFILE
As suggested in [3] my gpg.conf contains the foll. I found that I can
leave out the ca-cert-file following option, if the key has been added
to the bundle via update-ca-certificates:
auto-key-locate cert pka ldap hkps://hkps.pool.sks-keyservers.net
keyserver hkps://hkps.pool.sks-keyservers.net
keyserver-options no-honor-keyserver-url
What else needs to be done to retrieve gpg keys? A similar error
has been posted [4] on the curl list without an answer, maybe because
the message "". Seems as the problem is with the server certificate,
isn't it?
It would be great to have more meaningful error messages for gnupg,
also for "HTTP search error 77" when a wrong cert file is defined.
[3] [4] ii  curl                                  7.31.0-2
ii  gnupg-curl                            1.4.12-7
SSL certificate for hkps.pool.sks-keyservers.net:
-----BEGIN CERTIFICATE-----
-----END CERTIFICATE-----

@_date: 2013-07-14 09:46:31
@_author: kardan 
@_subject: searching for keys 
On Sat, 13 Jul 2013 20:20:16 -0500 Larry Brower
I worry about the general possibility to search keys without revealing
any metadata to the public. I think this is legitimate. If one sends
them to me encryptedly via email even better, but I need to have the
possibility to update them frequently to observe revocations and other
changes (best with low frequency via parcimonie). Or did you mean there
is a possibility to request keys via email from the key server? I never
heard of.
Am Sun, 14 Jul 2013 02:33:43 +0000
schrieb Henry Hertz Hobbit :
Thanks for the inspection! From my limited view I can not say what
makes a keyserver legitmate. This is what whois says for me
   Domain Name: SKS-KEYSERVERS.NET
   Registrar: PDR LTD. D/B/A PUBLICDOMAINREGISTRY.COM
   Whois Server: whois.PublicDomainRegistry.com
   Referral URL:    Name Server: NS1.KFWEBS.NET
   Name Server: NS10.SKS-KEYSERVERS.NET
   Name Server: NS11.SKS-KEYSERVERS.NET
   Name Server: NS12.SKS-KEYSERVERS.NET
   Name Server: NS13.SKS-KEYSERVERS.NET
   Name Server: NS6.SKS-KEYSERVERS.NET
   Status: clientTransferProhibited
   Updated Date: 17-feb-2013
   Creation Date: 01-dec-2006
   Expiration Date: 01-dec-2015
Searching for the owner via gpg brings different results without
success. I assume the pool is not that well mantained?
$ gpg --search
kf at kfwebs.net gpg: suche nach "kf at kfwebs.net" auf hkps-Server
pool.sks-keyservers.net gpgkeys: HTTP search error 51:
gnutls_handshake() warning: The server name sent was not recognized
$ gpg --verbose --keyserver-options=debug --search kf at kfwebs.net
gpg: searching for "kf at kfwebs.net" from hkps server
pool.sks-keyservers.net gpgkeys: curl version = libcurl/7.31.0
GnuTLS/2.12.23 zlib/1.2.8 libidn/1.25 libssh2/1.4.3 librtmp/2.3
gpgkeys: search type is 0, and key is "kf at kfwebs.net"
* About to connect() to pool.sks-keyservers.net port 443 (
*   Trying 192.0.224.138...
* Adding handle: conn: 0x984de90
* Adding handle: send: 0
* Adding handle: recv: 0
* Curl_addHandleToPipeline: length: 1
* - Conn 0 (0x984de90) send_pipe: 1, recv_pipe: 0
* Connection refused
*   Trying 192.95.24.133...
* Connection refused
*   Trying 198.82.169.69...
* Connected to pool.sks-keyservers.net (198.82.169.69) port 443 (
* found 1 certificates
in /etc/ssl/certs/hkps.pool.sks-keyservers.net.pem
* server certificate verification failed.
CAfile: /etc/ssl/certs/hkps.pool.sks-keyservers.net.pem CRLfile: none
* Closing connection 0
gpgkeys: HTTP search error 60: server certificate verification failed.
CAfile: /etc/ssl/certs/hkps.pool.sks-keyservers.net.pem CRLfile: none
gpg: key "kf at kfwebs.net" not found on keyserver gpg: keyserver internal
error gpg: keyserver search failed: keyserver error
$ gpg --verbose --keyserver-options=debug --search kf at kfwebs.net
* About to connect() to pool.sks-keyservers.net port 443 (
*   Trying 173.175.198.28...
gpg: keyserver timed out
gpg: keyserver search failed: keyserver error
*   Trying 91.121.176.163...
* server certificate verification failed.
  CAfile: /etc/ssl/certs/hkps.pool.sks-keyservers.net.pem CRLfile: none
*   Trying 88.198.24.12...
* server certificate verification failed.
  CAfile: /etc/ssl/certs/hkps.pool.sks-keyservers.net.pem CRLfile: none
*   Trying 87.106.189.5...
* server certificate verification failed.
  CAfile: /etc/ssl/certs/hkps.pool.sks-keyservers.net.pem CRLfile: none
*   Trying 80.90.43.162...
* server certificate verification failed.
  CAfile: /etc/ssl/certs/hkps.pool.sks-keyservers.net.pem CRLfile: none
*   Trying 80.241.60.3...
* Adding handle: conn: 0x89cee90
* Adding handle: send: 0
* Adding handle: recv: 0
* Curl_addHandleToPipeline: length: 1
* - Conn 0 (0x89cee90) send_pipe: 1, recv_pipe: 0
* Connected to pool.sks-keyservers.net (80.241.60.3) port 443 (
* found 1 certificates
  in /etc/ssl/certs/hkps.pool.sks-keyservers.net.pem
* gnutls_handshake() warning: The server name sent was not recognized
*   Trying 66.114.139.158...
* Adding handle: conn: 0x90efe90
* Adding handle: send: 0
* Adding handle: recv: 0
* Curl_addHandleToPipeline: length: 1
* - Conn 0 (0x90efe90) send_pipe: 1, recv_pipe: 0
* Connected to pool.sks-keyservers.net (66.114.139.158) port 443 (
* found 1 certificates
  in /etc/ssl/certs/hkps.pool.sks-keyservers.net.pem
* gnutls_handshake() failed: An unexpected TLS packet was received.
Interesting, what are scenarios for a "bad" keyservers beneath
sending me wrong keys? The pool is maintained by Kristian Fiskerstrand
(kfwebs.net) who publishes about PGP/gpg quite a while and see no
reason to not trust him. I took the link from the mentioned gpg howto
by Daniel Kahn Gilmore:
That is not my concern either, but data retention is quite aggressive
in europe as well. I just think it is a bad idea the reveal when I
search whose gpg first and when they are updated (see above). Speaking
of Snowden allow me one noteworthy quote from his yesterday's statement:
"This willingness by powerful states to act extra-legally represents a
threat to all of us, and must not be allowed to succeed."
Have a good day remembering those who don't!

@_date: 2013-07-16 04:38:55
@_author: kardan 
@_subject: searching for keys 
Hi, this already solved my mystery. Sorry that this was an easy one and
thanks for all your answers! I changed the certificate and feel a bit
more knowledged now. I usually retrieve TLS certificates with the
attached script (feedback appreciated) on first contact, thus I falsely
ignored the pool cert.
14 Jul 2013 12:08:27 +0200 Pete Stephenson :
Amazing, the first time I saw somebody registering with a fingerprint
in the domain holder field.
Sorry, I was too tired.
I wonder how long the 15kb key will be safe. For my understanding with
current hardware it is possible to attack keys below 1kb. This means
anything encrypted below in the last years will be readable quite soon.
So the key used for encryption now should be choosen to not only
withstand current cluster power but must last next 50 years for
example. Otherwise all the data currently sniffed by the NSA, Iran,
google, etc. will be plain until governments become repressive enough
which is, looking at the last decade, before I am 60. (I hope you
correct me to be wrong for missing a significant detail.)
Good to know how to overcome IPv4 scarcity for TLS.
Curl has no problems with this one either.
* Curl_addHandleToPipeline: length: 1
* - Conn 0 (0x8dc66a0) send_pipe: 1, recv_pipe: 0
* Connected to keyserver.secretresearchfacility.com (80.241.60.3) port 443 (
* found 1 certificates in /home/kardan/config/certs/sks-keyservers.netCA.pem
*        server certificate verification OK
*        common name: keyserver.secretresearchfacility.com (matched)
14 Jul 2013 13:37:18 +0200 Kristian Fiskerstrand
I see, the links on  are indeed to http

@_date: 2013-07-17 13:44:15
@_author: kardan 
@_subject: gpg-keycheck && tlscert-get 
Dear gpg users,
I think top priority is to make OpenPGP / GnuPG more user friendly and
especially user understandable. So I took Daniel's howto and wrapped
a key tester around it. It contains links to some gpg documentation
for interested users. If you find important howtos are missing, please
let me know. Also if there are testcases which should be included (like key relation
checks for advanced usage).
So far this is a bash script. If it turns out, that that there are
higher demands, I will consider a rewrite in perl, except somebody
comes up with something fancy like python or ruby :)
I also had in mind, to create an output that is easy transportable via
email to inform other users, if their keys do not comply current
For example my own key shows I should create a new one (however it
does not tell me about the mess I created on the keyservers with my
unrevocable lost keys):
----- BEGIN PGP KEY CHECK -----
PUBLIC KEY ID           9D6108AE58C06558
ALGORITHM               RSA SHA1 SIGNATURES         yes (INSECURE) [2]
ALGORITHM PRIORITY      8 2 9 10 11 (DISORDER) [3]
[WARNING] Better generate a new key [1]. (Show detailed reasons with
'gpg-keycheck -v 9D6108AE58C06558')
  [1] steps to create a key
  [2] SHA1 broken
  [3]
  [4] update your web of trust (WoT)
pub   2048R/9D6108AE58C06558 2013-04-23 [expires: 2014-06-30]
----- END PGP KEY CHECK -----
This is the condensed version with the basic info (-p). If you are
curious what 'gpg-keycheck -v 9D6108AE58C06558' says, have a try :)
Unlike for 'gpg --list-key' it is possible to dump a fingerprint like
the one below without changes. If you have an idea, how to catch the
'key not found error' and automatically download them, please share. But
maybe this is overkill.
I also attached the script for retrieving tls certificates which
i forgot in my last mail.
Happy hacking!

@_date: 2013-07-18 20:43:07
@_author: kardan 
@_subject: searching for keys: hkpms 
I reuse the thread as this topic is quite related.
From the parcimonie [1] manual one sentence hit my brain: "if using
hkps:// (which would be our second choice behind hkpms://)". To be
honest, this is the first time I heard of hkpms, despite I am a reading
some lists and try to keep up with security topics.
As Wikipedia has no article [2] on this yet by this (eventually I find
time in some quite night hour) I try to summarize my finding in case
others find this useful or are keen to add something.
[1] [2] This the parcimonie manual does say:
< in the nearer term, you could also use msva-perl with hkpms (if you want
to verify remote hosts via the OpenPGP web of trust).
< Monkeysphere's hkpms:// support will be used as soon as possible in
place of the hierarchical X.509 certification model.
hkpms is available in Debian: msva-perl
< "Cryptographic identity validation agent"
 The Monkeysphere Validation Agent offers a local service for tools to
validate certificates (both X.509 and OpenPGP) and other public keys.
This package contains a perl implementation of a Monkeysphere
< In addition, this project being what it is, there is now also a
Monkeysphere-enabled hkps ("hkpms") module provided with the
Monkeysphere validation agent package (msva-perl in Debian). This uses
the users monkeysphere validation agent, if running, to confirm the
identify of the keyserver. The Monkeysphere developers have signed the
host key of keys.mayfirst.org? so if you have a trust path to the
Monkeysphere developers you can try using hkpms://keys.mayfirst.org.
I found that Kristian's key is signed for hkpms too, while the manual
also recommends to use a different pool server for parcimonie than
for daily requests.
To use hkpms with the above I add to ~/.gnupg/gpg.conf
keyserver hkpms://hkps.pool.sks-keyservers.net
keyserver-options http-proxy=socks://127.0.0.1:9050
$ gpg --search cia
gpg: searching for "cia" from hkpms server hkps.pool.sks-keyservers.net
gpgkeys: protocol `hkpms' not supported
gpg: no handler for keyserver scheme `hkpms'
gpg: keyserver search failed: keyserver error
Of course! How should gpg know how to handle monkeysphere requests if
it is not installed. So we need to install msva-perl.
$ gpg --search cia
Requesting a socks proxy for hkpms, but LWP::Protocol::socks is not
installed. This will likely fail.
'ca-cert-file=/etc/ssl/certs/sks-keyservers.netca.pem' as an
option, but gpgkeys_hkpms does not implement it. Ignoring... HTTPS
error: 501 Protocol scheme 'socks' is not supported
Currently msva-perl recommends liblwp-protocol-socks-perl but I usually
drop recommendations by config due to limited disk space. So I also
installed liblwp-protocol-socks-perl (maybe it should become a
dependency of msva-perl in future versions).
$ gpg --search cia
gpg: searching for "cia" from hkpms server hkps.pool.sks-keyservers.net
gpg: error reading key: public key not found
Monkeysphere HKPMS Certificate validation failed:
  Failed to validate " through the
OpenPGP Web of Trust. HTTPS error: 500 Can't call method
"http_configure" on an undefined value gpg: key "cia" not found on
This often puzzles me with gnupg. Gpg tells 'public key not found' which
in the first place confuses me to think that no key CAN be found.
Instead it would be better to suppress the info due to the connection
issues. But it understand is sometimes hard to implement this for all
unforeseen errors with underlaying connection layers.
Ok. Now I need to understand and setup monkeysphere. What is it and
what do I need to do?
Have you ever thought: What about having a list of trusted IP addresses?
Trusted means, I think the admins of this server are knowledged and
responsible enough to take care, that all the applications on that
server are not vulnerable for spambots, trojans, arbitrary code
execution and other kind of remote usage. In other words: How to
designate a host to only do "good" thinks.
This is what Monkeysphere helps with. Monkeysphere manages your trusted
ssh servers/clients stored in .ssh. Also it will keep a list of trusted
TLS certificates.
From the FAQ:
How does it work?
To summarize what I have learned:
The hkpms protocol provides monkeysphere authenticated secured
connections for gpg key searches. As I send them through the TOR
network they are also anonymized. This is quite quite as by this I can
be sure, that no one can log which keys I am searching for, that they
keep updated and even in case Kristian or any server in the pool is an
evil eavesdropper, they do not know my WoT. (I hope somebody tells me,
if I misunderstood or missed something.)
This also is an issue for ssh. From /etc/monkeysphere/monkeysphere.conf:
# Set whether or not to check keyservers at every monkeysphere
# interaction, including all ssh connections if you use the
# monkeysphere ssh-proxycommand.  Leave unset for default behavior
# (see KEYSERVER CHECKING in monkeysphere(1)), or set to true or false.
# NOTE: setting CHECK_KEYSERVER explicitly to true will leak
# information about the timing and frequency of your ssh connections
# to the maintainer of the keyserver.
So something like parcimonie for gpg keys would be useful then as well.
Finally I would like to ask in the round, if this evaluation from the
FAQ is still uptodate:
I'm curious about your corrections.

@_date: 2018-08-11 09:49:03
@_author: kardan 
@_subject: ERR 167804929 Permission denied / No rule to make target 
today i was able to catch up on gnupg and IPv6 (somehow I missed the
primer before). Long story below, here's the short fix:
echo "SocksPort 9050 IPv6Traffic" >> /etc/tor/torrc # don't run it
I have two issues with gpg on debian buster. dirmngr constantly fails
(does not anymore) to search for keys:
$ gpg --search 74A941BA219EC810
gpg: error searching keyserver: Permission denied
gpg: keyserver search failed: Permission denied
$ gpg --version
gpg (GnuPG) 2.2.9
libgcrypt 1.8.3
Copyright (C) 2018 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later
 This is free software: you are free
to change and redistribute it. There is NO WARRANTY, to the extent
permitted by law.
Home: /home/user/.gnupg
Supported algorithms:
Pubkey: RSA, ELG, DSA, ECDH, ECDSA, EDDSA
Cipher: IDEA, 3DES, CAST5, BLOWFISH, AES, AES192, AES256, TWOFISH,
        CAMELLIA128, CAMELLIA192, CAMELLIA256
Hash: SHA1, RIPEMD160, SHA256, SHA384, SHA512, SHA224
Compression: Uncompressed, ZIP, ZLIB, BZIP2
Long version for Werner and other gurus I fail to name:
$ gpg --debug-level=guru --recv-key 74A941BA219EC810
gpg: enabled debug flags: packet mpi crypto filter
iobuf memory cache memstat trust hashing ipc clock lookup extp rog
gpg: DBG: [not enabled in the source]
start gpg: DBG: chan_3 <- # Home: /home/user/.gnupg
gpg: DBG: chan_3 <- #
Config: /home/user/.gnupg/dirmngr.conf gpg: DBG: chan_3 <- OK Dirmngr
2.2.9 at your service gpg: DBG: connection to the dirmngr established
gpg: DBG: chan_3 -> GETINFO version
gpg: DBG: chan_3 <- D 2.2.9
gpg: DBG: chan_3 <- OK
gpg: DBG: chan_3 -> KS_GET -- 0x74A941BA219EC810
gpg: DBG: chan_3 <- ERR 167804929 Keine Berechtigung gpg: keyserver receive failed: Permission denied
gpg: DBG: chan_3 -> BYE
gpg: DBG: [not enabled in the source] stop
gpg: keydb: handles=0 locks=0 parse=0 get=0
gpg:        build=0 update=0 insert=0 delete=0
gpg:        reset=0 found=0 not=0 cache=0 not=0
gpg: kid_not_found_cache: count=0 peak=0
flushes=0 gpg: sig_cache: total=0 cached=0 good=0 bad=0   gpg: random usage: poolsize=600 mixed=0 polls=0/0 added=0/0
              outmix=0 getlvl1=0/0 getlvl2=0/0
gpg: rndjent stat: collector=0x00000000 calls=0 bytes=0
gpg: secmem usage: 0/65536 bytes in 0 blocks
) =
39 write(3, "KS_GET -- 0x74A941BA219EC810", 28) =
28 write(3, "\n", 1)                       =
1 read(3, "ERR 167804929 Keine Berechtigung"..., 1002) =
42 read(3, "\n", 960)                      =
1 write(2, "gpg: DBG: ", 10gpg: DBG: )              =
10 write(2, "chan_3 <- ERR 167804929 Keine Be"..., 53chan_3 <- ERR
167804929 Keine Berechtigung  ) =
53 openat(AT_FDCWD,
"/usr/share/locale/en_US.UTF-8/LC_MESSAGES/libc.mo", O_RDONLY) = -1
ENOENT (No such file or dirctory) openat(AT_FDCWD,
"/usr/share/locale/en_US.utf8/LC_MESSAGES/libc.mo", O_RDONLY) = -1
ENOENT (No such file or diretory) openat(AT_FDCWD,
"/usr/share/locale/en_US/LC_MESSAGES/libc.mo", O_RDONLY) = -1 ENOENT
(No such file or directory) openat(AT_FDCWD,
"/usr/share/locale/en.UTF-8/LC_MESSAGES/libc.mo", O_RDONLY) = -1 ENOENT
(No such file or directry) openat(AT_FDCWD,
"/usr/share/locale/en.utf8/LC_MESSAGES/libc.mo", O_RDONLY) = -1 ENOENT
(No such file or directoy) openat(AT_FDCWD,
"/usr/share/locale/en/LC_MESSAGES/libc.mo", O_RDONLY) = -1 ENOENT (No
such file or directory) write(2, "gpg: keyserver receive failed: P"...,
48gpg: keyserver receive failed: Permission denied) = 48 write(2, "\n",
1 )                       = 1 write(2, "gpg: DBG: ", 10gpg:
DBG: )              = 10 write(2, "chan_3 -> BYE\n", 14chan_3 ->
BYE )         = 14 write(3, "BYE", 3)                      = 3 write(3,
"\n", 1)                       = 1
close(3)                                = 0 write(2, "gpg: DBG: [not
enabled in the so"..., 42gpg: DBG: [not enabled in the source] stop) =
42 write(2, "\n", 1 )                       = 1 write(2, "gpg: keydb:
handles=0 locks=0 pa"..., 43gpg: keydb: handles=0 locks=0 parse=0
get=0) = 43 write(2, "\n", 1 )                       = 1 write(2,
"gpg:        build=0 update=0 ins"..., 46gpg:        build=0 update=0
insert=0 delete=0) = 46 write(2, "\n", 1 )                       = 1
write(2, "gpg:        reset=0 found=0 not="..., 47gpg:        reset=0
found=0 not=0 cache=0 not=0) = 47 write(2, "\n",
1 )                       = 1 write(2, "gpg: kid_not_found_cache:
count="..., 50gpg: kid_not_found_cache: count=0 peak=0 flushes=0) = 50
write(2, "\n", 1 )                       =
1 write(2, "gpg: sig_cache: total=0 cached=0"..., 45gpg: sig_cache:
total=0 cached=0 good=0 bad=0) = 45 write(2, "\n", 1
)                       = 1
write(2, "\n", 1
)                       = 1
write(2, "gpg: random usage: poolsize=600 "..., 59gpg: random usage:
poolsize=600 mixed=0 polls=0/0 added=0/0) = 59
write(2, "\n", 1
)                       = 1
write(2, "              outmix=0 getlvl1=0"..., 46
outmix=0 getlvl1=0/0 getlvl2=0/0) = 46 write(2, "\n", 1
)                       = 1
write(2, "gpg: rndjent stat: collector=0x0"..., 55gpg: rndjent stat:
collector=0x00000000 calls=0 bytes=0) = 55 write(2, "\n", 1
)                       = 1
write(2, "gpg: secmem usage: 0/65536 bytes"..., 37gpg: secmem usage:
0/65536 bytes in 0) = 37 write(2, " blocks\n", 8 blocks
)                = 8
munmap(0xb7f68000, 65536)               = 0
exit_group(2)                           = ?
+++ exited with 2 +++
 End of log
I stopped dirmngr several times, tried 'dirmngr --flush', started it
with 'dirmngr --debug-all --standard-resolver' when searching for keys.
It showed nothing so I assume gpg starts another instance of dirmngr in
the background. Removing ~/.gnupg did not help either.
My second issue is trying to install latest dirmngr from git:
$ git clone  ; cd gnupg
# apt install libksba-dev libnpth0-dev libassuan-dev libgcrypt20-dev
$ ./autogen.sh && ./configure --prefix=$HOME && make
        GnuPG v2.3.0-beta440 has been configured as
follows:                                                            Revision:  1b309d9f6  (6960)
        Platform:  GNU/Linux (i686-pc-linux-gnu)
        OpenPGP:   yes
        S/MIME:    yes
        Agent:     yes
        Smartcard: yes (without internal CCID driver)
        G13:       no
        Dirmngr:   yes
        Gpgtar:    yes
        WKS tools: no
        Protect tool:      (default)
        LDAP wrapper:      (default)
        Default agent:     (default)
        Default pinentry:  (default)
        Default scdaemon:  (default)
        Default dirmngr:   (default)
        Dirmngr auto start:  yes
        Readline support:    no
        LDAP support:        no
        TLS support:         gnutls
        TOFU support:        yes
        Tor support:         yes
make  all-recursive
make[1]: Entering directory '/media/user/src/gnupg'
Making all in m4
make[2]: Entering directory '/media/user/src/gnupg/m4'
make[2]: Nothing to be done for 'all'.
make[2]: Leaving directory '/media/user/src/gnupg/m4'
Making all in common
make[2]: Entering directory '/media/user/src/gnupg/common'
make[2]: *** No rule to make target 'audit-events.h', needed by 'all'.
Stop. make[2]: Leaving directory '/media/user/src/gnupg/common'
make[1]: *** [Makefile:615: all-recursive] Error 1
make[1]: Leaving directory '/media/user/src/gnupg'
[make: *** [Makefile:535: all] Error 2
 End of log
Therefor I went back to investigate the origin of "ERR 167804929".
It is not a hardcoded in gnupg or tor, at least it doesn't show up in
the source with rgrep.
With the help of google (my favourite search engine left me on this)
I became aware of this log from ealier dirmngr 2.1.18, quoting
Jul 08 05:57:22 debian dirmngr[2574]: DBG: chan_5 <- KS_SEARCH -- intrig... at debian.org
Jul 08 05:57:24 debian dirmngr[2574]: resolve_dns_addr for 'hkps.pool.sks-keyservers.net': '[2a01:4a0:59:1000:223:9eff:fe00:100f]'
Jul 08 05:57:24 debian dirmngr[2574]: resolve_dns_addr for 'hkps.pool.sks-keyservers.net': '[2600:1f16:41e:bd0a::73:6b73]'
Jul 08 05:57:24 debian dirmngr[2574]: resolve_dns_addr for 'hkps.pool.sks-keyservers.net': '[2001:bc8:4700:2300::10:f15]'
Jul 08 05:57:24 debian dirmngr[2574]: resolve_dns_addr for 'hkps.pool.sks-keyservers.net': '[2001:470:1:116::6]'
Jul 08 05:57:24 debian dirmngr[2574]: resolve_dns_addr for 'hkps.pool.sks-keyservers.net': '216.66.15.2'
Jul 08 05:57:24 debian dirmngr[2574]: resolve_dns_addr for 'hkps.pool.sks-keyservers.net': '192.146.137.11'
Jul 08 05:57:24 debian dirmngr[2574]: resolve_dns_addr for 'hkps.pool.sks-keyservers.net': '68.187.0.77'
Jul 08 05:57:24 debian dirmngr[2574]: resolve_dns_addr for 'hkps.pool.sks-keyservers.net': '51.15.53.138'
Jul 08 05:57:24 debian dirmngr[2574]: resolve_dns_addr for 'hkps.pool.sks-keyservers.net': '37.191.226.104'
Jul 08 05:57:24 debian dirmngr[2574]: resolve_dns_addr for 'hkps.pool.sks-keyservers.net': '18.191.65.131'
Jul 08 05:57:24 debian dirmngr[2574]: can't connect to '2001:bc8:4700:2300::10:f15': Permission denied
Jul 08 05:57:24 debian dirmngr[2574]: error connecting to ' Permission denied
Jul 08 05:57:24 debian dirmngr[2574]: (Tor configuration problem)
Jul 08 05:57:24 debian dirmngr[2574]: DBG: chan_5 -> S WARNING tor_config_problem 0 Please check that the "SocksPort" flag
"IPv6Traffic" is set in torrc
Jul 08 05:57:24 debian dirmngr[2574]: command 'KS_SEARCH' failed:
Permission denied
Jul 08 05:57:24 debian dirmngr[2574]: DBG: chan_5 -> ERR 167804929
Permission denied Jul 08 05:57:24 debian dirmngr[2574]: DBG: chan_5 <- BYE
 End of quote
This error helped significantly, adding to torrc:
SocksPort PORT IPv6Traffic
It however may timeout with "No data" several times before succeeding.
Would be a great feature to catch this and retry for the sake of
scripted installations.
I imagine this could affect a lot of users, so it could have some
user time to restore this error message. Note that "gpg: DBG:
[not enabled in the source] stop" is the default packaged gnugp on
debian based systems.
Thanks for joining me on this interesting journey and please send back
suggestions on the compilation error. If you are interested, read part
two below when I try reproduce the error.
PartII: How to reproduct "Permission denied" with dirmngr
A usual quest after fixing an error is to try to make it happen again.
In this case, i removed the IPv6Traffic from the torrc line, stopped
tor altogether, killed all instances of dirmngr and gpgagent and
deleted the key:
$ gpg --delete-key 74A941BA219EC810
$ gpg --verbose --recv
74A941BA219EC810 gpg: data source:
 gpg: ASCII-H?lle: Version: SKS
1.1.6 gpg: ASCII-H?lle: Comment: Hostname:
zimmermann.mayfirst.org gpg: pub  rsa2048/0xEE8CBC9E886DDD89
2009-09-04  deb.torproject.org archive signing key
gpg: Tiefe: 0  g?ltig:   6  signiert:   0  Vertrauen: 0-, 0q, 0n, 0m,
0f, 6u gpg: n?chste "Trust-DB"-Pflicht?berpr?fung am 2018-12-20
gpg: Anzahl insgesamt bearbeiteter Schl?ssel: 1
gpg:                              importiert: 1
This is confusing because it should fail when tor is enabled:
$ cat ~/.gnupg/dirmngr.conf
 GPGConf ---+++
 GPGConf ---+++ Wed Jul 25 16:16:02 2018 CEST
# GPGConf edited this configuration file.
# It will disable options before this marked block, but it will
# never change anything below these lines.
And 'torsocks w3m  fails as expected.
So either gnupg ships it's own tor instance and runs it hiddenly, or it
found out how to recycle the circuit of my TBB or it silently falls back
to non-tor connections which is a bug.
So here I am left unable to reproduce the error, but at least this story
will help some later me to solve it again.
Thanks for following part II, am happy to read your thoughts on my
remaining questions:
1.  is it hard to restore the error from 2.1.18 (where to start)
2. how to fix: No rule to make target 'audit-events.h'
3. How does dirmngr connect when no tor circuit is available
4. Why does a foreground dirmngr does not show connections
5. How to enable "DBG: [not enabled in the source]"
6. Where's the database to look up ERR 167804929
7. How can I change the timeout?
I know that all answers can be solved by looking at the code, but maybe
someone can save me some time and I might be able to prepare a patch
stub in the next days. Thanks for taking the time to go through all
Have a nice day!
