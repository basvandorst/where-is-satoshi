
@_date: 2017-04-19 09:10:37
@_author: =?utf-8?B?w5ZiZXJnIEZyZWRyaWs=?= 
@_subject: Error decrypting after upgrading gpg (Windows) 
After upgrading from 1.2.2. to 2.0.30 we have problems decrypting files from our partner
C:\Temp\GnuPGtemp>gpg --version
gpg (GnuPG) 2.0.30 (Gpg4win 2.3.3)
libgcrypt 1.6.6
Copyright (C) 2015 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Home: C:/Users/UsrFoo/AppData/Roaming/gnupg
Supported algorithms:
Pubkey: RSA, RSA, RSA, ELG, DSA
Cipher: IDEA, 3DES, CAST5, BLOWFISH, AES, AES192, AES256, TWOFISH,
        CAMELLIA128, CAMELLIA192, CAMELLIA256
Hash: MD5, SHA1, RIPEMD160, SHA256, SHA384, SHA512, SHA224
Compression: Uncompressed, ZIP, ZLIB, BZIP2
Decrypting with
C:\Temp\GnuPGtemp>gpg -vv -o 401611390.170302.txt -d 401611390.170302
results in this:
:pubkey enc packet: version 3, algo 16, keyid [keyid]
        data: [2048 bits]
        data: [2048 bits]
gpg: public key is [subkey]
gpg: using subkey [subkey] instead of primary key [primarykey]
You need a passphrase to unlock the secret key for
user: "[my organization]"
gpg: using subkey [subkey] instead of primary key [primarykey]
2048-bit ELG key, ID [subkey], created 2009-09-16 (main key ID [primarykey])
gpg: public key encrypted data: good DEK
:encrypted data packet:
        length: unknown
gpg: encrypted with 2048-bit ELG key, ID [subkey], created 2009-09-16
      "[my organization]"
gpg: 3DES encrypted data
:literal data packet:
        mode ? (A0), created 2927189294, name="\xb7\x0adR\xde\xd6\xed\x09A&\x11\x0do_\x14\xf2\x0b\xab%\xfa\x96\xdd\xf7\xcd1\x82\xc
        raw data: 2369445039 bytes
gpg: original file name='?
gpg: problem reading source (2369443780 bytes remaining)
gpg: handle plaintext failed: No such file or directory
gpg: decryption okay
gpg: WARNING: message was not integrity protected
The decrypted file contains just jibberish.
If I decrypt the same file with the ancient gpg 1.2.2 everything works fine.
Our partner tells us they encrypt the file with gpg version 1.2.1 using the command
gpg -e -c 3DES -r [our key]
Nothing has changed there since 2011.
Any ideas why it is fine to decrypt using 1.2.2 but not using 2.0.13?

@_date: 2017-02-16 11:13:01
@_author: =?iso-8859-1?Q?=D6berg_Fredrik?= 
@_subject: Cannot decrypt with 1.4.21 but with 1.2.2 
I work in an organization where we sometimes receive and send encrypted files. This is far from our core business and we are no experts on this, so please bear with me.
For managing the files, we use scripts calling gpg.exe. This is a Windows environment.
We have been running version 1.2.2 for ages but as we upgraded our server, we decided to upgrade GnuPG to 1.4.21. We use the simple installer for GnuPG Classic.
Yesterday we received an encrypted file which we couldn't decrypt. This is what happens:
C:\>c:\GnuPG_2016\gpg --homedir=C:\Keyring -d -v -v -o output.txt input.gpg
:pubkey enc packet: version 3, algo 16, keyid xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
        data: [2048 bits]
        data: [2048 bits]
gpg: public key is xxxxxxxx
gpg: using subkey xxxxxxxx instead of primary key xxxxxxxx
You need a passphrase to unlock the secret key for
user: "My organization"
2048-bit ELG-E key, ID xxxxxxxx, created 2009-09-16 (main key ID xxxxxxxx)
gpg: public key encrypted data: good DEK
:encrypted data packet:
        length: unknown
gpg: encrypted with 2048-bit ELG-E key, ID xxxxxxxx, created 2009-09-16
      "My organization"
gpg: 3DES encrypted data
gpg: [don't know]: invalid packet (ctb=1b)
gpg: decryption okay
gpg: WARNING: message was not integrity protected
gpg: [don't know]: invalid packet (ctb=68)
Just to be sure, this is 1.4.21:
C:\>c:\GnuPG_2016\gpg --version
gpg (GnuPG) 1.4.21
My first guess was that the file was corrupted in some way, as we get if by ftp from one of our partners. After hashing and re-transfering the file we could rule out file corruption during transfer. Then I decided to try to decrypt the file using an older version of GnuPG, 1.2.2. Then decryption works with no problem:
C:\>c:\gnupg\gpg -d -v -v -o output.txt input.gpg
:pubkey enc packet: version 3, algo 16, keyid xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
        data: [2048 bits]
        data: [2048 bits]
gpg: public key is xxxxxxxx
gpg: using secondary key xxxxxxxx instead of primary key xxxxxxxx
You need a passphrase to unlock the secret key for
user: "My organization"
gpg: using secondary key xxxxxxxx instead of primary key xxxxxxxx
2048-bit ELG-E key, ID xxxxxxxx, created 2009-09-16 (main key ID xxxxxxxx)
gpg: public key encrypted data: good DEK
:encrypted data packet:
        length: unknown
gpg: encrypted with 2048-bit ELG-E key, ID xxxxxxxx, created 2009-09-16
      "My organization"
gpg: 3DES encrypted data
:literal data packet:
        mode b, created xxxxxxxx, name="",
        raw data: 0 bytes
gpg: original file name=''
gpg: decryption okay
gpg: WARNING: message was not integrity protected
Version is 1.2.2:
C:\temp>c:\gnupg\gpg --version
gpg (GnuPG) 1.2.2
Can anybody explain what is happening? Why can we decrypt the file with an older version, but not with the newest one?
