
@_date: 2011-09-03 09:51:58
@_author: David Robertson 
@_subject: OpenPGP card not working 
Hash: SHA1
I've just bought myself a Gemplus/Gemalto GemPC twin USB smartcard
reader and a V2.0 OpenPGP card. I'm running Debian Squeeze. I've set up
udev rules as described here
 .
However, when I insert my card and type gpg --card-status I get (gpg
gpg: selecting openpgp failed: ec=6.108
gpg: OpenPGP card not available: general error
Using gpg2 (2.0.14), I get
gpg: selecting openpgp failed: Card error
gpg: OpenPGP card not available: Card error
If i su into root, I get a different output for  gpg 1.4.10:
gpg: pcsc_establish_context failed: no service (0x8010001d)
gpg: card reader not available
gpg: OpenPGP card not available: general error
How can I fix this?
Thanks in advance,
David Robertson.

@_date: 2011-09-03 09:34:28
@_author: David Robertson 
@_subject: OpenPGP card not working 
I've just bought myself a Gemplus/Gemalto GemPC twin USB smartcard
reader and a V2.0 OpenPGP card. I'm running Debian Squeeze. I've set up
udev rules as described here
 .
However, when I insert my card and type gpg --card-status I get (gpg 1.4.10)
gpg: selecting openpgp failed: ec=6.108
gpg: OpenPGP card not available: general error
Using gpg2 (2.0.14), I get
gpg: selecting openpgp failed: Card error
gpg: OpenPGP card not available: Card error
If i su into root, I get a different output for  gpg 1.4.10:
gpg: pcsc_establish_context failed: no service (0x8010001d)
gpg: card reader not available
gpg: OpenPGP card not available: general error
How can I fix this?
Thanks in advance,
David Robertson.

@_date: 2011-09-03 21:05:33
@_author: David Robertson 
@_subject: OpenPGP card not working 
It's in the output of lsusb:
 $ lsusb
Bus 007 Device 002: ID 08e6:3437 Gemplus GemPC Twin SmartCard Reader
Bus 007 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 006 Device 003: ID 0518:0002 EzKEY Corp. EZ-9900C Keyboard
Bus 006 Device 002: ID 15d9:0a41 Trust International B.V. MI-2540D
[Optical mouse]
Bus 006 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 005 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 004 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 003 Device 005: ID 148f:3070 Ralink Technology, Corp. RT2870/RT3070
Wireless Adapter
Bus 003 Device 002: ID 0644:0200 TEAC Corp. All-In-One Multi-Card Reader
Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 002 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
I'll take a look at those links now.
Thanks, David Robertson.
P.S. Sorry for sending that to you directly Martin, accidentally hit
reply rather than reply list.

@_date: 2011-09-07 21:13:45
@_author: David Robertson 
@_subject: OpenPGP card issues 
I posted this earlier:
I had it up and running since I posted this but yesterday it
spontaneously stopped working again.
I've since been emailing Martin Gollowitzer  from this
list as he helped me get it to work in the first place, but he ran out
of ideas of how to fix it.
Anyway, some background info:
* The reader is a Gemalto/gemplus GemPC twin (USB)
* The card is an OpenPGP V2.0 bought from kernelconcepts
* I'm pretty sure I've got all of the udev stuff set up fine, No changes
were made to anything udev when it broke, and I tried removing the
relevant rules and adding them with Martin's script from here
* Now, the outputs of gpg --card-status and gpg2 --card-status are as
david at david-desktop-debian:~$ gpg2 --card-status
gpg: selecting openpgp failed: Card error
gpg: OpenPGP card not available: Card error
david at david-desktop-debian:~$ gpg --card-status
gpg: selecting openpgp failed: ec=6.108
gpg: OpenPGP card not available: general error
david at david-desktop-debian:~$
* And as root:
david at david-desktop-debian:/$ sudo su
[sudo] password for david:
root at david-desktop-debian:/# gpg --card-status
gpg: pcsc_establish_context failed: comm error (0x80100013)
gpg: card reader not available
gpg: OpenPGP card not available: general error
root at david-desktop-debian:/# gpg2 --card-status
can't connect to `/root/.gnupg/S.gpg-agent': No such file or directory
scdaemon[6852]: PC/SC OPEN failed: comm error
gpg: selecting openpgp failed: Card error
gpg: OpenPGP card not available: Card error
root at david-desktop-debian:/# scdaemon[6852]: scdaemon (GnuPG) 2.0.14
* pcscd and gpg-agent are definatly running
Any ideas anyone?

@_date: 2011-09-08 23:14:24
@_author: David Robertson 
@_subject: OpenPGP card issues 
I don't have a ~/.gnupg/gpg-agent.conf and starting gpg-agent with
--use-standard-socket doesn't work:
david at david-desktop-debian:/$ gpg-agent --use-standard-socket
gpg-agent[4092]: can't connect to `/tmp/gpg-ZGPhgS/S.gpg-agent': No such
file or directory
gpg-agent[4092]: can't connect to `/home/david/.gnupg/S.gpg-agent': No such
file or directory
gpg-agent: can't connect to the agent: IPC connect call failed
david at david-desktop-debian:/$ sudo su
[sudo] password for david:
root at david-desktop-debian:/# gpg-agent --use-standard-socket
gpg-agent[4104]: can't connect to `/root/.gnupg/S.gpg-agent': No such file
or directory
gpg-agent: no gpg-agent running in this session
I've completely removed seahorse and that's done nothing either, so I've
reinstalled it for now. Also it seemed originally I only couldn't connect to
gpg-agent when I had SUed to root, now I seem to get this:
david at david-desktop-debian:/$ gpg2 --card-status
can't connect to `/tmp/gpg-ZGPhgS/S.gpg-agent': No such file or directory
gpg: can't connect to the agent - trying fall back
can't connect to `/home/david/.gnupg/S.gpg-agent': No such file or directory
scdaemon[4301]: PC/SC OPEN failed: comm error
gpg: selecting openpgp failed: Card error
gpg: OpenPGP card not available: Card error
david at david-desktop-debian:/$ scdaemon[4301]: scdaemon (GnuPG) 2.0.14
David Robertson.
djpeterrobertson at gmail.com

@_date: 2011-09-09 20:00:32
@_author: David Robertson 
@_subject: OpenPGP card issues 
I tried this:
david at david-desktop-debian:~$ unset GPG_AGENT_INFO
david at david-desktop-debian:~$ gpg-agent --use-standard --daemon sh
gpg-agent[7657]: a gpg-agent is already running - not starting a new one
david at david-desktop-debian:~$ pkill gpg-agent
david at david-desktop-debian:~$ gpg-agent --use-standard --daemon sh
$ gpg2 --card-status
gpg: selecting openpgp failed: Card error
gpg: OpenPGP card not available: Card error
