
@_date: 2002-01-19 18:27:02
@_author: Sven-S. Porst 
@_subject: using --status-fd 
I am currently trying to write a small program that uses gpg. To do this,
I set the --status-fd option to receive easy-to-use status information
which is very handy.
The only thing that still evades me is how I can tell when gpg has
finished asking questions (say for passphrases or whether I want to use
unsinged keys) and when I can begin to write the actual message that is
to be encrypted or signed. There doesn't seem to be a message sent by gpg
for this - so how can I tell?
            Sven

@_date: 2002-01-20 19:38:01
@_author: Sven-S. Porst 
@_subject: using --status-fd 
Not quite. I am actually happy using the --status-fd and --command-fd
options and answering the questions for passphrases etc. The thing that
isn't clear to me is when I have to enter the _message_ I want to sign/
encrypt if it isn't coming from a file as it is in your example. In your example, say we don't give the file foo, then it seems the
message to be signed has to be written after the GOOD_PASSPHRASE message
.. so in this case I could trigger dumping the message to command-fd and
sending ^D when receiving GOOD_PASSPHRASE. If, however, I am encrypting
the message only, the appearance of BEGIN_ENCRYPTION seems to be a good
time to dump the message. And worst of all, when I am signing and
encrypting, it _seems_ that dumping the message after receiving
GOOD_PASSPHRASE is a good idea - but it isn't because after sending
GOOD_PASSPHRASE, gpg may still send a '[GNUPG:] GET_BOOL
untrusted_key.override' message if I am encrypting to unsigned keys - so
I don't see a reliable condition that I can use to trigger the dumping of
the message and closing the input. I had expected to see some kind of GET_MESSAGE command on status-fd as a
trigger but that doesn't seem to exist so I suspect my approach may be
completely wrong. I hope the problem I have is more clear this time.
            Sven

@_date: 2002-01-21 11:13:01
@_author: Sven-S. Porst 
@_subject: message in --status-fd 
Hm, I'm not sure whether this is a user or a developer question. But as I
am not developing gpg, I hope it is OK if I ask here and equally hope
that some development-y people read this...
When using the --status-fd option and encountering a key that isn't self-
signed, the [GNUPG:] GET_BOOL untrusted_key.override
message will be issued. Is there a chance of having an extra item in that
message with the ID of the key in question anytime in the near future?
            Sven

@_date: 2002-01-21 17:10:01
@_author: Sven-S. Porst 
@_subject: using --status-fd 
This works in your example, but what to do in the following case
[dhcp97:~] ssp% gpg --status-fd=2 --command-fd=0 --encrypt -r foo --armor
--sign --
[GNUPG:] USERID_HINT 93D72D600085ABA3 Sven-S. Porst [GNUPG:] NEED_PASSPHRASE 93D72D600085ABA3 93D72D600085ABA3 17 0
[GNUPG:] GET_HIDDEN passphrase.enter
[GNUPG:] GOT_IT
[GNUPG:] GOOD_PASSPHRASE                                  [GNUPG:] GET_BOOL untrusted_key.override
[GNUPG:] GOT_IT
<< gpg output
So in this case I have to write the message after GOT_IT which of course
doesn't appear necessarily as the key might be trusted in which case I
would have to write out the message after GOOD_PASSPHRASE. It seems to me
that there is no definite command sent at the time at which entering the
message is required. So I fear this may be the wrong way to do it. In
particular I haven't yet managed to use anything but stdin as my --
command-fd (probably due to my lack of knowledge on these things) in
which case I could perhaps write my message to stdin right away and deal
with the --command-fd input separately.
I had a look at it a while ago and tried it out. Somehow it needed about
10 seconds just to give me information on the keys in my moderately small
keyrings - so I decided not to use it, particularly as I wanted to learn
how to interactively use command line tools from a program anyway.
            Sven
