
@_date: 2017-02-08 17:34:40
@_author: Dr. Basil Becker 
@_subject: Non-deterministic behavior using GnuPG and a smart-card 
Hi everyone,
since a few days I'm observing a rather non-deterministic behavior,
where GnuPG sometimes fails to find my private key, that is located at a
smart-card and sometimes everything works.
I wrote about the problem in more detail at launchpad.net
However, if anyone of you has an idea, what the problem could be, I'd be
pleased to hear about it.

@_date: 2017-02-08 22:20:56
@_author: Dr. Basil Becker 
@_subject: Non-deterministic behavior using GnuPG and a smart-card 
Peter, thanks for the clarification. I understand your point ;)
I'm having a setup consisting of a main key, and three sub-keys for
encryption, authorization and signature. The three sub-keys are stored
on  a Yubikey 4 smart-card.
Authentication and signatures work like a charme. I'm only having
problems concerning the decryption of mails I received. I'm using
thunderbird together with enigmail to read my mails, but as the problem
also occurrs at the CLI, I assume that enigmail is not part of the puzzle.
Well, some messages could be successfully decrypted:
bb at melmac:~$ gpg2 -vv --output /dev/null -d /tmp/message.txt
gpg: armor: BEGIN PGP MESSAGE
gpg: armor header: Version: GnuPG v2
# off=0 ctb=85 tag=1 hlen=3 plen=400
:pubkey enc packet: version 3, algo 1, keyid DBC1D85BA9D1D189
gpg: public key is 0xDBC1D85BA9D1D189
gpg: using subkey 0xDBC1D85BA9D1D189 instead of primary key
gpg: public key encrypted data: good DEK
# off=403 ctb=d2 tag=18 hlen=2 plen=0 partial new-ctb
:encrypted data packet:
gpg: using subkey 0xDBC1D85BA9D1D189 instead of primary key
gpg: encrypted with 3104-bit RSA key, ID 0xDBC1D85BA9D1D189, created
      "Dr. Basil Becker "
gpg: AES256 encrypted data
# off=424 ctb=a3 tag=8 hlen=1 plen=0 indeterminate
:compressed packet: algo=2
# off=426 ctb=cb tag=11 hlen=2 plen=0 partial new-ctb
:literal data packet:
gpg: original file name=''
gpg: decryption okay
Some messages, however, fail to decrypt:
bb at melmac:~$ gpg2 -vv --output /dev/null -d /tmp/message-fail.txt
gpg: armor: BEGIN PGP MESSAGE
gpg: armor header: Version: GnuPG v2
# off=0 ctb=85 tag=1 hlen=3 plen=400
:pubkey enc packet: version 3, algo 1, keyid DBC1D85BA9D1D189
gpg: public key is 0xDBC1D85BA9D1D189
gpg: using subkey 0xDBC1D85BA9D1D189 instead of primary key
# off=403 ctb=d2 tag=18 hlen=2 plen=0 partial new-ctb
:encrypted data packet:
gpg: using subkey 0xDBC1D85BA9D1D189 instead of primary key
gpg: encrypted with 3104-bit RSA key, ID 0xDBC1D85BA9D1D189, created
      "Dr. Basil Becker "
gpg: public key decryption failed: Hardware problem
gpg: decryption failed: No secret key
The only difference I see, is that the pubkey data is 3103 bits vs 3104
bits. Unfortunately, I have no idea, whether this is a meaningful
difference and if this
If anyone could help me identifying what my problem is or even to solve
it, I'd appreciate it :) If you need any additional information or
dedicated log-output, I'm happy to provide it.

@_date: 2017-02-08 23:06:28
@_author: Dr. Basil Becker 
@_subject: Non-deterministic behavior using GnuPG and a smart-card 
Yes, if I'm able to decrypt a mail, I'm always able to it. Unfortunately
this holds also true for those mails, I can't decrypt.
I should also add, that I don't have any problems, when I read the mails
on my smartphone using K9 and Openkeychain.

@_date: 2017-02-08 23:29:40
@_author: Dr. Basil Becker 
@_subject: Non-deterministic behavior using GnuPG and a smart-card 
Eventually, but I'm a) pretty sure that always the same software has
been used to encrypt the mails (it is done by my mail provider). And I'm
using the Yubikey on my smartphone, too.
gpg is set to be an alias for gpg2 and enigmail states in its settings,
that it is running /usr/bin/gpg2 And some of my mails could be decrypted...
I appreciate it :)

@_date: 2017-02-09 11:39:34
@_author: Dr.  Basil Becker 
@_subject: Non-deterministic behavior using GnuPG and a smart-card 
Hi Peter et al. Am 9. Februar 2017 11:08:12 MEZ schrieb Peter Lebbing :
To encrypt every mail I receive is an option, that my mail - provider offers. I uploaded my public key and each incoming mail becomes encrypted. In my opinion quite a good trade off, given the general usage of mail encryption outside of this list. Is there anything else I could provide in order to help with the bug-fix?Logs,traces anything? Of course I can offer my environment to do some tests. Should I file a bug report for this issue? Yes, this is an option. Actually, I'm using my smart-card also on my phone through an USB OTG cable. Nevertheless, I have an backup of my encryption key, I could facilitate to overcome the current limitations. Thanks for pointing out. I'll consider using a more standard encryption key. I decided for this unusual key length more or less for the reason of obscurity. I had the unproven hope that using an unusual key length would make attacks harder. However, I did not expect it to complicate the general usage :) Cheers Basil

@_date: 2017-02-10 01:18:07
@_author: Dr. Basil Becker 
@_subject: Is NFC Appropriate? 
I'm not going to answer your question directly, but if you're unsure
about NFC's reliability, you could start with USB on-the-go [1]. This
way you could keep your already existing Yubikey 4, which also allows
stronger keys than the Yubikey NEO.
[1]
