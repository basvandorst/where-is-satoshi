
@_date: 2017-03-10 09:23:33
@_author: Pankaj Kumar. Chaurasia 
@_subject: Help Needed: I am able to decrypt file when I run package manually 
Hello Gnupg Users,
I am writing this mail regarding the issue facing to decrypt file through my SSIS Package.
Below is the command I am using:
gpg2.exe --batch --yes --status-fd 2 --passphrase-fd 0 --armor --output E:\File.csv --decrypt E:\File.pgp
When I run my SSIS package manually through visual studio it is decrypting the file properly. When I deploying the package on the same machine it is not decrypting. After spending to much time I come to know that the reason behind this is, I have imported the public key using command line, so it is imported for my user as I login on that machine with my windows user. But SQL Server agent job runs with MSSQL Agent Service account so I need to import the key for that service account.
Could you guys please let me know how to import the public key for that account as I cannot login with that Service account.
Thanks in Advance.
Thanks & Regards,
Pankaj K Chaurasia
Sr. Database Developer
Smart Utility Systems
0120-4208528 (O)  |  +91- 8109510013 (M) |  +91- 9406929510 (M)
pankaj.chaurasia at smartusys.com  | [facebook][linkedin] [twitter]   [google] This message may contain confidential and/or privileged information. If you are not the addressee or authorized to receive this for the addressee, you must not use, copy, disclose or take any action based on this message or any information herein. If you have received this message in error, please advise the sender immediately by reply e-mail and delete this message. Thank you for your cooperation.
P Please consider the environment before printing this email.

@_date: 2017-03-17 06:02:46
@_author: Pankaj Kumar. Chaurasia 
@_subject: Help Needed: I am able to decrypt file when I run package 
Any clue guys. I am using version 2.3.3.
Thanks & Regards,
Pankaj K Chaurasia
Sr. Database Developer
Smart Utility Systems
0120-4208528 (O)  |  +91- 8109510013 (M) |  +91- 9406929510 (M)
pankaj.chaurasia at smartusys.com  | [facebook][linkedin] [twitter]   [google] This message may contain confidential and/or privileged information. If you are not the addressee or authorized to receive this for the addressee, you must not use, copy, disclose or take any action based on this message or any information herein. If you have received this message in error, please advise the sender immediately by reply e-mail and delete this message. Thank you for your cooperation.
P Please consider the environment before printing this email.
Sent: Friday, March 10, 2017 2:53 PM
Hello Gnupg Users,
I am writing this mail regarding the issue facing to decrypt file through my SSIS Package.
Below is the command I am using:
gpg2.exe --batch --yes --status-fd 2 --passphrase-fd 0 --armor --output E:\File.csv --decrypt E:\File.pgp
When I run my SSIS package manually through visual studio it is decrypting the file properly. When I deploying the package on the same machine it is not decrypting. After spending to much time I come to know that the reason behind this is, I have imported the public key using command line, so it is imported for my user as I login on that machine with my windows user. But SQL Server agent job runs with MSSQL Agent Service account so I need to import the key for that service account.
Could you guys please let me know how to import the public key for that account as I cannot login with that Service account.
Thanks in Advance.
Thanks & Regards,
Pankaj K Chaurasia
Sr. Database Developer
Smart Utility Systems
0120-4208528 (O)  |  +91- 8109510013 (M) |  +91- 9406929510 (M)
pankaj.chaurasia at smartusys.com  | [facebook][linkedin] [twitter]   [google] This message may contain confidential and/or privileged information. If you are not the addressee or authorized to receive this for the addressee, you must not use, copy, disclose or take any action based on this message or any information herein. If you have received this message in error, please advise the sender immediately by reply e-mail and delete this message. Thank you for your cooperation.
P Please consider the environment before printing this email.

@_date: 2017-03-20 10:57:18
@_author: Pankaj Kumar. Chaurasia 
@_subject: Need Help. 
Does anyone know how to import a public key for a server account.
I tried below one, but it is not working:
Gpg2 -import -u NT\MSSQLAgent e:\MyPub.gpg
Thanks & Regards,
Pankaj K Chaurasia
Sr. Database Developer
Smart Utility Systems
0120-4208528 (O)  |  +91- 8109510013 (M) |  +91- 9406929510 (M)
pankaj.chaurasia at smartusys.com  | [facebook][linkedin] [twitter]   [google] This message may contain confidential and/or privileged information. If you are not the addressee or authorized to receive this for the addressee, you must not use, copy, disclose or take any action based on this message or any information herein. If you have received this message in error, please advise the sender immediately by reply e-mail and delete this message. Thank you for your cooperation.
P Please consider the environment before printing this email.

@_date: 2017-03-21 04:05:17
@_author: Pankaj Kumar. Chaurasia 
@_subject: Need Help. 
Hi Daniel,
Thanks for response. You are right, I am trying to import key for different user from which I have logged in. But the problem is I need to import the key for service account user. I do not allow to login. SQL Agent jobs run with this.
I am trying to do this after reading below article:
" gpg: decryption failed: No secret key
I realised that I was being an idiot and that the service account that I was running the SQL Agent under did not have the certificate registered under that userid. I had only imported the certificate into Kleopatra for the development userid I logged in with and not for the service account. I simply imported the certificate to the service account profile and then everything worked. This meant that the original instructions and code were valid, but I thought I?d put this post up in case anyone did the same stupid thing as me. It?s worth remembering that the certificates are by default imported at a user level into Kleopatra. "
Article link: Thanks & Regards,
Pankaj K Chaurasia
Sr. Database Developer
Smart Utility Systems
0120-4208528 (O) ?|? +91- 8109510013 (M) |? +91- 9406929510 (M)
pankaj.chaurasia at smartusys.com? |? This message may contain confidential and/or privileged information. If you are not the addressee or authorized to receive this for the addressee, you must not use, copy, disclose or take any action based on this message or any information herein. If you have received this message in error, please advise the sender immediately by reply e-mail and delete this message. Thank you for your cooperation.
? Please?consider the environment before printing this?email.
-----Original Message-----
Sent: Monday, March 20, 2017 8:52 PM
Usually --import needs two leading hyphens, not one.
it's not clear to me what "NT\MSSQLAgent" is supposed to mean -- the -u flag is to identify an OpenPGP User ID, which isn't relevant for the --import operation.
It looks like you're trying to use it to switch user accounts, which GnuPG won't do.  You'll need to use your operating system's mechanism to switch user accounts first, and then run gpg from the other user.  In Windows (which it looks like you're using) that'd be "Run as?" or something like that.
          --dkg
