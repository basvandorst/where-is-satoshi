
@_date: 2002-05-17 14:55:01
@_author: Joerg Toellner 
@_subject: --status-fd and stderr outputs! Huh? 
Hello Listmembers,
i am new to the list and its nice to be here. Ill hope not to be too
annyoing for you with my problems and hopefully i can halt s.o. too in the
But first i have a question hopefully not threaded too often in this list
(but even if i checked the listarchive i havent found an answer to this).
The Situation:
I use gpg 1.0.7. in an automatic, unattendend environment (a single
mailserver box under suse linux) in which i programmed a little "system"
that all outgoing mails to WAN coming from the LAN to this linux-box (our
mailserver-gateway) will be automatically encrypted if there is a public key
for the receipent of this email is present in the pubring (using the
email-address as the uid).
There is a special mailuser on this box which is for "controlling" this
gpg-system. I.e. sending a (say) "requestmail" to this special user will
result in a replymessage (automatically generated by my system) with in this
example say the fingerprint of a key if so requested.
All works fine until my errorchecking comes in play. The errorsystem is
necessary as there is neither a monitor nor a keyboard at the
mailserver-gateway-box. All communication between this gpg-system and the
user go by request- and/or answer/notficationmails) If an error occurs (say:
key not present or key signature expired) a notification mail is
automatically generated and send to the right receipent (i.E. the sender of
the requestmail) to notify him/her about the problem.
I hope it is clear enough what i mean and how it works. If you need further
information please request it.
The PROBLEM:
The system is written in PERL. And after doing my own work (interpreting the
requestmail a.s.o.) i start gpg when necessary with the open3 command
capturing the stdin, stdout and stderr of gpg. I use the --status-fd option
to get the well formatted status information from gpg over the stdout from
gpg. I use --passphrase-fd as well where it is necessary to pass a
passphrase. This is done with writing to the captured stdin from gpg from my
perl script.
All works fine so far. If i i.E. decrypt a mail i get a whole bunch of Msgs.
from gpg in my perl script. All prefixed with [GNUPG: ] TAGNAME (where
tagname is the keywords described in DETAILS file). I interpret this msgs.
to decide what to do further in my system. I get some msgs in normal (non
formatted words) over the stderr from gpg too (i.e. warning using insecure
memory or whatever).
BUT if i i.E. want to extract a public key from the pubring in armor mode
(to send it to a buddy i.e.) and the key isnt present (i.E. for a spelling
error in my uid) there is NO, NOTHING, NADA at the status-fd. I got the msgs
on stderr that says: Warning key not found or so. But the well formatted
msgs on status-fd is missing.
I always thought, that the status-fd is the only thing (and recommended one)
where i have to put my "ear" on and i'll be informed about every little
thing gpg do and had done. But this seems not to be as some errors where
reported on the status-fd and others not but only at stderr. And this
although there  is a special Errortag for status-fd output for missing key
named: NO_PUBKEY and NO_SECKEY.
My Question
Do i sth. wrong or is it a bug or a feature that i havent understand? :-) It
will be a really pain if i were forced to interpret the normal word output
(more human readable) on stderr too, instead of using the well formatted and
easy to interpret information on status-fd.
Any hint appreciated. URLs where i can get informations, example
source-code-snippets, hints, explanations, money for this good question
:-)))) Ok ill stop now.
Thanks a lot in advance.
Joerg Toellner

@_date: 2002-05-23 14:15:01
@_author: Joerg Toellner 
@_subject: 2nd Try: --fd-status and stderr msgs from gpg 
Hello List,
as im not having received a line for my problem posted a week ago, please
allow me to do a second try. I cant believe, that nobody here has handled
the --status-fd and can point me in the right direction.
Summary of my problem as posted last week:
I use gpg in our mailserver-gateway for our lan in an unattendet environment
from within some perl scripts. All outgoing mails should be encrypted by gpg
for every email-adress (used as the uid) where a public key is present in
the pubring.
To decide (in my perlscript which opens gpg where necessary) whether the
operation was succesful or not i capture --fd-status and the stderr from
gpg. I listen on the --status-fd, get there the well formatted gpg-msgs
(described in File DETAIL) and interpret this msgs to decide what to do
The problem is, that there are errors that are NOT reported on
the --status-fd but at the stderr. And this msgs are really ugly to
interpret (ok they are more human readable but this is not my intension).
if i decrypt i file i got alot of msgs (DECRYPTION_STARTED, DECRYPTION_OKAY
or DECRYPTION_FAILED a.s.o.) from the --status-fd prefixed with [GNUPG: ]
into my perlscript. All okay here.
But if i export a key in armor mode for sending it via email to someone and
the key is not present (for what reason ever), i got *NO* msgs on the
--status-fd but on the stderr there is a output that says: blah blah key not
The operation has failed and no msg on --status-fd appears in this case
indicating the error :-(. Even as there is a msg for this case
for --status-fd (see File DETAILS) named NO_PUBKEY.
Do i sth. wrong. I thought its enough to listen on --status-fd to know all
about gpgs actual workflow. I really dont want to interpret the stderr
output in addition to the --status-fd if i can avoid it.
Please! This is my second try to get an answer. Be kind and give me some
lines back this time. Im sure there are some good guys in this list that
have managed the error-interpretation for gpg in their scripts and can give
me a little hint.
PLEASE! TIA!
Joerg Toellner

@_date: 2002-05-27 10:31:02
@_author: Joerg Toellner 
@_subject: AW: --command-fd 
Dear Rasoul,
do the following (only a codesnippet) in perl.
------SNIPPET OFF-----------------------
(Beware of the linebreak! The open line is ALL on one line! AND NOTICE
 the | (Pipe) character in the open command)
What does it do?
It opens the gpg command with the perl-open-command and connects the stdin
from gpg (fd 0) used as the passphrase-input-pipe with the PERL Filehandle
PASSOUT. When gpg comes to the point that it needs the passphrase it expects
it on its stdin. You use the perl-print-command to fill the PASSOUT
(connected to the stdin from gpg) and so transfer your passphrase to gpg in
the right place where gpg expects it. GPG receives your passphrase and goes
on with his job. After the action, dont forget to close the
Thats all. Works for me fine. Hope it helps.
Joerg Toellner

@_date: 2002-05-27 11:45:01
@_author: Joerg Toellner 
@_subject: AW: --status-fd and stderr outputs! Huh? 
Dear Werner,
as you wished here are the results of the german jury ...uh... the results
of my tests of course :-))))
Start gpg with the following parameters:
  gpg --batch --yes --status-fd 1 --export -a -o sav/asckey_jt
and capture stdout (same as status-fd in this case in fact of
the --status-fd 1 parameter) and stderr from gpg, assuming, that there is NO
public key with the UID jt in the pubring (an so the expected
error occurs) will produce the following output on the different handles:
on stdout (or status-fd):
There is NO, Nothing, Nada, nix, garnix! Not even one line!
on stderr:
There is the following output:
  gpg: WARNING: nothing exported
The returncode from gpg in this case seems to be 0 (should'nt it be at least
I think there should be at least also a [GNUPG: ] NO_PUBKEY Msg. on the
Thanks for your advice and good work. If you need more information about
this please contact me again.
CU all
Joerg Toellner
