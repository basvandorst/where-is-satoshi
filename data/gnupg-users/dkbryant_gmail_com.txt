
@_date: 2015-04-27 15:07:38
@_author: Dan Bryant 
@_subject: Generating GnuPG S/MINE key pair 
TL;DR: gpgsm import fails with "no issuer found in certificate"
I'm trying to generate a key-pair for GnuPG S/MINE strictly for
instructional reasons.  I'll concede that I'm using a weak CA, but I'm
trying to image how the CA maintainers do this task as well.  So, for my
instruction, I'm trying to do the following:
I started off just wanting to create a GnuPG S/MINE key-pair.  I soon found
out that gpgsm requires key-pars to be externally signed by a CA.  So now
I'm trying to do the whole process, make-key, sign-key, import-key
   1. Create a CA with a new RSA key-pair (openSSL)
   2. Generate a new GnuPG S/MINE key-pair (gpgsm)
   3. Sign the GnuPG S/MINE key-pair with my fictitious CA above (openssl)
   4. Import the now signed GnuPG S/MINE key-pair into my gpgsm key-ring.
So I theory I thought this should work, but I've botched it somewhere along
the way.  Again... this is for INSTRUCTIONAL purposes.  I realize a self
signed CA is about as secure as a post-it on a monitor.  Trying to learn...
Here's what I tried (for those unfamiliar with Windows, the '^' is a line

@_date: 2015-04-27 21:22:39
@_author: Dan Bryant 
@_subject: Generating GnuPG S/MINE key pair 
OK... I found some very old posts about this... don't know how much still holds.
  -- This guide says:
1. Convert rootCA.pem to rootCA.der
2. Place rootCA.der in dirmngr\trusted-certs
3. Ensure rootCA.der has revocation URL (??can disable??)
4. Add rootCA.der fingerprint to trustlist.txt
5. Restart dirmngr service and gpg-agent
Don't know... you think that will work?
BTW.. Here's the versions of the previously mentioned utilities:
- OpenSSL 1.0.2a 19 Mar 2015
- gpg-protect-tool (GnuPG) 2.0.27 (Gpg4win 2.2.4)
- gpgsm (GnuPG) 2.1.3

@_date: 2015-04-27 23:28:57
@_author: Dan Bryant 
@_subject: Generating GnuPG S/MINE key pair 
Getting closer... The DirMngr stuff is totally required.  Got that out
of the way (added rootCA to the right dirmgr stuff).
Now I'm scrubbing the logs and it looks like DirMgr is complaining
because I didn't timestamp any of my custom certs.  Any "--ignore_ts"
or similar option to bypass this message?
     dirmngr[7276] command 'VALIDATE' failed: No value On to although I might have to shelve this for a few days at this point.
Call / Text: 281.760.4296

@_date: 2015-04-28 11:12:18
@_author: Dan Bryant 
@_subject: Generating GnuPG S/MINE key pair 
OK... I'm apparently suffering from a bad gpgsm setup.  According to
the 2011 post (
the following command, should just work:
   gpgsm --gen-key | gpgsm --import
Not for me... I get
  gpgsm: problem looking for existing certificate: Invalid argument
  gpgsm: error storing certificate
Moreover just trying to dump my keystore with "gpgsm -k" gives errors
  gpgsm: keydb_search failed: Invalid argument
Here's a dump of my failed import attempt.
C:\Program Files (x86)\GNU\GnuPG>gpgsm --gen-key | gpgsm --import
gpgsm (GnuPG) 2.1.3; Copyright (C) 2015 Free Software Foundation,
This is free software: you are free to change and redistribute it
There is NO WARRANTY, to the extent permitted by law.
Please select what kind of key you want:
   (1) RSA
   (2) Existing key
   (3) Existing key from card
Your selection? 1
What keysize do you want? (2048)
Requested keysize is 2048 bits
Possible actions for a RSA key:
   (1) sign, encrypt
   (2) sign
   (3) encrypt
Your selection? 1
Enter the X.509 subject name: CN=test cert
Enter email addresses (end with an empty line):
Enter DNS names (optional; end with an empty line):
Enter URIs (optional; end with an empty line):
Create self-signed certificate? (y/N) y
These parameters are used:
    Key-Type: RSA
    Key-Length: 2048
    Key-Usage: sign, encrypt
    Serial: random
    Name-DN: CN=test cert
Proceed with creation? (y/N) y
Now creating self-signed certificate.  This may take a while ...
gpgsm: about to sign the certificate for key: &77C68CE5AC362254D7
gpgsm: certificate created
gpgsm: problem looking for existing certificate: Invalid argument
gpgsm: error storing certificate
gpgsm: total number processed: 1
gpgsm:           not imported: 1

@_date: 2015-08-26 10:16:56
@_author: Dan Bryant 
@_subject: OSX: How to install gpg without Admin password 
I have a monitored OS X laptop that I would like to put GNU Privacy
Guard (gpg) on. Of course I can't because I don't have Admin rights,
but I was hoping there is a way to install it in user space through a
virtual environment or chroot, or some other wizardry, or by exacting
the package files.
Obviously I only need console access to the app.

@_date: 2015-08-26 18:19:32
@_author: Dan Bryant 
@_subject: OSX: How to install gpg without Admin password 
I went ahead and made a very very very light OpenSSL set of scripts to
encrypt / decrypt. Not nearly versatile enough, but at least I can
lock some files and send to my friends (if they run my scripts too).

@_date: 2015-08-29 12:13:21
@_author: Dan Bryant 
@_subject: OSX: How to install gpg without Admin password 
OK, this worked in getting the binaries extracted and by setting PATH
and DYNLD_LIBRARY_PATH I can get the bins to load and dump version
information... SUCCESS...
Now my biggest problem is getting the agent and pinentry (I assume) to
talk to gpg.
I was hoping I could set bindir, libdir, libexecdir with gpgconf
(gpgconf.conf) but I can't seem to figure out how to convice gpg to
look in nonstandard paths for binaries and libraries.  Seems to be
ignoring PATH environment.
On Thu, Aug 27, 2015 at 1:31 AM, Patrick Brunschwig

@_date: 2015-08-30 16:15:05
@_author: Dan Bryant 
@_subject: OSX: How to install gpg without Admin password 
COMPLETE SUCCESS.
I had to add the *-program argument to both the gpg and gpg-agent
config files.  Below is very very crude shell script to show others
how it was done.  The script wasn't tested as is, but rather was a
notepad I had open to try to record the steps as I did them.  It is
almost guaranteed to have one or two bus in it.
cd ~
curl -LO ${gpgosx}/GnuPG-2.1.7.dmg
curl -LO ${gpgosx}/GnuPG-2.1.7.dmg.sig
mkdir GnuPG
mkdir GnuPG/tmp
cd ~/GnuPG/tmp
7z x ../../GnuPG-2.1.7.dmg
7z x 4.hfs
tar -xf Install.pkg
cd ..
cat ./tmp/GnuPG.pkg/Payload | gunzip -dc |cpio -i
export PATH=${PATH}:`pwd`/bin
export DYLD_FALLBACK_LIBRARY_PATH=`pwd`/lib
export GNUPGHOME=${HOME}/.gnupg
echo "agent-program" \
  "`pwd`/bin/gpg-agent" \
  > ${GNUPGHOME}/gpg.conf
echo "pinentry-program" \
  "`pwd`/bin/pinentry-mac.app/Contents/MacOS/pinentry-mac" \
  > ${GNUPGHOME}/gpg-agent.conf
# this will start a gpg capable shell
So if anyone is stumbles upon this thread later who is also trying to
get GPG on a Admin controlled Mac, hopefully this will guide the way.
Another path you could take would be to install Chrome and Mailvelope.
I know that Chrome allows "drag-and-drop" install of the browser
without Admin rights.  Once in chrome you can install the Mailvelope
extension which will give you a graphical interface for GPG
operations.  You can also export your Mailvelope key to GPG so you can
do finer manipulation of it through the shell.
Many thanks to Mr. Brunschwig for the tips along the way.
On Sun, Aug 30, 2015 at 9:19 AM, Patrick Brunschwig

@_date: 2015-05-05 19:08:01
@_author: Dan Bryant 
@_subject: Generating GnuPG S/MINE key pair 
I found the problem.  I had a corrupt install.  I was
trying to work around problems in the 2.1.3 installer, and went about
it poorly.  I copied pinentry from gpg4win 2.2.4 (bad idea).
The better way to do it was as follows:
1) Download gnupg-w32-2.1.1_20141216.exe
2) Install {1} to %ProgramFiles(x86)%\GNU\GnuPG
3) Copy files out of {2} into %UserProfile%\GnuPG.Combined
4) Uninstall {1}
6) Stop any processes running from {2}
7) Remove directory {2}
8) Download gnupg-w32-2.1.3_20150413.exe
9) Install {8} to %ProgramFiles(x86)%\GNU\GnuPG
10) Copy files out of {9} into %UserProfile%\GnuPG.Combined
11) Stop any processes running from {9}
12) Copy %UserProfile%\GnuPG.Combined to %UserProfile%\GnuPG as Admin
13) Remove %UserProfile%\GnuPG.Combined
This will get GPA.exe and PinEntry.exe working (I hope) on a 2.1.3 baseline.
You may be able to simply install 2.1.1 then install 2.1.3 over it, I
leave others to speculate on that.  This worked for me.
The GPGSM self-sign cert now imports without error.

@_date: 2019-03-13 03:03:31
@_author: Dan Bryant 
@_subject: Can I use my Microsoft Outlook S/MIME certificate with gpgsm.exe ? 
So I work for a large company that has their own internal CA and
maintains their own set of S/MIME certificates.  We periodically have
to re-enroll in S/MIME and import the certificate into Microsoft
Outlook to have encrypt / sign functionality.  This time when I
enrolled for my recent certificate, I went ahead and added my S/MIME
to gpgsm.  Import looked good (I guess), but I'm unable to sign.  I've
looked at the public and private keys and it looks like the whole
chain is imported.  Kleopatra also has them showing up in the right
hierarchical order.  I apologize for clipping some of my command
output but our company is rather paranoid about publicly publishing
internal key data, even public key data.
$ gpgsm --version --verbose
gpgsm (GnuPG) 2.2.11
libgcrypt 1.8.4
libksba 1.3.5
$ gpgsm --import sMIME.pfx
gpgsm: total number processed: 4
gpgsm:              unchanged: 3
gpgsm:       secret keys read: 1
gpgsm:  secret keys unchanged: 1
$ echo hi | gpgsm --sign --armor --default-key 0x64208E9A
--disable-crl-checks --disable-policy-checks
gpgsm: error creating signature: No value

@_date: 2019-03-14 17:20:03
@_author: Dan Bryant 
@_subject: Can I use my Microsoft Outlook S/MIME certificate with gpgsm.exe ? 
Thanks,  I checked the following per your advice
1. Are any of the certs ECC?
No, they all appear to be RSA keys.
2. Has the org root cert been imported?
I believe so, yes.  There are three certs in the chain.  My s/MIME
cert, it's parent, and its "grandparent".  Both gpgsm and the Windows
Cert Manager show only three certs in the chain.  The same three certs
that show up in Windows Cert Manager show up in gpgsm.
When I listed the cert chain with validation I got a lot of CRL
errors.  I tried to import the CRLs listed in the certs, but it
appeared to fail.  I will also not that I have not added any LDAP
servers.  I would prefer to be able to do the signing "offline" when
I'm not on my corporate network.
I also don't think my company will allow me to store password data in
cleartext in the dirmngr_ldapservers.conf file.  If there is anyway to
encrypt this data with a master password, that would be prefered.
Here's a list of commands I tried to hopefully shed some light on my config
$ gpgsm --verbose --with-validation --list-chain 0x64208E9A
           ID: 0x64208E9A
          S/N: [REDACTED]
       Issuer: [REDACTED]
      Subject: [REDACTED]
          aka: [REDACTED]
     validity: [REDACTED]
     key type: 2048 bit RSA
    key usage: digitalSignature keyEncipherment
ext key usage: emailProtection
     policies: 2.16.840.1.113733.1.7.23.2:N:
  fingerprint: [REDACTED]
  [Note: non-critical certificate policy not allowed]
  [checking the CRL failed: No value]
  [certificate is bad: No value]
Certified by
           ID: 0x2731A14E
          S/N: [REDACTED]
       Issuer: [REDACTED]
      Subject: [REDACTED]
     validity: [REDACTED]
     key type: 2048 bit RSA
    key usage: certSign crlSign
     policies: 2.16.840.1.113733.1.7.23.2:N:
 chain length: 0
  fingerprint: [REDACTED]
  [Note: non-critical certificate policy not allowed]
  [certificate is bad: No value]
Certified by
           ID: 0x0B9BC7C1
          S/N: [REDACTED]
       Issuer: [REDACTED]
      Subject: [REDACTED]
     validity: [REDACTED]
     key type: 2048 bit RSA
 chain length: none
  fingerprint: [REDACTED]
  [certificate is bad: No value]
$ echo hi | gpgsm --sign --armor --default-key 0x64208E9A \
gpgsm: certificate is good
gpgsm: validation model used: shell
gpgsm: error creating signature: No value $ cat alog.txt
* Data signing succeeded:         No
*   Data available:         No
* Gpg-Agent usable:         Yes

@_date: 2019-04-30 23:47:33
@_author: Dan Bryant 
@_subject: Ideas on raising donations for GnuPG, Gpg4win, and g10 code 
I was on Amazon Smile today and noticed quite a few FOSS projects were
available to select as the source of my amazon shopping proceeds.
Also thought that registering gnupg.org, gpg4win.org and g10code.com
in the Brave Rewards program might be an interesting way to allow
GnuPG to accept small concurrency donations.
There may be some legal reasons, or non profit status constraints that
might prevent these organizations from accepting donations through
Smile or Brave, but I thought I would go ahead and make the suggestion
on the chance that it simply hadn't been considered yet.
AmazonSmile: BraveRewards:
