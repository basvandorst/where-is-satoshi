
@_date: 2013-04-29 09:43:54
@_author: M Russell 
@_subject: random_seed - no locks available 
I hope someone might be able to lend me a hand.  I am running into an error message that I resolve.  I get a lock error when trying to encrypt or decrypt a file.  I found other forums that suggest deleting the random_seed file and killing the rpm process, but I don't have a rpm process running.  Renaming the file allowed the system to recreate the random_seed file, but the error persists.  I have noticed the file size is 0 which would be appropriate since the file cannot be locked.  An strace shows the error message, but it doesn't appear to point anything else out.  A lsof doesn't show the file is open.  I'm not sure where else to look.  Has anyone seen this and have any suggestions?
I'm running centos 6.2, gnupg 2.0.14, libgcrypt 1.4.5
can't lock `/home/mruss/.gnupg/random_seed': No locks available
note: random_seed file not updated
open("/home/mruss/.gnupg/random_seed", O_RDONLY) = 10
fcntl(10, F_SETLK, {type=F_RDLCK, whence=SEEK_SET, start=0, len=0}) = -1 ENOLCK (No locks available)
open("/usr/share/locale/en_US.UTF-8/LC_MESSAGES/libc.mo", O_RDONLY) = -1 ENOENT (No such file or directory)
open("/usr/share/locale/en_US.utf8/LC_MESSAGES/libc.mo", O_RDONLY) = -1 ENOENT (No such file or directory)
open("/usr/share/locale/en_US/LC_MESSAGES/libc.mo", O_RDONLY) = -1 ENOENT (No such file or directory)
open("/usr/share/locale/en.UTF-8/LC_MESSAGES/libc.mo", O_RDONLY) = -1 ENOENT (No such file or directory)
open("/usr/share/locale/en.utf8/LC_MESSAGES/libc.mo", O_RDONLY) = -1 ENOENT (No such file or directory)
open("/usr/share/locale/en/LC_MESSAGES/libc.mo", O_RDONLY) = -1 ENOENT (No such file or directory)
write(2, "can't lock `/home/mruss/.gnupg/random_seed': No locks available\n", 68) = 68
close(10)                               = 0

@_date: 2013-05-01 21:19:25
@_author: brewsome 
@_subject: random_seed - no locks available 
Thanks for the responses.  I did find out that the home drive is a NFS
mount.  NFS is version 3, and I don't see any nolock option specified in
be a NFS problem too, but not sure were.  I'll dig into that side more.
ENOLCK (No locks available)
ENOENT (No such file or directory)
ENOENT (No such file or directory)
ENOENT (No such file or directory)
ENOENT (No such file or directory)
ENOENT (No such file or directory)
(No such file or directory)
available\n", 68) = 68
Werner already replied on this one - len == 0 has a special meaning and
should indeed be correct here.
Actually this would be my first question to the original poster - is
there any chance that your home directory is remotely mounted using NFS
or some other remote filesystem protocol for which your kernel does not
really support file locking?  (I have seen quite some usage of user home
directories exported via NFS in shared environments, e.g. universities)
If it is NFS, you might want to look into enabling file locking using
something like the "nfslock" service, rpc.lockd or something similar on
both the client and the server, just in case.
