
@_date: 2011-02-26 16:45:26
@_author: Todd A. Jacobs 
@_subject: SCR3310 reader working for root, but not scard group 
I have an SCR3310 card reader on an Ubuntu 10.10 system, and installed
the drivers through the libccid package. This works out of the box for
root, but mortal users can't access the card at all. I tried a lightly
modified version of the scripts from
but without success.
Here's all the debugging info I could think of. Anyone have any
suggestions for getting this working?
$ sudo aptitude install
$ lsusb | fgrep SCM
Bus 001 Device 012: ID 04e6:511f SCM Microsystems, Inc.
$ ls -l /dev/bus/usb/001/012
crw-rw-r-- 1 root root 189, 11 2011-02-26 16:32 /dev/bus/usb/001/012
$ sudo chown .scard /dev/bus/usb/001/012
$ ls -l /dev/bus/usb/001/012
crw-rw-r-- 1 root scard 189, 11 2011-02-26 16:32 /dev/bus/usb/001/012
$ gpg --card-status
gpg: selecting openpgp failed: ec=6.108
gpg: OpenPGP card not available: general error
$ sudo pcscd --foreground --debug --apdu
00000000 debuglog.c:230:DebugLogSetLevel() debug level=debug
00000040 debuglog.c:259:DebugLogSetCategory() Debug options: APDU
00000385 pcscdaemon.c:512:main() pcsc-lite 1.5.5 daemon ready.
00337587 hotplug_libusb.c:403:HPEstablishUSBNotifications() Driver
ifd-ccid.bundle does not support IFD_GENERATE_HOTPLUG. Using active
polling instead.
00000051 hotplug_libusb.c:412:HPEstablishUSBNotifications() Polling
forced every 1 second(s)
$ cat gnupg-ccid.rules
# GPG SmartCard Reader Support
ACTION=="add", SUBSYSTEM=="usb", ENV{PRODUCT}=="4e6/e003/*",
ACTION=="add", SUBSYSTEM=="usb", ENV{PRODUCT}=="4e6/5115/*",
ACTION=="add", SUBSYSTEM=="usb", ENV{PRODUCT}=="4e6/511f/*",
$ ls -l /usr/local/sbin/gnupg-ccid.sh
-rwxr-xr-x 1 root root 905 2011-02-26 15:40 /usr/local/sbin/gnupg-ccid.sh
$ cat /usr/local/sbin/gnupg-ccid.sh
# taken from libgphoto2
# Sets up newly plugged in card reader so that only members of the
# group can access it
# can access it from user space. (Replace scard with the name of the
# group you want to have access to the card reader.)
# Note that for this script to work, you'll need all of the following:
# a) a line in the file /etc/hotplug/gnupg-ccid.usermap that corresponds
 to the card reader you are using.
# b) a group "scard" where all users allowed access to the
 card reader are listed
# c) a Linux kernel supporting hotplug and usbdevfs
# d) the hotplug package (
# In the usermap file, the first field "usb module" should be named
# "gnupg-ccid" like this script.
if [ "${ACTION}" = "add" ] && [ -f "${DEVICE}" ]
??? chmod o-rwx "${DEVICE}"
??? chgrp "${GROUP}" "${DEVICE}"
??? chmod g+rw "${DEVICE}"

@_date: 2011-02-26 17:52:18
@_author: Todd A. Jacobs 
@_subject: SCR3310 reader working for root, but not scard group 
I have an SCR3310 card reader on an Ubuntu 10.10 system, and installed
the drivers through the libccid package. This works out of the box for
root, but mortal users can't access the card at all. I tried a lightly
modified version of the scripts from
but without success.
Here's all the debugging info I could think of. Anyone have any
suggestions for getting this working?
$ sudo aptitude install
$ lsusb | fgrep SCM
Bus 001 Device 012: ID 04e6:511f SCM Microsystems, Inc.
$ ls -l /dev/bus/usb/001/012
crw-rw-r-- 1 root root 189, 11 2011-02-26 16:32 /dev/bus/usb/001/012
$ sudo chown .scard /dev/bus/usb/001/012
$ ls -l /dev/bus/usb/001/012
crw-rw-r-- 1 root scard 189, 11 2011-02-26 16:32 /dev/bus/usb/001/012
$ gpg --card-status
gpg: selecting openpgp failed: ec=6.108
gpg: OpenPGP card not available: general error
$ sudo pcscd --foreground --debug --apdu
00000000 debuglog.c:230:DebugLogSetLevel() debug level=debug
00000040 debuglog.c:259:DebugLogSetCategory() Debug options: APDU
00000385 pcscdaemon.c:512:main() pcsc-lite 1.5.5 daemon ready.
00337587 hotplug_libusb.c:403:HPEstablishUSBNotifications() Driver
ifd-ccid.bundle does not support IFD_GENERATE_HOTPLUG. Using active
polling instead.
00000051 hotplug_libusb.c:412:HPEstablishUSBNotifications() Polling
forced every 1 second(s)
$ cat gnupg-ccid.rules
# GPG SmartCard Reader Support
ACTION=="add", SUBSYSTEM=="usb", ENV{PRODUCT}=="4e6/e003/*",
ACTION=="add", SUBSYSTEM=="usb", ENV{PRODUCT}=="4e6/5115/*",
ACTION=="add", SUBSYSTEM=="usb", ENV{PRODUCT}=="4e6/511f/*",
$ ls -l /usr/local/sbin/gnupg-ccid.sh
-rwxr-xr-x 1 root root 905 2011-02-26 15:40 /usr/local/sbin/gnupg-ccid.sh
$ cat /usr/local/sbin/gnupg-ccid.sh
# taken from libgphoto2
# Sets up newly plugged in card reader so that only members of the
# group can access it
# can access it from user space. (Replace scard with the name of the
# group you want to have access to the card reader.)
# Note that for this script to work, you'll need all of the following:
# a) a line in the file /etc/hotplug/gnupg-ccid.usermap that corresponds
# ? ?to the card reader you are using.
# b) a group "scard" where all users allowed access to the
# ? ?card reader are listed
# c) a Linux kernel supporting hotplug and usbdevfs
# d) the hotplug package (
# In the usermap file, the first field "usb module" should be named
# "gnupg-ccid" like this script.
if [ "${ACTION}" = "add" ] && [ -f "${DEVICE}" ]
? ?chmod o-rwx "${DEVICE}"
? ?chgrp "${GROUP}" "${DEVICE}"
? ?chmod g+rw "${DEVICE}"

@_date: 2011-02-26 18:20:00
@_author: Todd A. Jacobs 
@_subject: SCR3310 reader working for root, but not scard group 
The following line in gnupg-ccid.rules will now create the /dev node
with the correct permissions, but the card reader itself still remains
inaccessible to non-root users:
ACTION=="add", SUBSYSTEM=="usb", ENV{PRODUCT}=="4e6/511f/*", GROUP="scard"
This seems like a simpler way to assign the GID, rather than shelling
out to an external script. Of course, I'm still getting:
$ gpg --card-status
gpg: selecting openpgp failed: ec=6.108
gpg: OpenPGP card not available: general error
which implies the problem wasn't just the device node permissions;
could it be something to do with pcscd itself?

@_date: 2011-02-26 19:00:25
@_author: Todd A. Jacobs 
@_subject: [SOLVED] SCR3310 reader working for root, but not scard group 
Here are the steps I needed to take under Ubuntu 10.10 to get this
particular reader working properly as a mortal user.
1. sudo aptitude install --with-recommends libccid
2. sudo addgroup --system pcscd
3. sudo addgroup pcscd 4. cat << EOF | sudo tee /etc/udev/rules.d/gnupg-ccid.rules
SUBSYSTEM!="usb", GOTO="ccid_rules_end"
ACTION!="add", GOTO="ccid_rules_end"
ATTR{idVendor}=="04e6", ATTR{idProduct}=="e003", MODE="0660", GROUP="pcscd"
ATTR{idVendor}=="04e6", ATTR{idProduct}=="5115", MODE="0660", GROUP="pcscd"
ATTR{idVendor}=="04e6", ATTR{idProduct}=="511f", MODE="0660", GROUP="pcscd"
5. cat << EOF | sudo tee /etc/udev/rules.d/pcscd.rules
ACTION!="add", GOTO="pcscd_ccid_rules_end"
SUBSYSTEM!="usb", GOTO="pcscd_ccid_rules_end"
ENV{DEVTYPE}!="usb_device", GOTO="pcscd_ccid_rules_end"
# generic CCID device
ATTRS{bInterfaceClass}=="0b", RUN+="/bin/chgrp pcscd $root/$parent"
6. Remove and plug in the card reader to trigger the new rules.
7. Log in again to be part of the pcscd group.
8. Enjoy success with "gpg --card-status" as a mortal user.
I'm honestly not sure why both rules are necessary, but I couldn't get
this working at all without them both in place. The following blog
post by the maintainer wasn't particularly clear to me, but did point
me in the right direction:
Perhaps my experiences with this will help others, too.

@_date: 2011-02-26 18:06:55
@_author: Todd A. Jacobs 
@_subject: SCR3310 reader working for root, but not scard group 
Thanks for the suggestion. However, $DEVICE isn't populated at all,
although the udev rule appears to be triggering. My script now
echo "${DEVICE}" > /tmp/gnupg-ccid.log
if [ "${ACTION}" = "add" ] && [ -f "${DEVICE}" ]
    dev_device="${DEVICE//proc/dev}"
    chgrp "${GROUP}" "${dev_device}"
    chmod g+rw "${dev_device}"
but the log file always ends up with a blank line. So, no DEVICE
variable is being exported by udev, as far as I can tell.
