
@_date: 2003-06-23 19:15:02
@_author: Robert 
@_subject: CGI script decrypting using GPG? 
For a system I'm using GPG to encrypt data as users enter it and store that in a database.
I also need for some admistrative-type users to be able to view this data un-encrypted and I'm having problems writing a CGI script to do this trick.
This is on a UNIX system and my problem is that I need to give gpg 2 different pieces of input: the data to be decrpyted and the passphrase to use to decrypt it.
Something that Works, but is Bad is this:
echo "" | gpg --options decrypt.conf 2< But that means storing the passphrase in a plain text file on the server.
And that means anyone gaining root access to the server could decrypt this data.
I would rather ask the administrative-users for that passphrase (as well as a username and password that my CGI script would enforce), but I don't know how to pipe that into anything other than the standard input for GPG and I can't have the passphrase and the data-to-be-decrytped both piped in via stdin.
I know this is confusing, but I've been trying to make this work for a week and am just getting nowhere.
Thanks so much in advance!

@_date: 2003-06-25 16:49:01
@_author: Robert 
@_subject: [gpg]Re: decrypt stdin with passphrase in 
John Sheridan [21/06/2003]:
"Nomen Nescio nobody-at-dizum.com |gpg|" echo "mypassphrase" | gpg --homedir $gnuph_home --passphrase-fd=0 --no-tty
--decrypt \
Now, what I'd REALLY like to find is a way to do this without writing
either the passphrase OR the encrypted block of text to disk...
My problem seems to be that I can't pipe anything FROM any stream except
stdout and I can't pipe TO any stream except stdin.
Any ideas? Anyone?

@_date: 2003-06-25 17:58:02
@_author: Robert 
@_subject: decrypt stdin with passphrase in 
"darren chamberlain dlc-at-users.sourceforge.net |gpg|"
But using that syntax means I have to have the passphrase written to disk,
And I've got to avoid doing that.
Is there some way to sent things to file descriptor 3 other than
"3<filename"? I guess what I'm looking for is something like "echo 'passphrase' 3| gpg
...", but there is no "3|" in ksh or sh as far as I can tell...

@_date: 2003-06-25 22:33:02
@_author: Robert 
@_subject: summary: decrypt stdin with passphrase in 
A great answer to this problem is Named Pipes.
UNIX systems tend to have "mknod" and/or "mkfifo" programs that can be
used to create Named Pipes.
Named Pipes (aka "FIFO"'s) look like files or size 0 bytes of type "p" (as
opposed to "-" or "d").
Write to the file via redirection (or even by using "cp") and the writing
process will go into a wait state until another process tries to read from
that file.
Then the waiting/writing process's output goes straight into the reading
Thanks go to Steve Butler.
His script (once trimmed of a typo :-)  ) works quite nicely!
(I added the line to remove the named pipes at the end.)
rm /tmp/my_phrase /tmp/my_file
mknod /tmp/my_phrase p
mknod /tmp/my_file p
cat my_gpg_file > /tmp/my_file &
echo 'passphrase' > /tmp/my_phrase &
gpg --homedir $gnupg_home --passphrase-fd=3 --no-tty --decrypt \
  3< /tmp/my_phrase 1< /tmp/my_file
rm /tmp/my_phrase /tmp/my_file
