
@_date: 2015-05-05 01:14:27
@_author: luis 
@_subject: generating revocation certs non-interactively 
Hash: SHA256
Hello everyone,
I am working with a friend on project to try and get lots and lots of
people on encrypted email at an event using something like a photobooth.
At the end of the experience you leave with a keypair and little gift
wrapped with your revocation cert.
To do this efficiently we are using the batch generation option, I have
a set of scripts that can generate the key, copy it to the final user's
media and then shred it. It all works like a charm. Along with the
keypair we would also like to generate a revocation certificate. Keys
are passwordless, so at first I thought that it should be straight forward.
I couldn't find any documentation on how to do the same batch generation
for the revocation certificate. So I'm a little stuck. The --gen-revoke
option prompts the user for 4 questions for a passwordless key, 5 if the
key has a password and I couldn't get around this.
I have tried the python wrapper, but the python API doesn't seem to
expose revocation certificate generation.
Calling the --gen-revoke option in combination with the --batch option
gpg: can't do this in batch mode
So maybe this is so by design?
How could I get around the interactive process and generate the
certificate programmatically?
I have also tried pexpect to 'mock' user input to bypass interaction, no
success there.
Any help would be greatly appreciated.

@_date: 2015-05-05 20:46:39
@_author: luis 
@_subject: generating revocation certs non-interactively 
Great! Good to know!
Yes of course, this makes perfect sense. There is however the fact that
good practice guides now a days often advice to generate a preemptive
revocation certificate at the time of creation of the key. So at that
moment the reason is well... not really relevant. So it's great that 2.1
does this on keypair generation.
Great, thanks!
This hack seems to have worked though (in python), but your suggestion
seems more robust:
    import pexpect
    cmd = "gpg --homedir {0} --gen-revoke {1}".format(KEYRING_DIR,     px = pexpect.spawn(cmd, timeout=5)
    px.expect("(y/N)")
    px.sendline("y")
    px.expect("Your decision?")
    px.sendline('0')
    px.expect("> ")
    px.sendline("\n")
    px.sendline("\n")
    px.expect("Is this okay?")
    px.sendline("y")
    px.expect(pexpect.EOF)
    bidx = px.before.index('-----BEGIN PGP PUBLIC KEY BLOCK-----')
    eidx = px.before.index('-----END PGP PUBLIC KEY BLOCK-----')
    eidx += len('-----END PGP PUBLIC KEY BLOCK-----')
    print px.before[bidx:eidx]

@_date: 2015-05-07 10:47:21
@_author: luis 
@_subject: offtopic [WAS] Re: generating revocation certs non-interactively 
Is this spam?
How odd.
Could this person be stuck in this mailinglist somehow?
