
@_date: 2006-07-12 11:05:36
@_author: Benny Helms 
@_subject: How to verify the file was successfully encrypted... 
Hi folks.
I've read the man page.  I've read the FAQ's.  I'm not seeing what I'm
looking for.
Using something like "zip", you can use a -T to test the integrity of
the file.  Note: this is not testing that nobody has altered it, or that
it came from a specific user; it is only testing whether it is a good
gpg file and whether it can be decrypted.  All I can find in gpg is a
way to verify the integrity vs. a signature file.
I'm looking for a way to gpg encrypt a file, test that the encryption
was good and that the file can be extracted, and then to delete the
original file.
Even better would be a way to automatically remove the original when the
encrypted version has been successfully created, if such a parameter
At the very least, though, a way of testing that the file encryption was
successful without having to sit at my desk at 3AM running 'gpg
--decrypt filename' to test it would be very helpful.
Is this something I'm just not seeing on the man page and in the FAQ's?
Benny Helms

@_date: 2006-07-12 18:56:38
@_author: Benny Helms 
@_subject: How to verify the file was successfully encrypted... 
Sorry.  I guess I should have given more details.  I was just hoping the
bare minimum info would be enough because somebody would say, "Oh,
that's easy!  All you do is..."
I have a server with files that are created on a daily basis.  Many
files.  I've reached a point where I want to have those files encrypted
each night to prevent security breaches.  My intent is to encrypt the
file and delete the original.  However, if I do that, and then go back a
week later to obtain some data from that file, and it says, "Whoa, dude!
This gpg file seems to be hosed.  I can't open it!", I'm absolutely
screwed because our contract requires eternal data retention on some if
this stuff.  Losing data is unacceptable.  But at the same time, having
an encrypted version and an unencryted version is equally unacceptable.
Basically, I'm looking for a *scripted* way to verify that the newly
created gpg file is in good condition and I'll be able to open it at a
later date if needed, BEFORE I delete the original file.  Frankly, I'm
surprised that's not a standard built-in function in gpg.  Bzip2 will
bzip a file, and only after successfully completing the task, it will
automatically delete the original and leave only the bz2 version in
place.  That's the basic functionality I'm looking for.
And I definitely want it to be able to do the job in a script because I
don't have a life as it is, let alone sitting here manually decrypting
file after file to test their usability in the wee hours of the morning
when I should be home with my family.
Make sense?
I'm doing this with a plain old bash script.  Basically...
for file in "list of files"
  gpg -r username -z 9 --encrypt $file

@_date: 2006-07-12 18:58:36
@_author: Benny Helms 
@_subject: How to verify the file was successfully encrypted... 
Before deleting original file, I must make certain encrypted version is
in good shape so I can open it at a later date and obtain data.  If it
is broken, I'm in deep monkey muffins.  That's the threat model.
Can you please explain what you mean by "check the gpg's rc after the
encryption run?"  I'm unfamilar with the meaning of "rc" in this case.

@_date: 2006-07-12 19:56:06
@_author: Benny Helms 
@_subject: How to verify the file was successfully encrypted... 
Thank you for the reply, Mark.  Yes, that would definitely do the trick.
I guess I need to go to the FAQ to discover how to safely put a password
into a scripted activity since each decryption requires a password.
Check me on this, though.  Is there any error checking in gnupg when
creating a file?  Is it safe to assume that if the job completes, the
file is usable?  This method you've described will definitely work, but
it seems like a lot more CPU cycles and a lot more time involved in the
script than should be necessary.  Should I be submitting a "wish" to the
developer list?

@_date: 2006-07-12 22:58:45
@_author: Benny Helms 
@_subject: How to verify the file was successfully encrypted... 
Excellent question!  Truth be told, as soon as they are encrypted,
they're being moved to another server in another location, and then are
being burned to CD and moved to a safety deposit box.

@_date: 2006-07-13 00:22:51
@_author: Benny Helms 
@_subject: How to verify the file was successfully encrypted... 
Thanks Jeffrey.  Excellent suggestion.  This worked well with a .asc
file, but not with a .gpg file.  Does anyone on the list have a
preference for .asc vs .gpg output?  Pros?  Cons?  The size is almost
twice as big as a .gpg at this time, which is a definite con.  But there
are probably some serious pros as well.  Input?

@_date: 2006-07-14 23:24:25
@_author: Benny Helms 
@_subject: How to verify the file was successfully encrypted... 
Understood.  I call that return status.  Too many acronyms in our industry.  :-)
Interesting.  Perhaps I'm not clear.  That happens.
An encrypted file is absolutely useless if it cannot be decrypted.  In
fact, it's flat out dangerous!  It's like carrying a gun around for
protection, and when you suddenly need it, discovering it has no ammo
and the barrel has been blocked.  All the backups in the world, all the
RAID, DR policies, etc., will not help if the encrypted data is corrupt
and you do not have the original.  To me, that sounds very "consistent".
And the fact that I'm trying to certify that the file is a solid,
working encrypted file before deleting the original should have told you
that I wasn't being frivolous with my procedures and security measures.
As a Unix SysAdmin with many years on the job, I do my backups
faithfully, I'm running RAID, we have a DR policy in place and test it
on a regular basis.  Firewalls are many, strong and in place.  What
these items have to do with whether I can trust that an encrypted file
can be decrypted to return my "precious data" when I need it is beyond
And yes, I also take into account the data transfer, the storage media,
etc.  I already have procedures in place for all of that.  What I don't
have, and what makes everything you offered irrelevant, is the certainty
that the encrypted file is decryptable so I can safely remove the
original that I wanted to protect in the first place.  That was the only
question I put on the table because I've already handled the rest, and
don't need assistance in those areas.  I only asked for assistance with
gpg because I haven't used it in this way in the past.
Thanks for your input, though.

@_date: 2006-07-15 00:03:44
@_author: Benny Helms 
@_subject: How to verify the file was successfully encrypted... 
Interesting idea, Samuel.  Thank you!  I'll give it a whirl.
