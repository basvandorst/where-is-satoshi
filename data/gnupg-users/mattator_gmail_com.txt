
@_date: 2018-03-04 02:50:52
@_author: Matt 
@_subject: [gpgme] generate a wheel of the python bindings 
I've been trying to package gpgme python bindings for nixos
( since it's a dependency of the mail reader I use
(alot) but I haven't succeeded yet.
I manage to compile the python 2.7 bindings and to build a "wheel" (as
required by nixos, a wheel is a zip file replacing the older "egg'
binaries) but for some reason my wheel is empty ;/ (it has egg-info
but not the gpg package).
The -meager- result of my efforts is visible here
 and
Also I believe that if one wants to be able to run "setup.py install",
he will need a patch similar to:
I've tried asking on  but couldn't find a solution. I really
some skilled user can help solve that as I miss my mailreader :)

@_date: 2018-03-06 03:15:38
@_author: Matt 
@_subject: [gpgme] generate a wheel of the python bindings 
Thanks for the detail answer.
Nope, just "alot" :) Your mail cleared some of my doubts: Nixos is a source based
distribution with binary cache. I was trying to package the python
bindings separately than gpgme because it seemed cleaner. At the end
of the day though I just overcomplicated things. Looking into more
details building a wheel is not necessary either so I will just use
the upstream `make install`.
python seems to run some tests during the build but I couldn't find
the flag to prevent these ? I found
"--disable-gpgconf-test" "--disable-gpg-test" "--disable-gpgsm-test"
"--disable-g13-test" but  none disable the python tests.
Ideally I would make the tests run too (nixos rules don't make it
mandatory but it's encouraged) but iI wonder if the paths
"/build/gpgme-1.10.0/lang/python/tests/" are ok ? (it's unusual to see
a path starting with "/build" ).
gcc -pthread -shared -lgcc_s -g -O2 -Wall -Wcast-align -Wshadow
-Wstrict-prototypes -Wformat -Wno-format-y2k -Wformat-security -W
-Wextra -Wbad-function-cast -Wwrite-strings
-Wdeclaration-after-statement -Wno-missing-field-initializers
-Wno-sign-compare -Wpointer-arith
-lpython2.7 -o python2-gpg/lib.linux-x86_64-2.7/gpg/_gpgme.so
-L/nix/store/3m9br2anary4yssv6ag2kjh35i0qnhim-gpgme-1.10.0/lib -lgpgme
-lassuan -L/nix/store/y92c6dahh8i7wjhlh71mj5c1225a5073-libgpg-error-1.27/lib
running build_py
copying gpg/core.py -> python2-gpg/lib.linux-x86_64-2.7/gpg
copying gpg/results.py -> python2-gpg/lib.linux-x86_64-2.7/gpg
copying gpg/util.py -> python2-gpg/lib.linux-x86_64-2.7/gpg
copying gpg/__init__.py -> python2-gpg/lib.linux-x86_64-2.7/gpg
copying gpg/callbacks.py -> python2-gpg/lib.linux-x86_64-2.7/gpg
copying gpg/errors.py -> python2-gpg/lib.linux-x86_64-2.7/gpg
creating python2-gpg/lib.linux-x86_64-2.7/gpg/constants
copying gpg/constants/validity.py ->
copying gpg/constants/create.py ->
copying gpg/constants/status.py ->
copying gpg/constants/sigsum.py ->
copying gpg/constants/event.py -> python2-gpg/lib.linux-x86_64-2.7/gpg/constants
copying gpg/constants/pk.py -> python2-gpg/lib.linux-x86_64-2.7/gpg/constants
copying gpg/constants/md.py -> python2-gpg/lib.linux-x86_64-2.7/gpg/constants
copying gpg/constants/protocol.py ->
copying gpg/constants/import.py ->
copying gpg/constants/keysign.py ->
copying gpg/constants/__init__.py ->
creating python2-gpg/lib.linux-x86_64-2.7/gpg/constants/data
copying gpg/constants/data/encoding.py ->
copying gpg/constants/data/__init__.py ->
creating python2-gpg/lib.linux-x86_64-2.7/gpg/constants/keylist
copying gpg/constants/keylist/mode.py ->
copying gpg/constants/keylist/__init__.py ->
creating python2-gpg/lib.linux-x86_64-2.7/gpg/constants/sig
copying gpg/constants/sig/notation.py ->
copying gpg/constants/sig/mode.py ->
copying gpg/constants/sig/__init__.py ->
creating python2-gpg/lib.linux-x86_64-2.7/gpg/constants/tofu
copying gpg/constants/tofu/__init__.py ->
copying gpg/constants/tofu/policy.py ->
make[4]: Leaving directory '/build/gpgme-1.10.0/lang/python'
Making all in tests
make[4]: Entering directory '/build/gpgme-1.10.0/lang/python/tests'
echo no-force-v3-sigs > ./gpg.conf
echo ignore-invalid-option agent-program >> ./gpg.conf
echo "agent-program `which gpg-agent`|--debug-quick-random" >> ./gpg.conf
which: command not found
echo pinentry-program /build/gpgme-1.10.0/tests/gpg/pinentry >gpg-agent.conf
gpgconf --kill all
-p ./private-keys-v1.d
for k in ../../../tests/gpg/13CD0F3BDF24BE53FE192D62F18737256FF6E4FD
../../../tests/gpg/7A030357C0F253A5BBCD282FFC4E521B37558F5C; do \
          cp $k private-keys-v1.d/${k \
        done
echo x > ./private-keys-v1.d/gpg-sample.stamp
gpg --batch --no-permission-warning \
               --import ../../../tests/gpg/pubdemo.asc
gpg: keybox '/build/gpgme-1.10.0/lang/python/tests/pubring.kbx' created
gpg: /build/gpgme-1.10.0/lang/python/tests/trustdb.gpg: trustdb created
gpg: key 2D727CC768697734: public key "Alfa Test (demo key)
" imported
gpg: failed to start agent '|--debug-quick-random': No such file or directory
gpg: can't connect to the agent: No such file or directory
gpg: key FE180B1DA9E3B0B2: public key "Bob (demo key)" imported
gpg: failed to start agent '|--debug-quick-random': No such file or directory
gpg: can't connect to the agent: No such file or directory
gpg: Total number processed: 26
gpg:               imported: 26
make[4]: *** [Makefile:630: pubring-stamp] Error 2
make[4]: Leaving directory '/build/gpgme-1.10.0/lang/python/tests'
make[3]: *** [Makefile:471: all-recursive] Error 1
make: *** [Makefile:449: all] Error 2
2018-03-04 8:39 GMT+09:00 Ben McGinnes :

@_date: 2018-03-07 00:36:24
@_author: Matt 
@_subject: [gpgme] generate a wheel of the python bindings 
All problems disappeared with latest source. So everything is ok :)
Thank you once again
2018-03-06 3:15 GMT+09:00 Matt :
