
@_date: 2007-04-07 20:30:41
@_author: Alexander Feigl 
@_subject: Gnupg cannot handle extremely large keys on 32 bit Linux 
gnupg 2.x seems to have problems with importing extremely large keys on 32 bit Linux. (>= 16kbit RSA) While an sensible error message might be acceptable when support for such large keys is not desired, the current behaviour certanly isn't. gnupg 2.0 imports the key but when listing the key it appears under another key id and fingerprint and the key expiry date is not shown. Other data might be corrupted too.
I tested it with gnupg 2.0.3 under Gentoo Linux. Once on a 64 bit AMD CPU, once on a 32 bit AMD CPU. Besides everything is compiled for 64 bit/32 bit the machines should be rather identical. 64 bit seems to work without problems but 32 bit shows this incorrect behaviour. Gnupg 1.x seems to work on both CPUs. Is this problem reproducable on other distributions or does a compiler bug cause these problems.
I pasted a testing key below. The key with the key id 0x2D879666 gets imported as 0xB61454A3 here.
While such large keys seem like overkill. But gnupg also supports the SHA512 hash which would require such large keys for sensible use.
Alexander Feigl
-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: GnuPG v2.0.3 (GNU/Linux)
-----END PGP PUBLIC KEY BLOCK-----

@_date: 2007-04-13 23:30:43
@_author: Alexander Feigl 
@_subject: Gnupg cannot handle extremely large keys on 32 bit Linux 
So gpg behaves incorrectly on 1.4.7 for ppc, but correctly for i386, on 2.0.x it behaves incorrectly for i386 but correct for amd64. Any chance there is some problem in the architecture dependant part of gnupg?
PGP Desktop seems to be able to handle such keys
Alexander Feigl

@_date: 2007-04-14 18:44:18
@_author: Alexander Feigl 
@_subject: Gnupg cannot handle extremely large keys on 32 bit Linux 
Am Samstag 14 April 2007 schrieb Charly Avital:
Looks good.
Can anybody test it with 2.0.3 on Mac? For me it look like there are problems with saving to key to disk. Importing the key with 1.4.7 and then checking the key with 2.0.3 seems to work last time I checked it (x86 Linux). At least as long as the key file is not touched by 2.0.3. If Enigmal would use the same gnupg components as gnupg 2.0.x this would explain the behaviour. The key gets written out incorrectly and gnupg 1.4.7 fails because of this.
Is there any easy way to view and compare the key material (prime product, public exponent...) of a key ring?
Alexander Feigl

@_date: 2007-04-16 17:15:24
@_author: Alexander Feigl 
@_subject: Gnupg cannot handle extremely large keys on 32 bit Linux 
Am Montag 16 April 2007 schrieb Charly Avital:
Can confirm this on x86-linux with libgcrypt 1.2.4 but the key is imported as 0xB61454A3 here (Gentoo Linux). Furthermore if I import the key with 1.4.x and use gpg --list-key with gnupg 2.0.3, the command shows the correct key id. But as soon as anything touches the key RING (not the key itself) using 2.0.3 - like creating a new secret key, the incorrect key id shows up. Creating a new key should have nothing with the old key. I think there must be a problem in the code which copies the old key into the new keyring file with the fresh key in it
I found a tool named pgpdump which seems to be able to dump the key material of the key. And it semms like at least the last two bytes change. I did not compare the whole key yet
------ key material after being touched by 2.0.3----------------
Old: Public Key Packet(tag 6)(2061 bytes)
        Ver 4 - new
        Public key creation time - Sat Apr  7 13:10:06 CEST 2007
        Pub alg - RSA Encrypt or Sign(pub 1)
        RSA n(16384 bits) - 96 f4 17 c9 59 c5 3a 56 29 0b 76 b7 c5 81 c4 b2 c1 b5 bd 14 3d 80 71 de b4 f5 c8 c9 0f 5b ce 0b c7 5a 38 a7 4d 59 ac 2a e4 84 09 d9 fe 4c c0 d6 44 eb 10 06 47 fa 59 eb 57 23 33 0e 69 21 9a 2b 37 ff 9f e8 9b ab 8d 62 41 a2 c3 66 92 c9 40 3d ae e3 07 6e 34 e1 67 49 29 84 6e a5 38 47 ff 8c ef 8e 8c db de 62 9e 0c 5b 8c be 4d 6c 6c 73 5a 76 d6 77 5d 09 aa 8c f4 a9 ec 42 30 80 0e f4 be 99 93 5b 26 6a d8 3a 1a 9d 78 e5 d7 1f 8e 84 e3 40 8b 48 63 7e 1f 88 ed 80 e7 d1 ea 83 20 72 b8 9a 63 42 9c 00 a5 91 a1 28 da 20 d2 78 c1 25 b4 7e a6 76 fd 34 0c f5 10 78 61 d0 0a 9d 09 39 dc ea 65 cf dd a7 e6 8e ed a9 76 32 2e d6 46 ad a2 af 8c d5 ba ce 3d 2e 18 ac 1f ca c3 44 52 79 0c 94 36 f2 a1 89 c2 d8 f8 b0 88 38 fd 2c fa 32 c6 46 da 1c 0c 25 50 78 48 c3 e7 00 ec 81 94 f1 ad f7 ae 5d d2 3c 43 79 78 59 74 32 15 f7 22 af 02 22 85 65 c2 87 79 87 28 4a 18 5f e1 0c 1f 5f 52 ad 99 9d 2e 8b a6 b4 d6 2a 41 91 37 bc 7e 5a 0d 4f 25 ed be 3e ee 6f f9 38 ef b7 8a ee 14 0a dc d8 a3 bd 4c b3 71 00 d5 a3 b5 b5 13 06 11 da 2e dc 45 cd f8 41 ac f8 37 73 9e be ac 6f 06 01 68 7f c3 7e ad 57 a5 58 c6 1c ab 06 f2 a1 70 fb 98 0f 4e 9f 95 3c ff bc 31 52 28 49 9e 15 e6 ec 6c d2 68 29 41 7a 1f 69 57 67 e5 dd 24 4f 66 a7 bf 11 5d c5 d7 97 36 f5 03 0d de 16 3d c2 be 39 92 69 fa 68 4d 04 10 c8 fd d2 e0 13 c2 24 93 a0 46 dc ad a9 cb 02 e6 39 29 f9 88 44 6c fe 09 9d f9 37 bd 84 23 a8 9b 44 d1 ca 47 bd a2 44 3c 33 f6 a9 4d 42 cd ca 1e fe 11 7f ab c0 89 eb da e4 01 ba cb 05 11 ed bf 6a ac b9 bc bd 96 9b 33 1f b0 f6 f6 f5 ff c1 e3 ad 6a 8e 1c 80 b9 87 3b 84 ee 42 19 26 ba 8c 8e 22 3c fb e3 d2 77 db cc ed f2 13 28 59 34 14 c9 d5 cb 25 83 a2 72 a7 0d 84 1d 65 7b b1 65 94 4a 68 d0 96 cf 7b 99 3b 1f 5f d5 d6 80 b1 09 39 84 df 71 e1 08 f1 c1 b4 94 51 cf 6d 7a 09 13 6f 46 5f 2d 89 c1 87 24 e4 01 29 78 2b 8d 2c d2 b2 3e 3c 08 de 3a 22 dc a4 64 99 3c c0 ae 4f 55 a6 1f c0 18 89 5c 27 ce 69 27 e7 9b 10 ab 63 6b 82 32 de 33 18 d3 ba 73 bd fe ef b8 f6 7b 91 60 d4 d9 10 af 8d b1 78 57 ab f2 df 86 bd 52 3c d4 54 ed 5d a4 8b 14 6b 96 04 f4 99 92 33 09 23 d1 2a ad 42 5d 3e 0e e2 52 c6 13 02 a8 d3 28 e7 b5 59 6a 76 24 b6 37 c3 32 3c 8d b9 ff 24 69 46 b4 94 75 f0 8c 00 f5 b3 91 6b b3 75 81 dc 22 92 c8 b7 6a 71 f2 01 e2 5b 15 bc 11 0b 20 1c 85 11 49 9d c6 d0 ed c8 2a 40 b4 d1 5c ec d9 1c 87 79 a3 d5 4c 9f 7a 2f d3 2a de 2f 96 90 a8 93 2b 2a b7 82 39 13 5c 31 5b 48 8e 2c 7c 83 64 c6 16 81 17 f3 3c d5 96 b9 ed d3 3e e6 2f 22 f2 2d 4a df 61 3c af c8 2b 73 75 62 6c 50 f1 e7 7b aa 4c 4b 0c 4a aa e0 79 5b 9f 1c a0 79 6f 52 82 38 e8 8c 06 b0 ba f6 29 ff 1a 9c 7c 26 be f7 fc 9c d4 62 28 5a f6 b3 bb 67 66 79 5c 25 98 dc 86 6d d6 3f f9 0d ad a8 1f 8e 3f c3 16 30 1e 2a 69 2c f2 11 26 7d 77 ef ce 76 b4 ce b7 38 18 99 fa c9 de 2c b1 9e 7f 3b 8f d1 f2 a8 07 63 a7 d6 89 3c d6 c6 f3 f8 69 e2 ab 49 06 74 1c 27 a9 56 e8 33 d9 ec 3b bd 10 3e 03 4a 2d a9 32 74 7e 09 58 04 6f 1b a6 60 e1 78 6e ea ad dc ac ed a6 5b db 9e a9 6f ae c9 ed 49 33 33 fe 1a 73 26 82 64 8e c1 9f 6a d8 a3 26 7e 54 4d f1 36 05 8a 25 1f 0b f2 fc 57 90 33 53 de 54 3d fd 19 40 a3 db c7 88 dd d3 48 71 85 ec ce 12 c7 4e 71 cb fa 54 1b 2d 4a 37 da 97 6d 97 70 77 3c 40 12 d5 4c f7 51 23 b3 c5 1c 9e cd 02 29 24 f6 5f 69 7b 55 b9 14 ce fd 68 96 44 fa e4 0f 1a 08 b6 e9 96 49 3d 68 4d ad 23 20 78 e0 03 6c d6 9d 2b 2e da f7 7a 8b 37 f0 3c f6 b4 8c 7a d4 0b 33 12 7d d3 81 55 43 d9 c0 d6 2e 5f e0 79 45 ea 72 27 73 2c 96 74 b9 57 c5 03 47 ea bf ec 7b 36 67 c9 7e 5d ed ab 7b ee ee 14 c8 56 c8 43 d0 7d d6 a9 90 e5 b3 48 9e 4b 3a 1d 95 3f e1 5c 39 1f d9 49 81 ff 25 1a 73 1d 24 fc ea 3f d9 1f b8 5f b2 b8 09 32 9c 38 4f 79 62 cb 67 fa 87 7b 46 51 52 29 13 b7 b6 ed ea 1c 38 28 7e 14 46 b1 18 30 d7 3e fb 41 da e5 bf 16 cf 57 45 a2 7c 48 06 b3 4c 69 bb 5d 46 97 05 82 f5 4d 94 14 5c 89 9b ca 4b 72 d0 62 9e bb 76 f8 49 35 54 42 07 75 b6 8a de ce 6e 62 ac 7c 18 01 52 f0 1c 00 3c 0e 01 f6 c1 7c e7 7f fe 0c ec c0 78 6f b8 5c 8d b2 27 0e ae 74 aa 08 b7 b6 74 c7 83 18 d7 00 b9 4b 06 61 ee 30 22 3a db 1f e9 84 21 7c 64 ba e0 06 8c bb ef f2 1e d7 12 12 d7 7c d9 94 50 54 06 90 3f e7 88 c5 56 1c 99 2c 51 c5 e4 ea 99 78 1b 06 8c 20 7e 76 76 4e 7d 8b 62 f3 0b 9a d9 e3 d3 a4 3a 65 19 47 69 56 0f 03 c7 e6 ae 1f 3c 63 fb 29 79 36 6a 83 15 71 ac 8e 7c 4e b9 bd 9d be ac 2f ca fb 34 3b a2 da fd 86 da 74 bb 4e 65 52 b7 c2 31 41 a8 05 1d 0e bd 01 4a 51 7f f6 92 7d 14 20 78 af c8 70 ea fa 5e 7b f4 c3 82 a7 ec f7 0d 42 3d 95 e4 cd a4 ce 05 c0 c7 f8 5e 65 3f d0 00 3c 33 0b 3a 47 4c 00 9f 54 3d 40 2b 20 d6 37 7d 0b fc 82 63 26 0a 83 ea 91 75 3d 78 d0 b6 2c 87 36 36 72 06 25 d0 95 73 f7 6f c6 a6 e6 f5 8d db 05 bb 66 e9 5f d9 72 38 5a 39 74 e7 f8 08 c7 91 09 c0 4f d8 38 e8 23 6b c4 81 98 7e 84 0e 5a 45 30 ff 7b 4f b1 fa 3f 09 e7 3c bf 9c 7d b0 99 20 dd 1f c5 79 df eb 53 32 e4 b9 c5 2e c9 69 71 b2 0b 0b e8 4b 13 27 0b a1 ed ae 1c 0a c3 2b b7 a2 bd f7 0d c6 fe 0c 41 ac cc 45 ec 34 ce fe b2 84 c2 ee 19 e9 30 ff d4 a3 32 57 b2 c3 2d a9 15 7c d1 ca 71 6c 0f bb 07 4e 35 6f b9 c4 77 97 d8 7b 78 92 ce 9f c0 00 47 3a 81 df 7f 9d c5 fb 2a 9f fc 73 29 44 77 ad 52 86 44 ae 74 3c 45 a0 fa 87 5b 0c 90 9b a8 ff 1a 3b a7 de 3e ff c3 f4 1b af 24 2a c0 1d 21 62 91 db ef 7e 00 9c b5 d4 92 c4 45 63 b0 23 ae 8e 4c 40 dc 57 d9 e9 7b 39 37 69 55 20 f3 99 ef 3e c2 e7 1d c8 a1 27 20 b6 a7 d1 30 89 ed a5 37 d6 cf 2d 8d 05 73 81 c5 4b 44 bf b1 6c d3 e0 24 f7 73 a7 ff 7d 2d 7d e0 92 a4 58 41 31 bc 61 de e7 d9 a6 8c 9b da 2a 95 92 82 c5 c2 0f e1 65 40 cf c9 7b 04 02 49 e3 4b 5c ed 37 fc 71 25 de c9 48 c4 9b d1 db 10 09 7d a3 7c a5 9c 3d 6b eb 11 0c cb f7 b1 1c c0 b0 4e 79 4c 5a e1 f4 94 8a 82 dc 1a bd d5 e8 f6 e6 8b 50 c1 07 10 29 9b be d2 e5 08 54 30 83 ce 30 71 fe d8 c1 bf 9a 3c 22 c4 19 30 64 21 46 54 68 d1 42 ff 82 65 cf c8 e0 8f d6 f9 28 b3 60 b4 20 9e 4a 96 b9 cf 96 67 bb c0 19 e7 92 7d 79 7a 33 9e 90 50 73 d2 c7 76 71 5c 36 bf ca 99 92 b8 62 82 5d f5 c1 35 f2 ad c1 fa 86 ef b6 f9 6e 1e 06 f4 ae d9 8c 17 dc 1b 33 e7 99 c4 4f 62 d9 9c 48 5a 6d 35 5e 7b 96 11 d4 4a 8f 15 a3 67 31 cf 2a 43 9f 67 d0 6d 73 5d 93 c7 6f 50 1d 78 6c 02 f2 af 56 28 8d a4 85 fd 32 ad 2c f6 6e 3d 76 72 88 01 4a f7 dd 06 e4 17 38 4f 09 13 a7 99 26 08 5e 68 0f aa 44 ab 02 54 91 7b 3a e8 d1 32 7f be 9a 18 24 25 19 79 39 38 a8 01 68 86 53 6b 02 08
        RSA e(17 bits) - 01 00 01

@_date: 2007-04-16 18:54:29
@_author: Alexander Feigl 
@_subject: Gnupg cannot handle extremely large keys on 32 bit Linux 
Am Montag 16 April 2007 schrieb Werner Koch:
Found it
--- gnupg-2.0.3/g10/build-packet.c      2006-10-18 15:50:43.000000000 +0200
+++ gnupg-2.0.3-fixed/g10/build-packet.c        2007-04-16 18:40:31.000000000  -157,7 +157,7  static int
 mpi_write (iobuf_t out, gcry_mpi_t a)
 {
-  char buffer[(MAX_EXTERN_MPI_BITS+7)/8];
+  char buffer[(MAX_EXTERN_MPI_BITS+7)/8+2];
   size_t nbytes;
   int rc;
Seems like this fixes the problem. mpi_write allocates 2 bytes less it should. It shouldn't be security relevant on usual architectures, but it is a bug for The last MPI bytes of the MPI seem to be 0802, which is the content of int rc. On Mac you probably get 0000 because the endian is different
