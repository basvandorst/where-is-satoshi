
@_date: 2006-11-11 01:24:47
@_author: Pedro Pessoa 
@_subject: Failure to sign with gpgsm 
Altough I can sign with a certificate from Thawte, when using a certificate from the Portuguese nacional laywer association I'm having this error:
gpgsm: error creating signature: No value The certificate tree is correctly verified:
gpgsm: DBG: gcry_pk_verify: Success
gpgsm: certificate is good
gpgsm: DBG: got issuer's certificate:
gpgsm: DBG: BEGIN Certificate `issuer':
gpgsm: DBG: gcry_pk_verify: Success
gpgsm: error creating signature: No value Any thoughts on this? What's going on?
I've tried the following versions:
gnupg2 1.9.16 with libksba 0.9.11
gnupg2 1.9.22 with libksba 0.9.15
both give out the same error.
Thanks a lot!

@_date: 2006-11-14 15:42:00
@_author: Pedro Pessoa 
@_subject: Failure to sign with gpgsm 
After trying to figure out what's this problem and reaching a dead end, I went through the diferences out of a dump in both certtificates, the one that works, and the one that doesn't.
- Both have the fields:
- These are only present on the certificate that doesn't work:
 	. extKeyUsage: 1.3.6.1.4.1.6204.20.18.2.105.1020 (suggested)
                                 clientAuth (suggested)
                                 emailProtection (suggested)
                        1.3.6.1.4.1.6204.10.2.1020
               issuer: none
               issuer: none
Is it possible that one or several of these fields only present on the certificate that doesn't work is causing the failure?
Is there any way to strip them out of the certificate?
Btw, I've just tested importing the "bad" certificate on Thunderbird, and there I can use it to sign messages. Is this a certificate or gnupg problem? I'm really at a loss...

@_date: 2006-11-15 02:00:31
@_author: Pedro Pessoa 
@_subject: Failure to sign with gpgsm 
I've just finished compiling gnupg fresh from the tar ball. The error remains:
gpgsm: error creating signature: No value But now, with the code compiling, I could track down to where the problem is.
The method gpgsm_validate_chain (ctrl, cert, NULL, 0, NULL, 0); on sm/sign.c is failling. Any hints on what I can do to know why it is failling?

@_date: 2006-11-16 01:14:13
@_author: Pedro Pessoa 
@_subject: Failure to sign with gpgsm 
It looks ok, I can see the complete certificate chain.
Nope, still the same error:
gpgsm: error creating signature: No value Shall I try to dig into gpgsm_validate_chain?

@_date: 2006-11-20 00:46:38
@_author: Pedro Pessoa 
@_subject: Failure to sign with gpgsm 
Fixed. Details ahead.
After showing the certification chain to Werner, the error source was identified (gpgsm --dump-chain YOUR_KEY_ID).
The root CA I'm using is bogus because its missing a basic contraint:
  chainLength: [none]
However this did not showed up on gpgsm --dump-cert --with-validation. I said certificate was good.
The workaround is to look up the fingerprint (sha1_fpr) of the offending key.
In the case of /CN=GTE CyberTrust Global Root/OU=GTE CyberTrust Solutions, Inc./O=GTE Corporation/C=US the fingerprint is And the making sure that ~/.gnupg/trustlist.txt contains this line:
97:81:79:50:D8:1C:96:70:CC:34:D8:09:CF:79:44:31:36:7E:F4:74 S relax
which tells to ignore the fact that chainLength is not a number nor "unlimited" like it should.
BTW, this does not work with gnupg <= 1.9.16. In fact, I went through to version 2.0.0. There it works!
Just a side note, I had to use just one character for my passphrase that protects the imported certificate, because anything longer would fail the check afterwards during retrieval. I didn't gave it too much attention yet...
Werner, thanks a lot for your help!
