
@_date: 2008-03-19 08:25:54
@_author: bdorroh 
@_subject: Decyrption via scheduled task fails 
I'm using v1.4.8 for Windows. I've have a batch file setup to decrypt a file
and then to move the decrypted file to another location for further
processing. I can successfully decrypt the file by double-clicking my batch
file. But when I setup a scheduled task to run it, the decryption fails. I
can confirm that the scheduled task is executing, but I can't figure out why
the decryption fails as a task. Obviously, I can't see the output.
I've tried outputting the results to a file, but it only shows the command
executed and not what actually appears on the screen when run manually.
Also, i do have the path to GNU set in the windows path statement.
Any ideas here? I'm really stuck.

@_date: 2008-03-20 07:34:22
@_author: bdorroh 
@_subject: Decyrption via scheduled task fails 
Yes, it's running as a domain user with administrative rights on the box.

@_date: 2008-03-20 13:34:31
@_author: Dorroh, Brian 
@_subject: Decyrption via scheduled task fails 
When I type the command manually, it still doesn't log. The output is
I'm executing from the directory that contains the BAT files,
C:\LoadScripts>echo SECRETKEY|gpg --passphrase-fd 0 --decrypt-files
c:\mcdown\*.pgp --logger-file gpg_logfile.txt > gpg_output.txt
Reading passphrase from file descriptor 0
You need a passphrase to unlock the secret key for
user: "System Admin (no comment) "
2048-bit ELG-E key, ID 3211****, created 2008-02-24 (main key ID
gpg: encrypted with 2048-bit ELG-E key, ID 3211****, created 2008-02-24
      "System Admin (no comment) "
gpg: Signature made 03/20/08 02:14:53 using DSA key ID 0175****
gpg: Can't check signature: public key not found
gpg: --logger-file: unknown suffix
gpg: gpg_logfile.txt: unknown suffix
To answer your questions:
1) I changed the Start In location for the scheduled task to point to
the location of the encrypted file. Made no difference.
2) Also tried using full paths to the executable, but the job still
-----Original Message-----
Sent: Thursday, March 20, 2008 12:57 PM
I would think we should keep this in the list, such that other people
with a similar issue can search the list archives and find this answer.
 And so others know whether or not it *is* resolved in the end.  Hope
you don't mind me posting it back to the list.
If you try your commands directly from the command line, what happens?
Does it complain about syntax? Does it work and produce a log file?
Try this:
1. Check the working directory of the scheduled task. Make sure it is
set to the folder where the encrypted files are located.  Perhaps it is
working and just writing everything out to the working directory?
2. Change the job to use full paths for the executables, and redirect
the output to a file:
echo SECRETPASSPHRASE | C:\path-to-WinPT\gpg --passphrase-fd 0
--decrypt-files C:\path-to-files\*.pgp --logger-file gpg_logfile.txt >
Personally, I would leave the --logger-file directive in there even
after everything is working properly.  That way if there is ever a
question in the future, you'll at least have the log to verify what
occurred.  Once it is working, add a line to be beginning of the script
to remove the previous day's log file.

@_date: 2008-03-20 16:03:22
@_author: Dorroh, Brian 
@_subject: Decyrption via scheduled task fails 
That seems to work better. It only logged two entries to the gpg_logfile
when I let it run as a scheduled task. Here's what it says:
gpg: encrypted with ELG-E key, ID 3211****
gpg: decryption failed: secret key not available
And just to confirm, this works fine when I just double click the batch
file. Here's that output:
gpg: encrypted with 2048-bit ELG-E key, ID 3211****, created 2008-02-24
      "System Admin (no comment) "
gpg: Signature made 03/20/08 02:14:53 using DSA key ID 0175****
gpg: Can't check signature: public key not found
btw, it always throws up that public key error, even though it does
decrypt the file.
-----Original Message-----
Sent: Thursday, March 20, 2008 3:29 PM
Whoops, I missed something - order of arguments may matter, as it
apparently is
taking the "--logger-file logfile" as more files to decrypt.
echo SECRETKEY | gpg --logger-file gpg_logfile.txt --passphrase-fd 0
--decrypt-files c:\mcdown\*.pgp > gpg_output.txt

@_date: 2008-03-20 16:22:23
@_author: Dorroh, Brian 
@_subject: Decyrption via scheduled task fails 
Ok, now I'm getting somewhere. I logged in as the local service account
that was running the batch file. When I ran the bath file manually it
So I logged back in as my domain account, changed the scheduled job to
run as my domain admin account, and then ran the job. This time it
So basically the local system account isn't finding the key to decrypt.
I sort of remember something about this. Doesn't the GnuPG installer
dump the keys in the profile of the account that installed it? I
installed GnuPG with my domain admin account, rather than the service
Is there a simple way to fix this? I guess I could copy my user profile
over if nothing else.
-----Original Message-----
Sent: Thursday, March 20, 2008 3:29 PM
Whoops, I missed something - order of arguments may matter, as it
apparently is
taking the "--logger-file logfile" as more files to decrypt.
echo SECRETKEY | gpg --logger-file gpg_logfile.txt --passphrase-fd 0
--decrypt-files c:\mcdown\*.pgp > gpg_output.txt

@_date: 2008-03-21 09:09:33
@_author: Dorroh, Brian 
@_subject: Decyrption via scheduled task fails 
I finally fixed it. It did turn out to be a profile issue. Since GnuPG
was installed with my account rather than the service account used to
kick off the scheduled job, the scheduled job of decrypting the file
fails. So this morning I copied my user profile over to the service
account profile and ran the job. This time the file decrypts without any
Thanks to everyone who assisted!
-----Original Message-----
Sent: Thursday, March 20, 2008 3:29 PM
Whoops, I missed something - order of arguments may matter, as it
apparently is
taking the "--logger-file logfile" as more files to decrypt.
echo SECRETKEY | gpg --logger-file gpg_logfile.txt --passphrase-fd 0
--decrypt-files c:\mcdown\*.pgp > gpg_output.txt
