
@_date: 1995-11-21 00:06:33
@_author: Ben Holiday 
@_subject: Re: remailer abuse 
[extremely lucid comments clipped to save bandwidth]
Agreed, wholeheartedly. The above paragraph would be a perfect candidate for wide disemination across the net. The facts are that to eliminate the "abusive" mail would require crippling the remailer system to an unacceptable degree. Therefore we as operators are in a position of being forced to either tolerate messages that we may disagree (strongly) with, shut down the remailers, or resort to inadequate 40bit encryption and psuedo-anonymous Penti.fi remailing.
(no offense to Julf intended..)
I see nothing submissive or apologetic about pointing this fact out in a focused and organised way. In fact, making this fact plain might actually limit the number of people using the remailers to harrass other users. If general oppinion is that remailer operators accept and condone /all/ forms of communication, without regard for it potential effects, why shouldnt the spammer take advantage of our generosity?
Certainly being PC should not be the primary consideration in any undertaking, but the united states (and other nations) have well paid and well organised spin doctors working to convince the public that cryptographers and remail operators are "bad" people who's only purpose is to aid pedophiles and other criminals in carrying out their dastardly deeds. Ignoring the political implications of operating a remailer is simply foolish. Public oppinion is going to be an important consideration when the laws come to the table. Sure, we could move the remailers off shore, but why do that unless we have to? The idea of being a "cryptorebel", or an underground warrior for peace and privacy is certainly romantic, but i'd like to think that it doesnt have to be that way.
Then again, i didnt need propaganda to convince me that I needed privacy. Maybe im just strange..

@_date: 1995-12-13 09:51:33
@_author: Ben Holiday 
@_subject: IDEA encryption 
The copy of the source for idea (unix) that I have specify's a user key length of 8 bytes, but allows this to be increased to something larger. Will increasing the user keylength improve the overall security? Also, is it worth hashing the user key first, then using the hashed key as the key for encryption and decryption? Or am I wasting my time? Last thing -- how secure is unix "rm"?  If something is rm'd, is it really really gone?

@_date: 1995-12-14 17:42:51
@_author: Ben Holiday 
@_subject: Re: IDEA encryption 
[snipped irrelivant bits]
 Idea_nofRound                 8 /* number of rounds                   */
 Idea_userKeyLen               8 /* user key length (8 or larger)      */
 Idea_dataLen                       4 /* plain-/ciphertext block length*/
 Idea_keyLen    (Idea_nofRound * 6 + 4) /* en-/decryption key length   */
 Idea_dataSize       (Idea_dataLen * 2) /* 8 bytes = 64 bits           */
 Idea_userKeySize (Idea_userKeyLen * 2) /* 16 bytes = 128 bits         */
[end cut out]
So what im reading here is; A) it is possible to change the value of the userkeylength, and B) the actual key is (2 * userkeylen) or in the case of an 8byte key, 2 * 8bytes = 16 bytes = 128bits.
Maybe im crazy.

@_date: 1995-12-15 17:31:52
@_author: Ben Holiday 
@_subject: Re: Secured RM ? (source) 
Well, thanks for trying..  The athena package isnt an undelete program, its a replacement for rm that copies rm'd files into a trashcan directory which is expunged at regular intervals... *sigh*
Still looking..

@_date: 1995-12-17 18:37:47
@_author: Ben Holiday 
@_subject: Re: Secured RM ? (source) 
In this particular case what im concerned about is a temporary  cleartext copy of a permanently encrypted document.  The cleartext only exists for about 1-4 seconds, and then is deleted, so backups arent really a problem..

@_date: 1995-12-18 17:12:40
@_author: Ben Holiday 
@_subject: Re: Secured RM ? (source) 
Im pretty sure that its nessecary.. at least at this point.  Basically what im working on is a bit of front end that trys to make keeping things encrypted a bit less of a hassle.  It needs to be able to read multiple file types, and as such it does some odd things. It opens the file and figures out the magic for it, closes it, then jumps to the right routine for reading the particular thing.. the file is opened again, perhaps once, perhaps repeatedly, depnding on the nature of what is going on.. then when it finishes with the file the cleartext copy is removed.. the main idea pushing me here is that if you were to encrypt things on your harddrive for storage, you would most likely want access to them at some point, and if your like me, you'd want access to them on a regular basis. Prior to starting work on this project i would manually decode whichever file i needed, work with it, andd then delete it. This was a pain in the ass, and also somewhat less secure since im only human and could conceivabley forget to resecure the file after im done using it.  So looking at it from a relaxed standpoint.. the code as it stands now is at least as good as the previou method i was using, and is alot simpler. :) To be a bit more critical, neither method seems to be the BEST  method.. I hate saying this cause it feels like a cop out, but I keep coming back to the question of usability versus iron-clad security. At this point there is no noticible speed difference between using the program with encrypted versus decrypted files. Im pretty concerned about the overhead of getting too involved in a flawless implementation. I think at this point if i could produce a first release that would be "good enough" to pass (for example) a moderatly sophisticated once over by local law enforcement, i would be content.  Once thats available I have alot of other things tthat I'd like to see done better..  Incidentally, i'm planning to post the full details including an FTP site sometime in january or febuary.. at that point i expect to be torn to shreds by the cryptographic comunity.. :)

@_date: 1995-12-19 17:46:14
@_author: Ben Holiday 
@_subject: Re: redirect of newsgroups 
( im gonna work this back onto topic.. just watch. :)  ) There is a rather lengthy FAQ that explains about a zillion different ways to get your paws on whichever newsgroups you desire. Its called
"How to Receive Banned News Groups FAQ" and you can find it at:
(here it comes..)
In addition to covering topics relating to finding what you want in the way of usenet news, it also has a pretty well thought out anti-censorship rant towards the end, and gives pointers to some open NNTP servers, and freenets where you can obtain free access to usenet news. There is also a short list of mail to news gateways, which is useful if you would like to post to usenet via a remailer (or if your sysadmin censors which groups you have access to).
(Ok.. maybe not totally on topic.. i tried.. blegh)
have a day.

@_date: 1996-03-08 01:37:23
@_author: Ben Holiday 
@_subject: Re: Steganography idea: CU-SeeMe 
[lots of snippage]
Another problem is that in order to get a decent frame-rate CU-SeeMe does some image editing of its own: selectively sending only the portions of an image that have changed (I.e. the portion of the image that is a person who is moving is sent, The bookshelves in the background are not.) This could probably be easily gotten around however. This seems like a decent idea, however, once the initial obstacles have been overcome.. one typical problem with steg is the small number of bits that can be hidden.. i beleive a ratio of 1k per 100k is typical. Far too small to be useful for most people. Over the course of an hour long CU-SeeMe session however you could easily move enough data back and forth to provide adequate cover for a reasonablly long bit of cyphertext. As long as we're on the subject of stego, has anyone discussed/implemented subliminal streams in raw TCP packets? Seems possible to do at least on a point to point basis. If you could stash your data in the tcp packet itself, it wouldnt matter much what was actually being sent across the link. Some possibilities: a telnet client with a stegometer that would count the number of hidden bits remaining to be sent.. chat clients similarly equiped, etc. Then you could start up any client you choose and send data across it until you had gotten enough bits to complete transmission of your stego'd file.. just a thought.. ;)

@_date: 1996-03-10 21:55:30
@_author: Ben Holiday 
@_subject: TCP/IP Stego (was CU-SeeMe) 
It seems to me that it would be possible to squeeze one bit of subliminal data into each tcp packet if you were willing to sacrifice a few cpu cycles in the process:
A tcp header contains quite a bit of useful information.. but most of it wouldnt be easily manipulated (by me) to get a bit. You cant very well alternate the port number you are using, or change the packet sequence numbers. However, the tcp protocol forces each tcp header to contain a 'checksum' field.. which is (more or less) the sum of all the octets in the packet. This is used as error correction for the protocol. It shouldn't be too difficult to force TCP to fiddle with the data in the packet a bit to force the checksum to be a particular sort of thing (i.e. even or odd number) .. 0 for even and 1 for odd would get us our one bit of data per packet. I may be wrong, but im pretty certain that you could hack your client (an ftp client would be a good choice since it can easily be made to receive vast numbers of packets without attracting attention) and leave the basic tcp/ip stack untouched.  If your client figured out what sort of packet needed to be sent to get the right bit before passing it to the tcp stack then voila you have a subliminal channel.
Of course there are alot of other ways to go about it, im sure..

@_date: 1996-03-11 05:22:51
@_author: Ben Holiday 
@_subject: Re: TCP/IP Stego (was CU-SeeMe) 
Okay, i'm going to try to address things systematically, here goes..
(excuse non standard quoteing)
No need to do anything strange to the checksum.  In the normal process of framing packets data is buffered, and packets are 'padded' to make a full packet. The hacked tcp protocol would simply be a bit more selective about where and when padding was added. The checksum would still be a valid checksum for that packet - we would simply select a packet that gave a correct checksum value. The overhead for this is more than with standard tcp but could hardly be considered a serious drain of cpu cycles.
As for wasted bandwidth: That could be seen as a problem, but there are a few things to offset the overhead, the big one being that it doesnt make any difference what form the carrier data takes.. if you can generate half a meg of ANYTHING that can be plausibly sent to another machine, then you can send your 1k of data. If implemented properly the carrier data wouldnt even need to all come in through the same route. This scenario leaves any one who may be watching with quite a haystack, and a very small needle to find.
I disagree. Consider: the packet, taken bit by bit, or as a whole, would be completely valid - with nothing added, or taken away except perhaps the few octets that would need to be dropped to acheive the right parity. This would actually be very few, since you have a 50% chance that the parity will be correct to begin with. Thank you! This is what I was attempting (apparantly quite poorly) to say in the original post. :)

@_date: 1996-03-13 01:06:43
@_author: Ben Holiday 
@_subject: Remail Software Where? 
Seems that berkeley's ftp ain't talking anymore.  Where are the remailer packages living these days?

@_date: 1996-03-24 18:21:55
@_author: Ben Holiday 
@_subject: Crypto CD 
I'm considering the idea of cutting a crypto CD, and wanted to see if there was any potential interest in the idea, or not. Basically what i forsee is a disk with the basic algorithms (DES/IDEA/Etc), and steg tools, along with a few large crypto aps like PGP, and basic cracking software (Crypt Breakers Work Bench, XOR-type crackers, and dictionary attacks with a few dozen dictionaries). I'd also like to include a remail directory with some remailer sources, remailer-aware clients, and the mixmaster sources. And of course as much infomation as possible -- cyphernomicon preferably, possibly even archives of this list..  I would plan to put unix/dos/mac all on one CD. I'm thinking that realistically I can expect 50 megs or so. Possibly as much as 100 if I find a TON of wonderful text. Could be useful to individuals, as well as for groups wishing to create FTP sites etc. Pricing with shipping would wind up around US$20.00, give or take 5 dollars..
I'd like to know first off whether such a thing already exists. Secondly whether anyone would be interested in possesing such a thing. And lastly any suggestions for/about content that I may have missed..

@_date: 1996-03-30 00:32:26
@_author: nCognito 
@_subject: Crash 
Introduction to the French Edition of "Crash"
                         J.G.Ballard, 1974
The marriage of reason and nightmare which has dominated the 20th century
has given birth to an ever more ambiguous world.  Across the communications
landscape move the specters of sinister technologies and the dreams that
money can buy.  Thermonuclear weapons systems and soft drink commercials
coexist in an overlit realm ruled by advertising and pseudoevents, science
and pornography.  Over our lives preside the great twin leitmotifs of the 20th century - sex and paranoia.  Despite McLuhan's delight in high-speed
information mosaics we are still reminded of Freud's profound pessimism in
"Civilization and its Discontents".  Voyeurism, self-disgust, the infantile
basis of our dreams and longings - these diseases of the psyche have now
culminated in the most terrifying casualty of the century:  The death of
This demise of feeling and emotion has paved the way for all our most real
and tender pleasures - in the excitements of pain and mutilation; in sex
as the perfect arena, like a culture bed of sterile pus, for all the
veronicas of our own perversions; in our moral freedom to pursue our own
psychopathology as a game; and in our apparently limitless powers for
conceptualization - what our children have to fear is not the cars on the
highways of tomorrow but our own pleasure in calculating the most elegant
parameters of their deaths.
To document the uneasy pleasures of living within this glaucous paradise
has more and more become the role of science fiction.  I firmly believe
that science fiction, far from being an unimportant minor offshoot, in fact
represents the main literary tradition of the 20th century, and certainly
its oldest - a tradition of imaginative response to science and technology
that runs in an intact line through H.G. Wells, Aldous Huxley, the writers
of modern American science fiction, to such present-day innovators as William Burroughs.
The main "fact" of the 20th century is the concept of the unlimited
possibility.  This predicate of science and technology enshrines the notion
of a moratorium on the past - the irrelevancy and even death of the past - and the limitless alternatives available to the present.  What links the first flight of the Wright brothers to the invention of the Pill is the
social and sexual philosophy of the ejector seat.
Given this immense continent of possibility, few literatures would seem
better equipped to deal with their subject matter than science fiction.
No other form of fiction has the vocabulary of ideas and images to deal
with the present, let alone the future.  The dominant characteristic of
the modern mainstream novel is its sense of individual isolation, its mood
of introspection and alienation, a state of mind always assumed to be the
hallmark of the 20th century consciousness.
Far from it.  On the contrary, it seems to me that this is a psychology
that belongs entirely to the 19th century, part of a reaction against the
monolithic character of Victorianism and the tyranny of the paterfamilias,
secure in his financial and sexual authority.  Apart from its marked retrospective bias and its obsession with the subjective nature of
experience, its real subject matter is the rationalization of guilt and
estrangement.  Its elements are introspection, pessimism and sophistication.
Yet if anything befits the 20th century it is optimism, the iconography of
mass merchandising, naivety and a guilt-free enjoyment of all the mind's
The kind of imagination that now manifests itself in science fiction is not
something new.  Homer, Shakespeare and Milton all invented new worlds to comment on this one.  The split of science fiction into a separate and
somewhat disreputable genre is a recent development.  It is connected with
the near disappearance of dramatic and philosophical poetry and the slow
shrinking of the traditional novel as it concerns itself more and more exclusively with the nuances of human relationships.  Among those areas neglected by the traditional novel are, above all, the dynamics of human
societies (the traditional novel tends to depict society as static), and
man's place in the universe.  However crudely or naively, science fiction at least attempts to place a philosophical and metaphysical frame around  the most important events within our lives and consciousness.
If I make this general defense of science fiction it is, obviously, because
my own career as a writer has been involved with it for almost 20 years. that the future was a better key to the present than the past.  At the time,
however, I was dissatisfied with science fiction's obsession with its two
principal themes - outer space and the far future.  As much for emblematic
purposes as any theoretical or programmatic ones, I christened the new terrain I wishred to explore INNER SPACE, that psychological domain  (manifest, for example, in surrealist painting) where the inner world of the mind and the outer world of reality meet and fuse.
Science and technology multiply around us.  To an increasing extent they dictate the languages in which we speak and think.  Either we use those
languages, or we remain mute.
Yet, by an ironic paradox, modern science fiction became the first casualty
of the changing world it anticipated and helped to create.  The future
envisioned by the science fiction of the 1940s and 1950s is already our past.
Its dominant images, not merely of the first Moon flights and interplanetary
voyages, but of our changing social and political relationships in a world governed by technology, now resemble huge pieces of discarded stage scenery.
For me, this could be seen most touchingly in the film "2001: A Space
Odyssey", which signified the end of the heroic period of modern science
fiction - its lovingly imagined panoramas and costumes, its huge set pieces,
remind me of "Gone With the Wind", a scientific pageant that became a kind
of historical romance in reverse, a sealed world into which the hard light
of contemporary reality was never allowed to penetrate.
Increasingly, our concepts of past, present and future are being forced to revise themselves.  Just as the past itself, in social and psychological
terms, became a casualty of Hiroshima and the nuclear age (almost by
definition a period where we were all forced to think prospectively), so
in its turn the future is ceasing to exist, devoured by the all-voracious
present, as merely one of those manifold alternatives open to us.  Options
multiply around us, we live in an almost infantile world where any demand,
any possibility, whether for lifestyles, travel, sexual roles and identities, can be satisfied instantly.
In addition, I feel that the balance between fiction and reality has changed
significantly in the past decade.  Increasingly their roles are reversed.
We live in a world ruled by fictions of every kind - mass merchandising, advertising, politics conducted as a branch of advertising, the instant
translation of science and technology into popular imagery, the increasing
blurring and intermingling of identities within the realm of consumer goods,
the preempting of any free or original imaginative response to experience by
the television screen.  We live inside an enormous novel.  For the writer in
particular it is less and less necessary for him to invent the fictional
content of his novel.  The fiction is already there.  The writer's task is
to invent the reality.
In the past we have always assumed that the external world around us has
represented reality, however confusing or uncertain, and that the inner world of our minds, its dreams, hopes, ambitions, represented the realm of
fantasy and the imagination.  These roles too, it seems to me, have been
reversed.  The most prudent and effective method of dealing with the world
around us is to assume that it is a complete fiction - conversely, the one
small node of reality left to us is inside our own heads.  Freud's classic
distinction between the latent and manifest content of the dream, between
the apparent and the real, now needs to be applied to the external world of
so-called reality.
Given these transformations, what is the main task facing the writer?  Can he any longer make use of the techniques and perspectives of the traditional
19th century novel, with its linear narrative, its measured cronology, its
consular characters grandly inhabiting their domains within an ample time
and space? Is his subject matter the sources of character and personality
sunk deep in the past, the unhurried inspection of roots, the examination of
the most subtle nuances of social behavior and personal relationships?  Has
the writer still the moral authority to invent  a self-sufficient and self-
enclosed world, to preside over his characters like an examiner, knowing all
the questions in advance?  Can he leave out anything he prefers not to understand, including his own motives, prejudices and psychopathology?
I feel myuself that the writer's role, his authority and license to act, has
changed radically.  I feel that, in a sense, the writer knows nothing any
longer.  He has no moral stance.  He offers the reader the contents of his
own head, he offers a set of options and imaginative alternatives.  His role
is that of the scientist, whether on safari or in his laboratory, faced with
a completely unknown terrain or subject.  All he can do is to devise hypotheses and test them against the facts.
"Crash" is such a book, an extreme metaphor for an extreme situation, a kit
of desperate measures only for use in an extreme crisis.  If I am right, and
what I have done over the past few years is to rediscover the present for
myself, "Crash" takes up its position as a cataclysmic novel of the present day in line with my previous novels of world cataclysm set in the near or immediate future - "The Drowned World", "The Drought" and "The Crystal
"Crash", of course, is not concerned with an imaginary disaster, however
imminent, but with a pandemic cataclysm institutionalized in all industrial
societies that kills hundreds of thousands of people each year and injures
millions.  Do we see, in the car crash, a sinister portent of a nightmare
marriage between sex and technology?  Will modern technology provide us with
hitherto undreamed-of means for tapping our own psychopathologies?  Is this
harnessing of our innate perversity conceivably of benefit to us?  Is there
some deviant logic unfolding more powerful than that provided by reason?
Throughout "Crash" I have used the car not only as a sexual image, but as a
total metaphor for man's life in today's society.  As such the novel has
a political role quite apart from its sexual content, but I would still like
to think that "Crash" is the first pornographic novel based on technology.
In a sense, pornography is the most political form of fiction, dealing with
how we use and exploit each other in the most urgent and ruthless way.
Needless to say, the ultimate role of "Crash" is cautionary, a warning against that brutal, erotic and overlit realm that beckons more and more persuasively to us from the margins of the technological landscape.

@_date: 1996-05-10 23:35:20
@_author: Ben Holiday 
@_subject: Re: remailer-in-a-box 
I wrote a one part shell script which will run on most unix systems. It
will install a working type-1 ghio remailer on most shell accounts in
about 20seconds. It wont do reordering or Mix but its effortless .
Below is the readme and the shell script.. if you just want a remailer and
you want it NOW, export this message, cut this text and the text of the
readme file out, and then follow the directions below. Yippy.
This is the 10 second remailer package. The idea is from Sameer, and the C source is from Matt Ghio. This script will install a bare-bones cypherpunk style remailer on your shell account.  Making it work is simple:
1) Type:      chmod 700 build-remailer
2) Type:      build-remailer
3) Enter the email address of the remailer. This is optional. You may use    any address you like, or you may enter none at all. If you don't enter an
   email address here the address "nobody will appear in all    outbound mail from the mailer, and also in the mailers help files. 4) If no errors are generated, then your all set. Send some mail to
   yourself to test that it is working. Refer to the remailers help file
   for details.
----CUT HERE----CUT HERE----CUT HERE----CUT HERE----CUT HERE----
echo "Warning: This will DESTROY your existing .forward file."
echo "Type CTRL-C Now To Abort. I'll wait 10 Seconds For You."
sleep 10s
echo "Ok, here we go."
echo -e "\n"
echo "Getting Variables:"
echo "Found Mailspool as: $xspool"
xsendmail=`which sendmail`
echo "Found Sendmail as: $xsendmail"
xls=`which ls`
echo "Found ls as: $xls"
echo "Installing in: $xdir"
mkdir $xdir
echo "Enter the email address of the mailer now."
echo "You can leave this blank if you want."
read xaddr
if [ `echo $xaddr | wc -w` -eq 0 ]
cd $xdir
echo "Building C Source."
echo "
 DIR \"$xdir\"
 ANONFROM \"From: $xaddr (Anonymous\\n\")
 REMAILERFROM \"From: $xaddr (Remailer\\n\")
 REMAILERADDRESS \"$xaddr\"
 RETURN \"xaddr\"
 DISCLAIMER \"Comments: Please report misuse of this automated remailing service to <$xaddr>\\n\"
 NONANONDISC \"Comments: This message was forwarded by an automated remailing service.  No attempt was made to verify the sender's identity.  Please report misuse to <$xaddr>\\n\"  SPOOL \"$xspool\"
 SPAM_THRESHOLD 25
 WAIT_SEC 30
 DEFAULT_LATENCY 0
 PGP \"/usr/local/bin/pgp\"
 PGPPASS \"password\"
 PGPPATH DIR
 INEWS \"/usr/lib/news/inews\"
 NNTPSERVER \"127.0.0.1\"
 LS \"$xls\"
 SENDMAIL \"$xsendmail\"
 BLOCKFROM \"source.block\"
 BLOCKTO \"dest.block\"
 INQUEUE \"in.queue\"
 OUTQUEUE \"out.queue\"
 TEMPDIR \"temp\"
 HELPFILE \"remailer-help\"
 STATSDATA \"statsdata\"
      /* some os need this one also */
   FILE *infile;
FILE *outfile;
FILE *tempfile;
FILE *file2;
char from[256]=\"\";
char from_address[256]=\"\";
char cutmarks[256]=\"\";
int anon_flag=0;
int help_flag=0;
int stat_flag=0;
int pgp_flag=0;
char replykey[80]=\"\";
char idbuf[17];
int idcount=0;
struct timeval tp;
unsigned long latime;
int blockflag;
void getfrom(char *input){
  int x=0,y=0;
  while(input[x]!=':'){x=x+1;}
  x=x+1;
  while(input[x]<=32){x=x+1;}
  while(input[x]>32){
    from_address[y]=input[x];
    x=x+1;y=y+1;
  }
  from_address[y]=0;
  x=0; /* look for  */
  while(input[x]>31&&input[x]!='<'){x=x+1;}
  if(input[x]=='<'){
    y=0;x=x+1;
    while(input[x]>32&&input[x]!='>'){
      from_address[y]=input[x];
      x=x+1;y=y+1;
    }
    from_address[y]=0;
  }
void block_addr(char address[],char *file) {
  char input[256];
  int match=0;
  int x,y,z;
  int exclude;
  FILE *killfile;
  chdir(DIR);
  if(killfile=fopen(file,\"r\")){
    while(fscanf(killfile,\"%s\",input)>0) {
      if (input[0]!=' {
        x=0;exclude=0;z=0;
        if (input[0]=='!') {exclude=1;z++;}           y=0;
          while ((address[x+y]|32)==(input[y+z]|32)&&input[y+z]!='*'
              &&input[y+z]!=0&&address[x+y]!=0) {
            y++;
          if (input[y+z]==0) match=(1^exclude);
          if (input[y+z]=='*') {z=z+y+1;x=x+y;}
          else x++;
        }
      }
    }
    fclose(killfile);
  }
  if (match==1) address[0]=0;
int search(char str1[],char str2[]) {
  int x=0;
  int y=0;
  int match=0;
  while(str2[x]!=0) {
    y=0;
    while ((str2[x+y]==str1[y]||str2[x+y]==(str1[y]-32))&&str2[x+y]!=0) {
      y++;
      if (str1[y]==0) match=1;
    }
    x++;
  }
  return(match);
void scanline(char input[],char resend_address[]) {
  int x,y,z;
  int resend_flag=0;
  int cutmarks_flag=0;
  int post_flag=0;
  int latent_plusflag;
  int latent_randflag;
  int latent_h;
  int latent_m;
  int latent_s;
  /* Pass thru Subject, Content-Type, and In-Reply-To lines */
  if ((input[0]=='S'||input[0]=='s')&&input[1]=='u'&&input[2]=='b') {
     /* if the subject line is blank, drop it */
    if (input[8]!=0&&input[9]!=0) fprintf(outfile,\"%s\",input);
     /* and handle special case subjects for help and stats */
    if (search(\"remailer-stat\",input)) {
      latime=tp.tv_sec; /* No latency */
      stat_flag=1;
    }
    if (search(\"remailer-help\",input)||search(\"remailer-info\",input)) {
      latime=tp.tv_sec; /* No latency */
      help_flag=1;
    }
  }
  if ((input[0]=='C'||input[0]=='c')&&input[1]=='o'&&input[2]=='n') {
    fprintf(outfile,\"%s\",input);
  }
  if ((input[0]=='I'||input[0]=='i')&&input[1]=='n'&&input[2]=='-') {
    fprintf(outfile,\"%s\",input);
  }
  /* Save the from line in case non-anonymous posting is requested */
  if ((input[0]=='F'||input[0]=='f')&&input[1]=='r'&&input[2]=='o') {
    getfrom(input);block_addr(from_address,BLOCKFROM);
    if(from_address[0]==0) blockflag=1; /* Source block */
    block_addr(input,BLOCKTO);
    strcpy(from,input);
  }
  x=0;
  /* Remail-To? */
  while (input[x]!=0&&(input[x]!=32||x<=2)&&input[x]!=10&&x<256) {
    if (input[x]=='R'||input[x]=='r') {
      while (input[x]!=0&&input[x]!=32&&input[x]!=10&&x<256) {
        if (input[x]=='M'||input[x]=='m') {
          while (input[x]!=0&&input[x]!=10&&x<256) {
            if ((input[x]=='T'||input[x]=='t') &&
              (input[x+1]=='O'||input[x+1]=='o')) {
              while (input[x]!=0&&input[x]!=':'&&input[x]!=32
                     &&input[x]!=10&&x<256) x++;
              if (input[x]==':') {
                resend_flag=1;
                anon_flag=1;
                x=256;
              }
            } else x++;
          }
        } else x++;
      }
    } else x++;
  }
  /* Anon-To? */
  x=0;
  while (input[x]!=0&&(input[x]!=32||x<=2)&&input[x]!=10&&x<256) {
    if (input[x]=='A'||input[x]=='a') { x++;
      if (input[x]=='N'||input[x]=='n') {
        while (input[x]!=0&&input[x]!=10&&x<256) {
          if ((input[x]=='T'||input[x]=='t') &&
              (input[x+1]=='O'||input[x+1]=='o')) {
            while (input[x]!=0&&input[x]!=':'&&input[x]!=32
                   &&input[x]!=10&&x<256) x++;
            if (input[x]==':') {
              resend_flag=1;
              anon_flag=1;
            }
            x=256;
          } else x++;
        }
      }
    } else x++;
  }
  /* Post? */
  x=0;
  while (input[x]!=0&&input[x]!=32&&input[x]!=10&&x<256) {
    if (input[x]=='P'||input[x]=='p') { x++;
      if (input[x]=='O'||input[x]=='o') { x++;
        if (input[x]=='S'||input[x]=='s') {
          post_flag=1;
          /* Post-To ? */
          while (input[x]!=0&&input[x]!=32&&input[x]!=10&&x<256) {
            if (input[x]=='T'||input[x]=='t') { x++;
              if (input[x]=='O'||input[x]=='o') { x++;
                if (input[x]==':') {
                  resend_flag=1;
                }
              }
            } else x++;
          }
          x=256;
        }
      }
    } else x++;
  }
  /* soda.berkeley style Send-To ? */
  x=0;
  while (input[x]!=0&&input[x]!=32&&input[x]!=10&&x<256) {
    if (input[x]=='S'||input[x]=='s') { x++;
      if (input[x]=='E'||input[x]=='e') { x++;
        if (input[x]=='N'||input[x]=='n') { x++;
          if (input[x]=='D'||input[x]=='d') {
            while (input[x]!=0&&input[x]!=32&&input[x]!=10&&x<256) {
              if (input[x]=='T'||input[x]=='t') { x++;
                if (input[x]=='O'||input[x]=='o') { x++;
                  if (input[x]==':') resend_flag=1;
                }
              } else x++;
            }
          }
        }
      }
    } else x++;
  }
  if(input[0]=='E'&&input[1]=='n'&&input[2]=='c'
     &&input[3]=='r'&&input[4]=='y'&&input[5]=='p'
     &&input[6]=='t'&&input[7]=='e'&&input[8]=='d') {
    resend_flag=0;
    pgp_flag=1;
  }
  if(input[0]=='E'&&input[1]=='n'&&input[2]=='c'
     &&input[3]=='r'&&input[4]=='y'&&input[5]=='p'
     &&input[6]=='t'&&input[7]=='-') {
    x=0;y=0;
    while(input[x]!=':'){x=x+1;}
    x=x+1;
    if(input[x]==32){x=x+1;}
    z=x;
    while(input[x]>32){
      replykey[y]=input[x];
      x=x+1;y=y+1;
    }
    replykey[y]=0;
  }
  if(input[0]=='C'&&input[1]=='u'&&input[2]=='t') {
    cutmarks_flag=1;
  }
  if(resend_flag){
    x=2;y=0; /* x=2 in case Extropians-style ::Header */
    while(input[x]!=':'){x=x+1;}
    x=x+1;
    while(input[x]<=32){x=x+1;}
    z=x;
    if (post_flag==0) {
      while(input[x]>32){
        resend_address[y]=input[x];
        x=x+1;y=y+1;
      }
      resend_address[y]=0;
      x=0; /* look for  */
      while(input[x]>31&&input[x]!='<'){x=x+1;}
      if(input[x]=='<'){
        y=0;x=x+1;
        while(input[x]>32&&input[x]!='>'){
          resend_address[y]=input[x];
          x=x+1;y=y+1;
        }
        resend_address[y]=0;
      }
      /* Print out new To: line */
      fprintf(outfile,\"To: \");
      while(input[z]>0){
        fprintf(outfile,\"%c\",input[z]);
        z=z+1;
      }
      block_addr(resend_address,BLOCKTO);
    }
    if (post_flag) {
      fprintf(outfile,\"Newsgroups: \");
      while(input[z]>0){
        fprintf(outfile,\"%c\",input[z]);
        z=z+1;
      }
      resend_address[0]='p';
      resend_address[1]='o';
      resend_address[2]='s';
      resend_address[3]='t';
      resend_address[4]=0;
      block_addr(input,BLOCKTO);if (input[0]==0) resend_address[0]=0;
    }
  }
  if(cutmarks_flag){
    x=0;y=0;
    while(input[x]!=':'){x=x+1;}
    x=x+1;
    if(input[x]==32){x=x+1;}
    z=x;
    while(input[x]>32){
      cutmarks[y]=input[x];
      x=x+1;y=y+1;
    }
    cutmarks[y]=0;
  }
  if((input[0]|32)=='l'&&(input[1]|32)=='a'&&(input[2]|32)=='t') {
    x=0;
    while(input[x]!=':'){x=x+1;}
    x=x+1;
    if(input[x]==32){x=x+1;}
    latent_plusflag=0;latent_randflag=0;
    latent_h=0;latent_m=0;latent_s=0;
    while((input[x]<'0'||input[x]>'9')&&input[x]>=32) {
      if (input[x]=='+') latent_plusflag=1;
      if ((input[x]=='r')||(input[x]=='R')) latent_randflag=1;
      x++;
    }
    while (input[x]>='0'&&input[x]<='9') {
      latent_h=(latent_h*10)+(input[x]-48);
      x++;
    }
    if(input[x]==':') {
      x++;
      while (input[x]>='0'&&input[x]<='9') {
        latent_m=(latent_m*10)+(input[x]-48);
        x++;
      }
      if(input[x]==':') {
        x++;
        while (input[x]>='0'&&input[x]<='9') {
          latent_s=(latent_s*10)+(input[x]-48);
          x++;
        }
      }
    }
    while(input[x]>=32) {
      if (input[x]=='+') latent_plusflag=1;
      if ((input[x]=='r')||(input[x]=='R')) latent_randflag=1;
      x++;
    }
    latime=(latent_h*3600+latent_m*60+latent_s);
    if(latent_plusflag==0) {
      /* Not Supported - Is this really necessary? */
    }
    if(latent_randflag&&(latime>1)) {
      /* Simple randomizer */
      latime=abs((tp.tv_sec^latime)+tp.tv_usec+(getpid()*latime))%(latime+1);
    }
    latime+=tp.tv_sec;
  }
char* genid() { /* Generate ascii id from process id and time with shuffle */
  unsigned long int id1,id2;
  int x=0;
  id1=getpid()|(idcount<<16);
  id2=tp.tv_sec;
  idcount++;
  for(x=32;x--;){
    id1+=1234567890;
    id1^=0xABCDEF12;
    id1=(id1<<1)|(id1>>31);
    id2^=id1;
    id2+=0x12345678;
    id2^=0x9ABCDEF0;
    id2=(id2<<31)|(id2>>1);
    id1^=id2;
  }
  for(x=0;x<8;x++) {
    idbuf[x]=65+(id1&15);
    id1=id1>>4;
  }
  for(x=8;x<16;x++) {
    idbuf[x]=65+(id2&15);
    id2=id2>>4;
  }
  idbuf[16]=0;
  return(idbuf);
void reencrypt(){
  char input[256];
  int pipefd[2];
  int pipe2fd[2];
  input[255]=0;
  pipe(pipefd);
  pipe(pipe2fd);
  if(!fork()) {
    dup2(pipefd[0],0);
    dup2(pipe2fd[1],1);
    close(pipefd[1]);
    close(pipe2fd[0]);
    chdir(DIR);
    execl(PGP,\"pgp\",\"-fcta\",\"+BATCHMODE\",\"+ARMORLINES=0\",\"-z\",replykey,(char *)0);
  }
  close(pipefd[0]);close(pipe2fd[1]);
  file2=fdopen(pipefd[1],\"w\");
  while(fgets(input,255,infile)) {
    fprintf(file2,\"%s\",input);
  }
  fclose(file2);
  file2=fdopen(pipe2fd[0],\"r\");
  while(fgets(input,255,file2)) {
    fprintf(outfile,\"%s\",input);
  }
  fclose(file2);
void updatestats(int inccnt,int incpgp,int inclat,int incpost) {
  int m[24];
  int ccm=0;
  int p[24];
  int ccpgp=0;
  int l[24];
  int ccl=0;
  int u[24];
  int ccnews=0;
  char month[24][5];
  int date[24];
  int hour=0;
  int currenthour;
  FILE *datafile;
  int x;
  int y;
  struct tm *timestr;
  timestr=localtime(&(tp.tv_sec));
  if(datafile=fopen(STATSDATA,\"r\")){
    fscanf(datafile,\"%d\",&hour);
    fscanf(datafile,\"%d %d %d %d\",&ccm,&ccpgp,&ccl,&ccnews);
    for(x=0;x<24;x++) {
      fscanf(datafile,\"%s %d %d %d %d %d\",
             month[x],&date[x],&m[x],&p[x],&l[x],&u[x]); }
    fclose(datafile);
  }else{
    for(x=0;x<24;x++) {
      strcpy(month[x],\"---\");
      date[x]=0;m[x]=0;p[x]=0;l[x]=0;u[x]=0;
    }
  }
  currenthour=(*timestr).tm_hour;
  x=hour%24;
  while (x!=currenthour) {
    if (x>0) {
      strcpy(month[x],month[x-1]);
      date[x]=date[x-1];
    }else{
      if((*timestr).tm_mon==0) strcpy(month[0],\"Jan\");
      if((*timestr).tm_mon==1) strcpy(month[0],\"Feb\");
      if((*timestr).tm_mon==2) strcpy(month[0],\"Mar\");
      if((*timestr).tm_mon==3) strcpy(month[0],\"Apr\");
      if((*timestr).tm_mon==4) strcpy(month[0],\"May\");
      if((*timestr).tm_mon==5) strcpy(month[0],\"Jun\");
      if((*timestr).tm_mon==6) strcpy(month[0],\"Jul\");
      if((*timestr).tm_mon==7) strcpy(month[0],\"Aug\");
      if((*timestr).tm_mon==8) strcpy(month[0],\"Sep\");
      if((*timestr).tm_mon==9) strcpy(month[0],\"Oct\");
      if((*timestr).tm_mon==10) strcpy(month[0],\"Nov\");
      if((*timestr).tm_mon==11) strcpy(month[0],\"Dec\");
      date[0]=(*timestr).tm_mday;
    }
    m[x]=0;
    p[x]=0;
    l[x]=0;
    u[x]=0;
    x++;if (x>23) x=0;
  }
  if (hour!=currenthour) {
    m[hour]=ccm;
    p[hour]=ccpgp;
    l[hour]=ccl;
    u[hour]=ccnews;
    ccm=0;
    ccpgp=0;
    ccl=0;
    ccnews=0;
  }
  ccm+=inccnt;
  ccpgp+=incpgp;
  ccl+=inclat;
  ccnews+=incpost;
  if(datafile=fopen(STATSDATA,\"w\")){
    fprintf(datafile,\"%d\\n\",currenthour);
    fprintf(datafile,\"%d %d %d %d\\n\",ccm,ccpgp,ccl,ccnews);
    for(x=0;x<24;x++) {
      fprintf(datafile,\"%s %d %d %d %d %d\\n\",
              month[x],date[x],m[x],p[x],l[x],u[x]);
    }
    fclose(datafile);
  } else fprintf(stderr,\"remailer: can't write file %s\\n\",STATSDATA);
void viewstats() {
  int m[24];
  int ccm;
  int p[24];
  int ccpgp;
  int l[24];
  int ccl;
  int u[24];
  int ccnews;
  char month[24][5];
  int date[24];
  int hour;
  int currenthour;
  FILE *datafile;
  int x;
  int y;
  datafile=fopen(STATSDATA,\"r\");
  fscanf(datafile,\"%d\",&hour);
  fscanf(datafile,\"%d %d %d %d\",&ccm,&ccpgp,&ccl,&ccnews);
  for(x=0;x<24;x++) {
    fscanf(datafile,\"%s %d %d %d %d %d\",
           month[x],&date[x],&m[x],&p[x],&l[x],&u[x]); }
  fclose(datafile);
  fprintf(outfile,\"Subject: Re: Remailer Statistics\\n\");
  fprintf(outfile,\"\\n\");
  fprintf(outfile,\"Statistics for last 24 hours from anonymous remailer at\\n\");
  fprintf(outfile,\"e-mail address: %s\\n\",REMAILERADDRESS);
  fprintf(outfile,\"\\n\");
  fprintf(outfile,
    \"Number of messages per hour from %s %d %d:00 to %s %d %d:59\\n\",
    month[23],date[23],hour,month[0],date[0],(hour+23)%24);
  fprintf(outfile,\"\\n\");
  for(x=0;x<24;x++) {
    fprintf(outfile,\" %2d:00 (%2d) \",x,m[x]);
    if (m[x]>0) {
      y=0;while((ySPAM_THRESHOLD) exit(0);
  for(x=0;filename[x]>32;x++){} filename[x]=0;
  if(!(infile=fopen(filename,\"r\"))){}
  /* Open the output file */
  chdir(DIR);
  mkdir(OUTQUEUE,0700); /* Create it if it doesn't exist */
  if(chdir(OUTQUEUE))
    {fprintf(stderr,\"remailer: Error - can't chdir to %s\\n\",OUTQUEUE);exit(1);}
  if(!(outfile=fopen(filename,\"w\")))
    {fprintf(stderr,\"remailer: can't write output file, message left in %s\\n\",INQUEUE);exit(1);}
  /* Create blank space for fields in output file */
  latime=0;resend_address[0]=0;resend_address[255]=0;
  fwrite(&latime,sizeof(long),1,outfile);
  fwrite(resend_address,256,1,outfile);
  /* Initialize latency time & misc */
  latime=tp.tv_sec;
  from[0]=0;cutmarks[0]=0;replykey[0]=0;
  anon_flag=0;help_flag=0;stat_flag=0;pgp_flag=0;blockflag=0;
 DEFAULT_LATENCY
  /* Randomly reorder messages if DEFAULT_LATENCY is set */
  if(DEFAULT_LATENCY>1) {
    latime=tp.tv_sec+abs(tp.tv_sec+tp.tv_usec+getpid())%(DEFAULT_LATENCY+1);
  }
  /* Scan headers */
  fgets(input,255,infile);
  while(input[0]!=10) {
    scanline(input,resend_address);
    input[0]=10;input[1]=0;
    fgets(input,255,infile);
  }
  fgets(input,255,infile); /* end of headers, skip a line */
  /* if first line is blank, skip it and look for a :: on the next line */
  if(resend_address[0]==0&&input[0]<32) fgets(input,255,infile);
  /* Also skip \"blank\" lines with a space in them: */
  if(resend_address[0]==0){
    for(x=0;(input[x]<=32)&&(input[x]);x++){}
    if(input[x]==0) fgets(input,255,infile);
  }
  /* Scan :: headers, if applicable */
  if(input[0]==':'&&input[1]==':') {
    while(input[0]!=10) {
      scanline(input,resend_address);
      input[0]=10;input[1]=0;
      fgets(input,255,infile);
    }
    fgets(input,255,infile);
  }
  /* or scan for headers anyway for idiots who forget the double colon */
  if(resend_address[0]==0) {
    scanline(input,resend_address);
    if(resend_address[0]!=0) {
      fgets(input,255,infile);
      while(input[0]!=10) {
        scanline(input,resend_address);
        input[0]=10;input[1]=0;
        fgets(input,255,infile);
      }
    }
    fgets(input,255,infile);
  }
  /* Exec PGP? */
  if (pgp_flag) {
    fclose(outfile);
    chdir(DIR);chdir(OUTQUEUE);
    unlink(filename);
    pipe(pipefd);
    pipe(pipe2fd);
    if(!fork()) {
      dup2(pipefd[0],0);
      dup2(pipe2fd[1],1);
      close(pipefd[1]);
      close(pipe2fd[0]);
      chdir(DIR);
 PGPPATH
      strcpy(envstr,\"PGPPATH=\");
      strcat(envstr,PGPPATH);
      putenv(envstr);
      execl(PGP,\"pgp\",\"-f\",\"-z\",PGPPASS,(char *)0);
    }
    close(pipefd[0]);close(pipe2fd[1]);
    fseek(infile,0,0);
    outfile=fdopen(pipefd[1],\"w\");
    while((fgets(input,255,infile)>0)
         &&(strcmp(input,\"-----BEGIN PGP MESSAGE-----\\n\")!=0)) {}
    fprintf(outfile,\"%s\",input);
    while(fgets(input,255,infile)
         &&(strcmp(input,\"-----END PGP MESSAGE-----\\n\")!=0)) {
      fprintf(outfile,\"%s\",input);
    }
    fprintf(outfile,\"%s\",input);
    fclose(outfile);
    file2=fdopen(pipe2fd[0],\"r\");
    chdir(DIR);chdir(INQUEUE);
    outfile=fopen(genid(),\"w\");
    fprintf(outfile,\"\\n\");
    while(fgets(input,255,file2)) {
      fprintf(outfile,\"%s\",input);
    }
    fclose(file2);
    /* Append rest of message to decrypted reply-block */
    while(fgets(input,255,infile)) {
      fprintf(outfile,\"%s\",input);
    }
    fclose(infile);fclose(outfile);
    unlink(filename);/* Remove the original message from in.queue */
    chdir(DIR);
    updatestats(0,1,0,0);
    goto in_loop;
  }
  if (from[0]==0) anon_flag=1;
  if (anon_flag) {
    fprintf(outfile,ANONFROM);
    fprintf(outfile,DISCLAIMER);
  }else{
    fprintf(outfile,\"%s\",from);
    fprintf(outfile,NONANONDISC);
  }
  /* Paste in  headers if present */
  if(input[0]==' {
   /* Kill Reply-To lines with blocked addresses to prevent
      mailbombs via alt.test */
    while(fgets(input,255,infile)>0&&input[0]>31) {
      if ((input[0]=='R'||input[0]=='r')&&input[1]=='e'&&input[2]=='p') {
        block_addr(input,BLOCKTO);if (input[0]!=0) fprintf(outfile,\"%s\",input);
      /* Block  pasted Newsgroups: */
      }else if((input[0]|32=='n')&&input[1]=='e'&&input[2]=='w'&&input[3]=='s')
      {
        block_addr(input,BLOCKTO);if (input[0]!=0) fprintf(outfile,\"%s\",input);
      }else fprintf(outfile,\"%s\",input);
    }
    fprintf(outfile,\"\\n\");
  }else{
    fprintf(outfile,\"\\n%s\",input);
    if(replykey[0]>0&&input[0]=='*'&&input[1]=='*') {
      reencrypt();
    }
  }
  /* Copy message */
  stop=0;
  while(fgets(input,255,infile)>0&&(!stop)) {
    if (cutmarks[0]!=0) {
      x=0;
      while(cutmarks[x]==input[x]&&input[x]!=0&&cutmarks[x]!=0) {
        x++;
      }
      if (cutmarks[x]==0) stop=1;
    }
    if (!stop) fprintf(outfile,\"%s\",input);
    if(replykey[0]>0&&input[0]=='*'&&input[1]=='*') {
      reencrypt();
    }
  }
  /* If help or stats were requested, set destination address to reply
     to sender */
  if((resend_address[0]==0)&&(help_flag||stat_flag)){
    strcpy(resend_address,from_address);
  } else {help_flag=0;stat_flag=0;}
  /* Save time and destination address in binary data table at
     begining of file */
  if (blockflag) resend_address[0]=0;
  fseek(outfile,0,0);
  fwrite(&latime,sizeof(long),1,outfile);
  fwrite(resend_address,256,1,outfile);
  if(help_flag||stat_flag){
    chdir(DIR);
    fprintf(outfile,\"%s\",REMAILERFROM);
    if(help_flag) {
      if(file2=fopen(HELPFILE,\"r\")){
        while(fgets(input,255,file2)){
          for(x=0;input[x];x++){
            if(input[x]=='['&&input[x+1]=='a'&&input[x+2]=='d'
               &&input[x+3]=='d'&&input[x+4]=='r'&&input[x+5]==']')
            {
              fprintf(outfile,\"%s\",REMAILERADDRESS);x=x+5;
            }
            else
            {
              fprintf(outfile,\"%c\",input[x]);
            }             }
        }
        fclose(file2);
      } else resend_address[0]=0;
    }
    if(stat_flag) {viewstats();}
  }
  fclose(outfile);
  chdir(DIR);chdir(INQUEUE);
  /* Second message?  Put message following cutmarks into inqueue */
  if (stop==1&&input[0]==':'&&input[1]==':') {
    outfile=fopen(genid(),\"w\");
    fprintf(outfile,\"\\n::\\n\");
    while(fgets(input,255,infile)>0) {
      fprintf(outfile,\"%s\",input);
    }
    fclose(outfile);
  }
  /* Write non-remailer messages into operator's mailbox */
  if (resend_address[0]==0&&from[0]!=0){
    fseek(infile,0,0);
    outfile=fopen(SPOOL,\"a\");
    while(fgets(input,255,infile)) {
      fprintf(outfile,\"%s\",input);
    }
    fclose(infile);
    fprintf(outfile,\"\\n\");
    fclose(outfile);
    unlink(filename);
    chdir(DIR);chdir(OUTQUEUE);
    unlink(filename);
  }else{
    fclose(infile);
    unlink(filename);
    if(strcmp(resend_address,\"null\")==0
strcmp(resend_address,\"/dev/null\")==0) resend_address[0]=0;
    if(resend_address[0]==0){ /* drop empty messages */
      chdir(DIR);chdir(OUTQUEUE);
      unlink(filename);
    }else{
      chdir(DIR);
      if((latime-tp.tv_sec)>2) updatestats(0,0,1,0);
      updatestats(1,0,0,0); /* Add one remailed message to stats */
    }
  }
  /* Deliver messages in out.queue */
  gettimeofday(&tp,0);
  chdir(DIR);chdir(OUTQUEUE);
  pipe(pipefd);
  filename[0]=0;
  if(!fork()) {
    dup2(pipefd[1],1);
    close(pipefd[0]);
    execl(LS,\"ls\",\"-1\",(char *)0);
  }
  x=0;close(pipefd[1]);
  file2=fdopen(pipefd[0],\"r\");
  while(fgets(filename,256,file2)&&filename[0]!=0) {
    for(x=0;filename[x]>32;x++){} filename[x]=0;
    if(infile=fopen(filename,\"r\")){
      fread(&latime,sizeof(long),1,infile);
      fread(resend_address,256,1,infile);
      if (latime<=tp.tv_sec) {
        pipe(pipe2fd);/*pipe(pipe3fd);*/
        if(!fork()) {
          /*Child*/
          dup2(pipe2fd[0],0);close(pipe2fd[1]);
          /*dup2(pipe3fd[1],1);close(pipe3fd[0]);*/
          if(strcmp(resend_address,\"post\")){
            execl(SENDMAIL,SENDMAIL,
 RETURN
                                    \"-f\",RETURN,
                                                resend_address,(char *)0);
            exit(0);
          }else{
 INEWS
 NNTPSERVER
            strcpy(envstr,\"NNTPSERVER=\");
            strcat(envstr,NNTPSERVER);
            putenv(envstr);
            execl(INEWS,\"inews\",\"-h\",(char *)0);
            exit(0);
          }
        }else{
          /*Parent*/
          close(pipe2fd[0]);/*close(pipe3fd[1]);*/
          outfile=fdopen(pipe2fd[1],\"w\");
          if(strcmp(resend_address,\"post\")){
            /* We are talking to sendmail */
            while(fgets(input,255,infile)>0) {
              fprintf(outfile,\"%s\",input);
            }
            fclose(outfile);
            /* At this point, it's a safe bet that sendmail will deliver
               the message, so the remailer can delete its copy.  If
               sendmail execution had failed for some reason, this
               process would have been killed by a SIGPIPE */
            unlink(filename);
          }else{
            /* We are talking to inews */
 INEWS
            while(fgets(input,255,infile)>0) {
              fprintf(outfile,\"%s\",input);
            }
            /* There should be a way to analyze the response from inews
               and requeue messages that could not be posted due to server
               failure.  Now, the messages just get deleted :( */
            unlink(filename);
            /* If posting is not allowed, delete the failed message */
            unlink(filename);
          }
        }
 WAIT_SEC
        sleep(WAIT_SEC);
        gettimeofday(&tp,0);
      }
      fclose(infile);
    }
  }
  fclose(file2);
  goto in_loop;
" | tee -a remailer.c > /dev/null
echo "Spawning compile in background."
gcc -o RM remailer.c 2> /dev/null &
echo "Building help-file."
echo "
This message is being sent to you automatically in response to the message
you sent to $xaddr with subject \"remailer-help\".
I have an automated mail handling program installed here which will take
any message with the proper headers and automatically re-send it anonymously.
You can use this by sending a message to $xaddr, with the
header Anon-To: containing the address that you want to send anonymously to.
(Only one recipient address is permitted.)  If you can't add headers to your
mail, you can place two colons on the first line of your message, followed
by the Anon-To line.  Follow that with a blank line, and then begin your
message.  For Example:
The above would be delivered to beth anonymously.  All headers in
the original message are removed, with the exception of the Subject (and
Content-Type, if present).  She would not know that it came from Joe, nor
would she be able to reply to the message.
However, if Beth suspected that Joe had sent the message, she could compare
the time that the message was received with the times that Joe was logged
in.  However, this problem can be avoided by instructing the remailer to
delay the message, by using the Latent-Time header:
The above message would be delayed one hour from when it is sent.  It is also
possible to create a random delay by adding an r to the time (ie +1:00r),
which would have the message be delivered at a random time, but not more
than an hour.
Another problem is that some mailers automatically insert a signature file.
Of course, this usually contains the senders email address, and so would
reveal their identity.  The remailer software can be instructed to remove
a signature file with the header \"Cutmarks\".  Any line beginning with the
same text at in the cutmarks header, and any lines following it will be
The remailer can also be used to make posts to usenet.  To do this, use
Anon-Post-To.  Non-Anonymous posts can be made by using Post-To.
When posting test messages, please use the appropriate newsgroups (alt.test,
You can add additional headers to the output message by preceeding them
with By seperating messages with cutmarks, you can send more than one message
at once:
The two messages will be delivered seperately.
For added security, you can encrypt your messages to the remailer with PGP.
The remailer software will decrypt the message and send it on.  Here is the
remailer's public key:
-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: 2.3a
-----END PGP PUBLIC KEY BLOCK-----
To utilize this feature, create a message with two colons on the first line,
then the Anon-To line, then any other headers, such as cutmarks or latency,
then a blank line, and then the message.  Encrypt this with the remailer's
public key.  Then send it to the remailer, adding the header \"Encrypted: PGP\".
If you forget this, the remailer won't know that it needs to be decrypted.
Also be sure to use the -t option with PGP, or the linefeeds might not be
handled properly.
Any unencrypted text after the PGP message is also remailed.  This is to
allow sending to someone who is anonymous.  If you create a PGP-encrypted
message to yourself via my remailer, and then you give it to someone, they
can send you a message by sending the encrypted message to the remailer.
The remailer will then decrypt it and send it to you.  The message gets
anonymized in the process, so the sender will need to include a return
address if he wants a reply.
Messages sent this way can be encrypted using the Encrypt-Key: feature.
Any text following a line beginning with ** will be encrypted with this
key.  For example, if you put in your PGP message:
The appended message after the ** will be encrypted with the key \"your_password\", using PGP's conventional encryption option.  Abuse Policy:
I consider the following to be inappropriate use of this anonymous remailer,
and will take steps to prevent anyone from doing any of the following:
- Sending messages intended primarilly to be harassing or annoying.
- Use of the remailer for any illegal purpose.
If you don't want to receive anonymous mail, send me a message, and I will
add your email address to the block list.
You can get a list of statistics on remailer usage by sending mail to
$xaddr with Subject: remailer-stats
" | tee -a remailer-help > /dev/null
cd $HOME
echo "|$xdir/RM" > .forward
echo -e "\n"
echo "
Ok, i've installed a very basic type one remailer.
If you want to support Mixmaster, PGP, or other features, check the source code in $xdir/remailer.c and make appropriate changes, then type:
 \"gcc -o RM remailer.c\"
If you don't care to support these features, then your remailer should now be fully functional.

@_date: 1996-05-22 10:07:53
@_author: Ben Holiday 
@_subject: Re: An alternative to remailer shutdowns 
After pondering a bit it seems to me that the "knock knock" remailer
approach (only send anon-mail if the recipient agrees to receive it) could
be made feasable pretty easily.
Rather than hold the mail while waiting for a consent to release, you
could simply encrypt the peice of mail with a symetric algorythm on its
final hop, and send the encrypted mail to the recipient. At this point there are 2 options, which I havnt examined closely: The
first is that you require them to send a request for their "consent-code"
which can be used to decrypt the mail. Under this arrangment you could
possibly provide for a user to specify a specific consent code, so that 2
party's who had previously agreed to communicate could avoid "knocking".
If you strip the subject, then it would be all but impossible for a person
to include the consent code in the actual peice of mail.
The second is to simply include the
consent-code along with the encrypted peice of mail and a legal notice
stating that decryption of the mail constitutes your consent to receive
the mail, as well as your agreement to hold the remailer-operator harmless
should the mail be found to be in some way offensive. Further, the
recipient would agree to be solely liable for the contents of the mail,
etc etc.. I leave the actual agreement to the net.lawyers to figure out.
As far as I can tell an agreement of this form would be at least as valid
as the software licenses ("NOTICE: Opening this envelope constitutes your
agreement to the terms.. blah blah blah") that are commonly used today.
Also would seem to be a similar concept to "Opening the case of this
device void's your warranty" stickers on appliances.
Under this approach persons would receive mail whether they'd consented or
not (unless they requested to be blocked). But it would be difficult for
anyone to raise any serious legal issues about something they havnt read,
and impossible for them to make noise about what they read, after the
implied consent they gave when decrypting.
Under both approaches it would be wise to have a list of addresses who've
already consented, which would contain all of the known remailers..
whether or not an operator chose to have names besides remailers in the
list would be at his/her discretion.

@_date: 1996-05-22 14:13:48
@_author: Ben Holiday 
@_subject: Re: An alternative to remailer shutdowns 
Well, if we've gone that far, why not attach an encrypted copy of the key
to the peice of mail, and eliminate all storage from the r-ops machine? Donno. IANAL. :)
[RANT MODE ON- skip to the next paragraph if you dont like politiks]
Here we are back at step one again. In the end, it would seem that there
isn't much that can be done about the worst forms of abuse, without
filtering mail for content. However, someone pointed out that other
package delivery services have acheived freedom from responsibilty for the
content of the packages they deliver - and I beleive that a part of the
explanation for this lies in the fact that they /do/ make attempts to
limit abuse in-so-far as they are able. Part of limiting the remailers
liability is tied up with legitimizing them as a useful service, and
establishing to the public that we are concerned with abuse. Too many
people beleive that the whole point of a remailer is to facilitate illegal
and abusive communication, and unless that changes we can expect to be
dealt with as criminals at worst, or at best as purposfully negligent.
I'm not certain what the solution is, but I am certain that doing nothing
isnt it...
[RANT MODE OFF--]
One idea that came up a while back was a sort of limited tracking of mail

@_date: 1996-05-22 15:19:19
@_author: Ben Holiday 
@_subject: Re: The Twilight of the Remailers? 
Thanks for the encouraging words. As the mailers drop off, its seeming
more and more likely that my mailer will need to be temporarily offed
also. (I would like to stress temporarily.)
Unfortunately, fewer remailers means that the mailers that are left will
be bearing an exponentially increasing amount of risk, not to mention the
increase in traffic levels overall.
The suggestion of inverting the sense of destination blocking seems the
most feasable on a short term level... and will most likely be the route
that I take for the near future.
The remailer at this account will remain up temporarily, pending further

@_date: 1996-05-27 06:52:45
@_author: Ben Holiday 
@_subject: nCognito is Dead.. 
Well I have been given my notice to terminate the remailers running at
this account. Make a note to remove ncognito from your type2.list, and
those running pingers, please remove nCognito as soon as its convenient.
Below i've quoted verbatim the request to shutdown that I received. PLEASE
note that there is no mention of FBI, NSA, or Co$. :)  The request is the
result of some errors that mix generated while I was makeing changes, that
resulted in the administration at gate.net noticing the remailer. Frankly,
I cant blame them given the current legal climate.
Although I would have liked to continute operating the remailers, I must
admit that I'll sleep better at night now that its gone. BTW: Does anyone know of a few ISP's that accept cash and dont require
verification of your identity? :)

@_date: 1996-05-28 13:47:53
@_author: Ben Holiday 
@_subject: Asendmail For Mix [Testers Needed] 
For the past several days i've been working on a method of concealing the
identity of Remailers..
I've put together a program that acts as a replacement for sendmail with
mixmaster, along with a list of 135 sites on the internet that either do
not add received headers at all, or add headers that don't indicate who
the originator was.
The program is called asendmail and what it does is pick 2 servers from
its list of proxy's (using a modified version of the rnd generator from
Lance Cottrell's reorder package). It then opens an smtp socket with the
first server, sends the second servers name in its introduction, and
procedes to send its mail that way.
I'm not an expert on such things, but a careful look at the resulting mail
has revealed no sign of the originating remailers address. As far as I can
tell the only way to identify the remailer would be by obtaining logs from
the proxy host, if they exist.
Asendmail is being used for all mixmaster mail sent through
ncognito currently.  It would be helpful in debugging if
some people could route a few test messages through the mailer, examine
the headers, verify that mail has arrived, etc. Any and all feedback will
be greatly appreciated.
Assuming that the results of this testing are acceptable, i will make a
beta version of asendmail, and my (ever expanding) proxy list available.
Thanks,

@_date: 1996-05-28 13:11:46
@_author: Ben Holiday 
@_subject: Re: Asendmail For Mix [Testers Needed] 
No, they dont. And yes, it probably is bad netiquette. Unfortunately, the
idea of your friendly neighborhood remailer is dying very quickly. Using
other remailers as out-points is fine in so far as it goes, but someone
eventually must eventually send mail to someone who isnt a remailer.
If we define a remailer as a site that strips identifying headers from
mail and passes it to its destination, then these sites are in fact
remailers. They simply dont advertise themselves as such.
Why is it that hundreds of government and university machines can operate
what amount to anonymous remailers, and no one pays any attention, and yet
cypherpunks are threatened with jail time for what is essentially the same
thing?

@_date: 1996-05-30 14:51:09
@_author: Ben Holiday 
@_subject: Asendmail Status & Politikal Rant 
Well, asendmail has been running for several days now, handling outbound
mix mail from my remailer. It appears to be getting the mail through
reliably, although there are still a few bugs.
After reading through the responses from other cypherpunks and interested
parties, I decided to make a few changes to the software, the largest of
which was support for a separate configuration file of text strings to be
sent in SMTP's initial HELO command. It is possible to add as many lines
as you care to in the list of fake HELO strings, which should satisfy the
need (want?) for randomness in the headering of outbound mail, without
restricting anyone to useing either faked site names, OR real site names.
I'll be working on final preparation of README's and install notes, and
should have a tar.gziped source available by friday at the outside. Once
the initial software is released I'll put together a mail robot to help
with gathering proxy addresses.
I still need test mail to be routed through the mailer! Everything appears
to be OK, but I'd like more chances to see what is happening with mail
that gets resent this way.
On to politiks:
I understand that the entire concpet of this program is a bit
controversial, and I can accept that.  Personnaly I am not certain exactly
how to feel about it.  I suppose that I am not thrilled about the idea of
cloaking the mailer this way, but at the same time I perceive it as an
evil of requirement. I beleive very strongly that remailers SHOULD exist,
whether or not the CoS, or the FBI agree; and I am willing to be a bit
impolite if thats what needs to be. My only hesitation is that I'm afraid
now might be to soon.
At the same time I think it would be unfortunate if it came down to
someone actually going to jail for remailing before people are willing to
do something that may be a bit extreme.
Anyway, someone raised the argument that the problem was political, and
that a technical solution would do more harm than good - maybe you're
right, I can't see the future, But it seems to me that I read somewhere
that "Cypherpunks Write Code". This statement is amazingly profound in its
Anonymous communication on the net depends on the technical solutions
embodied in the current remailing software, and cryptography applications.
If, years ago, the cypherpunks had decided that a publicity campaign,
political lobbying, and apologizing were the right course of action,
anonymous speach on the internet would be virtually non-existant today. If
the cypherpunks decide today that coding is not the answer, where will
free speach on the net be in 5 years? I think it is very naive to beleive
that the world is going to change enough, quickly enough, that remailers
will become accepted, and protected, methods of speaking - no matter how
politically correct we try to be.
Why do we see big business and big government launching a full frontal
assault on the remailers, while the mailing lists continue to operate
without incident? Because the enemy's of free speach recognize where the
true threat to their opression lies. Relying on politics to preserve our rights
is like throwing down your gun and asking the bear to please not eat you.
The powers that be want us to shut up. The programs that we write are the weapons that will defend our right to speak.

@_date: 1996-06-01 11:22:04
@_author: Ben Holiday 
@_subject: Asendmail V0.5beta is available now. 
The beta release of asendmail is now available from:
The compressed archive is about 13k.
Included are the current proxys.conf and a sample fakes.conf file, along
with pretty decent instructions for use with and without mix. I'll be out of town for the next 2 days, so I'll not be responding to
email until monday.
Adios..

@_date: 1996-06-05 05:13:20
@_author: Ben Holiday 
@_subject: Asendmail v0.5beta 
Okay, so i'm an idiot. :)  I ran out the door in such a hurry on friday
that I didn't bother to make the asendmail package globally readable.
Apologies to everyone who tried to get a copy and got a permission denied.
It is now really and truely available from:
Sorry for the hassles.

@_date: 1996-06-05 05:37:56
@_author: Ben Holiday 
@_subject: Electronic Signature Act Of 1996 
(Condensed from AP article)
Florida now recognizes electronic signatures as legal and binding. In
other words - its okay to sign it by modem.
The electronic Signature Act of 1996 passed the Legislature unanimously
and became law Friday. The law does not specify how an electronic document
must be signed, but it probably will mean coding the text and typed
signature so they cannot be changed by anyone other than the writer. California and Utah are the only other states that have laws recognizing
electronic signatures.

@_date: 1996-06-05 09:36:26
@_author: Ben Holiday 
@_subject: Asendmail yet again 
Ok so it isnt really and truely available.  The right URL should have
been: If that still isn't right then im gonna assume that god is giving me a
hint and go shoot myself in the head.

@_date: 1996-06-05 17:06:38
@_author: Ben Holiday 
@_subject: Re: How to explain crypto? 
Im quoting directly from the PGP manual from pgp2.6.2:
"People who work in factoring research say that the workload to
exhaust all the possible 128-bit keys in the IDEA cipher would
roughly equal the factoring workload to crack a 3100-bit RSA key,
which is quite a bit bigger than the 1024-bit RSA key size that most
people use for high security applications..."
If we take phil at his word, I would say that comparing 90bit symetric to
1024bit RSA would be a bit generous to RSA.

@_date: 1996-07-09 10:22:01
@_author: Ben Holiday 
@_subject: Re: Word lists for passphrases 
I'm not sure if anyone actually still cares about getting wordlists, if
not you can delete this now.. :) Someone probably mentioned this anyway,
but just in case.. If you have access to a shell, and to the news spool, you can generate
some quick lists by hopping into the directory of any newsgroup that
interests you and doing:
cat * | tr -cs A-Za-z '\n' | tr A-Z a-z | sort | uniq > my-big-ol-wordlist
With most unixes that will generate an alphabetized list of all the unique
words in your source text, converted to lowercase. I've had some problems
with tr on a few machines, however. Adding a '-c' after 'uniq' will tell
you how many times each word occured (useful for grepping out words that
appear too infrequently, or too frequently) .. Incidentally, if you're running crack against a particular person it might
be useful to check dejanews for posts by the individual, and generate your
wordlists from that, I havn't had occasion to actually try this but it
seems like a good idea.

@_date: 1996-07-23 16:29:20
@_author: Ben Holiday 
@_subject: Distributed DES crack 
I've a few machines around that could be dedicated almost full time to the
task. What are the bandwidth requirements? Specifically, could the
keycracker be run over a 28.8 (with a 486 running linux)?  If so, how many
486's could I get over a single 28.8 (i.e. 28.8 -> multiple 486's daisy
chained with ppp over direct serial connection)?

@_date: 1996-08-27 08:58:42
@_author: Ben Holiday 
@_subject: Microsoft Explorer security hole (fwd) 
On Sun, 25 Aug 1996 13:55:30 -0600 (MDT), Carl Nation
To our Resellers/Customers,
Our sysadmin received this security alert, and we thought we should
pass it along...
------- Forwarded Message
We have discovered a security flaw in the current version (3.0) of
Microsoft's Internet Explorer browser running under Windows 95.  An
attacker could exploit the flaw to run any DOS command on the machine of
an Explorer user who visits the attacker's page.  For example, the
attacker could read, modify, or delete the victim's files, or insert a
virus or backdoor entrance into the victim's machine.  We have verified
our discovery by creating a Web page that deletes a file on the machine of
any Explorer user who visits the page.
The core of the attack is a technique for delivering a document to the
victim's browser while bypassing the security checks that would
normally be applied to the document.  If the document is, for example, a
Microsoft Word template, it could contain a macro that executes any DOS
Normally, before Explorer downloads a dangerous file like a Word
document, it displays a dialog box warning that the file might contain a
virus or other dangerous content, and asking the user whether to abort the
download or to proceed with the download anyway.  This gives the user a
chance to avoid the risk of a malicious document.  However, our technique
allows an attacker to deliver a document without triggering the dialog
Microsoft has been notified and they are working on fixing the
problem. Until a remedy is widely available, we will not disclose further
details about the flaw.
For more information, contact Ed Felten at felten or
Dirk Balfanz and Ed Felten
Dept. of Computer Science, Princeton University
------- End of Forwarded Message
