
@_date: 2017-09-06 17:44:47
@_author: Luca Venturini 
@_subject: [bitcoin-dev] [BIP Proposal] Token Protocol Specification 
Hi everyone,
I would like to propose a standard protocol to manage tokens on top of the Bitcoin blockchain.
The full text is enclosed and can be found here:
Any feedback will be appreciated.
Luca Venturini
This document describes a protocol to manage digital assets (tokens) on top of the bitcoin blockchain. The protocol enables a semantic layer that permits reading the bitcoin transactions as operations related to The protocol allows a new level of plausible deniability, while permitting statefull public auditability on each issued token. It allows both the user and the issuer to deny that an existing bitcoin transaction between the two is actually a token transaction, or a new token issuance. While both the token sender and the token issuer cannot deny to have sent bitcoins, nobody can prove the transaction was related to a digital asset. On top of that, to guarantee plausible deniability, tokens can be issued, sent, and received using any existing bitcoin client software.
There is no need to have a wallet exclusively dedicated to manage the tokens. With a few simple precautions by the user, tokens can be managed using any existing Bitcoin wallet, while it is used for normal bitcoin transactions as well.
Since it is possible to infinitely split a token in parts, there is no definition of the number of decimals of token generated and transferred. The number of tokens is always an integer.
Every operation of the protocol is performed with Bitcoin transactions, without the use of OP_RETURN and without any form of pollution of the blockchain, or of the UTXO set.
The protocol permits atomic buy and sell transactions between tokens and Bitcoin, and between different types of tokens. The only operations that require a coin selection enabled wallet are the split and join special operations and the token offering issuance operations. Those are used to modify the token unit of measure and to receive bitcoins from third parties during a token offering issuance.
This document is licensed under the 2-clause BSD license.
The current protocols that permit to issue tokens based on the bitcoin blockchain (i.e. Counterparty, Omni, Colored Coins, Coinprism, Colu) are The existing solutions usually need dedicated wallets and/or verification nodes. Usually, a "pivot" currency is involved and atomic transactions are not permitted unless they use the pivot currency. Those protocols pollute the blockchain (30% or more) and in some cases they do not accept P2SH scripts. Since the use of a dedicated wallet is required, the users cannot plausibly deny they have got tokens. Plausible deniability on the issuer side is not available either. None of these protocols permits infinite division of the tokens, so usually the number of decimals has to be specified at issuance time. The automatic token offering issuance is not enabled as well.
Let's take an example from the real world, a yacht. We write on the yacht's license that the owner is any person that can show a one dollar bill having the serial number F82119977F. Thus the one dollar bill can be exchanged between owners with extreme simplicity and full plausible deniability. The US government will guarantee that there is no other person having the same dollar bill.
The protocol permits managing a token in the same way. The underlying Bitcoin protocol will guarantee against double spending.
  - Easy of use. Tokens can be managed using any wallet. Even if the wallet has no coin selection feature.
  - Plausible Deniability by the issuer. The issuer can generate a new type of token and nobody analyzing the blockchain will understand that the transaction is issuing a token. Even if a token is known, the issuer can issue other tokens. Since a single output contains a large number of different token types, the issuer is actually generating different types of tokens every time she sends a new Bitcoin transaction to the network.
  - Plausible Deniability by the user (no use of tokens at all, or use of a different token type). A transaction that sends tokens from Alice to Bob is a normal transaction. Nobody can understand that this transaction is moving tokens unless they explicitly know which transaction is the token issuance. In fact a single address contains a large number of token types, and the use of tokens itself can be denied.
  - Accountability. Everybody can see the state of the distribution of a type of token.
  - Tunnel mode (confidentiality by issuer and user versus a third party). Alice can send tokens to Bob and ask him to give the tokens to Charlie, without telling to Bob what is the type of the token given. Alice can disclose this information in the future, if she wants.
  - It is possible to perform open or closed issuances. While an open issuance permits to continue the issuance of tokens in the future, closed issuance guarantees that no other token of the same type will ever be issued.
  - The power to continue the issuance of an open token can be sent to another address, using a transaction. Once the power to continue the issuance is sent to someone, the former issuer cannot issue any more tokens.
  - The power to continue the issuance has the same features of plausible deniability of the possess of a token.
  - Since a token type is uniquely identified by a transaction hash, or, in some cases, by a Bitcoin address, a user can prove to be the issuer by signing a message using the Bitcoin protocol.
  - Future proof. Tokens can move following P2PKH, P2SH, P2SH-P2WPKH outputs or any other type of script
  - Blockchain pollution of the protocol transactions is almost zero. There is no OP_RETURN involved, nor any other type of "fake" addresses that pollute the UTXO database.
  - The protocol is based on the Bitcoin blockchain, but, with small changes, can be considered blockchain agnostic.
  - Atomic transactions between tokens and Bitcoin are possible.
  - Atomic transactions between different types of tokens are possible.
  - Tokens of different types can be held by the same address and by the same output.
  - Tokens can be divided indefintely, thus having any number of decimals.
  - Tokens can be issued automatically on the receiving of bitcoins. This operation performs a token offering issuance (also known as Initial Coin Offering).
Where are the tokens?
The large majority of bitcoin transactions can be semantically seen as token issuances. There are two types of token issuances: closed and opened. A closed token issuance guarantees that no other token of the same type will ever be issued.
Issuance chains
A token can be identified using only the first characters of the Bitcoin address, as alternate name defined above, if the characters are different from every previous Bitcoin address seen in the blockchain. An example is provided below.
Tokens can coexist
After some while, Bob decides to give some shares of the company to his husband Giacomo. He generates a new transaction spending the output of the issuance transaction:
  - 0.03400008 to Giacomo
  - 0.96600004 change generated by Bob's wallet
This transaction gives to Giacomo 8 shares of the company.
Atomic transactions
A transaction that has only one output, or has the first output that is a cut, issues no token. Every other Bitcoin transaction is an issuance of tokens of the type of the transaction.
When a issuance is open, Power of Continuation (POC), will be given to an output that will be spent in a transaction that continues the issuance of the same type of tokens.
As for the protocol behavior, we divide the structure of the sorted outputs of a bitcoin transaction in the following groups. For each group, a description of the behavior of the protocol is provided.
  - a1, ..., an, cut(POC), z1(POC), ... zm(POC), b1, ..., bl, with n>0, m>=0, m+l>0
      * zi are outputs signaling zero. They are optional.
      * This is an open issuance. It generates the number of tokens signaled by the outputs before the cut: a1, ..., an. Every output of that set receives a number of tokens as signaled by the output satoshis'       * The cut output, and every other output zi, signaling zero, that is directly after the cut, receive the POC. This means that the transactions that will spend the POC will be a continuation of this issuance and a continuation of every issuance that gave the POC to the this transaction.
  - cut, b1, ..., bm with m>0 (a cut alone is a case of the fourth type)
      * This is a particular case of the first group, having n=0 and m=0. This transaction *closes the issuance forever*. Every token's chain that ends into this transaction is closed as well.
      * It generates no tokens and there are no other outputs that can continue the issuance in the future.
      * If b1 or b2 have a signal of zero and m>2, this is a token offering issuance transaction. It will be described in a following section.
  - a1, ..., an, c(POC) with n>0
      * This is an open issuance. It generates the number of tokens that are signaled in a1, ..., an. The last output c will not receive tokens.
      * The last output c will receive the POC. A following transaction that spends the output c is an issuance transaction of the same type of       * The fact that c is a cut (or not) does not modify the behavior of the transactions of this group
  - c(POC) (single output, also seen as the previous one, with n=0)
      * This transaction generates no tokens at all.
      * The output c receives the POC. Thus a following transaction that spends the output c is an issuance transaction of the same type of token.
Notes on token issuances
Every bitcoin transaction spends all the tokens' content of the inputs and sends them to the outputs. Some of the outputs receive the number of tokens exactly stated in the last five digits of the satoshis sent (the signal), in a way similar to an issuance transaction.
A transaction can be seen as having one of the three following shapes (ai means an output that is not a cut, bi and c are outputs that can be   - a1, ..., an, cut, b1, ..., bm, c (transactions with a cut) (n=0 is described here)
      * No output (bi) after a cut receives tokens.
      * Tokens will be assigned to outputs a1, ..., an trying to follow the signal as follows:
          - If there are enough tokens, the tokens signaled by the first output are assigned to that output.
          - If there are still remaining tokens, the tokens are sent to the following output based on the signal.
          - This continues until there is a cut or the tokens signaled by an output are more than the remaining tokens. In these cases:
              * If there is a cut, it receives all the remaining tokens.
              * If there is an output receiving more tokens than the remaining tokens (we define it a "remaining error"), the output receives no token at all. No other output will receive tokens after this and all the remaining tokens will be sent to the last output c (thus, if there is a cut in the transaction, the algorithm "jumps" the cut).
              * If there is a "remaining error" and the transaction is a special transaction as defined in the next section, and the number of tokens in input is exactly the same of the two types (big and small) that are the result of a previous split or join special transaction, the "remaining error" output gets one of the smallest tokens involved. This will be better explained in the following section about "special       * If the first output is a cut, and the transaction is not a special one as defined below in the document, the last output (c) receives all the tokens
  - a1, ..., an, c (ai is not a cut, for every i; c can be a cut)
      * The tokens are assigned to a1, ..., an as described in the previous group.
      * The last output c receives all the remaining tokens. This behavior is not modified by the fact that the last output is a cut.
  - c (single output transaction, also seen as the previous one, with n=0)
      * The output receives all the tokens received from the inputs
Transactions receiving both the POC of an issuance and some tokens of the same issuance

@_date: 2017-09-06 20:32:47
@_author: Luca Venturini 
@_subject: [bitcoin-dev] [BIP Proposal] Token Protocol Specification 
Hi Dan,
thank you for your feedback. Let me clarify that the plausible deniability is a property of the protocol. If this will become a BIP, and will be approved, there will be wallets that will manage tokens. In the meantime, and in the future, it is important that a person with a legacy bitcoin wallet can hold, issue and transfer bitcoins without disclose that there are tokens involved. Tokens are contained in Bitcoin transactions without any modification.
Vanity addresses are on option. They are not mandatory. In situations where plausible deniability is a concern they will, probably, not be used.
Sending to someone 0.23000012 bitcoin is really easy. You don't need any form of math and you are sending exactly 12 tokens from your wallet. Sometimes it is suspect, but sending 0.03423122 in order to send 23122 tokens does not seem suspect to me. The large majority of the transactions have strange numbers like this one.
In the document, when I say "wallet" I mean every single bitcoin wallet that you can use today to hold bitcoins. The base of the plausible deniability is that there is no "special" wallet involved. Maybe there will be special wallets to manage tokens, but they are not mandatory. The consolidation is needed only when using wallets that do not allow coin selection.
The state of the tokens is fully contained in the bitcoin blockchain. There is no need for verification nodes, nor for any other software. Maybe you already issued some tokens using this protocol and I cannot know it. Unless you disclose it.
There is no "special" need to create small outputs. In order to send a transaction containing tokens, you need to send a bitcoin transaction. The bitcoin value will be transfered along with the token value. If you issue tokens with a token offering transactions (aka ICO), the value of the bitcoin transferred to you is exactly the price of the tokens, so there is no "extra" bitcoin value involved.
I'm sorry if the example of the corporation is not clear. The idea was only that Alice receives from the shareholders the bitcoin value, in order to use that same value to give back the tokens. There is no interest. As I wrote, people got equity for "time, money, furniture, knowledge". I could simply write that Alice sends small outputs without receiving the underlying bitcoin value beforehand.
I agree that memorable names are great to social scalability. This is why you can use a vanity address or only the first part of the vanity address to identify a token type.

@_date: 2017-09-06 21:25:16
@_author: Luca Venturini 
@_subject: [bitcoin-dev] [BIP Proposal] Token Protocol Specification 
Hi Luke,
thanks for your feedback.
I can try to coordinate with the OpenAssets group, but the base requirements are completely different. For example, they are very far from any form of plausible deniability.
Please tell me which problems are not solved technically, so that I can try to fix the differences between the claims and the technical part, if
