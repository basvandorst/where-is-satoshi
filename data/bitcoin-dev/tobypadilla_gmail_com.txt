
@_date: 2015-12-07 18:10:22
@_author: Toby Padilla 
@_subject: [bitcoin-dev] Key.run: BIP-70 Payments and OP_RETURN 
Hi all. I've been working on a new publication platform based on Bitcoin
called key.run: The high level overview is that key.run stores BitTorrent info hashes
(magnet links) in the blockchain by sending transactions to a "namespace"
Bitcoin address. Using SPV, I reconstitute the key.run db from the
blockchain. This is meant to be an open source and distributed system so
anyone can run the key.run server (and change namespace keys). More info
here: Now to my issue...
One of the main use cases I wanted to support was people using their
*existing* Bitcoin wallet to encode the key.run transactions on the
blockchain. Practically speaking this meant building the transactions with
the proper OP_RETURN value server-side then passing them to the end user's
wallet via BIP-70. I have this working with Bitcoin Core (there are issues
with other wallets I've tested with BIP-70).
The problem I'm having is that Bitcoin Core will not allow BIP-70
PaymentDetails to contain outputs with zero value. As stated in
"if there are more than one; Outputs with zero amounts shall be ignored"
Bitcoin Core doesn't seem to ignore the output though, it rejects the
transaction and doesn't allow the user to submit it. The key.run
transactions currently work by giving the OP_RETURN outputs a non-zero >
dust value. This value is presumably lost forever.
I think ideally OP_RETURN outputs with zero value WOULD be allowed since
they are valid transactions. Allowing OP_RETURN outputs to be constructed
with BIP-70 Payments is also the only way I can think of to extend the
functionality of existing wallets.
I would love to get feedback on if there is an alternative way to do what I
propose or ideally if BIP-70 could be tweaked to allow OP_RETURN outputs
with zero value.
I'd also love feedback on key.run but this probably isn't the best venue
for that. I've setup  on Freenode if anyone is interested in
discussing the project.

@_date: 2016-02-02 09:27:58
@_author: Toby Padilla 
@_subject: [bitcoin-dev] [BIP Draft] Allow zero value OP_RETURN in Payment 
My BIP was ultimately accepted, it's number 74
The editor did not agree with it, and I suspect would comment against it
with his new proposed BIP :)
I really appreciated that despite his vehement disagreement, he assigned
the BIP. It seems like the process worked great. There was deep vetting,
lots of back and forth and the editor put aside his personal opinions to
accept the BIP.
That being said...
The mailing list is a problem. I'm still on moderation only. I have no idea
if this message will go through and when it will go through. I totally
understand the desire to keep the conversation level high, but when people
who *are* whitelisted can quickly post multiple heated arguments against
you (publicly) and you can't respond, then that starts to look very
centralized and discouraging.
I would agree with Gavin on the other thread about the proposed BIP
commenting BIP. Putting more decision power behind a moderated mailing list
and wiki doesn't seem like a good idea.
On Tue, Feb 2, 2016 at 9:16 AM, Pieter Wuille

@_date: 2016-02-02 09:41:35
@_author: Toby Padilla 
@_subject: [bitcoin-dev] [BIP Draft] Allow zero value OP_RETURN in Payment 
Then the moderation is being unevenly applied. Luke commented against my
BIP multiple times right after it was published but it took hours for my
responses to go through and I had to track people down on IRC to ask about

@_date: 2016-02-02 11:22:10
@_author: Toby Padilla 
@_subject: [bitcoin-dev] [BIP Draft] Allow zero value OP_RETURN in Payment 
I think it would be helpful to clarify this in the list documentation.
Right now there's a bunch of conflicting information.
 states:
"*Greylisting Notice*
Your first post to this list may be delayed by 5+ minutes due to Greylisting
. Subsequent posts should go
through without delay."
"Everyone starts moderated, and the mod bit gets cleared as they post. It
gets set again if someone notices or reports a violation."

@_date: 2016-01-25 17:02:44
@_author: Toby Padilla 
@_subject: [bitcoin-dev] [BIP Draft] Allow zero value OP_RETURN in Payment 
Hi all,
I'm submitting a new BIP draft for consideration and discussion. I've put a
pull request up on Github that implements this BIP (with discussion from
the Core team):
My original discussion of this issue:
BIP draft as follows...
Title: Allow zero value OP_RETURN in Payment Protocol
Author: Toby Padilla  Abstract
This BIP alters the Payment Protocol to allow for zero value OP_RETURN
outputs in serialized PaymentRequests.
 Motivation
The Payment Protocol (defined in BIP70) gives merchants a way to build
sophisticated transactions by serializing one or more outputs in the form
of a PaymentRequest. The PaymentRequest is then served over http/https to a
customer's wallet where the serialized transaction can be executed.
While the Payment Protocol allows for any valid script in its outputs, it
also ignores outputs with zero value. This means BIP70 implementations can
encode an OP_RETURN script but must provide a greater than dust value for
that output. The end result is a successful PaymentRequest transaction with
an OP_RETURN but the value assigned to that output is lost forever.
This BIP allows for zero value OP_RETURN outputs in serialized
PaymentRequests. The change means that OP_RETURN scripts will work as they
were originally intended from within PaymentRequests without permanently
destroying Bitcoin value. Zero value non-OP_RETURN scripts should continue
to be ignored and positive value OP_RETURN outputs should now be rejected.
In addition to fixing the issue of destroyed value, this change opens up
new use cases that were previously impossible.
While storing data on the blockchain is controversial, when used
responsibly OP_RETURN provides a powerful mechanism for attaching metadata
to a transaction. This BIP effectively decouples the creation of
transactions containing OP_RETURN data from the execution of those
transactions. The result are positive benefits for both merchants and
By supporting this BIP, wallets can participate in current and future,
unforeseen use cases that benefit from metadata stored in OP_RETURN. Until
now OP_RETURN transactions have typically been created and submitted by
custom software. If a wallet can process a PaymentRequest with OP_RETURN
data as proposed by this BIP, it will support potentially sophisticated
Bitcoin applications without the wallet developer having to have prior
knowledge of that application.
An example might be a merchant that adds the hash of a plain text invoice
to the checkout transaction. The merchant could construct the
PaymentRequest with the invoice hash in an OP_RETURN and pass it to the
customer's wallet. The wallet could then submit the transaction, including
the invoice hash from the PaymentRequest. The wallet will have encoded a
proof of purchase to the blockchain without the wallet developer having to
coordinate with the merchant software or add features beyond this BIP.
Merchants and Bitcoin application developers benefit from this BIP because
they can now construct transactions that include OP_RETURN data in a
keyless environment. Again, prior to this BIP, transactions that used
OP_RETURN (with zero value) needed to be constructed and executed in the
same software. By separating the two concerns, this BIP allows merchant
software to create transactions with OP_RETURN metadata on a server without
storing public or private Bitcoin keys. This greatly enhances security
where OP_RETURN applications currently need access to a private key to sign
 Specification
The specification for this BIP is straightforward. BIP70 should be fully
implemented with two changes:
1. Outputs where the script is an OP_RETURN and the value is zero should be
accepted by the wallet.
2. Outputs where the script is an OP_RETURN and the value is greater than
zero should be rejected.
This is a change from the BIP70 requirement that all zero value outputs be
 Rationale
As with the discussion around vanilla OP_RETURN, the practice of storing
data on the blockchain is controversial. While blockchain and network bloat
is an undeniable issue, the benefits that come from attaching metadata to
transactions has proven to be too powerful to dismiss entirely. In the
absence of OP_RETURN support the Bitcoin ecosystem has seen alternative,
less elegant and more wasteful methods employed for Blockchain data storage.
As it exists today, BIP70 allows for OP_RETURN data storage at the expense
of permanently destroyed Bitcoin. Even fully removing support for OP_RETURN
values in the Payment Protocol would still leave the door open to
suboptimal data encoding via burning a larger than dust value to an output
with a false address designed to encode data.
This BIP offers all of the same benefits that come from the OP_RETURN
compromise. Mainly that OP_RETURN scripts are provably unspendable and thus
can be pruned from the UTXO pool. Without supporting this BIP, wallets that
support BIP70 will allow for wasteful data storage.
 Compatibility
While not in widespread use, existing BIP70 PaymentRequest outputs that
have a greater than zero value with an OP_RETURN script (burning Bitcoin)
will need to have their values changed to zero or they will be rejected by
wallets implementing this BIP.

@_date: 2016-01-25 18:54:16
@_author: Toby Padilla 
@_subject: [bitcoin-dev] [BIP Draft] Allow zero value OP_RETURN in Payment 
It looks like my draft hasn't been approved by the mailing list so if
anyone would like to read it it's also on Gist:
Luke - As stated in the Github thread, I totally understand where you're
coming from but the fact is people *will* encode data on the blockchain
using worse methods. For all of the reasons that OP_RETURN was a good idea
in the first place, it's a good idea to support it in PaymentRequests.
As for keyless - there's no way (that I know of) to construct a transaction
with a zero value OP_RETURN in an environment without keys since the
Payment Protocol is what defines the method for getting a transaction from
a server to a wallet. You can make a custom transaction and execute it in
the same application but without Payments there's no way to move
transactions between two applications. You need to build the transaction
where you execute it and thus need a key.

@_date: 2016-01-25 19:01:13
@_author: Toby Padilla 
@_subject: [bitcoin-dev] [BIP Draft] Allow zero value OP_RETURN in Payment 
As they exist today PaymentRequests allow for essentially the same types of
transactions as non-PaymentRequest based transactions with the limitation
that OP_RETURN values must be greater. In that sense they're basically a
pre-OP_RETURN environment. OP_RETURN serves a purpose and it can't be used
with PaymentRequest transactions.
I think if you think through how you would create an OP_RETURN transaction
today without this BIP you'll see you need a key at some point if you want
a zero value.

@_date: 2016-01-25 19:07:40
@_author: Toby Padilla 
@_subject: [bitcoin-dev] [BIP Draft] Allow zero value OP_RETURN in Payment 
changing that. It is better that coins are burned.
I think this is our fundamental disagreement. People will burn coins to
encode data, why allow this when there's a better alternative?
Correct, but with BIP70 that key is in the user's wallet and you can
construct transactions on another machine (thus not needing a key during
construction). Right now there's no way to do the transaction construction
on another machine with zero value OP_RETURNs.

@_date: 2016-01-25 19:30:38
@_author: Toby Padilla 
@_subject: [bitcoin-dev] [BIP Draft] Allow zero value OP_RETURN in Payment 
There are already valid use cases for OP_RETURN, it only makes sense to
fully support the feature. The only reason it's not supported now is
because the Payments protocol came before OP_RETURN.
I give one example use case in the BIP. I agree that special wallet support
would make the feature even better, but if someone tried to use Core the
transaction would at least not be rejected.
I've also been exploring this area with key.run (
 and want the functionality for voting
based on aggregate OP_RETURN value. *Not* to store data on the blockchain,
but to associate content pointers with transactions.
I think that since OP_RETURN has already been approved and supported it
doesn't make much sense for me to have to re-defend it from scratch here.

@_date: 2016-01-26 09:41:01
@_author: Toby Padilla 
@_subject: [bitcoin-dev] [BIP Draft] Allow zero value OP_RETURN in Payment 
The wording is a little strange and I think it *should* work as you state,
but Bitcoin Core will actually reject any output that has zero value (even
a single OP_RETURN output -- I just tested again to make sure).
Here's the blocking code:
I agree that this should be made more clear in my BIP though, I'll clean up
the language.
On Tue, Jan 26, 2016 at 6:37 AM, Andreas Schildbach via bitcoin-dev <

@_date: 2016-01-25 19:17:12
@_author: Toby Padilla 
@_subject: [bitcoin-dev] [BIP Draft] Allow zero value OP_RETURN in Payment 
I don't think every application of OP_RETURN could be classified as "spam".
I also don't think burning the value is going to dissuade anyone from going
down that route. I don't think lost value is better for anyone.

@_date: 2016-01-26 09:44:48
@_author: Toby Padilla 
@_subject: [bitcoin-dev] [BIP Draft] Allow zero value OP_RETURN in Payment 
OP_RETURN was not part of isStandard? from day one. Once it was supported
by Core it became necessary to actually support it, not try to support it
in one part of the software and not in others. The whole reason it was
supported is because without it people will use more heinous methods to
encode data on the blockchain. There's no way to stop people from doing
that, so this compromise seemed best for everyone.
I think we should actually define "spam". To me a valid transaction someone
willing pays for is never spam. Also PaymentRequests would be a very
inefficient way to spam. It would be much easier to write a script to
automatically create and submit transactions yourself. With PaymentRequests
 customers have to initiate the transaction and submit/pay for it one by
What is actually the worst case scenario that those opposed to this are
concerned about? That this takes off like wild fire and all of the sudden
millions of people are using PaymentRequests and creating small
transactions? That seems like a win for Bitcoin. It will help spread
support for the Payment protocol and IF it becomes a problem it's because
so many people are using it. In which case there's a very valid use case
for Bitcoin that people are obviously excited about.
I really don't like the idea of policing other people's use of the
protocol. If a transaction pays its fee and has a greater than dust value,
it makes no sense to object to it.
On Tue, Jan 26, 2016 at 8:19 AM, Thomas Kerin via bitcoin-dev <
