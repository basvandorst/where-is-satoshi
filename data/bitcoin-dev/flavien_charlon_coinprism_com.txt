
@_date: 2014-04-06 21:59:34
@_author: Flavien Charlon 
@_subject: [Bitcoin-development] Feedback request: colored coins protocol 
I am the lead developer of Coinprism , the new
colored coins web wallet. After some discussions with the other people
involved with colored coins, I wrote a specification document describing
the colored coins protocol that we are using in coinprism.
I am looking for feedback/discussions regarding the protocol before we move
from TestNet to MainNet. The document is here:
The colored coin protocol is layered on top of the existing Bitcoin
protocol and requires no modification of the existing protocol, so it can
be used today. This means that SPV is not as efficient, as the client needs
to backtrack up to the issuing transaction to find the color of an output,
but that is something we can live with.
The protocol marks transactions either as issuance or transfer transactions
by using an OP_RETURN output with a 9 bytes marker. The protocol uses the
value of an output as the colored value. So if an output has 1 BTC and is
colored with color A, that means we have 1 BTC colored with color A.
An alternative would have been to completely disconnect the colored value
and the real BTC value. The colored value of each output would be encoded
in an OP_RETURN output. Someone who wants to send 1000 colored coins would
craft a transaction with an output with the smallest possible amount of BTC
(5,400 satoshis) and indicate in the OP_RETURN that they are sending 1000
colored coins.
The two reasons why we haven't chosen that approach is that first, this
only works with a limited number of outputs given that we have only 40
bytes. And second, this could lead to people spamming the network with very
small outputs (but containing an arbitrary number of colored coins).
On the other hand, with the approach we're using (colored value = actual
value of the output), the 5,400 satoshis rule means that the smallest unit
of colored coin you can send is 5,400 satoshis.
If you want to issue 1 million shares, while still being able to trade each
share individually, you'd have to set 1 share = 5,400 satoshis, and you
would need a capital of 54 BTC for issuing a million shares. It's not a big
problem in itself, but still a slight inconvenience.
Do you think this is the right approach?
Feel free to reply with any feedback regarding the protocol.

@_date: 2014-04-07 10:49:55
@_author: Flavien Charlon 
@_subject: [Bitcoin-development] Feedback request: colored coins protocol 
Thanks for the feedback Mark.
it is not validated
Sure, there is a good reason to include it in the blockchain: so that
clients don't need external information to recognize colored coins. Also,
I'm not sure what you mean by "not validated", in that proposal, the tagged
transaction is the authoritative source of information.
9 bytes is much less than what Mastercoin and counterparty are doing
(certainly under the 40 bytes allowed).
Yes I have seen it and find the padding quite clumsy and unintuitive. A
more general solution is the one I described in my original post, where the
color value is entirely separate from the satoshi value, and encoded
separately: if you have to have an additional "padding" value to calculate
color_value = satoshi_value - padding, you might as well have color_value
directly, independently from satoshi_value. But I don't even think it is
An easy workaround is to have various scales, the same way you have $1
bills, $5 bills an $10 bills. I don't see that as a big problem. That way
the protocol is more lightweight and simple.
Also those 54 BTC (actually 5.4 BTC if the dust is now 540 satoshis) become
part of the capital of the company, and can always be recovered by
uncoloring the shares. It's an investment, not an expense, so I think it is

@_date: 2014-04-07 15:00:20
@_author: Flavien Charlon 
@_subject: [Bitcoin-development] Feedback request: colored coins protocol 
Jorge, they'd have to be. Otherwise, assuming the price of the share goes
low enough, you could buy a share of the company, melt the gold plate, and
sell it for a profit. If the gold is part of the capital of the company,
the cheapest a share can be is the price of the gold on which the stock
certificate is printed.
This is why I think the importance of padding with colored coins is

@_date: 2014-04-07 16:19:20
@_author: Flavien Charlon 
@_subject: [Bitcoin-development] Feedback request: colored coins protocol 
Ok, I guess I'm not using the proper terminology. It would be listed on the
"Asset" section of the company's balance sheet, is what I meant.

@_date: 2014-04-07 20:26:07
@_author: Flavien Charlon 
@_subject: [Bitcoin-development] Feedback request: colored coins protocol 
An IOU written in a gold plate sure makes no sense. I see what you are
saying, the inconvenience comes from the fact that the buyer has to buy
some amount of BTC at the same time as he buys a share.
That's why I was making the point that you could have a colored coin
representing a single share, a different colored coin representing 10
shares, and another one representing 100 shares (like the different
denominations of dollar bills). Assuming you have a proper application
layer/UI that can hide this from the user, the need for padding is greatly
reduced. My opinion is that the protocol should do the minimum required and
remain as simple as possible. If a proper UI can work around this, then it
might not be worth complicating the protocol for this. Also, the dust rule
may disappear all together one day (it's already been slashed heavily to
540 satoshis), at which point we'll be left with a useless padding
parameter. It's easier to add something when you need it than to remove it.
But I am posting here to see how people feel about this, and I see you are
on the opinion that satoshi_value and color_value should have a degree of
freedom between each other. Thanks for the feedback.

@_date: 2014-04-11 13:51:10
@_author: Flavien Charlon 
@_subject: [Bitcoin-development] Feedback request: colored coins protocol 
I have updated the
significant problem for some kinds of applications.
This is correct, the number of colored outputs you can have per transaction
is limited by OP_RETURN's 40 bytes. We use a compact format
for the asset quantity of each output to mitigate that. Assuming you're
transferring small amounts of colored coins, you could have up to about 30
colored ouputs.
It should work for a decentralized exchange (you only really need 2 or 3
colored outputs). Applications like sending dividends in colored coins
however may require splitting into several smaller transactions, but I
believe that's an acceptable limitation.

@_date: 2014-08-05 18:02:38
@_author: Flavien Charlon 
@_subject: [Bitcoin-development] deterministic transaction expiration 
current block height onto the operand stack. Then you could implement
arbitrary logic about which blocks the transaction can be valid in. This
would require that the client revalidate all transactions in its mempool
(really, only those making use of this opcode) whenever the chain tip
I have to say I like this idea, this would allow someone to prove they
can't spend funds before a given date, and vice versa, prove that the funds
can't ever be spent after a given date (and this is provably prunable,
isn't it?). Of course, there are some risks associated with that, but
nobody is forced to use it.
This becomes increasingly expensive as the deadline is further away, so not
very hard to mitigate.

@_date: 2014-05-03 19:04:52
@_author: Flavien Charlon 
@_subject: [Bitcoin-development] Bug with handing of OP_RETURN? 
Can someone enlighten me on why the following transaction is being rejected
by Bitcoind 0.9.1 with error code -22 on Mainnet.
Debug.log shows the following:
ERROR: AcceptToMemoryPool : nonstandard transaction: scriptpubkey
Here is the decoded transaction:
Outputs are above dust, inputs are not spent. OP_RETURN is supposed to be
standard in 0.9.1 and the data is well below 40 bytes, so why is this being

@_date: 2014-05-04 11:05:36
@_author: Flavien Charlon 
@_subject: [Bitcoin-development] Bug with handing of OP_RETURN? 
Thanks, that makes sense, just wanted to make sure this what the problem

@_date: 2014-11-16 16:21:27
@_author: Flavien Charlon 
@_subject: [Bitcoin-development] Increasing the OP_RETURN maximum payload size 
The data that can be embedded as part of an OP_RETURN output is currently
limited to 40 bytes. It was initially supposed to be 80 bytes, but got
reduced to 40 before the 0.9 release to err on the side of caution.
After 9 months, it seems OP_RETURN did not lead to a blockchain
catastrophe, so I think it might be time to discuss increasing the limit.
There are a number of proposals:
   1. Allow two OP_RETURN outputs per transaction (PR
   )
   2. Increase the default maximum payload size from 40 bytes to 80 bytes (
   PR )
   Note that the maximum can be configured already through the
   'datacarriersize' option - this is just changing the default.
   3. Make the maximum OP_RETURN payload size proportional to the number of
   outputs of the transaction
   4. A combination of the above
3 sounds the most interesting, and 2 would be the second best.
1 is also good to have as long as the "space budget" is shared between the
two outputs.
Can we discuss this and agree on a plan?

@_date: 2014-11-17 11:43:38
@_author: Flavien Charlon 
@_subject: [Bitcoin-development] Increasing the OP_RETURN maximum payload 
use the blockchain as a convenient transport channel
The number one user of the blockchain as a storage and transport mechanism
is Counterparty, and limiting OP_RETURN to 40 bytes didn't prevent them
from doing so. In fact they use multi-sig outputs which is worse than
OP_RETURN since it's not always prunable, and yet let them store much more
than 40 bytes.
For Open Assets , we
need to store a URL in the OP_RETURN output (with optionally a hash) plus
some bytes of overhead. 40 bytes comes really short for that. The benefit
of having a URL in there is that any storage mechanism can be used (Web,
FTP, BitTorrent, MaidSafe...), whereas with only a hash, you have to
hardcode the storing mechanism in the protocol (and even then, a hash is
not enough to address a HTTP or FTP resource). Storing only a hash is fine
for the most basic timestamping application, but it's hardly enough to
build something interesting.
I've counted the number of OP_RETURN outputs in the blockchain for the
month of October 2014. There were 1,674 OP_RETURNs for a span of 4,659
blocks. Assuming they were all 40 bytes (the average is probably less than
half of that), that means an increase of 14.37 bytes per block. Considering
a 1 MB block, that's about 0.0013% of the block used up by OP_RETURN data
in average.
Increasing to 80 bytes will have a negligible impact on bandwidth and
storage requirements, while being extremely useful for many use cases where
a hash only is not enough.
On Mon, Nov 17, 2014 at 10:35 AM, Pieter Wuille

@_date: 2014-11-19 00:46:51
@_author: Flavien Charlon 
@_subject: [Bitcoin-development] Increasing the OP_RETURN maximum payload 
Sure, but even if they are not permitted to store their data in OP_RETURN,
they will still store it in the blockchain in bare multisig outputs, so
it's not contributing to an overhead (in fact, it would consume less space
in the blockchain if they used OP_RETURN).

@_date: 2014-11-28 11:45:19
@_author: Flavien Charlon 
@_subject: [Bitcoin-development] BIP 65 and OP_CHECKLOCKTIMEVERIFY 
fungible because they wouldn't be reorg safe.
I'm not sure coins are ever reorg safe. All it takes is a double spend in
the history of your coins for them to become invalid after a reorg. Because
of that, there are already less fungible coins. This is why we recommend 6
confirmations for important payments.

@_date: 2014-10-02 16:05:01
@_author: Flavien Charlon 
@_subject: [Bitcoin-development] [BIP draft] CHECKLOCKTIMEVERIFY - Prevent 
Very good, I like the proposal.
A question I have: can it be used to do the opposite, i.e. build a script
that can only be spent up until block X?

@_date: 2014-10-17 21:36:04
@_author: Flavien Charlon 
@_subject: [Bitcoin-development] About watch-only addresses 
What is the status of watch-only addresses in Bitcoin Core? Is it merged in
master and usable? Is there documentation on how to add a watch-only
address through RPC.
Also, I believe that is going towards the 0.10 release, is there a
rough ETA for a release candidate?

@_date: 2014-10-18 10:44:10
@_author: Flavien Charlon 
@_subject: [Bitcoin-development] About watch-only addresses 
Also, I was wondering if there were nightly builds I could try this from?
On Fri, Oct 17, 2014 at 9:36 PM, Flavien Charlon <
