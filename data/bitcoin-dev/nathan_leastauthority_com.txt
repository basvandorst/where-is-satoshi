
@_date: 2015-07-11 01:05:25
@_author: Nathan Wilcox 
@_subject: [bitcoin-dev] SPV Mining reveals a problematic incentive issue. 
Thesis: The disincentive miners have for verifying transactions is
problematic and weakens the network's robustness against forks.
According to the 2015-07-04 bitcoin.org alert [1]_ so-called "SPV Mining"
has become popular across a large portion of miners, and this enabled the
consensus-violating forks to persist. Peter Todd provides an explanation
of the incentive for SPV Mining over in another thread [2]_.
.. [1] .. [2]
 at lists.linuxfoundation.org/msg00404.html
If there is a cost to verifying transactions in a received block, then
there is an incentive to *not verify transactions*.  However, this is
balanced by the a risk of mining atop an invalid block.
If we imagine all miners verify all transactions, except Charlie the
Cheapskate, then it's in Charlie's interest to forego transaction
verification.  If all miners make a similar wager, then in the extreme,
no miners verify any transactions, and the expected cost of skipping
transaction verification becomes very high.
Unfortunately, it's difficult to measure how many miners are not
validating transactions, since there's no evidence of this until they
mine atop on invalid block. Because of this, I worry that over time,
more and more miners cut this particular corner, to save on costs.
If true, then the network continues to grow more brittle towards the kind
of forking-persistence behavior we saw from the July 4th (and 5th) forks.
This gets weird.  For example, a malicious miner which suspects a large
fraction of miners are neglecting transaction verification may choose to
forego a block reward by throwing an erroneous transaction into their
winning block, then, as all the "SPV Miners" run off along a worthless
chain, they can reap a higher reward rate due to controlling a larger
network capacity fraction on the valid chain.
Can we fix this?
Nathan Wilcox
Least Authoritarian
email: nathan at leastauthority.com
twitter: Standard Disclaimer: I'm behind on dev archives, irc logs, bitcointalk,
the wiki...  if this has been discussed before I appreciate mentions of
that fact.

@_date: 2015-07-11 05:09:16
@_author: Nathan Wilcox 
@_subject: [bitcoin-dev] SPV Mining reveals a problematic incentive issue. 
attack you've described.
The problem is one of individual incentives leading to a systemic problem.
"All X should do..." solutions which are oblivious to individual incentives
don't scale, eg: "If all factories avoid emitting pollution they don't pay
for..." does not work if individual factories save their own costs by
dumping into the environment.  No one wants environmental catastrophe, and
no one wants a blockchain where miners don't validate transactions, but
there may be a systemic problem of incentives.
The bitcoin.org claim that "about half" of miner capacity does SPV Mining,
is consistent with the incentives problem as I described it.  However, I
don't claim the state of mining is certainly due to these incentives and
not other incentives we haven't discussed.  Also, there may be other
incentives that outweigh this issue.
If there's any cost to non-SPV mining, and the chance that an incoming
block contains only valid transactions is very high, isn't there still an
incentive to make this timeout longer and longer?
The average cost to the miner from building on an invalid block is small,
Yes. If it's rare enough, then skipping transaction validation saves more
cost than the expected cost of mining atop an invalid block.  ... but if
everyone follows that logic, the chance is no longer rare.
This is a good point.  If the benefit to skipping verification outweighs
expected transaction costs, then a non-validating miner might also choose
to mine empty blocks with only their coinbase.  (I recall hearing this
occurred somewhat regularly around 2013, but I haven't paid attention since
then.  How common are empty blocks these days?)
This is a benefit of the world where transaction fees approach or surpass
block reward.
SPV-mining is to prevent hashing hardware from having to waste power when
It may be less of a problem if (when?) electricity costs dominate hardware
Oh.  This is a different explanation than Peter Todd's I linked to above,
which claimed it was network latency in receiving transactions.
Could you explain this a bit more?  What is not needed, the hashing
hardware or the power?  How does SPV Mining affect that?
I'll bet there are many individual rationales for SPV-Mining, but
ultimately they come down to dropping a cost based on a bet about other
miners' behavior.

@_date: 2015-06-10 11:37:59
@_author: Nathan Wilcox 
@_subject: [Bitcoin-development] Proposal: SPV Fee Discovery mechanism 
[I'm currently wading through bitcoin-development. I'm still about a month
behind, so I apologize in advance for any noisy redundancy in this post.]
While reading about blocksize, I've just finished Mike Hearn's blog post
describing expected systemic behavior as actual blocks approach the current
limit (with or without non-protocol-changing implementation improvements):
One detail Mike uses to argue against the "fee's will save us" line of
reasoning is that wallets have no good way to learn fee information.
So, here's a proposal to fix that: put fee and (and perhaps block size,
UTXO, etc...) statistics into the locally-verifiable data available to SPV
clients (ie: block headers).
It's easy to imagine a hard fork that places details like per-block total
fees, transaction count, fee variance, UTXO delta, etc... in a each block
header. This would allow SPV clients to rely on this data with the same
PoW-backed assurances as all other header data.
This mechanism seems valuable regardless of the outcome of blocksize
debate. So long as fees are interesting or important, SPV clients should
know about them. (Same for other stats such as UTXO count.)
Upgrading the protocol without a hard-fork may be possible and is left as
an exercise for the reader. ;-)

@_date: 2015-06-10 14:00:27
@_author: Nathan Wilcox 
@_subject: [Bitcoin-development] Proposal: SPV Fee Discovery mechanism 
Sounds plausible, except SPV protocols would need to include this coinbase
txn if it's going to help SPV clients. (Until a softfork is activated, SPV
clients should not rely on this encoding, since until that time the results
can be fabricated by individual miners.)
Hm, when you mention Sybil attack, I don't quite follow.
When a client relies on any report of a mempool [*], this is already
outside the realm of locally-verifiable SPV information, so they are
already susceptible to the service making false claims. If that's
acceptable (and in many cases it may be) then this whole mechanism is moot,
because the client can ask the service for fee statistics for past blocks.
This is interesting for me, because I had previously believed fees were
fairly static presently, and also because I like hearing about real life
wallet implementations.
So if this "SPV Fee Stats" feature were added, a wallet might rely on an
API for timely stats (aka "block height < 1") then verify that the API
isn't lying after doing SPV verification of fee stats for confirmed blocks.
This is also the kind of thing being done for exchange rate data which is
That makes sense, although there's no SPV equivalent for exchange data.
Aaron Voisine

@_date: 2015-06-11 12:18:50
@_author: Nathan Wilcox 
@_subject: [Bitcoin-development] Proposal: SPV Fee Discovery mechanism 
I haven't looked closely at replace-by-fee yet, but I assume this is a
non-consensus change to mempool mechanics. To me, this seems like the
"actuator" side of fee mechanics: it provides a transaction sender a way to
influence the system.  By contrast, learning about fees is the "sensor"
side of fee mechanics.
Consider how a replace-by-fee wallet makes fee decisions. When does it
replace by fee?  It needs feedback in one of two forms:
a. Direct feedback from a trnasaction relay service, or:
b. Information in the blockchain, which is verified by all verifying nodes
and refined by all miners.
The first kind of information is quite acceptable and practical for many
use cases, but leave the wallet vulnerable to fabrications by that service.
This vulnerability is precisely what SPV security intends to mitigate,
With only information type a, a (non-SPV) wallet can "shop around" to find
competing services, and this should work pretty well, provided the wallet
can discover those competing services. If, OTOH, the wallet has access to
information type b, it now has "perfect competition" across all such
services, even when it can't discover the low-priced services directly.
This actual-fees-in-the-actual-block-chain information of type b seem like
a powerful source of pricing information, and if SPV security is already
valuable for other reasons, then it seems natural to leverage that value.
Re: "dropped in an unpredictable way" - transactions would be dropped

@_date: 2015-06-11 12:30:54
@_author: Nathan Wilcox 
@_subject: [Bitcoin-development] Proposal: SPV Fee Discovery mechanism 
This is a point I hadn't considered carefully before. I don't understand
the marketplace here or why miners would want to move fees outside of
explicit inband fees. Implicit in this proposal is that the statistics only
cover in-band data, because that's the scope of consensus rules, and thus
the proposal is only as useful as the information of in-band fees is useful.
I've also noticed a detracting technical argument given a particular
A Header-PoW-verifying client could still be given all transactions in a
recent block, from which it can see the in-band fees directly.  The
trade-off is the size of those transactions versus the need to alter any
consensus rules or do soft forks.
Notice how this trade-off's costs change with maximum block size.

@_date: 2015-06-13 09:38:56
@_author: Nathan Wilcox 
@_subject: [Bitcoin-development] Proposal: SPV Fee Discovery mechanism 
Excellent point and alternative proposal. You're right: to get the specifi
fees, you'd need all transactions in a block, and all TxOuts with
membership proofs. Your alternative seems like a much leaner trade-off for
similar data.

@_date: 2015-06-22 10:52:19
@_author: Nathan Wilcox 
@_subject: [bitcoin-dev] test post 
attack at dawn.
On Mon, Jun 22, 2015 at 10:46 AM, Richard Winder
