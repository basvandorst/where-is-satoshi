
@_date: 2012-02-28 20:35:05
@_author: Ben Reeves 
@_subject: [Bitcoin-development] Duplicate transactions vulnerability 
I might be wrong but I think perhaps it would help to get this fix out before the p2sh protocol change. Otherwise a miner could combine a duplicate coinbase and an invalid P2SH transaction to create a block which can have excellent network propagation and still be guaranteed to be orphaned. This makes the attack significantly easier to perform.
If someone were to do this on the day of the P2SH switchover they could corrupt the database of all clients < 0.6 with only a single block. If it was done on an early block and was widespread enough it would make it difficult for new clients to find a genuine non-corrupted copy of the blockchain to download.
Thank You,
Ben Reeves

@_date: 2012-02-29 22:05:55
@_author: Ben Reeves 
@_subject: [Bitcoin-development] Duplicate transactions vulnerability 
Assuming 50% of hashing power adopts BIP30 but the actual client
install base is relatively low the patch will likely result in a
"hard" blockchain split if someone takes advantage.
A malicious miner can produce a duplicate coinbase which the majority
of clients will accept but the majority of hashing power won't.
Spending the coinbase output after disconnection will cause the
blockchain to fork. All none BIP30 clients on the short blockchain
will be vulnerable to transaction reversal of 6 confirmations or more.
It is a relatively inexpensive attack to perform (costing the attacker
only one valid block ~$240) and could be quite disruptive. I think
this should be patched in DisconnectBlock() (if it hasn't already?)
before any protocol change - maybe a new mapByCoinbase multimap is
Thank You,
Ben Reeves

@_date: 2012-02-29 23:00:42
@_author: Ben Reeves 
@_subject: [Bitcoin-development] Duplicate transactions vulnerability 
I'm not sure. What if they use a coinbase of a block that has already matured?
On Wed, Feb 29, 2012 at 10:46 PM, Gavin Andresen

@_date: 2012-01-16 15:45:17
@_author: Ben Reeves 
@_subject: [Bitcoin-development] BIP Submission 
Hi everyone,
I wish to submit the following draft BIP for discussion and possible
formal BIP review.
It is a proposed alternative to BIP 16 ("/P2SH/").
Thank you,
Ben Reeves

@_date: 2012-07-09 15:12:03
@_author: Ben Reeves 
@_subject: [Bitcoin-development] Bitcoin Wallet for Android 
Any chance the blockchain.info iphone app could be included on the clients page? The source is available under an lGPL license:  More info:
Also the javascript web front end can be reviewed using a combination of  and  but I could see why that might be more of an issue for the the official site.
Thank You,
Ben Reeves

@_date: 2012-03-01 10:15:01
@_author: Ben Reeves 
@_subject: [Bitcoin-development] Duplicate transactions vulnerability 
Yes you are right. Any fix in DisconnectBlock() has the same potential issues.
I think the exchanges and major merchants need to be made aware that
they must also upgrade. Maybe bundle both BIP16 and BIP30 in 0.6 and
issue an advisory stating that this is a mandatory upgrade for
It also might be prudent to have a blockchain repair script ready,
which checks the db for missing coinbase transactions and downloads
them from another peer or block explorer if necessary.
Thank You,
Ben Reeves

@_date: 2012-03-01 13:09:02
@_author: Ben Reeves 
@_subject: [Bitcoin-development] Duplicate transactions vulnerability 
One more thing to add. The implementation in the reference patch fixes
the blockchain forking issue however by still allowing spent coinbases
to be disconnected patched clients are still vulnerable to blockchain
corruption. While not an immediate issue it would mean
LoadBlockIndex() would error on restart and could cause problems for
new clients during the initial blockchain download.
Is there a reason not to disallow duplicate coinbases entirely?

@_date: 2012-03-01 17:20:41
@_author: Ben Reeves 
@_subject: [Bitcoin-development] Duplicate transactions vulnerability 
If I mine a duplicate coinbase of an old block (whether spent or not)
if that block is then invalidated DisconnectBlock() will erase both
the coinbase of the new block and of the old block. This leaves the
blockchain is in an inconsistent state because with the coinbase
missing the old block will no longer pass CheckBlock().
When affected clients are restarted LoadBlockIndex() will try and
verify all blocks in the main chain, failing at the block with the
missing coinbase.
1) If an attacker was to do this with an early block it would force
all affected clients to redownload the majority of the blockchain.
2) If the attacker was able to do this on a block after the March 1st
deadline (future block A). If they mined a fake copy of block A (block
B) with the same coinbase but a different hash clients who received
block B before block A will refuse to accept block A because of the
unspent duplicate coinbase in block B. The attacker can then fork the
chain at this point despite the real chain being longer.
I am just think out load here so I could be wrong, but maybe it would
be better to go for the full block height fix now?
